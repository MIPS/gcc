Needs upstreaming and checking. It may regress with fusion pass and p5600
