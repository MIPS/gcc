Upstream complete. Reworked as discussed upstream.
