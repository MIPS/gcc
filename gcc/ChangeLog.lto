2008-10-31  Doug Kwan  <dougkwan@google.com>

	* lto-cgraph.c (input_nodE): Fix test so that output_node and
	input_node handle optional fields under the same condition.

2008-10-30  Doug Kwan  <dougkwan@google.com>

	* lto-symtab.c (lto_same_type_p): Handle the case in which both
	array types have NULL TYPE_DOMAIN.
	* lto-function-out.c (copy_function): Copy tree vectors in decl
	states verbatim.

2008-10-30  Diego Novillo  <dnovillo@google.com>

	* collect2.c (maybe_run_lto_and_relink): Fix call to
	putenv.

2008-10-30  Simon Baldwin  <simonb@google.com>

	* collect2.c (maybe_run_lto_and_relink): Set environment variable
	WPA_SAVE_LTRANS=1 if debug.

2008-10-29  Doug Kwan  <dougkwan@google.com>

	* lto-symtab.c (New file): Move from up from lto sub-directory.
	* lto-cgraph.c (lto-tree-in.h): New include
	(input_overwrite_node, input_node, input_edge, input_cgraph_1,
	input_cgraph): Move from back from lto/lto-lang.c to here.
	* lto-tree-in.h (lto_symtab_clear_resolution): New prototype.
	* langhooks.c (lhd_input_cgraph): Remove.
	* langhooks.h (struct lang_hooks_for_lto): Remove INPUT_CRAPH hooks.
	* Makefile.in (PLUGIN_API_H, LTO_TREE_IN_H): New vars.
	(OBJS-common): Include lto-symtab.o
	(lto-cgraph.o): Add LTO_TREE_IN_H in dependency.
	(lto-function-in.o): Ditto.
	(lto-symtab.o): New rule.
	(GTFILES): Add lto-symtab.c
	* langhooks-def.h (lhd_input_cgraph): Remove prototype.
	(LANG_HOOKS_INPUT_GRAPH): Remove macro.
	(LANG_HOOKS_LTO): Remove LANG_HOOKS_INPUT_CGRAPH from initializer.

2008-10-28  Doug Kwan  <dougkwan@google.com>

	* gcc.c (invoke_as): Do not invoke assembler if -fwpa is given
	in command line.

2008-10-24  Cary Coutant  <ccoutant@google.com>

	* lto-section-out.c (lto_record_common_node): For array types,
	record the underlying type.

2008-10-23 Rafael Espindola  <espindola@google.com>

	* ipa-pure-const.c (node_duplication_hook_holder,
	node_removal_hook_holder): Remove.
	(get_function_state, set_function_state): Use DECL_UID.
	(duplicate_node_data, remove_node_data): Remove.
	(generate_summary): Don't use the removed functions. Iterate over
	funct_state_vec and free the states.

2008-10-22  Diego Novillo  <dnovillo@google.com>
	    Rafael Espindola  <espindola@google.com>

	* lto-function-in.c (get_resolution): Handle weak
	definitions.
	(input_function_decl): Tidy.

2008-10-22 Rafael Espindola  <espindola@google.com>

	* passes.c (execute_all_ipa_transforms): New.
	(execute_one_pass): Don't call execute_one_ipa_transform_pass.
	* tree-optimize.c (tree_rest_of_compilation): Call
	execute_all_ipa_transforms.
	* tree-pass.h (execute_all_ipa_transforms): New.

2008-10-22 Rafael Espindola  <espindola@google.com>

	* tree.c (reset_decl_lang_specific): Clear DECL_CONTEXT of inline
	functions.

2008-10-22 Rafael Espindola  <espindola@google.com>

	* Make-lang.in (lto/lto-lang.o): Update dependencies.
	* lto-lang.c: Include lto/common.h and lto-tree-in.h.
	(input_overwrite_node): Don't call cgraph_mark_needed_node.
	(input_node): Just read the node. Don't update it to reflect that
	another node for the same decl might have been read.
	(input_edge): Don't create an edge if the caller has been preempted.
	Make sure the callee is the prevailing decl.
	(input_cgraph_1): Remove nodes corresponding to preempted decls.
	* lto.c (lto_main): Read the cgraph before calling lto_fixup_decls.

2008-10-22 Rafael Espindola  <espindola@google.com>

	* ipa-struct-reorg.c (create_new_alloc_sites): Properly insert the
	newly created statements.

2008-10-22 Rafael Espindola  <espindola@google.com>

	* ipa-pure-const.c (finish_state): Remove.

2008-10-21  Diego Novillo  <dnovillo@google.com>

	* lto-function-in.c (lto_input_function_body): Tidy some formatting.
	* lto-header.h: Likewise.
	* lto-section-in.c: Likewise.
	* lto-stream-debug.c: Likewise.
	* lto-section-out.c: Likewise.

2008-10-21  Diego Novillo  <dnovillo@google.com>

	* lto-section-in.c (lto_debug_in_fun): Guard against empty
	stream debug sections.

2008-10-21 Rafael Espindola  <espindola@google.com>

	* cgraphunit.c (ipa_passes): Use execute_regular_ipa_pass_list.
	* passes.c (execute_ipa_pass_list): Don't run
	execute_ipa_summary_passes.
	(execute_regular_ipa_pass_list): New.

2008-10-21 Rafael Espindola  <espindola@google.com>

	* cgraphunit.c (ipa_passes): call execute_ipa_pass_list on
	all_regular_ipa_passes.
	* passes.c (all_regular_ipa_passes): New.
	(all_ipa_passes): Rename to all_small_ipa_passes.
	(init_optimization_passes): Init all_regular_ipa_passes.
	(ipa_write_summaries,ipa_read_summaries,
	ipa_write_summaries_of_cgraph_node_set): Use all_regular_ipa_passes.
	* tree-pass.h (all_regular_ipa_passes): New.
	(all_ipa_passes): Rename to all_small_ipa_passes.

2008-10-17  Diego Novillo  <dnovillo@google.com>

	* lto-function-in.c (input_imported_decl): New.
	(input_tree_operand): Handle IMPORTED_DECL.
	* lto-function-out.c (output_function_decl): Remove handling
	of DECL_INLINE.
	(output_imported_decl): New.
	(output_tree): Handle IMPORTED_DECL.
	* lto-tags.h (enum LTO_tags): Add LTO_imported_decl.
	* lto-tree-flags.def: Handle IMPORTED_DECL.

2008-10-16  Diego Novillo  <dnovillo@google.com>

	Mainline merge @141167.

	* configure.ac (ACX_PKGVERSION): Update revision merge string.
	* configure: Regenerate.

2008-10-16  Simon Baldwin  <simonb@google.com>

	* langhooks.c: (lhd_print_error_function): Avoid accessing
	TREE_CODE(block) where block is NULL.

2008-10-14  Diego Novillo  <dnovillo@google.com>

	* lto-function-out.c (output_bb): Fix generation of EH
	region numbers when transitioning outside a region.
	* lto-function-in.c (input_var_decl): Do not force
	TREE_STATIC on global symbols.
	Handle TREE_PUBLIC decls even if they have a context.

2008-10-13  Ollie Wild  <aaw@google.com>

	* c.opt (flto): Switch variable name to flag_lto.
	(fwhopr): New option.
	* collect2.c (enum lto_mode_d): Rename LTO_MODE_WPA to LTO_MODE_WHOPR.
	(lto_o_file): Remove.
	(lto_o_files): New variable.
	(collect_exit): Replace lto_o_file with lto_o_files.
	(handler): Replace lto_o_file with lto_o_files.
	(maybe_run_lto_and_relink): Add support for -fwhopr.
	(main): Replace -fwpa with -fwhopr.
	(maybe_unlink_list): New function.
	* gcc.c (gcc_lto_option_t): Remove.
	(lto_single): New variable.
	(LINK_COMMAND_SPEC): Add flto and fwhopr.  Remove link_lto_options.
	(cc1_non_lto_options): Rename as cc1_options.
	(cc1_options): Remove.
	(lto1_options): Remove.
	(link_lto_options): Remove.
	(invoke_lto_single): Replace lto-option with lto-single.  Add -flto.
	Replace lto1_options with cc1_options.
	(static_specs): Remove cc1_non_lto_options, lto1_options, and
	link_lto_options.
	(static_spec_functions): Replace lto-option with lto-single.
	(process_command): Set lto_single.  Remove cases for -flto, -fwpa, and
	-fltrans.
	(lto_option_spec_function): Remove.
	(lto_single_spec_function): New function.
	* c-opts.c (c_common_post_options): Add -flto/-fwhopr validation.
	* flags.h (flag_generate_lto): New variable declaration.
	* toplev.c (flag_generate_lto): New variable definition.

2008-10-10  Diego Novillo  <dnovillo@google.com>

	* opts.c (decode_options): Remove error message about -g
	-flto.

2008-10-10  Doug Kwan  <dougkwan@google.com>

	* toplev.c (announce_function): Use DECL_ASSEMBLER_NAME
	instead of DECL_NAME and lang_hooks.decl_printable_name.

2008-10-09  Diego Novillo  <dnovillo@google.com>

	* lto-function-out.c (output_tree): If EXPR is
	char_type_node and -funsigned-char is used, emit
	unsigned_char_type_node.

2008-10-09  Doug Kwan  <dougkwan@google.com>

	* gimple-low.c (gimple_try_catch_may_fallthru): Check for empty
	clean-up GIMPLE sequence.

2008-10-08 Rafael Espindola  <espindola@google.com>

	* lto-tree-in.h (lto_symtab_get_resolution): New.

2008-10-07 Rafael Espindola  <espindola@google.com>

	* cgraph.h (LTO_cgraph_tags, LCC_NOT_FOUND): Moved from lto-cgraph.c.
	(LTO_cgraph_tag_names): declare.
	* langhooks-def.h (lhd_input_cgraph, LANG_HOOKS_INPUT_CGRAPH): New.
	(LANG_HOOKS_LTO): Add LANG_HOOKS_INPUT_CGRAPH.
	* langhooks.c (lhd_input_cgraph): New.
	* langhooks.h (lang_hooks_for_lto): Add input_cgraph.
	* lto-cgraph.c (LTO_cgraph_tags, LCC_NOT_FOUND, input_overwrite_node,
	input_node, input_edge, input_cgraph_1): Remove.
	(LTO_cgraph_tag_names): Make in non-statitc.
	(input_cgraph): Just call lang_hooks.lto.input_cgraph.

2008-10-06  Diego Novillo  <dnovillo@google.com>

	* gcc.c (cc1_options, lto1_options): Remove -O2 from
	-flto.
	* passes.c (ipa_read_summaries_1): Use the gating
	function to decide if a pass should be executed.
	* lto-section-out.c (gate_lto_out): Return true if
	in_lto_p is set.
	* collect2.c (maybe_run_lto_and_relink): Do not force
	-O2.

2008-10-03 Rafael Espindola  <espindola@google.com>

	* lto-function-in.c (global_vector_fixup) Remove. Remove all calls.

2008-10-02  Ollie Wild  <aaw@google.com>

	* c.opt (flto): Moved from common.opt.  Remove RejectNegative.
	* common.opt (flto): Moved to c.opt.
	(fltrans): Moved to lto/lang.opt.
	(fwpa): Moved to lto/lang.opt.
	* opts.c (common_handle_option): Remove -fltrans and -fwpa validation.

2008-10-02 Rafael Espindola  <espindola@google.com>

	* lto-function-in.c (global_vector_fixup): Removed node argument.
	Use lto_symtab_prevailing_decl. Update all uses.
	* lto-tree-in.h (lto_symtab_merge_var, lto_symtab_merge_fn): Return
	void. Update all uses.
	(lto_symtab_prevailing_decl): New.

2008-09-30  Doug Kwan  <dougkwan@google.com>

	* lto-symtab.c (lto_symbol_overwrite_decl): Check for change in
	exception attribute and remember decl for fix-up.
	(lto_symtab_merge_decl): Remove incorrect code do to a previous
	merge error.  Check for change in exception attribute and
	remember decl for fix-up.

2008-09-30 Rafael Espindola  <espindola@google.com>

	* lto-function-in.c (input_tree): Remove slot argument. Return a tree.
	(input_field_decl, input_function_decl, input_var_decl, input_parm_decl,
	input_result_decl, input_type_decl, input_label_decl,
	input_namespace_decl, input_translation_unit_decl, input_binfo,
	input_type, input_tree_operand): Use new input_tree signature.
	* lto-tree-in.h (input_tree): Update signature.

2008-09-30 Rafael Espindola  <espindola@google.com>

	* lto-function-in.c (get_resolution): Assert the decl is not
	DECL_ABSTRACT.
	(input_function_decl): Don't merge DECL_ABSTRACT function decls.

2008-09-30 Rafael Espindola  <espindola@google.com>

	* lto-function-in.c (vec_tree_ptr, lto_fixups): Remove.
	(global_vector_enter): Remove the need_fixups argument.
	(global_vector_fixup): Just update globals_index and free the old node.
	Do nothing else.
	(input_field_decl, input_const_decl, input_function_decl,
	input_var_decl, input_parm_decl, input_result_decl,
	input_type_decl, input_label_decl, input_namespace_decl,
	input_translation_unit_decl, input_binfo, input_type): Update call to
	global_vector_enter.
	(input_tree_operand): Don't assert on TREE_VISITED.
	(input_tree): Don't assert on TREE_VISITED.

2008-09-29  Doug Kwan  <dougkwan@google.com>

	* lto-function-out.c (output_gimple_stmt): Remove special
	case code for GIMPLE_CHANGE_DYNAMIC_TYPE.  Use the general
	code to handle this gimple code.
	* lto-function-in.c (input_gimple_stmt): Ditto.

2008-09-28  Diego Novillo  <dnovillo@google.com>

	* lto-function-out.c (output_type_ref): Do not call
	LTO_DEBUG_TOKEN.
	(output_type_list): Remove.  Update all callers.
	(get_eh_types_for_runtime): New.
	(output_eh_region): Call it.
	(output_expr_operand): Call output_type_ref when EXPR is
	a type.
	* lto-function-in.c (input_type_ref): Do not call
	LTO_DEBUG_TOKEN.
	(input_eh_region): Call add_type_for_runtime after
	reading type lists.
	Call input_expr_operand to read type lists.
	* except.c (add_type_for_runtime): Declare extern.
	(lookup_type_for_runtime): Likewise.
	* lto/lto-lang.c (lto_eh_runtime_type): New.
	(lto_init_eh): Set lang_eh_runtime_type to lto_eh_runtime_type.

2008-09-26  Doug Kwan  <dougkwan@google.com>

	* lto-wpa-fixup.c (output_wpa_fixup): Check for NULL
	lto_nothrow_fndecls.

2008-09-26  Doug Kwan  <dougkwan@google.com>

	* tree-pass.h (pass_ipa_lto_wpa_fixup): New pass.
	* lto-header.h (enum lto_section_type): Add LTO_section_wpa_fixup.
	(lto_mark_nothrow_fndecl): New prototype.
	(lto_fixup_nothrow_decls): Ditto.
	* lto-wpa-fixup.c: New file.
	* Makefile.in (OBJS-common): Add lto-wpa-fixup.o
	(lto-wpa-fixup.o): New rule.
	* passes.c (init_optimization_passes): Add pass_ipa_lto_wpa_fixup.
	* lto-section-out.c (lto_get_section_name): Handle new enum
	LTO_section_wpa_fixup.

2008-09-26 Rafael Espindola  <espindola@google.com>

	* lto-function-in.c (vec_tree_ptr, lto_fixups): New.
	(global_vector_fixup, input_tree): Use lto_fixups instead of
	DECL_LANG_SPECIFIC.

2008-09-25  Ollie Wild  <aaw@google.com>

	* doc/invoke.texi (fltrans-output-list): Document new option.

2008-09-25  Doug Kwan  <dougkwan@google.com>
	    Ollie Wild  <aaw@google.com>

	* ipa-prop.c (ipa_propagate_indirect_call_infos): Skip if flag_wpa is
	set.

2008-09-24  Doug Kwan  <dougkwan@google.com>

	* lto-cgraph.c (output_edge): Output indirect_call flag.
	(input_overwrite_node): Correct a comment.
	(input_edge): Read indirect_call flag.

2008-09-24  Diego Novillo  <dnovillo@google.com>

	* lto-function-in.c (input_var_decl): Do not abort if
	DEBUG_EXPR is set.

2008-09-24  Diego Novillo  <dnovillo@google.com>

	* collect2.c (enum lto_mode_d): Remove final comma.
	(lto_mode): Change type to enum lto_mode_d.

2008-09-24  Diego Novillo  <dnovillo@google.com>

	* tree.c (reset_type_lang_specific): Clear cached values
	for types replaced with unsigned_char_type_node.

2008-09-24  Doug Kwan  <dougkwan@google.com>

	* lto-function-out.c (output_gimple_stmt): Handle gimple code
	GIMPLE_CHANGE_DYNAMIC_TYPE.
	* lto-function-in.c (input_gimple_stmt): Handle new tag
	LTO_gimple_change_dynamic_type.  Handle gimple code
	GIMPLE_CHANGE_DYNAMIC_TYPE specially.
	* lto-tree-tags.def (LTO_gimple_change_dynamic_type): New tag name.
	Map tag to GIMPLE_CHANGE_DYNAMIC_TYPE.
	* lto-tags.h (enum LTO_tags): New enum LTO_gimple_change_dynamic_type.

2008-09-24  Doug Kwan  <dougkwan@google.com>
	    Ollie Wild  <aaw@google.com>

	* collect2.c (LTO_MODE_NONE, LTO_MODE_LTO, LTO_MODE_WPA): New enums.
	(lto_mode): New variable.
	(maybe_run_lto_and_relink): Handle the -fwpa option.
	(main): Handle the -fwpa option.
	* gcc.c (link_lto_options): Replace -flto with -fwpa.
	* doc/invoke.texi (fwpa): Add reference to -fltrans-driver.
	(fltrans-driver): New option.

2008-09-24 Rafael Espindola  <espindola@google.com>

	* lto-function-in.c (get_resolution): New.
	(input_function_decl): Pass resolution to lto_symtab_merge_var and
	lto_symtab_merge_fn.
	* lto-tree-in.h: Include plugin-api.h.
	(data_in): Add globals_resolution and globals_resolution_size.
	(lto_symtab_merge_var, lto_symtab_merge_fn): Add a resolution argument.

2008-09-24  Diego Novillo  <dnovillo@google.com>

	* tree.c: Include tree-pass.h.
	(reset_type_lang_specific): If flag_signed_char is false,
	make char_type_node a clone of unsigned_char_type_node
	and fix TYPE_MAIN_VARIANTs of types that have
	char_type_node as their main variant.
	(reset_decl_lang_specific): Tidy.
	(free_lang_specifics): Make private.
	Change return type.  Update all users.
	(gate_free_lang_specifics): New.
	(pass_ipa_free_lang_specifics): New.
	* tree.h (free_lang_specifics): Remove.
	* tree-pass.h (pass_ipa_free_lang_specifics): Declare.
	* lto-function-out.c (output_function): Remove stale
	debugging code.
	(lto_output): Do not call free_lang_specifics.
	* opts.c (complain_wrong_lang): Do not complain if
	running lto1.
	* tree-ssa-pre.c (create_expression_by_pieces): Add
	asserts for NEW_SETS (block) and AVAIL_OUT (block).
	* Makefile.in (tree.o): Depend on tree-pass.h
	* passes.c (init_optimization_passes): Schedule
	pass_ipa_free_lang_specifics.
	* lto-section-out.c (lto_get_common_nodes): Tidy comment.

2008-09-24  Simon Baldwin  <simonb@google.com>

	* tree.c (reset_lang_specific): Rename to reset_decl_lang_specific,
	add call to reset_lang_specifics langhook.

2008-09-23  Diego Novillo  <dnovillo@google.com>

	* configure.ac: Add type check for intptr_t.
	* configure: Regenerate.

2008-09-23  Rafael Espindola  <espindola@google.com>

	* lto-section-out.c (write_symbol_vec): Don't write RESULT_DECL to the
	symbol table.

2008-09-23  Diego Novillo  <dnovillo@google.com>

	* lto-cgraph.c (lto_cgraph_encoder_encode): Change REF
	type to intptr_t.
	(lto_cgraph_encoder_lookup): Change return type to intptr_t.
	Update all users.

2008-09-23  Diego Novillo  <dnovillo@google.com>

	* lto-cgraph.c (lto_cgraph_encoder_encode): Change return
	type to void.
	Fix 64-bit issues with REF's type.
	(lto_cgraph_encoder_lookup): Change return type to
	HOST_WIDE_INT.  Update all users.

2008-09-23 Rafael Espindola  <espindola@google.com>

	* lto-section-out.c (write_symbol_vec): Skip non TREE_PUBLIC nodes.

2008-09-22  Doug Kwan  <dougkwan@google.com>

	* cgraphbuild.c (reset_inline_failed): New function.
	* cgraph.c (cgraph_clone_edge): Take an additional parameter STMT_UID.
	(cgraph_clone_node): Adjust call to cgraph_clone_edge.
	(cgraph_clone_input_node): New.
	(struct cgraph_node_set_hash_access_def, cgraph_node_set_hash_access):
	Remove types.
	(hash_cgraph_node_set_element): Adjust to use cgraph_node_set_element.
	type instead of cgraph_node_set_hash_access.
	(eq_cgraph_node_set_element): Ditto.
	(cgraph_node_set_add): Ditto.
	(cgraph_node_set_remove): Ditto.
	(cgraph_node_set_find): Ditto.
	* cgraph.h (struct cgraph_node_set_element_def): Add new field NODE.
	(cgraph_clone_edge): Add new parameter for STMT_UID in prototype.
	(cgraph_clone_input_node, reset_inline_failed): New prototypes.
	* lto-function-out.c (output_function_decl): Fake DECL attributes
	if it is foreced to be static inline.
	* lto-function-in.c (input_function): Go over all clones during
	call-stmt fix-up.
	* cgraphunit.c (verify_cgraph_node): Do not check for CFG if
	running in WPA mode.
	(cgraph_copy_node_for_versioning): Adjust call to cgraph_clone_edge.
	* lto-cgraph.c (struct lto_cgraph_encoder_def): New type.
	(struct lto_cgraph_node_ref): Ditto.
	(lto_cgraph_encoder_new, lto_cgraph_encoder_delete_ref,
	lto_cgraph_encoder_delete, lto_cgraph_encoder_encode,
	lto_cgraph_encoder_lookup, lto_cgraph_encoder_deref,
	lto_cgraph_encoder_size): New functions.
	(output_edge): Add new parameter ENCODER.  Output references to both
	caller and callee of an edge. Also output INLINE_FAILED.
	(output_node): Remove parameter BOUNDARY_P.  Add new parameters
	ENCODER and SET.  Handle boundary nodes and clones specially.
	Output global node states in WPA mode.  Do not output edges.
	(output_cgraph_verify_node):  Handle clones.
	(output_cgraph):  Changle algorithm.  Output all nodes first then
	followed by all edges.  Use an lto_cgraph_encoder to handle node
	pointers.  Remove code to compute set of boundary nodes.
	(input_node): New function.
	(input_edge): New function.
	(input_cgraph_1): Factor out node and edge code input code into
	seperate functions.
	* ipa-inline.c (cgraph_clone_inlined_nodes): Format to fit in 80
	columns.
	(cgraph_decide_recursive_inlining): Ditto.
	(cgraph_decide_inlining): Check for LTRANS mode.
	(inline_generate_summary): Ditto.
	* lto-section-in.c (bitmap.h): New include.
	(lto_section_out_obstack; function_body_in_file_p): New vars.
 	(lto_create_simple_input_block): Return NULL if successful instead of
	SEGV fault.
	(lto_mark_function_body_in_file): New.
	(lto_function_body_in_file_p): Ditto.
	* lto-section-in.h (lto_mark_function_body_in_file): New prototype.
	(lto_function_body_in_file_p): Ditto.
	* tree-inline.c (copy_bb): Adjust call to cgraph_clone_edge.
	* Makefile.in (lto-cgraph.o): Add pointer-set.h to dependencies.
	* passes.c (do_per_function): Do not free dominance information if
	running in WPA mode.
	(ipa_write_summaries): Provide valid static inline states.
	* lto-section-out.c (forced_static_inline, lto_section_out_obstack):
	New vars.
	(lto_new_static_inline_states, lto_delete_static_inline_states,
	lto_force_function_static_inline, lto_force_functions_static_inline,
	lto_forced_static_inline_p): New functions.
	(produce_symtab): Set up and tear down obstack.
	* lto-section-out.h (lto_new_static_inline_states,
	lto_delete_state_inline_states, lto_force_function_static_inline,
	lto_force_functions_static_inline, lto_forced_static_inline_p): New
	prototypes.

2008-09-19  Doug Kwan  <dougkwan@google.com>

	* gcc.c (gcc_lto_option_t): New type.
	(current_lto_option): New variable.
	(lto_single_spec_function): Remove and is replaced by ..
	(lto_option_spec_function): New function.
 	(LINK_COMMAND_SPEC): Use link_lto_option spec instead of just
	passing the -flto flag.
	(cc1_options): Separate non-LTO related parts into ..
	(cc1_non_lto_options): Non-LTO related options shared by all FEs.
	(lto1_options): New spec for lto FE.
	(link_lto_options): New spec for handling LTO flags in linker.
	(invoke_lto_single): Re-format to fit in 80 column.  Replace
	lto-single with lto-option.
	(static_specs): Add cc1_non_lto_options, lto1_options and
	link_lto_options.
	(static_spec_function): Replace lto-single with lto-option.
	(process_command): Handle -flto, -flto-single, -fwpa and -fltran
	by setting current_lto_option and not passing it to subprocess
	unconditionally..
	* ipa-inline.c (cgraph_decide_inlining): Do not remove hook if
	LTO is running in WPA mode.
	* opts.c (common_handle_option): Handle -flto, -fltrans and -fwpa.
	* common.opt: (flto): Reject negative.
	(fltrans): New option.
	(fwpa): Reject negative. Update description.
	* doc/invoke.text (fwpa): Update.
	(fltrans): New flag.

2008-09-18  Rafael Avila de Espindola  <espindola@google.com>

	* lto-function-in.c (flags_length_for_code): Change size to
	NUM_TREE_CODES.
	* lto-function-out.c (expr_to_tag): Change size to
	NUM_TREE_CODES.
	(lto_static_init): Change the size of lto_flags_needed_for and
	lto_types_needed_for to NUM_TREE_CODES.

2008-09-17  Ollie Wild  <aaw@google.com>

	* doc/invoke.text (fwpa): Fix obvious typos.

2008-09-17  Paolo Bonzini  <bonzini@gnu.org>
	    Rafael Avila de Espindola  <espindola@google.com>

	* Makefile.in (TREE_H, s-alltree, c-lang.o): Remove c-common.def
	* c-common.c (c_expand_expr, c_staticp): Remove.
	* c-common.def: Delete.
	* c-common.h (emit_local_var, c_staticp, COMPOUND_LITERAL_EXPR_DECL,
	COMPOUND_LITERAL_EXPR_DECL_EXPR, c_expand_expr): Remove.
	* c-gimplify.c (gimplify_compound_literal_expr,
	optimize_compound_literals_in_ctor): Remove.
	(c_gimplify_expr): Remove COMPOUND_LITERAL_EXPR handling.
	* c-objc-common.h (LANG_HOOKS_EXPAND_EXPR, LANG_HOOKS_STATICP): Remove.
	* c-semantics.c (emit_local_var): Remove.
	* langhooks-def.h (lhd_expand_expr, LANG_HOOKS_EXPAND_EXPR): Remove.
	* langhooks.c (lhd_expand_expr): Remove.
	* langhooks.h (LANG_HOOKS_DEF): Remove LANG_HOOKS_EXPAND_EXPR.
	* expr.c (expand_expr_real_1): Move COMPOUND_LITERAL_EXPR
	handling from c-semantics.c; don't call into langhook.
	(expand_expr_addr_expr_1): Check that we don't get non-GENERIC trees.
	* gimplify.c (gimplify_compound_literal_expr,
	optimize_compound_literals_in_ctor): Move from c-gimplify.c.
	(gimplify_init_constructor): Call optimize_compound_literals_in_ctor.
	(gimplify_modify_expr_rhs, gimplify_expr): Handle COMPOUND_LITERAL_EXPR
	as was done in c-gimplify.c.
	* tree.c (staticp): Move COMPOUND_LITERAL_EXPR handling from c_staticp.
	* tree.h (COMPOUND_LITERAL_EXPR_DECL, COMPOUND_LITERAL_EXPR_DECL_EXPR):
	Move from c-common.h.
	* tree.def (COMPOUND_LITERAL_EXPR): Move from c-common.def.
	* doc/c-tree.texi (Expression nodes): Refer to DECL_EXPRs
	instead of DECL_STMTs.

2008-09-16  Rafael Avila de Espindola  <espindola@google.com>

	Mainline merge @140208.

	* configure.ac (ACX_PKGVERSION): Update revision merge string.
	* configure: Regenerate.

2008-09-16  Diego Novillo  <dnovillo@google.com>

	* tree.c (reset_type_lang_specific): Re-implement
	skipping of unwanted fields in TYPE_FIELDS and
	TYPE_METHODS to avoid corrupting tree chains in
	other types that share these lists.

2008-09-16  Rafael Avila de Espindola  <espindola@google.com>

	* lto-function-in.c (input_const_decl): Pass decl to
	global_vector_enter.

2008-09-12  Diego Novillo  <dnovillo@google.com>

	* lto-tags.h (enum LTO_tags): Add LTO_gimple_predict
	* lto-tree-tags.def: Handle it.
	(CONST_DECL): Add decl_flag2, addressable_flag,
	public_flag, readonly_flag and static_flag.
	(CONSTRUCTOR): Add readonly_flag and volatile_flag.
	* lto-function-in.c (input_gimple_stmt): Handle GIMPLE_PREDICT.
	(input_const_decl): New.
	(input_tree_operand): Call it.
	* lto-function-out.c (output_gimple_stmt): Handle GIMPLE_PREDICT.
	(output_expr_operand): Clarify why CONST_DECLs should not
	show up.
	(output_const_decl): New.
	(output_tree): Call it.

2008-09-12  Bill Maddox  <maddox@google.com>

	* lto-function-in.c (input_var_decl): Enter DECL in the
	global vector even if it's only partially read.

2008-09-11  Diego Novillo  <dnovillo@google.com>

	* lto-function-out.c (output_eh_cleanup): Remove.
	(output_eh_try): Remove.
	(output_eh_catch): Remove.
	(output_eh_allowed): Remove.
	(output_eh_must_not_throw): Remove.
	(output_eh_region): New.
	(output_eh_regions): Call it.
	(output_bb): Emit EH region information for statements.
	* lto-function-in.c: Do not include ctype.h.
	(input_tree, input_type_tree, input_tree_operand): Move
	forward declarations to the top of the file.
	(fixup_eh_region_pointers): New.
	(input_eh_region): New.
	(input_eh_regions): Call them.
	(input_bb): Read EH information for every statement.
	* lto-tree-tags.def (LTO_eh_table_cleanup2,
	LTO_eh_table_cleanup3, LTO_eh_table_try2,
	LTO_eh_table_try3, LTO_eh_table_catch2,
	LTO_eh_table_catch3, LTO_eh_table_allowed2,
	LTO_eh_table_allowed3, LTO_eh_table_must_not_throw2,
	LTO_eh_table_must_not_throw3): Remove.
	(LTO_eh_table_throw0, LTO_eh_table_throw1): Add.
	* lto-tags.h: Likewise.
	* except.c (struct eh_region, struct eh_status): Move ...
	* except.h: ... here.
	(output_eh_cleanup_t, output_eh_try_t, output_eh_catch_t,
	output_eh_allowed_t, output_eh_must_not_throw_t,
	output_eh_records): Remove.
	* Makefile.in (GTFILES): Include except.h before except.c

2008-09-11  Rafael Avila de Espindola  <espindola@google.com>

	* lto-function-out.c (lto_static_init):  Allocate enough space in
	lto_types_needed_for and lto_flags_needed_for.

2008-09-09  Bill Maddox  <maddox@google.com>

	* lto-tags.h (enum LTO_tags): Add new tags LTO_decl_expr and
	LTO_compound_literal_expr.
	* lto-tree-tags.h:  Add MAP_EXPR_TAG and SET_NAME calls for
	new LTO tags.  Cleanup comments.
	* lto-tree-flags.def: Add START_EXPR_CASE/END_EXPR_CASE calls
	for COMPOUND_LITERAL_EXPR.
	* lto-function-out.c (static expr_to_tag): Size array to
	include all tree codes, including front-end specific ones.
	* lto-function-in.c (static flags_length_for_code): Size array
	to include all tree codes, including front-end specific ones.

2008-09-08  Diego Novillo  <dnovillo@google.com>

	* tree-ssa-pre.c (gate_pre): Re-enable.

	Bring from mainline @140111

	2008-09-08  Richard Guenther  <rguenther@suse.de>

		PR tree-optimization/37421
		* tree-ssa-sccvn.c (visit_copy): Make sure to fully
		valueize the RHS.

2008-09-08  Diego Novillo  <dnovillo@google.com>

	* tree-ssa-pre.c (gate_pre): Disable.

2008-09-07  Diego Novillo  <dnovillo@google.com>

	* lto-function-out.c (output_expr_operand) <RESULT_DECL>: Call
	lto_output_var_decl_index.
	(output_result_decl): Do not output DECL_INITIAL.
	* lto-function-in.c (input_expr_operand) <SSA_NAME>: Do
	not call add_referenced_var.
	<VAR_DECL>: Also handle RESULT_DECL.
	<RESULT_DECL>: Remove.
	(input_bb): Call find_referenced_vars_in after reading
	statements and PHI nodes.
	(lto_read_body): Do not add every symbol to referenced
	variables.
	Tidy formatting.
	(input_result_decl): Do not read DECL_INITIAL.
	(input_tree): Tidy formatting.
	* lto-cgraph.c: Tidy formatting.
	* lto-section-in.h: Likewise.
	* tree-dfa.c (find_referenced_vars): Factor calls to
	find_vars_r ...
	(find_referenced_vars_in): ... here.
	* tree-flow.h (find_referenced_vars_in): Declare.
	* passes.c (init_optimization_passes): Move
	pass_ipa_lto_finish_out as the last IPA pass.
	* lto-section-out.c (write_symbol_vec): Handle
	RESULT_DECL.

2008-09-04  Bill Maddox  <maddox@google.com>

	* lto-function-in.c (input_var_decl): Use decl_function_context
	rather than DECL_FILE_SCOPE_P to determine whether a VAR_DECL
	is global.

2008-09-04  Doug Kwan  <dougkwan@google.com>

	* cgraph.c (cgraph_inlined_failed_string): Cast REASON from
	implementation-defined integer type to unsigned before comparison.

2008-09-04  Diego Novillo  <dnovillo@google.com>

	* cgraph.c (cgraph_inlined_failed_string): Fix always
	true comparison.

2008-09-03  Doug Kwan  <dougkwan@google.com>

	* cgraphbuild.c (initialize_inline_failed): Use cgraph_inline_failed_t
	enums instead of reason strings.
	* cgraph.c (cgraph_create_edge): Same.
	(cgraph_inline_failed_string): New function.
	* cgraph.h (cgraph_inline_failed_t): New enum type.
	(cgraph_inline_failed_string): New prototype.
	(struct cgraph_edge): Change type of INLINED_FAILED from constant
	char pointer to cgraph_inline_failed_t.
	(cgraph_inline_p): Adjust prototype to use cgraph_inline_failed_t.
	(cgraph_default_inline_p): Ditto.
	* gcc/cgraphunit.c (cgraph_inline_p): Change type of parameter REASON
	to cgraph_inline_failed_t pointer.
	* cif-code.def: New file.
	* ipa-inline.c (cgraph_mark_inline_edge): Use an enum instead of a
	reason string.
	(cgraph_check_inline_limits): Change type of REASON to pointer to
	cgraph_inline_failed_t.  Replace reason strings with enums.
	(cgraph_default_inline_p): Ditto.
	(cgraph_recursive_inlining_p): Ditto.
	(update_caller_keys): Change type of FAILED_REASON to
	cgraph_inline_failed_t.
	(cgraph_set_inline_failed): Change type of REASON to pointer to
	cgraph_inline_failed_t.  Call cgraph_inline_failed_string to
	convert enums to strings for text output.
	(cgraph_decide_inlining_of_small_function): Change FAILED_REASON
	to be of type cgraph_inline_failed_t.  Replace reason strings with
	enums.  Call cgraph_inline_failed_string to covert enums
	to strings for text output.
	(cgraph_decide_inlining): Replace reason strings with enums.
	(cgraph_decide_inlining_incrementally): Change type of FAILED_REASON
	to cgraph_inline_failed_t type.  Call cgraph_inline_failed_string
	for text output.
	* tree-inline.c (expand_call_inline): Change type of REASON
	to cgraph_inline_failed_t.  Replace reason strings with enums.
	Call cgraph_inline_failed_string for text output.
	* Makefile.in (CGRAPH_H): Add cif-code.def to dependencies.
	(cgraph.o): Ditto.

2008-09-03  Rafael Avila de Espindola  <espindola@google.com>

	* lto-section-out.c (produce_asm_for_decls): Free function_decl_states
	after calling produce_symtab.

2008-09-01  Bill Maddox  <maddox@google.com>

	* lto-cgraph.c (output_node): Stream out 'needed' flag.
	(input_overwrite_node): Stream in 'needed' flag.
	* lto-function-in.c (input_expr_operand, input_tree_operand):
	Remove call to cgraph_mark_needed_node.

2008-08-29  Diego Novillo  <dnovillo@google.com>

	* lto-tree-flags.def: Add readonly_flag for
	FUNCTION_DECLs.

2008-08-28  Diego Novillo  <dnovillo@google.com>

	* cgraph.c (hash_cgraph_node_set_element,
	eq_cgraph_node_set_element, cgraph_node_set_remove): Fix
	type casts for C++ warnings.

2008-08-28  Diego Novillo  <dnovillo@google.com>

	Mainline merge @139194.

	* configure.ac (ACX_PKGVERSION): Update revision merge string.
	* configure: Regenerate.

	* lto-cgraph.c: Tuplify.
	* lto-function-in.c (set_line_info): Tuplify.
	(input_expr_operand): Remove handlers for LABEL_EXPR,
	CALL_EXPR, ASM_EXPR, RETURN_EXPR, GIMPLE_MODIFY_STMT,
	SWITCH_EXPR, OMP_CONTINUE and OMP_RETURN.
	Simplify handling of COND_EXPRs.
	(input_tree_operand): Likewise.
	(MAP_STMT_TAG): Define.
	(input_local_var_decl): Remove #if 0 code.
	(make_new_block): Tuplify.
	(input_phi): Tuplify.
	(input_ssa_names): Tuplify.
	(input_gimple_stmt): New.
	(input_bb): Call it.
	Tuplify.
	(input_function): Tuplify
	(lto_static_init_local):
	* lto-function-out.c (START_CLASS_CASE): Rename argument
	to prevent C++ warnings.
	(END_CLASS_CASE): Likewise.
	(END_EXPR_CASE): Likewise.
	(output_tree_flags): Tuplify.
	(output_record_start): Remove static declaration.
	(output_local_decl_ref): Rename local variable NEW to
	avoid C++ warnings.
	(output_eh_cleanup): Rename argument CATCH to avoid C++
	warnings.
	(output_expr_operand): Rename local variable CLASS to
	avoid C++ warnings.
	Remove handlers for LABEL_EXPR, COND_EXPR, CALL_EXPR,
	RESX_EXPR, RETURN_EXPR, GIMPLIFY_MODIFY_STMT,
	SWITCH_EXPR, OMP_CONTINUE and OMP_RETURN.
	(output_phi): Tuplify.
	(output_gimple_stmt): New.
	(output_bb): Call it.
	Tuplify
	(lto_static_init): Tuplify.
	(MAP_STMT_TAG): New.
	(GIMPLE_CODES): Define.
	(START_CLASS_CASE): Rename argument to avoid C++
	warnings.
	(END_CLASS_CASE): Likewise.
	(END_EXPR_CASE): Likewise.
	(output_tree): Rename local variable CLASS to avoid C++
	warnings.
	Remove handlers for CASE_LABEL_EXPR, COND_EXPR,
	CALL_EXPR, ASM_EXPR, RETURN_EXPR, GIMPLE_MODIFY_STMT,
	SWITCH_EXPR, OMP_CONTINUE and OMP_RETURN.
	* lto-section-in.c: Do not include ctype.h.
	* lto-section-out.c (lto_output_uleb128_stream): Remove
	#if 0 code.
	* lto-tags.h (enum LTO_tags): Add LTO_null,
	LTO_gimple_asm, LTO_gimple_assign, LTO_gimple_call,
	LTO_gimple_cond, LTO_gimple_goto, LTO_gimple_label,
	LTO_gimple_phi, LTO_gimple_return, LTO_gimple_resx and
	LTO_gimple_switch.
	Remove LTO_gimple_modify_stmt, LTO_phi_node, LTO_cond_expr0
	and LTO_cond_expr1.
	Add LTO_cond_expr.
	* gimple.c (gimple_size): Export.  Add handler for
	GIMPLE_PHI.
	(gimple_alloc_stat): Export.
	* gimple.h (gimple_size, gimple_alloc,
	gimple_alloc_stat): Declare.
	(mark_addressable): Declare.
	(gimple_reset_mem_ops): New.

2008-08-27  Doug Kwan  <dougkwan@google.com>

	* cgraph.c (hash_cgraph_node_set_element, eq_cgraph_node_set_element,
	cgraph_node_set_new, cgraph_node_set_add, cgraph_node_set_remove,
	cgraph_node_set_find, dump_cgraph_node_set, debug_cgraph_node_set):
	New functions.
	* cgraph.h (cgraph_node_ptr): New type for vector functions.
	(struct cgraph_node_set_def): New type.
	(cgraph_node_set) New type. Also declare vector functions.
	(struct cgraph_node_set_element_def): New type.
	(cgraph_node_set_element): Ditto.
	(cgraph_node_set_iterator): New iterator type.
	(cgraph_node_set_new, cgraph_node_set_find, cgraph_node_set_add,
	cgraph_node_set_remove, dump_cgraph_node_set,
	debug_cgraph_node_set): New prototypes.
	(csi_end_p, csi_next, csi_node, csi_start, cgraph_node_in_set_p,
	cgraph_node_set_size): New inlines.
	* tree-pass.h (struct cgraph_node_set_def): New decl to avoid
	including cgraph.h.
	(struct ipa_opt_pass): Add a struct cgraph_node_set_def pointer
	type parameter to WRITE_SUMMARY.
	(ipa_write_summaries_of_cgraph_node_set): New prototype.
	* lto-function-out.c (lto-section-in.h): New include.
	(copy_function): New function.
	(lto_output): Add new parameter for set of nodes written.
	* ipa-reference.c (write_node_summary_p): New function from
	refactoring.
	(write_summary): Add new parameter for set of nodes written. Also
	replace repeated code with calls to write_node_summary_p.
	* lto-cgraph.c (output_edge): Do not look at CALL_STMT of EDGE in
	WPA mode.
	(output_node): Add new parameter BOUNDARY_P. Fake availability and
	omit out-going edges for when BOUNDARY_P is set.
	(output_cgraph_verify_node): New function factored from...
	(output_cgraph): Use it.  Also add a new parameter SET.  Compute
	the boundary of SET and output boundary nodes specially.
	* ipa-pure-const.c (write_summary): Add parameter for set of nodes
	written.
	* ipa-inline.c (cgraph_default_inline_p): Do not check for CFG of
	functions in WPA mode.
	* common.opt (flag_wpa): New flag.
	* Makefile.in (lto-function-out.o): Add variable LTO_SECTION_IN_H
	to dependencies.
	* passes.c (ipa_write_summaries_1): Add new parameter SET and pass
	it to IPA passes.
	(ipa_write_summaries): Create a new set for the whole call-graph
	and pass it to ipa_write_summaries_1.
	(ipa_write_summaries_of_cgraph_node_set): New function.
	* lto-section-out.c (lto_get_out_decl_state): Add comments.
	(produce_asm_for_decls): Add new parameter SET.
	* doc/invoke.texi (fwpa): Document new option.

2008-08-26  Bill Maddox <maddox@google.com>

	* tree-gimple.h (mark_addressable): Declare extern.
	* lto-function-in.c (input_expr_operand,
	input_tree_operand): Read RESX_EXPR operand properly.
	* gimplify.c (make_addressable): Export.
	* stmt.c (expand_asm_operands): Add comments regarding
	dubious use of lang_hooks.mark_addressable.

2008-08-26  Doug Kwan  <dougkwan@google.com>

	* (lto_decl_stream_e_t): New type.
	* Makefile.in (lto-section-out.o): Add BITMAP_H.
	* lto-section-out.c (bitmap.h): New include.
	(write_symbol_vec): Renamed from produce_symtabl_1.  Also take a new
	parameter SEEN to avoid duplicate symbols.
	(write_symbols_of_kind): New.
	(produce_symtab): Remove FUNCTIONS and VARIABLES parameters.
	Now also look at out-decl states of functions for symbols.

2008-08-25  Bill Maddox <maddox@google.com>

	* tree.c (reset_type_lang_specific): Clear TYPE_CONTEXT of
	TYPE_DECL nodes.  Clear TYPE_LANG_SLOT_1 where applicable.
	(set_asm_name): New function.
	(reset_lang_specific): Clear DECL_CONTEXT.  Add/update comments.
	(free_lang_specifics): Apply set_asm_name to declarations.  Apply
	reset_type_lang_specific last, after asm names are set.
	* lto-function-out.c (output_local_var_decl): Allow for DECL_SIZE
	to be null
	(lto_output): Invoke free_lang_specifics before output of functions.
	(output_type_decl): Verify context is null and don't stream it out.
	(output_type): Assert that binfo only is present for record or union.
	Verify context is null and don't stream it out.	
	* lto-function-in.c (input_local_var_decl): Allow for null DECL_SIZE.
	(input_function_decl): Don't rely on set_decl_assembler_name langhook
	to make static function names unique.
	(input_var_decl): Don't rely on set_decl_assembler_name langhook
	to make static variable names unique.  Use DECL_FILE_SCOPE_P to test
	declaration for file scope.
	(input_type_decl):  Don't read DECL_CONTEXT.
	(input_type): Don't read TYPE_CONTEXT.
	* lto-section-out.c (produce_asm_for_decls): Remove call to
	free_lang_specifics, moved to lto_input.

2008-08-25  Rafael Avila de Espindola  <espindola@google.com>

	* lto-section-out.c (produce_symtab_1): Use DECL_ASSEMBLER_NAME
	instead of DECL_NAME.

2008-08-22  Doug Kwan  <dougkwan@google.com>

	* cgraphbuild.c	(initialize_inline_failed): Use cgraph_edge field
	CALL_STMT_CANNOT_INLINE_P instead of looking at the corresponding
	CALL_STMT of a cgraph_edge.
	* cgraph.c (cgraph_create_edge): Copy CALL_STMT_CANNOT_INLINE_P
	of cgraph_edge struct from CALL_STMT if CALL_STMT is not NULL.
	* cgraph.hraph.h (struct cgraph_edge) Reduce size of LOOP_NEST
	by one bit to make room for a new filed CALL_STMT_CANNOT_INLINE_P.
	* tree-gimple.h (CALL_CANNOT_INLINE_P): Remove macro.
	* lto-cgraph.c (output_edge): Write CALL_STMT_CANNOT_INLINE_P.
	(input_cgraph_1): Read CALL_STMT_CANNOT_INLINE_P.
	* ipa-inline.c (initialize_inline_failed): Use cgraph_edge field
	CALL_STMT_CANNOT_INLINE_P instead of looking at the corresponding
	CALL_STMT of a cgraph_edge.
	(cgraph_decide_inlining_of_small_function): Ditto.
	(cgraph_decide_inlining): Ditto.
	(cgraph_decide_inlining_incrementally): Ditto.

2008-07-22  Rafael Avila de Espindola  <espindola@google.com>

	* lto-section-out.c (produce_symtab_1): Write comdat.

2008-08-21  Doug Kwan  <dougkwan@google.com>

	* lto-function-out.c (create_output_block): Replace code to initialize
	LOCAL_DECL_HASH_TABLE with a call the lto_init_tree_ref_encoder.
	Re-format a comment to make it fit in 80 columns.
 	(destroy_output_block): Replace code to delete LOCAL_DECL_HASH_TABLE
	and LOCAL_DECLS with a call to lto_destroy_tree_ref_encoder.
	(output_local_decl_ref): Adjust for change in parameters of
	lto_output_decl_index.  Remove code for pushing NAME into
	LOCAL_DECLS.
 	(output_local_var_decl): Use inline lto_tree_ref_encoder_get_tree
	instead of manipulating the internals of a tree ref encoder.
 	(output_local_decl): Same.
	(output_local_vars): Use inline lto_tree_ref_encoder_size instead of
	accessing the internals of a tree ref encoder.
	(produce_asm): Same.
 	(lto_output): Use a separate out-decl state for the function being
	output.
	* ipa-reference.c (read_summary): Call lto_file_decl_data_get_fn_decl
	and lto_file_decl_data_get_var_decl instead of accessing internals of
	an lto_file_decl_data struct.
	* lto-function-in.c (input_type_ref_1): Use a lto_file_decl_data
	struct accessor instead of accessing the internals of
	an lto_file_decl_data_struct.
	(input_expr_operand): Use lto_file_decl_data accessors instead of
	accessing internals of an lto_file_decl_data struct.
	(lto_read_body): Use per-function decl state to decode tree
	references used in function body.  Use an lto_file_decl_data
	accessor instead of accessing internals of the struct.
	* lto-cgraph.c (input_cgraph_1): Use lto_file_decl_data_get_fn_decl
	instead of accessing internals of an lto_file_decl_data struct.
	* lto-header.h (LTO_DECL_STREAM_TYPE, LTO_DECL_STREAM_FIELD_DECL,
	LTO_DECL_STREAM_FN_DECL, LTO_DECL_STREAM_VAR_DECL,
	LTO_DECL_STREAM_TYPE_DECL, LTO_DECL_STREAM_NAMESPACE_DECL,
	LTO_N_DECL_STREAMS): New enums.
	* lto-section.h (lto_decl_header): Use DECL_STATE_SIZE to replace
	NUM_FIELD_DECLS, NUM_FN_DECLS, NUM_VAR_DECLS, NUM_TYPE_DECLS,
	NUM_NAMESPACE_DECLS and NUM_TYPES.
	* ipa-pure-const.c (read_summary): Use lto_fiel_decl_data_get_fn_decl
	instead of accessing internals of an lto_file_decl_data struct.
	* lto-section-in.c (lto_new_in_decl_statE): New function.
	(lto_delete_in_decl_state): Same.
	(lto_hash_in_decl_state): New hash table helper.
	(lto_eq_in_decl_state): Same.
	(lto_get_function_in_decl_state): New function.
	* lto-section-in.h (struct lto_tree_ref_table): New.
	(struct lto_in_decl_state) Same.
 	(struct lto_file_decl_data): Group decl and type streams into
	an lto_in_decl_state struct GLOBAL_DECL_STATE. Add new field
	CURRENT_DECL_STATE to point to the currently active in-decl state.
	Remove FIELD_DECLS, FN_DECLS, VAR_DECLS, TYPE_DECLS, NAMESPACE_DECLS,
	TYPES, NUM_FIELD_DECLS, NUM_FN_DECLS, NUM_VAR_DECLS, NUM_TYPE_DECLS,
	NUM_NAMESPACE_DECLS and NUM_TYPES.  Add new field FUNCTION_DECL_STATES
	to map functions to their in-decl states.
	(DEFINE_DECL_STREAM_FUNCS): New macro for definiting accessors for
	streams in an lto_in_decl_state struct.  Use it.
	(lto_new_in_decl_state): New prototype.
	(lto_delete_in_decl_state): Same.
	(lto_hash_in_decl_state): Same.
	(lto_eq_in_decl_state): Same.
	(lto_get_function_in_decl_state): Same.
	* lto-tree-out.h (struct output_block): Replace LOCAL_DECL_HASH_TABLE,
	NEXT_LOCAL_DECL_INDEX and LOCAL_DECLS with an lto_tree_ref_encoder
	LOCAL_DECL_ENCODER.
	* Makefile.in (LTO_SECTION_OUT_H): New.
	(lto-cgraph.o): Use LTO_SECITON_OUT_H instead of lto-section-out.h.
	(lto-function-out.o) : Same.
	(lto-section-out.o) : Same.
	(ipa-pure-const.o): Same.
	(ipa-reference.o): Same.
	(passes.o): Add lto-header.h and LTO_SECTION_OUT_H.
	* passes.c (lto-header.h, lto-section-out.h): New includes.
 	(ipa_write_summaries_1): Create and use an lto_out_decl_state
	for the current output file.  Delete the state after use.
	* lto-section-out.c (pointer-set.h): New include.
	(decl_state_stack): New var.
	(function_decl_states): Same.
	(lto_output_decl_index): Take an lto_tree_ref_encoder as parameter
	instead using separate parameters for a hash table and a pointer
	to the next index.  Also push NAME to tree vector in ENCODER if
	NAME is new.
	(lto_output_field_decl_index): Adjust for new interface and semantics
	of lto_output_decl_index.
	(lto_output_fn_decl_index): Same.
	(lto_output_namespace_decl_index): Same.
	(lto_output_var_decl_index): Same.
	(lto_output_type_decl_index): Same.
	(lto_output_type_ref_index): Same.
	(lto_new_out_decl_state): New.
	(lto_delete_out_decl_state): New.
 	(lto_get_out_decl_state): Return the currently active decl state.
	Remove code for creating a decl state.
	(lto_push_out_decl_state): New.
	(lto_pop_out_decl_state): New.
	(lto_record_function_out_decl_state): New.
	(lto_record_common_node): New.
	(lto_get_common_nodes): New.
	(preload_common_nodes): Adjust to work with lto_get_common_nodes.
	(preload_common_nodes): Call lto_get_common_nodes instead of computing
	(write_global_stream): Change to accept an lto_tree_ref_encoder
	instead of a tree vector as parameter.
	(write_global_references): Same.
	(lto_output_decl_state_streams): New.
	(lto_output_decl_state_refs): New.
	(lto_out_decl_state_written_size): New.
 	(produce_asm_for_decls): Change code for the update in
	lto_decl_header.  Also write out global and per-function
	out-decl states.  Remove code for deleting out-decl state.
	* lto-section-out.h (lto-section.h): New include.
	(struct lto_tree_ref_encoder): New.
 	(struct lto_out_decl_state): Consolidate separate fields for
	decl and type streams into an array of lto_tree_ref_encoders
	STREAMS.  Add new field FN_DECL.
	(lto_out_decl_state_ptr): New typer.  Use it to declare vector
	functions.
	(lto_init_tree_ref_encoder): New inline.
	(lto_destroy_tree_ref_encoder): Same.
	(lto_tree_ref_encoder_size): Same.
	(lto_tree_ref_encoder_get_tree): Same.
	(lto_output_decl_index): Change parameters.
	(lto_new_out_decl_state): New prototype.
	(lto_delete_out_decl_state): Same.
 	(lto_get_out_decl_state): Same.
	(lto_push_out_decl_state): Same.
	(lto_pop_out_decl_state): Same.
	(lto_record_function_out_decl_state): Same.
	(lto_get_common_nodes): Same.
 
2008-08-21  Doug Kwan  <dougkwan@google.com>

	* lto-function-out.c (create_output_block): Use XCNEW instead of
	xcalloc.
	(destroy_output_block): Delete MAIN_HASH_TABLE if present.
	* lto-section-out.c: Move call to destroy_output_block to be after
	all use of OB.  Remove call to htab_delete of MAIN_HASH_TABLE of OB.

2008-08-21  Rafael Espindola  <espindola@google.com>

	* aclocal.m4: Include ../config/libelf.m4.
	* configure.ac: Use AC_CHECK_LIBELF.
	* configure: Update.
	* lto-section-out.c: include lto-symtab.h
	(ld_plugin_symbol_kind): Remove.
	(ld_plugin_symbol_visibility): Remove.
	(produce_symtab_1): Update to use lto-symtab.h

2008-08-20  Bill Maddox <maddox@google.com>

	* lto-tree-flags.def: Stream private_flag for
	PARM_DECL and RESULT_DECL.
	* lto-function-out.c (output_type): Use debug token
	"fields" for unions as well as records.
	* lto-function-in.c (typedef tree_ptr): New.
	Also, declared vec.h-style vector of same.
	(global_vector_enter): Added need_fixups parameter,
	and code to mark vector entry for backpatching.
	(global_vector_fixup): Implement backpatching of
	references to the replaced vector entry.  Add comments.
	Call ggc_free on the replaced node.
	(input_field_decl, input_function_decl, input_var_decl,
	input_parm_decl, input_result_decl, input_type_decl,
	input_namespace_decl, input_translation_unit_decl,
	input_binfo, input_type): Use new API for reading
	backpatchable fields.
	(input_type): Use debug token "fields" for unions
	as well as records.
	(input_tree_operand): Assert if reference is resolved
	to a backpatchable node without providing a location
	to backpatch.  Add comment.  Allow for backpatching
	of operands of TREE_VEC, TREE_LIST, and various
	expression operators.
	(input_tree): Added slot parameter, providing location
	to backpatch.  Added code to register this location
	for backpatching if needed.
	(input_type_tree): Made static.
	* lto-tree-in.h (input_tree): Added slot parameter
	to function prototype.

2008-08-20  Doug Kwan  <dougkwan@google.com>

	* lto-section-out.c (produce_symtab_1): Fix a 32-bit bootstrap
	failure due to a missing cast.

2008-08-20  Rafael Avila de Espindola  <espindola@google.com>

	* lto-header.h (lto_section_type): Add LTO_section_symtab.
	* lto-section-out.c: Include stdint.h.
	(lto_get_section_name): Handle LTO_section_symtab.
	(ld_plugin_symbol_kind): New.
	(ld_plugin_symbol_visibility): New.
	(produce_symtab_1): New.
	(produce_symtab): New.
	(produce_asm_for_decls): Call produce_symtab.

2008-08-20  Rafael Avila de Espindola  <espindola@google.com>

	Backport revision 39233 from trunk.

2008-08-19  Rafael Avila de Espindola  <espindola@google.com>

	Backport revisions 138310, 138347 and 139100 from trunk.

2008-08-19  Rafael Avila de Espindola  <espindola@google.com>

	* lto-tree-flags.def (CONSTRUCTOR): Add constant_flag.

2008-08-14  Rafael Avila de Espindola  <espindola@google.com>

	* lto-function-in.c (input_constructors_or_inits): Input aliases.
	* lto-function-out.c (output_constructors_and_inits): Output aliases.
	* tree.h (alias_pair): Moved from varasm.c.
	(alias_pairs): Moved from varasm.c.
	* varasm.c (alias_pair): Move to tree.h.
	(alias_pairs): Move to tree.h.

2008-08-12  Simon Baldwin  <simonb@google.com>

	* lto-section-out.c (produce_asm_for_decls): Move htab_delete()
	call up.

2008-08-09  Bill Maddox <maddox@google.com>

	* tree-pretty-print.c (dump_generic_node): Add
	missing break after case.
	* tree.c (reset_type_lang_specific): Rename parameter
	decl to type.  Strip members other than FIELD_DECL
	from record field list.  Strip members other than
	FUNCTION_DECL from record method list.
	(free_lang_specifics): Force FE-independent definition
	of fileptr_type_node.
	* lto-function-out.c (output_expr_operand): Abort on
	unhandled CONST_DECL nodes.
	(output_local_type): Abort if this bit-rotted code is
	configured in and used.
	(output_function): Call output_type_ref_1 to handle
	either local or global type reference correctly.
	(global_vector_debug): New function.
	(output_field_decl, output_function_decl, output_var_decl,
	output_parm_decl, output_result_decl, output_type_decl,
	output_namespace_decl, output_label_decl,
	output_translation_unit_decl, output_binfo, output_type):
	Improved streamer debug tracing, including calls to
	global_vector_debug and LTO_DEBUG_TOKEN.
	(output_type_decl): Do not stream out DECL_INITIAL.
	(output_namespace_decl): Do not stream out DECL_ALIGN.
	(output_type): Do not stream out TYPE_UID.  Handle record
	fields separately from other overloaded uses of TYPE_VALUES.
	(output_global_record_start_1): New function.
	(output_global_constructor): Use output_global_record_start_1.
	Fix statement indentation.
	(output_tree): Check for unhandled types and decls.
	Abort on unhandled CONST_DECL.  Improve error diagnostic
	for language-specific tree codes.
	* lto-function-in.c: Removed extra space before array subscripts.
	(input_expr_operand): Handle type references.  Abort on
	unexpected CONST_DECL.
	(global_vector_enter): Cast pointer to void * for printing.
	Show symbolic name for tree code of the new node in debug trace.
	(global_vector_fixup): Cast pointer to void * for printing.
	(input_field_decl, input_function_decl, input_var_decl,
	input_parm_decl, input_result_decl, input_type_decl,
	input_label_decl, input_namespace_decl, input_translation_unit_decl,
	input_binfo, input_type): Add calls to LTO_DEBUG_TOKEN.
	(input_type_decl): Do not read DECL_INITIAL.
	(input_type): Do not read TYPE_UID.  Handle record fields
	separately from other uses of TYPE_VALUES.
	(input_tree_operand): Abort on unexpected CONST_DECL.
	(input_type_tree): Allow for NULL_TREE as type.
	* opts.c (common_handle_option): Do not force debug info
	generation when -flto is specified.
	* lto-section-out.c (preload_common_node): Do not return
	prematurely if the type has been seen before.  Check for
	expected values of fileptr_type_node and its main variant.

2008-07-30  Bill Maddox  <maddox@google.com>

	* lto-function-in.c (input_function_decl): Save the
	old assembler name before renaming static functions.
	* lto-tree-in.h (struct data_in): Removed field global.
	Tidy up comments.
	* lto-section-in.c (struct lto_renaming_slot): New type.
	(hash_name, eq_name, renaming_slot_free, lto_create_renaming_table,
	lto_record_renamed_decl, lto_original_decl_name): New functions.
	* lto-section-in.h (struct lto_file_decl_data): Add field
	renaming_hash_table.  Fix comments.
	(lto_create_renaming_table, lto_record_renamed_decl,
	lto_original_decl_name): Declare.
	* lto-section-out.c: Remove marker comments.
	
2008-07-28  Kenneth Zadeck <zadeck@naturalbridge.com>

	Mainline merge @138147

2008-07-25  Diego Novillo  <dnovillo@google.com>
	    Bill Maddox  <maddox@google.com>

	* tree-pretty-print.c (dump_generic_node): Always call
	print_struct_decl for structures.
	* tree.c (free_lang_specifics): Force ptrdiff_type_node
	to be integer_type_node.
	* lto-function-out.c (output_tree): Reformat debug output.
	Call get_ref_idx_for.
	* lto-function-in.c (input_tree_operand): Reformat debug
	output.
	* lto-tree-out.h (struct output_block): Remove field
	next_main_index.
	* tree-flow.h (tree_node_can_be_shared): Declare.
	* tree-cfg.c (tree_node_can_be_shared): Declare extern.
	* lto-section-out.c: Remove includes of ctype.h and
	strings.h
	(get_ref_idx_for): Factor out of ...
	(preload_common_node): ... here.
	Call it.
	(preload_common_nodes): Add debugging output.
	* lto-section-out.h (preload_common_node): Declare.
	(get_ref_idx_for): Declare.

2008-07-23  Rafael Espindola  <espindola@google.com>

	Mainline merge @138073

	* configure.ac (ACX_PKGVERSION): Update revision merge string.
	* configure: Regenerate.

2008-07-22  Rafael Espindola  <espindola@google.com>

	* lto-function-in.c (lto_read_body): Read labels.
	* lto-function-out.c (create_output_block): Always allocate named_label_stream.
	Always create label_hash_table and local_decl_hash_table.
	Use XCNEW.
	(destroy_output_block): Always delete label_hash_table and
	local_decl_hash_table.
	Always free named_label_stream.
	Always clean debug_label_stream.
	Always free named_labels.
	(produce_asm): Always set num_local_decls, num_named_labels,
	num_unnamed_labels, named_label_size and
	debug_label_size.
	Always write named_label_stream and debug_label_stream.
	(output_constructors_and_inits): Output labels.

2008-07-15  Kenneth Zadeck <zadeck@naturalbridge.com>

	* tree-pass.h (pass_ipa_reference): Make into ipa_opt_pass.
	* ipa-reference.c (lto-section-in.h, lto-section-out.h): New includes.
	(init_function_info, generate_summary, write_summary,
	read_summary, propagate): New functions.
	(analyze_function):  Call init_function_info.
	(static_execute): Stripped into generate_summary and propagate.
	(pass_ipa_reference): Made into ipa_opt_pass.
	* lto-header.h (lto_section_type): Added LTO_section_ipa_reference.
	* ipa-pure-const.c (read_summary): Move call to init_state out of loop.
	* Makefile.in (ipa-reference.o): Add rules.
	* passes.c (init_optimization_passes): Reorder pass_ipa_reference.
	* lto-section-out.c (lto_get_section_name): Add .reference section.

2008-07-10  Bill Maddox  <maddox@google.com>

	* gcc/collect2.c (prefix_from_string): Fix c++ compatibility warnings.
	(maybe_run_lto_and_relink): Fix c++ compatibility warnings.
	* gcc/lto-function-in.c (input_type_ref_1): Fix c++ compatibility
	warnings.
	(canon_file_name): Fix c++ compatibility warnings.
	(input_expr_operand): Fix c++ compatibility warnings.
	(input_labels): Fix c++ compatibility warnings.
	(input_local_vars_index): Fix c++ compatibility warnings.
	(input_local_tree): Fix c++ compatibility warnings.
	(input_local_vars): Fix c++ compatibility warnings.
	(input_function): Fix c++ compatibility warnings.
	* gcc/lto-function-out.c (string_slot_free): Fix c++ compatibility
	warnings.
	(create_output_block): Fix c++ compatibility warnings.
	(output_label_ref): Fix c++ compatibility warnings.
	(produce_asm): Fix c++ compatibility warnings.
	(output_tree): Fix c++ compatibility warnings.
	* gcc/lto-section-out.c (lto_output_data_stream): Fix c++ compatibility
	warnings.
	(lto_output_decl_index): Fix c++ compatibility warnings.
	(lto_output_type_ref_index): Fix c++ compatibility warnings.
	(lto_destroy_simple_output_block): Fix c++ compatibility warnings.
	(lto_get_out_decl_state): Fix c++ compatibility warnings.
	(preload_common_node): Fix c++ compatibility warnings.
	(write_global_references): Fix c++ compatibility warnings.
	(produce_asm_for_decls): Fix c++ compatibility warnings.
	* gcc/lto-section-out.h (LTO_SET_DEBUGGING_STREAM): Fix c++
	compatibility warnings.

2008-07-10  Bill Maddox  <maddox@google.com>

	* lto-function-out.c (lto_static_init):
	Back out reset of lto_types_needed_for bit for
	TREE_BINFO nodes.
	* lto-function-in.c (input_binfo): Restore reading
	of flags and check for presence of line info.
	(input_tree_operand): Add test for tree code TREE_BINFO
	where we check for special handling of type and decl nodes.

2008-07-09  Kenneth Zadeck <zadeck@naturalbridge.com>
	Mainline merge @137631

	* configure: Regenerate.

2008-07-09  Rafael Espindola  <espindola@google.com>

	* lto-function-in.c (input_binfo): Don't read flags. Don't read line
	info.
	* lto_static_init (lto_static_init): Reset TREE_BINFO in
	lto_types_needed_for.

2008-07-02  Rafael Espindola  <espindola@google.com>

	* tree.c (reset_lang_specific): Remove local VAR_DECLs from
	DECL_DEBUG_EXPR of other VAR_DECLs.

2008-06-27  Bill Maddox  <maddox@google.com>

	* lto-function-out.c (output_function_decl):
	Write function_code and built_in_class fields.
	* lto-function-in.c (input_function_decl):
	Read function_code and built_in_class fields.

2008-06-27  Ollie Wild  <aaw@google.com>

	* lto-section-out.h (lto_begin_section): New function declaration.
	(lto_end_section): New function declaration.
	(lto_output_data_stream): New function declaration.
	* lto-section-out.c (lto_begin_section): New function.
	(lto_end_section): New function.
	(lto_write_stream): Modify lang_hooks call.  Remove free.
	(append_block): New function.
	(lto_output_1_stream): Replace block allocation with call to
	append_block.
	(lto_output_data_stream): New function.
	(lto_destroy_simple_output_block): Add header_stream.  Replace
	lang_hook calls with lto-section functions.
	(write_global_references): Add ref_stream.  Replace lang_hooks call
	with lto-section calls.
	(produce_asm_for_decls): Add header_stream.  Replace lang_hook calls
	with lto-section calls.
	* lto-function-out.c (langhooks.h): Remove include.
	(produce_asm): Add header_stream.  Replace lang_hook calls with
	lto-section calls.
	* langhooks.h (struct lang_hooks_for_lto): Rename write_section_data
	to append_data.  Add a block parameter.
	* langhooks-def.h (lhd_append_data): Rename from
	lhd_write_section_data.  Add a new parameter.
	(lhd_write_section_data): Rename to lhd_append_data.
	(LANG_HOOKS_APPEND_DATA): Rename from LANG_HOOKS_WRITE_SECTION_DATA.
	Change lhd_write_section_data to lhd_append_data.
	(LANG_HOOKS_WRITE_SECTION_DATA): Rename to LANG_HOOKS_APPEND_DATA.
	(LANG_HOOKS_LTO): Change LANG_HOOKS_WRITE_SECTION-DATA to
	LANG_HOOKS_APPEND_DATA.
	* langhooks.c (lhd_append_data): Rename from lhd_write_section_data.
	Add a block parameter.
	(lhd_write_section_data): Rename to lhd_append_data.

2008-06-27  Rafael Espindola  <espindola@google.com>

	Based on http://gcc.gnu.org/ml/gcc-patches/2007-11/msg00523.html
	and http://gcc.gnu.org/ml/gcc-patches/2008-03/msg00349.html

	* tree.h (remove_decl_from_map): New.
	* tree.c (decl_for_uid_map): New.
	(init_ttree): Initialize decl_for_uid_map.
	(make_node_stat): call insert_decl_to_uid_decl_map.
	(insert_decl_to_uid_decl_map): New.
	(remove_decl_from_map): New.
	(reset_type_lang_specific): Handle RECORD_TYPE.
	(reset_lang_specific): New.
	(free_lang_specifics): Call reset_lang_specific.

2008-06-26  Rafael Espindola  <espindola@google.com>

	* tree-ssa-forwprop.c
	(forward_propagate_addr_into_variable_array_index): Check if
	the size of an array is NULL.

2008-06-25  Rafael Espindola  <espindola@google.com>

	* calls.c (must_pass_in_stack_var_size_or_pad): Don't check if
	TYPE_SIZE is NULL.
	* expr.c (store_field): Don't check if TYPE_SIZE is NULL.
	* tree.c (reset_type_lang_specific): Set both TYPE_SIZE_UNIT
	and TYPE_SIZE or none of them. Don't set TYPE_MAX_VALUE to
	NULL. call set_min_and_max_values_for_integral_type.

2008-06-24  Rafael Espindola  <espindola@google.com>

	* gcc.c (cc1_options): add -flto if -flto-single is given.
	(default_compilers): remove redundant parts that were moved to
	cc1_options.

2008-06-23  Ollie Wild  <aaw@google.com>

	* lto-section-out.c (dwarf2asm.h): Remove include.
	(write_global_references): Replace dw2_asm_output_data calls with a
	single call to lang_hooks.lto.write_section_data.

2008-06-23  Bill Maddox  <maddox@google.com>

	* gcc.c: (lto_single): New variable.  Flag to indicate
	lto-single mode.
	(LINK_COMMAND_SPEC,cc1_options): Add support for
	lto-single mode.
	(invoke_lto_single): New constant.
	Specs string to run hidden lto1 pass.
	(default_compilers): Add support for lto-single
	mode in specs for C compilations.
	(static_specs): Add entry for invoke_lto_single.
	(process_command): Recognize -flto-single option.
	(handle_spec_predicate): Parse and invoke spec predicate,
	similar to spec funtion.
	(handle_braces): Implement conditional on spec predicates.
	(lto_single_spec_predicate): New function. Spec predicate
	to test for lto-single mode.

2008-06-23  Rafael Espindola  <espindola@google.com>

	* calls.c (must_pass_in_stack_var_size): handle a NULL TYPE_SIZE.
	* expr.c (store_field): handle a NULL TYPE_SIZE.
	* tree.c (reset_type_lang_specific): set TYPE_SIZE_UNIT,
	TYPE_SIZE and TYPE_MAX_VALUE to NULL_TREE if they are not INTEGER_CST.

2008-06-18  Ollie Wild  <aaw@google.com>

	* langhooks-def.h (lhd_begin_section): New function declaration.
	(lhd_write_section): New function declaration.
	(lhd_end_section): New function declaration.
	(LANG_HOOKS_BEGIN_SECTION): New macro.
	(LANG_HOOKS_WRITE_SECTION_DATA): New macro.
	(LANG_HOOKS_END_SECTION): New macro.
	(LANG_HOOKS_LTO): New macro.
	(LANG_HOOKS_INITIALIZER): Add LANG_HOOKS_LTO.
	* langhooks.c (output.h): Add include.
	(saved_section): New static variable.
	(lhd_begin_section): New function.
	(lhd_write_section_data): New function.
	(lhd_end_section): New function.
	* langhooks.h (struct lang_hooks_for_lto): New structure.
	(struct lang_hooks): Add member lto.
	* lto-function-out.c (output.h): Remove include.
	(produce_asm): Call the lto.begin_section, lto.write_section_data, and
	lto.end_section language hooks.
	(lto_output): Remove saved_section and call to switch_to_section.
	* lto-section-out.c (output.h): Remove include.
	(lto_get_section): Remove function.
	(lto_write_stream): Call the lto.write_section_data language hook.
	(lto_destroy_simple_output_block): Call the lto.begin_section,
	lto.write_section_data, and lto.end_section language hooks.
	(produce_asm_for_decls): Call the lto.begin_section,
	lto.write_section_data, and lto.end_section language hooks.
	* lto-header.h (lto_get_section): Remove function declaration.

2008-06-17  Doug Kwan <dougkwan@google.com>
	* lto-section-in.c (lto_get_flags): Fix bug in mask computation.
	* lto-section-out.c (lto_set_flags): Same.

2008-06-14  Rafael Avila de Espindola  <espindola@google.com>

	* init.c (build_new_1): add nelts_for_type argument.
	(build_new): create nelts_for_type without a SAVE_EXPR.

2008-06-11  Diego Novillo  <dnovillo@google.com>

	Merge from lto-streamer sub-branch:

	2008-06-09  Bill Maddox  <maddox@google.com>

		* lto-tags.h: Add new tags LTO_local_type_ref
		and LTO_global_type_ref.  Split LTO_type_decl
		and LTO_field_decl into LTO_type_decl0, LTO_type_decl1,
		LTO_field_decl0, and LTO_field_decl1.
		* lto-tree-tags.h: Set names and tree code mappings for
		the new tags.
		* lto-function-out.c: Tidy comments and formatting.
		(output_record_start): Add forward declaration.
		(type_function_context): New function.
		(field_decl_is_local, type_decl_is_local): New functions.
		(output_type_ref_1): Write "local" (e.g., variably-modified)
		types to local_decls stream.
		(output_type_ref): Use "type_ref" as debug token to avoid
		confusing clash with use of "type" elsewhere.
		(output_local_decl_ref):  Update comment.
		(output_expr_operand): Cases for FIELD_DECL and TYPE_DECL
		now write "local" declarations to local_decls stream.
		(output_local_var):  Rename to output_local_var_decl.
		(output_local_var_decl): Remove code to set slot in
		local_decls_index, now handled by output_local_decl.
		(output_local_tree): New function.
		(output_local_field_decl, output_local_type_decl,
		output_local_type): New functions.
		(output_local_decl): New function.
		(output_field_decl): Use new tag LTO_field_decl1, to
		distinguish from "local" fields.
		(output_type_decl): Use new tag LTO_type_decl1, to
		distinguish from "local" fields.
		* lto-function-in.c: Tidy comments and formatting.
		(input_local_tree, input_local_var_decl, input_local_field_decl,
		input_local_type_decl, input_local_type):  Add
		forward declarations.
		(input_type_ref_1): Distinguish references to global or local
		declaration streams.
		(input_type_ref):  Use "type_ref" as debug token to avoid
		confusing clash with use of "type" elsewhere.
		(input_expr_operand):  Cases for FIELD_DECL and TYPE_DECL
		now read "local" declarations from local_decls stream.
		(input_local_tree): New function.
		(input_local_var): Rename to input_local_var_decl.
		(input_local_var_decl): Input record tag is now an argument.
		(input_local_field_decl, input_local_type_decl,
		input_local_type): New functions.
		(input_local_decl): New function.
		(input_local_vars): Call input_local_decl instead
		of input_local_var.
		(lto_static_init_local): Don't call
		add_referenced_var on non-vars.
		* lto-section-out.c (lto_hash_decl_slot_node,
		lto_eq_decl_slot_node): Use object pointer, not
		UID, as hash key.

	2008-06-04  Rafael Espindola  <espindola@google.com>

		* lto-function-out.c (output_tree): call error
		with the TREE_CODE name.

	2008-06-04  Ollie Wild  <aaw@google.com>

		* dwarf2out.c (dwarf2_called_from_lto_p): Remove.
		(current_fde): New function.
		(add_fde_cfi): Call current_fde.
		(lookup_cfa): Call curent_fde.
		(dwarf2out_end_epilogue): Call current_fde.
		(dwarf2out_switch_text_section: Call current_fde.
		(lto_void_type_die): Remove.
		(dwarf_attr_name): Declare static.  Remove
		flag_generate_lto check.

		(assign_symbol_name): Remove.
		(assign_symbol_names): Expand call to assign_symbol_name.
		(base_type_die): Replace
		DW_ATE_GNU_complex_unsigned and
		DW_ATE_GNU_complex_signed encodings with
		DW_ATE_lo_user.  Remove byte_size computation.
		Remove extra precision information.
		(may_reference_to_unused): Rename reference_to_unused.
		(rtl_for_decl_init): Rename calls to may_reference_to_unused.
		(convert_cfa_to_fb_loc_list): Call current_fde.
		(gen_subprogram_die): Remove flag_generate_lto and
		dwarf2_called_from_lto_p checks.
		(gen_variable_die): Remove context_die == comp_unit_die checks.
		(add_high_low_attributes): Remove
		dwarf2_called_from_lto_p check.
		(force_die_for_context): Remove.
		(containing_decl_for_block): Remove.
		(force_block_die): Remove.
		(force_decl_die): Expand call to force_die_for_context.  Remove
		context_die == comp_unit_die check.  Remove the removal of of
		DW_AT_DECLARATION.
		(force_type_die): Expand the force_die_for_context call.
		(force_field_die): Remove.
		(gen_decl_die): Remove the cgraph_global_info_ready check.
		(dwarf2out_init): Remove lto_void_type_die initialization.
		(dwarf2out_finish): Remove context assignment.
		(mark_die_used): Remove.
		(lto_init_ref): Remove.
		(lto_type_ref): Remove.
		(lto_var_ref): Remove.
		(lto_fn_ref): Remove.
		(lto_field_ref): Remove.
		(lto_typedecl_ref): Remove.
		(lto_namespacedecl_ref): Remove.
		* dwarf2out.h (dwarf2_called_from_lto_p): Remove.
		(dwarf_attr_name): Remove.
		(lto_out_ref): Remove.
		(lto_type_ref): Remove.
		(lto_var_ref): Remove.
		(lto_fn_ref): Remove.
		(lto_field_ref): Remove.
		(lto_typedecl_ref): Remove.
		(lto_namespacedecl_ref): Remove.
		* dwarf2.h (enum dwarf_type): Remove
		DW_ATE_GNU_complex_signed and
		DW_ATE_GNU_complex_unsigned.
		* lto-cgraph-in.c: Remove inclusion of
		dwarf2asm.h and dwarf2out.h.
		* lto-cgraph-out.c: Remove inclusion of
		dwarf2asm.h and dwarf2out.h.
		(lto_output_cgraph): Remove assignments to
		dwarf2_called_from_lto_p.
		* lto-function-in.c: Remove inclusion of
		dwarf2asm.h and dwarf2out.h.
		* lto-function-out.c: Remove inclusion of
		dwarf2asm.h and dwarf2out.h.
		(generate_early_dwarf_information): Remove.
		(output_function): Remove generate_early_dwarf_information call.
		(lto_output): Remove assignments to dwarf2_called_from_lto_p.
		* lto-section-in.c: Remove inclusion of
		dwarf2asm.h and dwarf2out.h.
		* lto-section-out.c: Remove inclusion of dwarf2out.h.

	2008-06-03  Bill Maddox  <maddox@google.com>
		
		* lto-tree-flags.def: Add flags for LABEL_DECL.
		* lto-function-out.c (output_label_decl): New function.
		(output_tree): Make sure that we do not stream out
		well-known nodes, even for node types for which we
		would not necessarily force sharing.  Reinstate handlers
		for SWITCH_EXPR	and CASE_LABEL. Add case for LABEL_DECL.
		* lto-function-in.c (input_label_decl): New function.
		(input_tree_operand): Reinstate handlers for 
		SWITCH_EXPR and CASE_LABEL. Add case for LABEL_DECL.
		* lto-section-out.c (preload_common_nodes): Verify
		that main_identifier_name is as expected by the reader.
		* lto.c (preload_common_nodes): Initialize
		main_identifier_node.

	2008-06-03  Diego Novillo  <dnovillo@google.com>

		* lto-header.h: Tidy formatting.
		* lto-section-in.c (lto_get_section_data): Fix type for
		SECTION_NAME.
		(lto_debug_in_fun): Tidy formatting.
		* lto-tags.h (enum): Tidy formatting.
		* lto-cgraph-out.c (output_fn_decl): Add comment.
		* lto-section-out.c (lto_output_decl_index):  Tidy formatting.

	2008-06-03  Diego Novillo  <dnovillo@google.com>

		* lto-function-out.c (output_tree_flags): Tidy
		formatting.
		(output_type_decl): Emit TYPE_MODE.
		(output_tree): Add comment.
		Ignore language codes.  Add pointer to proper fix.
		* lto-function-in.c (input_type_decl): Read TYPE_MODE.

	2008-06-02  Diego Novillo  <dnovillo@google.com>

		* lto-function-out.c: Do not include ctype.h.
		Tidy whitespace.
		(output_function_decl): Add comment.
		(output_type_tree): Reformat comment.
		* lto-header.h (lto_get_section_name): Fix return type.
		Tidy whitespace.
		* lto-tree-out.h: Tidy whitespace and comments.
		* lto-section-out.c (lto_get_section_name): Fix return
		type.
		(lto_get_section): Fix type of section_name.
		(lto_get_out_decl_state): Reformat comment.
		(out_state): Declare as local static to
		lto_get_out_decl_state.
		Fix wraparound problems.
		(preload_common_node): Reformat comment.
		Tidy whitespace.
		(produce_asm_for_decls): Remove extern declarations.
		Fix wraparound problems.
		(lto_debug_out_fun): Fix comment.
		* lto-section-out.h: Tidy whitesace and formatting.

	2008-05-30  Diego Novillo  <dnovillo@google.com>

		* lto-function-out.c (output_namespace_decl): Fix
		assertions for NAMESPACE_DECL.

	2008-05-30  Diego Novillo  <dnovillo@google.com>

		Backport from trunk:

		2008-05-27  Richard Guenther  <rguenther@suse.de>

			PR tree-optimization/36245
			* tree-ssa-address.c (add_to_parts): Deal
			with non-pointer bases.

	2008-05-29  Bill Maddox  <maddox@google.com>

		* lto-tree-in.h, lto-tree-out.h: New files,
		accidently omitted from previous commit.

	2008-05-28  Bill Maddox  <maddox@google.com>
		
		Replace the DWARF reader in the LTO front-end.

		* lto-tree-flags.def: Add flags for *_DECL
		and *_TYPE for use by g lobal streamer.
		* lto-function-out.c: Include lto-tree-out.h.
		(struct output_block): Moved to lto-tree-out.h.
		(create_output_block, destroy_output_block):
		Make non-static, now exported.
		(output_tree_flags, debug_tree_flags): Add ADD_CLASS_TYPE,
		ADD_TYPE_FLAG, ADD_FUN_FLAG macros.  Fix bug where stream
		debugging info was sometimes omitted.
		(lto_static_init): Adjust lto_flags_needed_for and
		lto_types_needed_for for node types now newly handled by
		the global streamer.
		(output_tree, output_type_tree, output_global_record_start,
		output_field_decl, output_function_decl, output_var_decl,
		output_parm_decl, output_result_decl, output_type_decl,
		output_namespace_decl, output_translation_unit_decl,
		output_binfo, output_type, output_global_constructor)
		New functions.
		* lto_function-in.c: Include lto-tree-in.h.
		(struct data_in): Moved to lto-tree-in.h.
		(input_string_internal): Initialize input_block before
		reading string table size from the stream.
		(process_tree_flags): Add ADD_CLASS_TYPE_FLAG, ADD_TYPE_FLAG,
		ADD_FUN_FLAG.
		(input_local_var): Handle stream debugging information
		that was previously omitted due to a bug in the writer.
		(lto_static_init_local): Make non-static, now exported.
		Add ADD_CLASS_TYPE_FLAG, ADD_TYPE_FLAG, ADD_FUN_FLAG.
		(input_tree, input_type_tree, input_tree_operand,
		global_vector_enter, global_vector_fixup, input_field_decl,
		input_function_decl, input_var_decl, input_parm_decl,
		input_result_decl, input_type_decl, input_namespace_decl,
		input_translation_unit_decl, input_binfo, input_type):
		New functions.
		* lto-section.h (struct lto_decl_header): Add fields for
		sizes of globals stream and its associated debug and string
		table streams.
		* lto-tree-tags.def: MAP_EXPR_TAG and SET_NAME macro calls
		for newly-handled tree codes for global decls and types.
		* lto-section-in.c (dump_debug_stream): Fix typo
		in error message.
		* lto-section-in.h (lto_input_function_body,
		lto_input_constructors_and_inits): Moved to lto-tree-in.h.
		* lto-tags.h (enum LTO_tags): Added literals LTO_tree_vec,
		LTO_translation_unit_decl, LTO_*_type, LTO_tree_binfo,
		LTO_pickle_reference.
	
2008-06-09 Rafael Espindola  <espindola@google.com>

	based on http://gcc.gnu.org/ml/gcc-patches/2008-03/msg00349.html

	* langhooks-def.h (LANG_HOOKS_RESET_LANG_SPECIFICS): New.
	(LANG_HOOKS_INITIALIZER): add LANG_HOOKS_RESET_LANG_SPECIFICS.
	* langhooks.h (reset_lang_specifics): New.
	* lto-section-out.c (produce_asm_for_decls): Call free_lang_specifics.
	* tree.c (uid2type_map): New.
	(insert_type_to_uid_type_map): New.
	(uid_type_map_eq): New.
	(uid_type_map_hash): New.
	(init_ttree): Initialize uid2type_map.
	(make_node_stat): Call insert_type_to_uid_type_map.
	(copy_node_stat): Call insert_type_to_uid_type_map.
	(reset_type_lang_specific): New.
	(free_lang_specifics): New.
	* tree.h (free_lang_specifics) New.

2008-06-09  Rafael Espindola  <espindola@google.com>

	* Make-lang.in (lto.all.cross): depend on $(LTO_EXE).

2008-05-05  Kenneth Zadeck <zadeck@naturalbridge.com>
	    Jan Hubicka  <jh@suse.cz>
	
	* tree-pass.h (ipa_opt_pass pass_ipa_lto_gimple_out,
	pass_ipa_pure_const, pass_ipa_lto_finish_out): Changed from being 
	simple_ipa_opt_pass to ipa_opt_pass. 
	(ipa_opt_pass pass_ipa_lto_cgraph): Renamed from
	ipa_opt_pass pass_ipa_lto_cgraph_out.
	(ipa_write_summaries, ipa_read_summaries): New functions.
	* lto-function-out.c (string_slot_free): New function.
	(next_string_index): Removed.
	(string_hash_table): Now use string_slot_free.
	(output_string): Copy string to malloced space and properly
	initialize slots.
	(output_type_ref_1): Renamed to lto_output_type_ref_index and
	moved to lto_section_out.c
	(output_type_ref, output_function): Now calls lto_output_type_ref_index.
	(output_expr_operand): Moved bodies of FIELD_DECL, FUNCTION_DECL,
	VAR_DECL, TYPE_DECL, NAMESPACE_DECL to new functions in
	lto_section_out.c.
	(lto_output): Now returns void.
	(pass_ipa_lto_gimple_out): Now a IPA_PASS with lto_output as
	write_summary method.
	* lto-function-in.c (input_string_internal): Moved initialization
	of len to proper place.
	* lto-cgraph.c: New file that is combination of lto-cgraph-out.c
	lto-cgraph-in.c and cgraph.h.
	(lto-section-in.h, lto-section-out.h): Added includes.
	(tree-vectorizer.h, tree-iterator.h): Removed includes.
	(LTO_cgraph_tag_names, LTO_cgraph_tags): Added from cgraph.h.
	(create_output_block, destroy_output_block, output_uleb128,
	output_sleb128, output_fun_decl, add_flag): Moved to
	lto-section-out.c, renamed with "lto_" prefix and generalized.
	(output_node, output_cgraph, input_overwrite_mode, input_cgraph):
	Changed to call moved and renamed functions.
	(input_overwrite_mode): Renamed from overwrite_mode.
	(input_cgraph): Renamed from lto_input_cgraph and made private and
	now loops over all file_datas.
	(pass_ipa_lto_cgraph): Renamed from pass_ipa_lto_cgraph_out and
	made into IPA_PASS.
	* lto-cgraph.h: File deleted and all infomation moved to
	lto-cgraph.c.
	* lto-header.h (LTO_section_ipa_pure_const): New section type.
	(lto_simple_header): New structure.
	* ipa-pure-const.c (lto-section-in.h, lto-section-out.h): New
	includes.
	(init_state, finish_state, set_function_state, generate_summary,
	write_summary, read_summary): New functions.
	(scan_stmt): Renamed from scan_function.  Changed to keep state in
	local static vars rather than cgraph aux field.
	(propagate): Renamed from static_execute. Changed to keep state in
	local static vars rather than cgraph aux field.
	(pass_ipa_pure_const): Changed from SIMPLE_IPA_PASS to IPA_PASS.
	* lto-cgraph-in.c: Content moved to lto-cgraph.c.
	* lto-section-in.c (lto_get_flag, lto_get_flags): Moved from
	lto-cgraph-in.c and renamed from add_flag and add_flags.
	(lto_read_section_data): Moved to lto/lto.c and modified to use
	mmap.
	(lto_set_in_hooks, lto_get_file_decl_data, lto_free_section_data, 
	lto_create_simple_input_block, lto_destroy_simple_input_block):
	New functions.
	(lto_get_section_data): Modified to call hook in lto front end.
	* lto-section-in.h (lto_section_slot): Moved to lto.h.
	(LTO_INIT_INPUT_BLOCK_PTR): New macro.
	(lto_file_decl_data.fd): New field.
	(lto_get_section_data_f, lto_free_section_data_f): New typedefs.
	(lto_create_simple_input_block, lto_destroy_simple_input_block,
	lto_get_flag, lto_get_flags, lto_set_in_hooks, lto_file_decl_data,
	lto_free_section_data): New functions.
	(lto_get_section_data): Added parms.
	* Makefile.in (lto-cgaph.o): Combined rules from lto-cgraph-in.o
	and lto-cgraph-out.o.
	(lto-function-in.o, lto-function-out.o): Added dependencies.
	* passes.c (init_optimization_passes): Reordered ipa passes.
	(execute_ipa_summary_passes): Added check to see that pass was
	there.
	(ipa_write_summaries_1, ipa_write_summaries,
	ipa_read_summaries_1): New function.
	(execute_ipa_pass_list): Added call to ipa_write_summaries and
	fixed bug.
	* lto-cgraph-out.c: Content moved to lto-cgraph.c.
	* lto-section-out.c (lto_set_flag, lto_set_flags): Functions moved
	and renamed (with lto_ prefix) from lto-cgraph-out.c.
	(lto_output_field_decl_index, lto_output_fn_decl_index,
	lto_output_namespace_decl_index, lto_output_var_decl_index,
	lto_output_type_decl_index, lto_output_type_ref_index): New
	functions.  The code for these functions was taken from
	lto-function-out.c
	(lto_create_simple_output_block, lto_destroy_simple_output_block):
	New functions.
	(produce_asm_for_decls): Now returns void.
	(pass_ipa_lto_finish_out): Now an IPA_PASS.
	* lto-section-out.h (lto_simple_output_block): New structure.
	(lto_set_flag, lto_set_flags, lto_output_field_decl_index,
	lto_output_fn_decl_index, lto_output_namespace_decl_index,
	lto_output_var_decl_index, lto_output_type_decl_index,
	lto_output_type_ref_index, lto_create_simple_output_block,
	lto_destroy_simple_output_block): New functions.
	(lto_get_out_decl_state): Removed function
	(lto_output_decl_index): Added parms.
	
2008-05-29  Rafael Espindola  <espindola@google.com>

	Mainline merge @136135

	* configure.ac (ACX_PKGVERSION): Update revision merge string.
	* configure: Regenerate.

2008-04-27  Kenneth Zadeck <zadeck@naturalbridge.com>

	* cgraph.h (lto_file_decl_data): Removed.
	* lto-function-in.c: Moved from lto directory.
	(lto-section-in.h): Added include.
	(lto.h): Deleted include.
	(input_string_internal): Initialized str_tab with
	LTO_INIT_INPUT_BLOCK.
	(canon_file_name): Reordered to remove stmt before decl.
	(input_expr_operand): Ditto.
	(input_bb): Removed assignment to TREE_BLOCK.
	(lto_static_init_local): Changed data to be char* rather than
	void*.
	(lto_read_body): Changed all vars of type struct lto_input_block
	to be initialized with LTO_INIT_INPUT_BLOCK.
	(lto_read_body, lto_input_constructors_and_inits): Changed data to
	be char* rather than void*.
	* lto-cgraph-in.c: Moved from lto directory.
	(lto.h): Removed include.
	(lto_input_cgraph): Changed data to be char* rather than
	void*. Changed ib_main and debug_main to be initialized with
	LTO_INIT_INPUT_BLOCK.
	* lto-section-in.c: Moved from lto directory.
	(lto.h): Removed include.
	(lto_read_decls): Moved to lto/lto.c.
	* lto-section-in.h: Moved from lto directory.
	(LTO_INIT_INPUT_BLOCK): New macro.
	(lto_input_function_body, lto_input_constructors_and_inits, 
	lto_input_cgraph): Declarations moved from lto.h.
	* Makefile.in (lto-cgraph-in.o, lto-function-in.o,
	lto-section-in.o): Rules moved from lto/Make-lang.in.
	
	
2008-05-25  Rafael Espindola  <espindola@google.com>

	Mainline merge @135852

	* configure.ac (ACX_PKGVERSION): Update revision merge string.
	* configure: Regenerate.

2008-05-20  Rafael Espindola  <espindola@google.com>

	* ../configure: Regenerate with the correct autoconf version: 2.59.

2008-05-16  Diego Novillo  <dnovillo@google.com>

	Mainline merge @135422

	* configure.ac (ACX_PKGVERSION): Update revision merge string.
	* configure: Regenerate.

2008-05-14  Rafael Espindola  <espindola@google.com>

	Mainline merge @135302

	* configure.ac (ACX_PKGVERSION): Update revision merge string.
	* configure: Regenerate.

2008-05-13  Diego Novillo  <dnovillo@google.com>

	Mainline merge @135270

	* configure.ac (ACX_PKGVERSION): Update revision merge string.
	* configure: Regenerate.

2008-05-12  Diego Novillo  <dnovillo@google.com>

	Mainline merge @135136

	* configure.ac (ACX_PKGVERSION): Update revision merge string.
	* configure: Regenerate.

2008-05-12  Diego Novillo  <dnovillo@google.com>

	* lto-tree-flags.def (STRUCT_FIELD_TAG): Remove.
	* treestruct.def (STRUCT_FIELD_TAG): Remove.
	Update all users.
	* lto-cgraph-out.c (output_node): Update references to
	inline summary fields.

2008-04-29  Ollie Wild  <aaw@google.com>

	* lto-tags.h (enum LTO_tags): Add LTO_namespace_decl.
	* lto-tree-tags.def (LTO_namespace_decl): New tag.
	* lto-section-out.c (lto_get_out_decl_state): Initialize
	out_state->namespace_decl_hash_table.
	(produce_asm_for_decls): Write assembly for namespace declarations.
	* lto-section-out.h (struct lto_out_decl_state): Add
	namespace_decl_hash_table, next_namespace_decl_index, and
	namespace_decls.
	* lto-section.h (struct lto_decl_header): Add num_namespace_decls.
	* lto-function-out.c (output_expr_operand): Add NAMESPACE_DECL case.
	(lto_static_init): Clear lto_flags_needed_for and lto_types_needed_for
	entries for NAMESPACE_DECL.
	(output_constructors_and_inits): Output initializer if
	DECL_CONTEXT (var) is not a FUNCTION_DECL.
	* dwarf2out.c (lto_namespacedecl_ref): New function.
	* dwarf2out.h (lto_namespacedecl_ref): New function.

2008-04-24  Kenneth Zadeck <zadeck@naturalbridge.com>

	Merge with mainline @134626.

2008-04-16  Ollie Wild  <aaw@google.com>

	* lto-function-out.c (output_type_ref): Updated function description.

2008-04-16  Ollie Wild  <aaw@google.com>

	* lto-function-out.c (output_type_ref_1): New function.
	(output_type_ref): Split into two functions.
	(output_function): Output an LTO_type record if DECL_CONTEXT (function)
	is a type.
	* lto-tags.h (LTO_tags): Add LTO_type enumerator.
	* lto-tree-tags.def (LTO_type): Add new name.

2008-03-25  Kenneth Zadeck <zadeck@naturalbridge.com>

	Merge with mainline @133491.

2008-03-05  Kenneth Zadeck <zadeck@naturalbridge.com>
	    Jan Hubicka  <jh@suse.cz>

	* cgraph.h (cgraph_local_info): Added lto_file_data.
	(cgraph_decide_is_function_needed): Made public.
	* tree-pass.h (pass_ipa_lto_cgraph_out): New lto pass.	
	* lto-function-out.c (LTO_tag_names): Renamed to LTO_tree_tag_names.
	(current_stmt_uid): Removed.
	(create_output_block): Moved call to lto_get_output_decl_state and set
	lto_debug_context.tag_names.
	(output_expr_operand, output_bb, output_constructors_and_inits): 
	Removed current_stmt_id.
	(lto_static_init): Renamed LTO_tag_names to LTO_tree_tag_names
	(output_function): Added debugging code.
	* cgraphunit.c (decide_is_function_needed): Renamed to
	cgraph_decide_is_function_needed and made public.
	(cgraph_analyze_functions): Only analyze unanalyzed functions.
	* lto-cgraph.h: New file.
	* lto-header.h (LTO_DEBUG_FN_NAME): New macro.
	(struct lto_debug_context.tag_names): New field.
	(lto_debug_fn_name): New function.
	* lto-tags.h (LTO_last_tag): Renamed to LTO_tree_last_tag.
	* lto-stream-debug.c (lto_debug_indent): Get tag from context.
	(lto_debug_fn_name): New function.
	* Makefile.in (lto-stream-debug.o, lto-cgraph-out.o, varpool.o):
	Fixed dependencies.
	* passes.c (init_optimization_passes): New
	pass_ipa_lto_cgraph_out.
	* lto-cgraph-out.c: New file.
	* varpool.c (decide_is_variable_needed): Check for in_lto_p.
		
2008-02-09  Kenneth Zadeck <zadeck@naturalbridge.com>

	* tree-pass.h: (pass_ipa_lto_out): Renamed to pass_ipa_lto_gimple_out.
	(pass_ipa_lto_finish_out): New pass.
	* lto-function-out.c (decl_slot, hash_decl_slot_node, eq_decl_slot_node, 
	hash_type_slot_node, eq_type_slot_node, output_decl_index): Moved to
	lto-section-out.c, made public and and renamed to have "lto_"
	prefix.
	(eq_label_slot_node, hash_label_slot_node): Uses lto_decl_slot rather than
	decl_slot.
	(output_block): Deleted these fields: field_decl_hash_table,
	next_field_decl_index, field_decls, fn_decl_hash_table,
	next_fn_decl_index, fn_decls, var_decl_hash_table,
	next_var_decl_index, var_decls, type_decl_hash_table,
	next_type_decl_index, type_decls, type_hash_table,
	next_type_index, types.
	Added cgraph_node and current_stmt_id.
	(create_output_block): Now takes lto_section_type.  Removed code 
	to init hash tables moved to lto_section_out.c.
	(destroy_output_block): Removed is_function parameter.
	Removed code to destroy tables moved to lto_section_out.c 
	(output_type_ref, output_local_decl_ref, output_label_ref, 
	output_expr_operand): Modified to call functions moved to lto_section_out.
	(output_bb): Properly set current_stmt_id.
	(write_references): Moved to lto_section_out.c.
	(produce_asm): tripped of all of the function that was moved
	to lto_section_out.c.
	(output_constructor_or_init): Renamed
	output_constructors_and_inits and writes all initializers in a
	single section rather than one per section.
	(lto_output): Moved loop over all constructors to
	output_constructors_and_inits.
	(gate_lto_out): Moved to lto-section-out.c. 
	* tree-ssa-sccvn.c (init_scc_vn): Removed unused bb var.
	* lto-header.h (lto_section_type): Changed prefix of all
	elements to "LTO_section".
	(lto_get_section_name): New function.
	(lto_get_section): Move from lto-section.h.
	(LTO_STREAM_DEBUGGING, LTO_DEBUG_INDENT, LTO_DEBUG_INDENT_TOKEN, 
	LTO_DEBUG_INTEGER, LTO_DEBUG_STRING, LTO_DEBUG_TOKEN, 
	LTO_DEBUG_TREE_FLAGS, LTO_DEBUG_UNDENT, LTO_DEBUG_WIDE,
	lto_debug_context, lto_debug_out): Moved from lto-tags.h.
	* lto-section.h: New file.
	* lto-tags.h (lto_function_header): Moved fields num_field_decls,
	num_fn_decls, num_var_decls, num_type_decls, num_types. to
	lto_decl_header in lto-section.h.
	(LTO_STREAM_DEBUGGING, LTO_DEBUG_INDENT, LTO_DEBUG_INDENT_TOKEN, 
	LTO_DEBUG_INTEGER, LTO_DEBUG_STRING, LTO_DEBUG_TOKEN, 
	LTO_DEBUG_TREE_FLAGS, LTO_DEBUG_UNDENT, LTO_DEBUG_WIDE,
	lto_debug_context, lto_debug_out): Moved to lto-tags.h.
	* lto-stream-debug.c: Include lto-header.h.
	* Makefile.in (LTO_TAGS_H, lto-stream-debug.o, lto-function-out.o,
	lto-section-out.o): Updated dependencies.
	(LTO_SECTION_H): New.
	* passes.c: (pass_ipa_lto_out): Renamed to pass_ipa_lto_gimple_out.
	(pass_ipa_lto_finish_out): New pass.
	* lto-section-out.c (lto_hash_decl_slot_node, lto_eq_decl_slot_node, 
	lto_hash_type_slot_node, lto_eq_type_slot_node,
	lto_output_decl_index): Moved from lto-function-out.c and
	renamed with "lto_" prefix.
	(lto_get_section_name, lto_get_out_decl_state, produce_asm_for_decls): New function.
	(write_references, gate_lto_out): Moved from lto-function-out.c.
	* lto-section-out.h (lto_out_decl_state): New structure.

2008-01-28  Kenneth Zadeck <zadeck@naturalbridge.com>
	* cgraph.h (cgraph_edge.lto_stmt_uid): New field.
	* lto-function-out.c (output_constructor, output_expr_operand,
	output_phi, output_bb, output_function): Removal of code to thread
	the stmt_number thru the code.
	(produce_asm): Moved code to create dwarf_sections to
	lto_section_out.c.  Encapsulated section type independent code
	into separate header structure.  Changed to use enum section_type.
	(output_function, output_constructor_or_init): Added call to
	renumber_gimple_stmt_uids and to pass section type to produce_asm.
	(lto_output): Pass cgraph node rather than decl to
	output_function.
	* tree-ssa-dse (max_stmt_uid): Removed.
	(get_stmt_uid, dse_possible_dead_store_p, dse_optimize_stmt, 
	tree_ssa_dse): Encapsulate all uses of stmt_ann->uid.
	* tree-ssa-sccvn.c (compare_ops, init_scc_vn): Ditto.
	* lto-header.h: New
	* function.h (cfun.last_stmt_uid): New field.
	* lto-tags.h (lto_header): Renamed to lto_function_header and
	moved shared fields to lto_header in lto-header.h.
	(LTO_SECTION_NAME_PREFIX): Moved to lto-header.h.
	* tree-flow-inline.h (set_gimple_stmt_uid, gimple_stmt_uid,
	gimple_stmt_max_uid, set_gimple_stmt_max_uid, 
	inc_gimple_stmt_max_uid): New functions.
	* tree-dfa.c (renumber_gimple_stmt_uids): New function.
	(create_stmt_ann): Initialize the ann->uid field.
	* tree-ssa-pre.c (compute_avail): Encapsulate the stmt_ann->uid
	with new calls.
	* tree-flow.h (renumber_gimple_stmt_uids): New function.
	* lto-section-out.c (lto_get_section): New function.
	* lto-section-out.h (lto_get_section): New function.
	
2008-01-14  Kenneth Zadeck <zadeck@naturalbridge.com>
	* lto-function-out (lto_debug_context, output_stream,
	LTO_SET_DEBUGGING_STREAM): Moved to lto_section_out.h.
	(debug_out_fun): Renamed lto_debug_out_fun and moved to
	lto_section_out.c.
	(write_stream): Renamed lto_write_stream and moved to
	lto_section_out.c.
	(output_1_stream): Renamed lto_output_1_stream and moved to
	lto_section_out.c.
	(output_uleb128_stream): Renamed lto_output_uleb128 and moved to
	lto_section_out.c.
	(output_widest_uint_uleb128_stream): Renamed
	lto_output_widest_uint_uleb128_stream and moved to
	lto_section_out.c.
	(output_sleb128_stream): Renamed lto_output_sleb128_stream and
	moved to lto_section_out.c.
	(output_string, output_decl_index, output_record_start,
	output_constructor, output_expr_operand, output_local_vars,
	output_local_vars_index, output_ssa_names, output_bb, produce_asm,
	output_function, output_constructor_or_init): Renamed all calls as above.
	(output_integer): Guts moved to lto_output_integer_stream.
	(output_expr_operand, output_local_var, output_cfg, output_phi,
	output_bb, output_function): 
	Added stmt_num parameter.
	* lto-tags.h (lto_debug_context): Added.
	* lto-section-out.c: New file that contains functions moved and
	renamed from lto-function-out.
	* lto-section-out.h: New file that contains declarations in
	lto-section-out.c. 
	* Makefile.in (lto-section-out.o): New rule.
	
2008-01-07  Diego Novillo  <dnovillo@google.com>

	http://gcc.gnu.org/ml/gcc-patches/2008-01/msg00263.html

	* dwarf2out.c (force_decl_die): Initialize SAVED_IGNORED_FLAG.
	* dwarf2.h (enum dwarf_type): Remove trailing comma.

2007-12-29  Nathan Froyd  <froydnj@codesourcery.com>

	* collect2.c (scan_prog_file): Read all the output when reading
	information for LTO.

2007-12-24  Nathan Froyd  <froydnj@codesourcery.com>

	* lto-function-out.c (output_local_vars): Output DECL_INITIAL
	regardless of whether we are outputting the function in which
	it was defined.

2007-12-22  Nathan Froyd  <froydnj@codesourcery.com>
	    Kenneth Zadeck <zadeck@naturalbridge.com>

	* dwarf2out.c (force_decl_die): Unset the DECL_IGNORED_P flag if
	we are called from LTO.  Remove the DW_AT_declaration flag if the
	decl has an initial value.
	* lto-function-out.c (output_expr_operand): Add explicit check
	for statics or externs rathen than use DECL_CONTEXT.
	(output_local_vars): Serialize the DECL_INITIAL field of local
	statics and add it the unexpanded_vars_list as necessary.

2007-12-19  Doug Kwan  <dougkwan@google.com>

	* dwarf2out.c (base_type_de): Use DW_ATE_GNU_complex_unsigned
	and DW_ATE_GNU_complex_signed as appropriate instead of using
	DW_ATE_lo_user.
	
	* dwarf2.h (DW_ATE_GNU_complex_signed, DW_ATE_GNU_complex_unsigned):
	New encoding formats.

2007-12-18  Doug Kwan  <dougkwan@google.com>

	* real.c (real_to_decimal, real_to_hexadecimal): Distinguish
	QNaN & SNaN.
	(real_from_string): Handle NaNs and Inf as approriate.

2007-12-17  Kenneth Zadeck <zadeck@naturalbridge.com>

	* lto-function-out.c (output_block.unexpanded_local_decls_index): New vector.
	(destroy_output_block): Added missing ifdef.
	(output_decl_index): Added this_index to return added index.
	(output_type_ref): Added parameter to output_decl_index.
	(output_local_decl_ref): Added write parameter and code to initialize 
	unexpanded_local_decls_index.
	(output_expr_operand): Added extra operands to output_decl_index and
	output_local_decl_ref.
	(output_local_var): New function split out from output_local_vars.
	(output_local_vars): Added code to string unexpanded_var_list separately.
	(output_function): Added code to output decl_context for function.

2007-12-13  Nathan Froyd  <froydnj@codesourcery.com>

	* dwarf2out.c (mark_die_used): New function.
	(lto_init_ref): Call it.

2007-12-13  Nathan Froyd  <froydnj@codesourcery.com>

	* langhooks.h (struct lang_hooks) Add comment for
	reduce_bit_field_operations.

2007-12-12  Bill Maddox  <maddox@google.com>

	Revert
	2007-12-07  Bill Maddox  <maddox@google.com>

	* dwarf2out.c (AT_string_form): Remove code to suppress
	the use of the DWARF string table.

2007-12-07  Bill Maddox  <maddox@google.com>

	* dwarf2out.c (AT_string_form): Remove code to suppress
	the use of the DWARF string table.

2007-12-07  Nathan Froyd  <froydnj@codesourcery.com>

	* tree-flow.h (init_empty_tree_cfg_for_function): Declare.
	* tree-cfg.c (init_empty_tree_cfg_for_function): Define.
	(init_empty_tree_cfg): Call it.
	* lto_function-out.c (output_cfg): Write out the block chain.

2007-12-07  Nathan Froyd  <froydnj@codesourcery.com>

	* dwarf2out.c (containing_decl_for_block): New function.
	(force_block_die): Call it.
	(dwarf2out_finish): Call it if we have a BLOCK for our context.

2007-12-06  Nathan Froyd  <froydnj@codesourcery.com>

	* lto-function-out.c (write_references): New function.
	(produce_asm): Call it.

2007-12-03  Nathan Froyd  <froydnj@codesourcery.com>

	* tree-into-ssa.c (rebuild_ssa_for_lto): Remove.
	(pass_rebuild_ssa_for_lto): Remove.
	* tree-optimize.c (gate_early_lto_passes): Remove.
	(pass_early_lto_passes): Remove.
	* passes.c (init_optimization_passes): Remove pass_early_lto_passes
	and its sub-passes.
	* tree-pass.h (pass_early_lto_passes, pass_rebuild_ssa_for_lto):
	Remove.
	* lto-tree-flags.def (VAR_DECL): Add volatile_flag.

2007-11-30  Nathan Froyd  <froydnj@codesourcery.com>

	* lto-tree-flags.def (RESULT_DECL): Add gimple_reg_flag.

2007-11-29  Kenneth Zadeck <zadeck@naturalbridge.com>

	* lto-function-out.c (output_expr_operand): Fix STRING_CST to
	always have type.

2007-11-21  Nathan Froyd  <froydnj@codesourcery.com>

	* dwarf2out.c (gen_subprogram_die): Inhibit generation of labels
	if we are being called for LTO's purposes.
	(gen_variable_die): Don't generate multiple DIEs for and equate
	the generated DIE with the decl for global variables.
	(force_decl_die): Don't play games with DECL_EXTERNAL if we are
	forcing a DIE for a global variable.
	(lto_typedecl_ref): Remove assert.

2007-11-16  Kenneth Zadeck <zadeck@naturalbridge.com>

	* lto-function-out.c (output_expr_operand): Get types right 
	for COMPLEX_CST.

2007-11-16  Nathan Froyd  <froydnj@codesourcery.com>

	* c-common.c (c_build_bitfield_integer_type): Rename this...
	* stor-layout.c (make_bitfield_integer_type): ...to this.
	* c-decl.c (finish_struct): Use new name.
	* c-common.h (c_build_bitfield_integer_type): Move declaration...
	* tree.h (make_bitfield_integer_type): ...here.

2007-11-16  Kenneth Zadeck <zadeck@naturalbridge.com>

	* lto-tree-flags.def (tcc_constant): Added static_flag.
	(tcc_vl_exp): Added asm_written_flag.
	* lto-function-out.c (output_local_vars): Output DECL_INITIAL
	for static local vars.
	(lto_types_needed_for): Added STRING_CST.
	* tree-cfg.c (dump_function_to_file): Add verbose dump for
	local vars and parms.

2007-11-15  Nathan Froyd  <froydnj@codesourcery.com>

	* tree.h (DECL_CONTEXT): Note that this applies to RESULT_DECLs too.

2007-11-15  Kenneth Zadeck <zadeck@naturalbridge.com>

	* tree-dump.c (dump_options): Removed verbose from -all option.
	* tree-pretty-print.c (dump_phi_nodes, dump_generic_bb_buff): 
	Fixed && vs & dyslexia.
	* lto-tree-flags.def (ADD_CLASS_FLAG) Renamed to ADD_CLASS_EXPR_FLAG.
	(ADD_CLASS_DECL_FLAG): New macro.
	(OMP_ATOMIC_LOAD, OMP_ATOMIC_STORE): New cases.
	* lto-function-out (output_tree_flags, lto_debug_tree_flags):
	Renamed to ADD_CLASS_EXPR_FLAG. ADD_CLASS_DECL_FLAG New Macro.
	(output_expr_operand): Added type for SWITCH_EXPR.
	* tree-cfg.c (dump_function_to_file): Fixed && vs & dyslexia.

2007-11-14  Diego Novillo  <dnovillo@google.com>

	Merge with mainline @130155.

	* configure.ac (ACX_PKGVERSION): Update revision merge
	string.
	* configure: Regenerate.

2007-11-13  Diego Novillo  <dnovillo@google.com>

	* lto-function-out.c (output_tree_flags): Declare local
	variable CURRENT_COL.  Fix existing misspellings of its
	name.
	* dwarf2out.c (lto_typedecl_ref): Remove unused variable.
	Reformat comments.

2007-11-13  Kenneth Zadeck <zadeck@naturalbridge.com>

	* lto-tree-flags.def (PARM_DECL): Serialize the addressable_flag.
	(PHI_NODE): Serialize the asm_written_flag.

2007-11-13  Kenneth Zadeck <zadeck@naturalbridge.com>

	* lto-function-out.c (output_expr_operand): Get the types
	correct for vector-cst.
	* tree-cfg.c (dump_function_to_file): Print the
	function_decl in verbose mode.

2007-11-13  Diego Novillo  <dnovillo@google.com>

	* lto-tags.h: Call #error if BITS_PER_LTO_FLAGS_TYPE is
	not wide enough.

2007-11-13  Doug Kwan  <dougkwan@google.com>

	* lto-function-out.c (output_widest_uint_uleb128_stream,
	output_widest_uint_uleb128): New functions. 
	(output_tree_flags): Use lto_flags_type instead of unsigned
	HOST_WIDE_INT.  Call output_widest_unint_uleb128 instead of
	output_uleb128.
	(lto_debug_tree_flags): Replace HOST_BITS_PER_WIDE_INT with
	BITS_PER_LTO_FLAGS_TYPE as appropriate.
	* lto-tags.h (lto_flags_type): New type.
	(BITS_PER_LTO_FLAGS_TYPES): New macro.
	(lto_debug_tree_flags): Change prototype to use
	lto_flags_type.

2007-11-13  Kenneth Zadeck <zadeck@naturalbridge.com>

	* lto-function-out.c (output_constructor): Modified to output
	index field if it exists.
	(output_expr_operand): Removed incorrect assert about type names.
	Added RANGE_EXPR case.
	* lto-tree-flags.def (LTO_constructor_range): Removed.
	* lto-tags.h (LTO_constructor_range): Removed.
		
2007-11-11  Kenneth Zadeck <zadeck@naturalbridge.com>

	* doc/invoke.text (-fdump-tree-*-verbose): New option.
	* tree-dump.c (dump_options): New verbose option.
	* tree-pretty-print.c (dump_phi_nodes, dump_generic_bb_buff):
	Add verbose dump.
	* lto-tree-flags.def (tcc_expression, tcc_gimple_stmt,
	tcc_statement): Add asm_written flag to support undocumented use.
	(FUNCTION_DECL): Removed all flags since these are not serialized
	by lto-function-out.
	(VAR_DECL): Reorganized flags and added missing ones.
	* tree-pass.h (TDF_VERBOSE): New dump flag.
	* lto-function-out.c (output_tree_flags): Removed ADD_FUNCT_FLAG
	macro.  Added fixes to get line numbers correct.
	(pass_ipa_lto_out): Fixed dump options and name.
	* lto-flags.h (LTO_SOURCE_*): Removed conditional code
	USE_MAPPED_LOCATION.
	(LTO_SOURCE_HAS_LOC): New macro.
	* tree-dfa-c (pass_referenced_var): Added dump option.
	* print-tree.c (print_node): Added code to be able to print
	PHI_NODES.
	(tree-flow.h): Added include.
	Makefile.in (print-tree.o):  Added TREE_FLOW_H.
		
2007-11-09  Nathan Froyd  <froydnj@codesourcery.com>

	* dwarf2out.c (lto_var_ref): Don't remove DW_AT_declaration.

2007-11-09  Nathan Froyd  <froydnj@codesourcery.com>

	* dwarf2out.h (dwarf2_generate_frame_info_p): Rename this...
	(dwarf2_called_from_lto_p): ...to this.
	* dwarf2out.c (dwarf2_generate_frame_info): Rename this...
	(dwarf2_called_from_lto_p): ...to this.
	(gen_subprogram_die): Use dwarf2_called_from_lto_p and invert sense.
	(add_high_low_attributes): Disable generation of the attributes if
	we are generating information for LTO.
	* lto-function-out.c (output_function): Use push_cfun and pop_cfun.
	(lto_output): Use dwarf2_called_from_lto_p and invert sense.

2007-11-09  Nathan Froyd  <froydnj@codesourcery.com>

	* dwarf2out.c (lto_var_ref): Remove DW_AT_declaration if we are
	forcing an initialized global variable.

2007-11-08  Nathan Froyd  <froydnj@codesourcery.com>

	* c-decl.c (match_builtin_function_types): Move this...
	* tree.c (match_builtin_function_types): ...here.
	* tree.h (match_builtin_function_types): Declare it.

2007-11-08  Nathan Froyd  <froydnj@codesourcery.com>

	* gengtype.c (main): Add uint64_t as a typedef.

2007-11-07  Nathan Froyd  <froydnj@codesourcery.com>

	* doc/gty.texi (Source Files Containing Type Information): Note
	that headers should appear first in the gtfiles list.

2007-11-06  Doug Kwan  <dougkwan@google.com>

        * lto-function-out.c (output_record_start): Check for presence of
        type before calling output_type_ref.
		  
2007-11-06  Alon Dayan <alond@il.ibm.com>
	    Kenneth Zadeck <zadeck@naturalbridge.com>

     	* lto-function-out.c: (output_tree_flags): Use expanded location for exprs.
	(output_tree_flags, lto_debug_tree_flags): 
	Macro add flags of size>1.
     	* lto-tree-flags.def: Likewise.

2007-11-02  Nathan Froyd  <froydnj@codesourcery.com>

	* dwarf2out.c (force_block_die): Implement.  

2007-11-02  Nathan Froyd  <froydnj@codesourcery.com>

	* lto-function-out.c (output_expr_operand): Change the
	single-argument RETURN_EXPR case to check whether we are writing
	out DECL_RESULT.
	
2007-11-01  Kenneth Zadeck <zadeck@naturalbridge.com>

	* lto-function-out.c (output_tree_list): Removed function.
	(output_expr_operand): Added case for TREE_LIST, and
	IDENTIFER_NODE and changed ASM_EXPRs to recursively call
	output_expr_operand.
	(output_local_vars): Changed some calls from output_uleb128 to
	output_zero and changed calls to output_tree_list to
	output_expr_operand.
	(output_ssa_names): Changed some calls from output_uleb128 to
	output_zero.
	(lto_static_init): Initialized IDENTIFIER_NODE and TREE_LIST
	cases.
	* lto-tree-tags.def: Ditto.
	* lto-tags.h: Ditto.
	
	
2007-10-31  Nathan Froyd  <froydnj@codesourcery.com>

	* lto-function.c (output_expr_operand): Assert that DECL_NAME of a
	TYPE_DECL is NULL, as it should be for function-local TYPE_DECLs.
	(lto_static_init): Reset the bit for TYPE_DECLs in
	lto_flags_needed_for and lto_types_needed_for.
	(generate_early_dwarf_information): Move the setting of
	dwarf2_generate_frame_info_p to...
	(lto_output): ...here.
	* dwarf2out.c (force_decl_die): Don't handle TYPE_DECL.
	(lto_typedecl_ref): Dump a reference to the decl's type instead of
	the decl itself.

2007-10-30  Nathan Froyd  <froydnj@codesourcery.com>

	* Makefile.in (lto/lto-stream-debug.o): Add dependency on $(TREE_H).

2007-10-29  Kenneth Zadeck <zadeck@naturalbridge.com>

	* lto-tree-flags.def (VAR_DECL): Added seen_in_bind_expr flag.
	* lto-function-out.c (struct output_block): Added
	type_decl_hash_table, next_type_decl_index, type_decls,
	current_col. Changed last_file to current_file. Changed last_line
	to current_line.
	(clear_line_info): New function.
	(create_output_block): Added call to clear_line_info.  Added
	initialization of type_decl_hash_table.
	(destroy_output_block): Added destruction of type_decl_hash_table.
	(output_string): Fixed type snafu.
	(output_tree_flags): Added force_loc parameter and uses of it.
	Full rewrite of processing of line numbers.
	(output_expr_operand): Added TYPE_DECL case.
	(output_local_vars): Properly handle TREE_CHAIN and DECL_CONTEXT.
	(output_named_labels, output_constructor_or_init): Added call to
	clear_line_info.
	(output_ssa_names): Added parm to not process line numbers for ssa
	names.
	(produce_asm): Added code to output type_decls.
	(output_function): Added call to clear_line_info.  Moved
	production of labels to after local_vars to get processing of
	context correct.
	* lto-tree-tags.def (LTO_type_decl): New tag.
	* lto-tags.h (lto_header): Added num_type_decls.
	(LTO_type_decl): New tag.
	(LTO_SOURCE_FILE, LTO_SOURCE_LINE, LTO_SOURCE_LOC_BITS,
	LTO_SOURCE_COL): New macros.
	* tree-dfa.c (find_referenced_vars): Added code to walk phi
	operands.
	

2007-10-29  Nathan Froyd  <froydnj@codesourcery.com>

	* dwarf2out.h (lto_typedecl_ref): Declare.
	* dwarf2out.c (force_die_for_context): New function.
	(force_decl_die): Use it.  Handle TYPE_DECLs.
	(force_type_die): Use it.
	(force_block_die): New function.
	(lto_typedecl_ref): New function.

2007-10-22  Kenneth Zadeck <zadeck@naturalbridge.com>

	* lto-function-out.c (output_tree_flags): Changed type of
	flags and enhanced stream debugging for flags.
	(output_local_vars): Added debugging for tree_chains.
	(lto_debug_tree_flags): New function.
	* lto-flags.h (lto_debug_tree_flags): New function.
	(LTO_flags_needed): New LTO_tags.
	(LTO_DEBUG_TREE_FLAGS): New macro.
	* Makefile.in (LTO_TAGS_H): Add tree.h dependency.


2007-10-19  Diego Novillo  <dnovillo@google.com>

	* gcc.c (cc1_options): Force -O2 if -flto is given.
	* collect2.c (maybe_run_lto_and_relink): Tidy formatting.
	Add -O2 when calling gcc to do an LTO link.
	(scan_prog_file): Send the error output of 'nm' to HOST_BIT_BUCKET.

2007-10-19  Nathan Froyd  <froydnj@codesourcery.com>

	* dwarf2out.c (gen_decl_die): Check cgraph_global_info_ready to determine
	whether we can output information for abstract instances.

2007-10-18  Kenneth Zadeck <zadeck@naturalbridge.com>

	* tree-into-ssa.c (get_default_def_for, rewrite_stmt,
	maybe_register_def): Add cfun parameter to make_ssa_name.
	* tree-ssa-loop-im.c (rewrite_reciprocal, rewrite_bittest): Ditto.
	* tree-complex.c (get_component_ssa_name): Ditto.
	* tree-ssa-loop-manip.c (create_iv, tree_transform_and_unroll_loop): Ditto.
	* tree-tailcall.c (adjust_accumulator_values,
	adjust_return_value, tree_optimize_tail_calls_1): Ditto.
	* tree.h (extern void phinodes_print_statistics): Ditto.
	* tree-phinodes.c (make_phi_node): Ditto.
	* omp-low.c (expand_parallel_call, expand_omp_parallel,
	expand_omp_for_static_chunk): Ditto.
	* tree-parloops.c (take_address_of, separate_decls_in_loop,
	transform_to_exit_first_loop, create_parallel_loop): Ditto.
	* matrix-reorg.c (transform_access_sites): Ditto.
	* tree-if-conv.c (ifc_temp_var): Ditto.
	* gimplify.c (gimplify_modify_expr): Ditto.
	* tree-ssa-phiopt.c (conditional_replacement, abs_replacement,
	cond_store_replacement): Ditto.
	* tree-ssa-pre.c (create_expression_by_pieces, insert_fake_stores): Ditto.
	* tree-predcom.c (initialize_root_vars,
	* initialize_root_vars_lm, execute_load_motion,
	reassociate_to_the_same_stmt): Ditto.
	* tree-ssa-forwprop.c (phiprop_insert_phi): Ditto.
	* tree-vect-patterns.c (vect_pattern_recog_1): Ditto.
	* lambda-code.c (lambda_loopnest_to_gcc_loopnest,
	replace_uses_equiv_to_x_with_y, perfect_nestify): Ditto.
	* tree-inline.c (remap_ssa_name): Ditto.
	* tree-vect-transform.c (vect_create_data_ref_ptr,
	bump_vector_ptr, vect_init_vector,
	get_initial_def_for_induction,
	get_initial_def_for_induction,
	vect_create_epilog_for_reduction, vect_finalize_reduction,
	vectorizable_reduction, vectorizable_call,
	vect_gen_widened_results_half, vectorizable_conversion,
	vectorizable_assignment, vectorizable_operation,
	vectorizable_type_demotion, vect_permute_store_chain,
	vect_setup_realignment, vect_permute_load_chain,
	vectorizable_load, vectorizable_condition,
	vect_create_cond_for_align_checks): Ditto.
	* tree-outof-ssa.c (insert_backedge_copies): Ditto.
	* tree-cfg.c (tree_make_forwarder_block, replace_ssa_name): Ditto.
	* tree-ssanames.c (duplicate_ssa_name): Ditto.
	(make_ssa_name): Use struct function parameter rather than cfun.
	* lto-function-out.c (output_local_vars): Add chaining for parm_decls.

2007-10-17  Nathan Froyd  <froydnj@codesourcery.com>

	* dwarf2out.c (gen_subprogram_die): Don't remove attributes and
	formal parameters if we are generating LTO objects, as the formal
	parameters likely have references to them from elsewhere.
	Instead, return early if we find a DIE for this decl.

2007-10-16  Kenneth Zadeck <zadeck@naturalbridge.com>

	* lto-function-out.c (output_integer): Added casting.
	(output_tree_list): Remove the tag parameter and the record.
	(output_expr_operand): Make the asm operands use output_tree_list.
	(output_local_vars): Remove LTO_attribute_list.
        * lto-tree-tags.def (LTO_attribute_list): Removed.
	* lto-tags.h (LTO_attribute_list): Removed.

2007-10-16  Kenneth Zadeck <zadeck@naturalbridge.com>

	* lto-function-out.c (struct string_slot): Added len.
	(eq_string_slot_node): Fixed to honor real length of strings with nulls.  
	(output_string): Set len and fix debugging.
	(output_expr_operand): Output CASE_HIGH and CASE_LOW properly.

2007-10-05  Nathan Froyd  <froydnj@codesourcery.com>

	* dwarf2out.h (dwarf_attr_name): Declare.
	* dwarf2out.c (dwarf_attr_name): Remove declaration and change
	definition accordingly.

2007-10-05  Diego Novillo  <dnovillo@google.com>

	* lto-function-out.c (output_constructor): Handle constructor elts
	with NULL indices.
	(output_expr_operand): Check whether the variable is in the
	global scope.
	(lto_output): Only handle statics that are in the global
	scope.
	* tree-nested.c (get_trampoline_type): Set DECL_CONTEXT for
	the new field.

	Backport

	2007-07-26  Doug Kwan  <dougkwan@google.com>

	* dwarf2out.c: (may_reference_to_unsued) : Renamed from
	reference_to_unsued as it is now more conservative than
	before. Replace unreachable assert into a return that tells
	caller that tree may reference an unused DECL.
	(rtl_for_decl_init): Rename callee to may_reference_to_usused.

2007-10-04  Kenneth Zadeck <zadeck@naturalbridge.com>

	* lto-tree-flags.def (FIXED_CONVERT_EXPR, FIXED_CST, FIXED_POINT_TYPE,
	OMP_SECTIONS_SWITCH): Added new tree codes.
	* lto-function-out.c (lto_static_init): Added types for FIXED_CONVERT_EXPR,
	FIXED_CST.
	* lto-tree-tags.def (FIXED_CONVERT_EXPR, FIXED_CST): Added mappings.
	* lto-tags.h (LTO_fixed_convert_expr, LTO_fixed_cst): New codes.

2007-10-02  Kenneth Zadeck <zadeck@naturalbridge.com>

	* omp-low.c (expand_omp_parallel): Added struct function param
	to init_tree_ssa.
	* passes.c (dump_properties): Removed reference to PROP_pta.

2007-09-26  Nathan Froyd  <froydnj@codesourcery.com>

	* dwarf2out.h (dwarf2_generate_frame_info_p): Declare.
	* dwarf2out.c (dwarf2_generate_frame_info_p): Define it.
	(gen_subprogram_die): Consult it to determine whether to generate
	frame information.
	(lto_type_ref): Remove sorry call.
	* lto-function-out.c (generate_early_dwarf_information): New function.
	(output_function): Call it.  Set current_function_decl and cfun to
	facilitate DWARF generation.

2007-09-11  Bill Maddox  <maddox@google.com>

	Add `gcc' driver support for link-time code generation (LTO).

	* collect2.c (enum pass): Add new literal PASS_LTOINFO.
	(lto_flag, lto_objects, lto_o_file): New variables.
	(struct lto_object, struct lto_object_list): New structures.
	(collect_exit, handler): Remove LTO temporary output file on exit.
	(add_lto_object): New function.
	(maybe_run_lto_and_relink): New function. Perform link time code
	generation and relinking for object files containing LTO information.
	(main): Invoke maybe_run_lto_and_relink().
	(dump_argv): New function.  For debugging, currently disabled.
	(scan_prog_file): Add LTO information pass.
	* gcc.c (LINK_COMMAND_SPEC): Pass `-flto' switch to linker, i.e.,
	collect2.
	* toplev.c (compile_file): Emit assembler directive to create
	the `gnu_lto_v1' marker symbol when compiling with `-flto'.

2007-09-11  Kenneth Zadeck <zadeck@naturalbridge.com>

	* lto-function-out.c (lto_static_init): Added type for STRING_CST.

2007-09-11  Kenneth Zadeck <zadeck@naturalbridge.com>

	* lto-function-out.c (output_constructor): Allow anything in the tree.
	* lto-tree-tags.def (POINTER_PLUS_EXPR): New tree type.

2007-09-05  Jan Hubicka  <jh@suse.cz>

	* cgraphbuild.c (build_cgraph_edges): Export.
	* cgraph.h (build_cgraph_edges): Declare.
	* cgraphunit.c (cgraph_finalize_function): Rebuild cgraph edges.

2007-08-29  Kenneth Zadeck <zadeck@naturalbridge.com>

	* lto-function-out.c (LTO_SET_DEBUGGING_STREAM): Now swallows
	semicolons.
	(LTO_CLEAR_DEBUGGING_STREAM): New macro.
	(create_output_block, destroy_output_block,
	output_constructor_or_init): New functions.
	(produce_asm, lto_output): Modified to produce both functions and
	constructors.
	(output_function): Much of the function that could be used to also
	handle constructors has been moved to create_output_block and
	destroy_output_block.
	* lto-tags.h (lto_function_header): Renamed to lto_header.
		
2007-08-28  Kenneth Zadeck <zadeck@naturalbridge.com>

	* lto-function-out (output_expr_operand): Reorder the fields
	in the stream for CALL_EXPRs.
	(lto_static_init): Do not put out types for FUNCTION_DECLs.

2007-08-28  Kenneth Zadeck <zadeck@naturalbridge.com>

	* lto-function-out.c (output_block): Added
	local_decl_index_stream, debug_decl_index_stream,
	local_decls_index and local_decls_index_d.
	(output_local_vars): Add code to write a seperate stream
	containing the index of each local var.
	(output_local_vars_index): New function.
	(produce_asm, output_function): Write new streams.
	(lto_static_init): Do not write flags or types for FIELD_DECLS.
	* lto-tags.h (lto_debug_context): Added decl_index_data.
	
2007-08-15  Jim Blandy  <jimb@codesourcery.com>

	* dwarf2out.c (lto_field_ref, force_field_die): New functions.
	* dwarf2out.h (lto_field_ref): New declaration.

2007-08-05  Mark Mitchell  <mark@codesourcery.com>

	* tree.h (FILE_SCOPE_P): New macro.
	(DECL_FILE_SCOPE_P): Use it.
	* dwarf2out.c (lto_type_ref): Use FILE_SCOPE_P to test whether
	an entity is at file scope.

2007-08-02  Kenneth Zadeck <zadeck@naturalbridge.com>
        * lto-tags.h (LTO_DEBUG_INDENT, LTO_DEBUG_INDENT_TOKEN,
	LTO_DEBUG_INTEGER, LTO_DEBUG_STRING, LTO_DEBUG_TOKEN,
	LTO_DEBUG_UNDENT, LTO_DEBUG_WIDE): Change "useless_function ()" to
	"(void)0"
	(useless_function): Removed.

	
2007-08-01  Kenneth Zadeck <zadeck@naturalbridge.com>

	* lto-function-out.c (output_1_stream, output_zero,
	output_sleb128_stream, output_string, output_real, output_integer,
	output_tree_flags, output_type_ref, output_record_start,
	output_tree_list, output_eh_cleanup, output_eh_try,
	output_eh_catch, output_eh_allowed, output_eh_must_not_throw,
	output_eh_regions, output_constructor, output_expr_operand,
	output_local_vars, output_cfg, output_phi, output_bb,
	output_function): Added semicolons.
	* lto-tags.h (LTO_DEBUG_INDENT, LTO_DEBUG_INDENT_TOKEN,
	LTO_DEBUG_INTEGER, LTO_DEBUG_STRING, LTO_DEBUG_TOKEN, 
	LTO_DEBUG_UNDENT, LTO_DEBUG_WIDE): Changed to support semicolon
	after macro call.
	(useless_function): New function.
	

2007-07-31  Kenneth Zadeck <zadeck@naturalbridge.com>

	* lto-function-out.c (produce_asm): Remove old debugging code.
	(output_function): Serialize DECL_ARGUMENTS.

2007-07-31  Kenneth Zadeck <zadeck@naturalbridge.com>

	* tree-into-ssa.c (rebuild_ssa_for_lto): New function.
	(pass_rebuild_ssa_for_lto): New pass.
	* cgraph_build.c (tree_opt_pass pass_rebuild_cgraph): Added some dumping.
	* lto-tree-flags.def (tcc_declaration): Added used_flag to serialized list.
	(SSA_NAME): Added nothrow_flag and volatile_flag to serialized list.
	* tree-pass.h (pass_early_lto_passes, pass_rebuild_ssa_for_lto): New passes.
	* lto-function-out.c (output_tree_flags): Added code to properly
	control writing of flags. Also added new parameter to pass in the
	tree code.
	(output_record_start, output_local_vars): Added param to
	output_tree_flags.
	(output_tree_list, output_eh_cleanup, output_eh_try,
	output_eh_catch, output_eh_allowed, output_eh_must_not_throw,
	output_eh_regions): Added missing debugging undent.
	(output_expr_operand): Added assert that there was no rtl and code
	to properly handle COND_EXPR.  Fixed the outputing of types and
	flags for many tree codes.
	(output_phi): Fixed the outputing of types and flags.  Generalized
	to handle parameters to phi that are not SSA_NAMES.
	(output_bb, LTO_SET_DEBUGGING_STREAM): Added assert to check for
	proper debug stream usage.
	(lto_static_init): Changed the outputting of flags and types for
	various tree codes.
	(pass_ipa_lto_out): Added dumping.
	* ipa-inline.c (pass_inline_parameters): Added dumping.
	* lto-tree-tags.def (COND_EXPR): Changed processing options.
	* lto-tags.h: Changed define into enum.
	* ipa.c (gate_ipa_fun_and_var_visibility): Always execute this
	pass.
	* tree.def (COND_EXEC): Properly documented this code.
	* tree-dfa.c (find_referenced_vars): Added code to walk phi
	functions.
	(pass_referenced_vars): Added name and dump flag.
	(find_vars_r): Now handles SSA_NAMES.
	* tree-optimize.c (gate_early_lto_passes): New function.
	(pass_early_lto_passes): New pass.
	* passes.c (pass_early_lto_passes): New pass.
	(dump_properties, debug_properties): New debugging function.
	* tree-ssanames.c (pass_release_ssa_names): Added dumping.
	
	
2007-07-19  Jan Hubicka  <jh@suse.cz>

	* cgraphunit.c (cgraph_finalize_function): Set properties of lowered
	body.

2007-07-13  Kenneth Zadeck <zadeck@naturalbridge.com>

	* flags.h (in_lto_p): New flag.
	* lto-tree_flags.def (CHANGE_DYNAMIC_TYPE_EXPR, POINTER_PLUS_EXPR): 
	New tree codes from merge.
	* tree.h (init_ssanames): Added cfun parameter.
	* lto-function-out.c: (ssa_names_stream, cfg_stream): New streams.
	(output_eh_regions): Renamed parameter cfun to fn.
	(output_expr_operand): Implemented SSA_NAME and GIMPLE_MODIFY_STMT
	cases.
	(output_local_vars): Set the local_vars stream locally.
	(output_ssa_names, output_cfg, output_phi): New function.
	(output_bb): Changed the cfun parameter to fn.  Do not put out cfg
	locally.  Output the phi_functions.
	(produce_asm): Add code to support ssa_names and cfg streams.
	(lto_static_init): Added GIMPLE_MODIFY_STMT.
	(LTO_SET_DEBUGGING_STREAM): New macro.
	(output_function): Add code to support ssa_names and cfg streams.
	* toplev.c (in_lto_p): Initialize.
	* ipa-inline.c (cgraph_gate_ipa_early_inlining): Added test for
	in_lto_p.
	* lto-tree-tags.def (GIMPLE_MODIFY_STMT, PHI_NODE): New tags.
	(LTO_change_dynamic_type_expr, LTO_gimple_modify_stmt,
	LTO_phi_node, LTO_pointer_plus_expr): New names.
	lto-tags.h (ssa_names_size, cfg_size, debug_ssa_names_size,
	debug_cfg_size): New fields in lto_function_header.
	(LTO_change_dynamic_type_expr, LTO_gimple_modify_stmt,
	LTO_phi_node, LTO_pointer_plus_expr): New fields and renumbered
	the rest.
	(ssa_names_data, cfg_data): New fields of lto_debug_context.
	* ipa.c (flags.h): New include.
	(gate_ipa_fun_and_var_visibility): New function for
	pass_ipa_function_and_variable_visibility.
	* tree-ssa.c (init_tree_ssa): Add fn parameter and replaced refs
	to cfun.
	* tree-inline.c (initialize_cfun): Ditto.
	* tree-optimize.c (gate_all_early_local_passes): Added ref to
	in_ltp_p.
	(execute_init_datastructures): Added cfun parameter to
	init_tree_ssa.
	* tree-flow.h (init_tree_ssa): Added struct function parameter.
	* Makefile.in (ipa.o): Added FLAGS_H dependency.
	* tree-ssanames.c (init_ssanames): Added two parameters.  Now
	takes struct function and default size.

	
2007-06-26  Kenneth Zadeck <zadeck@naturalbridge.com>

	* lto-tree-flags.def (tcc_gimple_stmt): New TREE_CLASS.
	(GIMPLE_MODIFY_STMT, MEMORY_PARTITION_TAG, VEC_WIDEN_MULT_HI_EXPR,
	VEC_WIDEN_MULT_LO_EXPR, VEC_UNPACK_HI_EXPR,
	VEC_UNPACK_LO_EXPR, VEC_UNPACK_FLOAT_HI_EXPR,
	VEC_UNPACK_FLOAT_LO_EXPR, VEC_PACK_TRUNC_EXPR,
	VEC_PACK_SAT_EXPR, VEC_PACK_FIX_TRUNC_EXPR,
	VEC_EXTRACT_EVEN_EXPR, VEC_EXTRACT_ODD_EXPR,
	VEC_INTERLEAVE_HIGH_EXPR, VEC_INTERLEAVE_LOW_EXPR): New
	TREE_EXPRs.


2007-06-23  Mark Mitchell  <mark@codesourcery.com>
	
	* configure.ac: Use AC_CHECK_HEADERS to find libelf.h.
	* config.in: Regenerated.
	* configure: Likewise.

	* lto-tags.h (LTO_last_tag): Update.

2007-06-21  Kenneth Zadeck <zadeck@naturalbridge.com>

	* lto-tree-flags.def (FIX_CEIL_EXPR, FIX_FLOOR_EXPR,
	FIX_ROUND_EXPR, section_name, call_clobbered_flag): Removed dead
	cases.
	* lto-function-out.c (ADD_CLASS_FLAG, ADD_EXPR_FLAG): Changed
	expr->common to expr->base.
	* cfg.c (init_flow): Fixed ggc macro rot.
	* lto-tree-tags.def (FIX_CEIL_EXPR, FIX_FLOOR_EXPR,
	FIX_ROUND_EXPR): Removed dead tree types.
	

Local Variables:
change-log-default-name: "ChangeLog.lto"
End:
