2003-02-27  Diego Novillo  <dnovillo@redhat.com>

	* tree-ssa-ccp.c (ccp_fold): Fold builtins by replacing and
	restoring their arguments.

2003-02-27  Jeff Law  <law@redhat.com>

	* tree-dfa.c (find_vars_r): Clear *walk_subtrees appropriately
	to avoid useless walking of subtrees.

	* fold-const.c (nondestructive_fold_binary_to_constant): Renamed
	from nondestructive_fold_binary.  Update comments slightly.
	(nondestructive_fold_unary_to_constant): Similarly.
	(fold_relational_hi_lo): Corresponding changes.
	* tree-ssa-ccp.c (ccp_fold): Corresponding changes.
	* tree.h: Corresponding changes.

2003-02-26  Jeff Law  <law@redhat.com>

	* tree-ssa-ccp.c (ccp_fold): Also handle folding of calls to
	builtin functions.

	* fold-const.c (nondestructive_fold_binary): Handle truth ops
	when both arguments are constant (duh!).  Handle CONJ_EXPR.

2003-02-25  Jeff Law  <law@redhat.com>
	    Diego Novillo  <dnovillo@redhat.com>

	* tree-ssa-ccp.c (likely_value): If the statement has no
	use operands, then return CONSTANT.

	* fold-const.c (nondestructive_fold_binary): Handle TRUTH_AND_EXPR
	and TRUTH_OR_EXPR.  Placeholder for TRUTH_XOR_EXPR.
	* tree-ssa-ccp.c (ccp_fold): Handle TRUTH_{AND,OR,XOR}_EXPR.
	(def_to_undefined): Re-enable VARYING->UNDEFINED state transition
	sanity check.

	* tree-ssa-ccp.c (likely_value): Renamed from may_fold_p.  Now
	returns a latticevalue indicating the likely value for the
	the RHS of the statement.
	(evaluate_stmt): Update to use likely_value instead of may_fold_p.
	Statements with UNDEFINED operands produce an UNDEFINED result.
	(set_lattice_value): Reenable VARYING->CONSTANT sanity check.

2003-02-25  Andrew MacLeod  <amacleod@redhat.com>

	* tree-cfg.c (bsi_init): Handle BIND_EXPR nodes inside a basic block.
	(bsi_next_in_bb): Likewise.

2003-02-25  Diego Novillo  <dnovillo@redhat.com>

	* tree-cfg.c (parent_array): Remove.  Update all users.
	(struct cfg_stats_d): Add field 'num_failed_bind_expr_merges'.
	(NEXT_BLOCK_LINK): Define.
	(build_tree_cfg): Call alloc_aux_for_blocks instead of
	create_block_annotations.
	(make_blocks): Rewrite to support basic blocks that can span whole
	BIND_EXPR bodies and put control statements at the end of blocks.
	Add arguments 'next_block_link' and 'bb'.  Replace 'parent_block'
	with 'parent_stmt'.  Update all users.
	(make_loop_expr_blocks): Replace argument 'parent_block' with 'entry'.
	Add argument 'next_block_link'.  Update all users.
	Don't create an empty latch block.
	(make_cond_expr_blocks): Add argument 'next_block_link'.  Update
	all users.
	(make_switch_expr_blocks): Likewise.
	(make_bind_expr_blocks): Replace 'parent_block' with 'parent_stmt'.
	Add argument 'next_block_link' and 'entry'.
	Don't create a new block for the BIND_EXPR node.  Extend the
	existing block.
	(add_stmt_to_bb): New function.
	(create_bb): Remove argument 'parent_block'.  Update all users.
	(create_block_annotations): Remove.  Update all users.
	(make_edges): Don't handle BIND_EXPR nodes.
	(make_ctrl_stmt_edges): Don't create an extra edge to the body of
	the switch.
	(make_loop_expr_edges): Only create an edge to the body of the
	loop.
	(remove_unreachable_block): Add more documentation for the special
	case where a control statement entry is unreachable but its body
	isn't.
	Remove the basic block annotation from the head and end containers
	in the block.
	(disconnect_unreachable_case_labels): Don't keep the edge that goes
	to the BIND_EXPR at the start of the switch body.
	(dump_tree_bb): Call is_latch_block_for.
	(dump_cfg_stats): Show stats about basic blocks that could not span
	beyond the end of a BIND_EXPR body.
	(successor_block): Use NEXT_BLOCK_LINK if the block is the last
	inside a control structure.
	(is_ctrl_stmt): Update documentation.
	(stmt_starts_bb_p): Add new argument 'prev_t'.  Update all users.
	Only labels may start a new basic block.
	(stmt_ends_bb_p): Add LOOP_EXPR, TRY_FINALLY_EXPR and
	TRY_CATCH_EXPR to the list.
	(latch_block): Remove.
	(is_latch_block_for): New function.
	(set_bb_for_stmt): Reformat some code.

	* tree-flow-inline.h (set_parent_block): Remove.  Update all users.
	(parent_stmt): New function.
	(parent_block): Call it.

	* tree-flow.h (struct stmt_ann_d): Add field 'parent_stmt'.
	(struct bb_ann_d): Remove block parent_block.

	* tree-pretty-print.c (dump_generic_node): Don't handle empty latch
	nodes.

	* tree-ssa-ccp.c (def_to_undefined): Temporarily disable check for
	VARYING->UNDEFINED transitions.
	(set_lattice_value): Likewise for VARYING->CONSTANT transitions.

	* tree-ssa-dce.c (mark_necessary): Use parent_stmt() to traverse
	all the control statements that contain the current
	statement.
	(makr_control_parent_necessary): Remove.  Update all users.
	(stmt_useful_p): Add BIND_EXPR to the list of useful
	statements.
	(process_worklist): Check that the statement is
	associated to a basic block.
	(remove_dead_stmt): Don't assume that the block has a
	postdominator.

2002-02-20  Daniel Berlin  <dberlin@dberlin.org>

	* tree-alias-ander.c: Store cached ptsets in the typevar, not
	a seperate hash table.
	(ptset_map): Removed;
	(ptset_map_eq): Ditto.
	(ptset_map_hash): Ditto.
	(andersen_init): Remove ptset_map.
	(andersen_cleanup): Ditto.
	(andersen_add_var): Ditto.
	(andersen_add_var_asm): Ditto.
	(andersen_may_alias): Ditto.
	* tree-alias-common.c: Store typevars for DECL nodes in the tree_decl
	structure.
	(get_alias_var_decl): Use DECL_PTA_TYPEVAR for DECL's.
	(create_alias_var): Ditto.
	(find_func_aliases): CONST functions don't affect aliasing either.
	(ptr_may_alias_var): Don't call get_base_symbol.
	Remove decl_function_context, use DECL_CONTEXT instead.
	For DECL's, use DECL_PTA_TYPEVAR.
	* tree-alias-type.c (struct alias_typevar_aterm): Add ptset member.
	(ALIAS_TVAR_PTSET): New macro.
	* tree.h (DECL_PTA_TYPEVAR): New macro.
	(struct tree_decl): Add typevar member.

2003-02-20  Jeff Law  <law@redhat.com>

	* c-simplify.c (simplify_decl_stmt): Call set_vla_decl on the
	temporary holding the size and unit size for a VLA.  Minor
	formatting fixes.

	* ssa.c: Revert caching of immediate dominators change made on
	Jan 28, 2003.

	* tree-dfa.c: Fix comment.

2003-02-20  Jeff Law  <law@redhat.com>

	* tree-cfg.c (remove_bb): Update PHI nodes as edges are removed.
	(cleanup_cond_expr_graph): Likewise.
	(cleanup_switch_expr_graph): Likewise.
	(disconnect_unreachable_case_labels): Likewise.

	* tree-ssa-dce.c (mark_control_parent_necessary): Be much more
	selective about what statements in the control parents are marked
	as necessary.
	
	* tree-dfa.c (INDIRECT_REFs and ADDRESSABLE_VARs varrays): Replace
	with a single ALIASED_OBJECTs set of varrays.
	(dump_dfa_stats): Corresponding changes.
	(compute_may_aliases, dump_alias_info): Likewise.
	(compute_alias_sets): Likesise.  Update comments.    Register
	alias sets for all potentially aliased objects which are stored.
	Check each potentially aliased object with the registered alias
	sets.
	(register_alias_set): If DEREF aliases a single registered _DECL,
	then replace the _DECL's entry with DEREF.
	(find_alias_for): Update comments.  Do not stop the search when
	an alias is found.  There may be multiple entries with conflicting
	alias sets.
	(struct walk_state): New structure for statement walker callbacks.
	(find_vars_r): Add logic to track loads and stores of potentially
	aliased objects separately.  Various changes related to
	using a single set of varrays for all aliased objects. 
	(add_referenced_var): Record in the var's annotation if the 
	var is read or written.  Various changes related to using a
	single set of varrays for all the aliased objects.
	(add_stmt_operand): Only set may_point_to_global_mem for INDIRECT_REFs.
	* tree-flow.h (struct var_ann_d): Add new fields indicating if
	the var is loaded or stored.  Explicitly note unused bitfield
	entries.

2003-02-19  Jeff Law  <law@redhat.com>

	* fold-const.c (fold_negate_const): New function.  Broken out of
	the generic fold code.
	(fold_abs_const, fold_relational_const): Likewise.
	(fold_relational_hi_lo): Likewise.
	(nondestructive_fold_unary, nondestructive_fold_binary): Likewise.
	(fold): Use fold_negate_const, fold_abs_const, fold_relational_const,
	and fold_relational_hi_lo.
	* tree.h (nondestructive_fold_unary): Declare.
	(nondestructive_fold_binary): Declare.
	* tree-ssa-ccp.c (ccp_fold): New function.
	(add_control_edge): Fix trivial formatting bug.
	(evaluate_stmt): Rework to use ccp_fold instead of copying
	statements.

2003-02-18  Jeff Law  <law@redhat.com>

	* tree-ssa-ccp.c (visit_assignment): For simple copies, copy the
	lattice values.
	(defs_to_undefined): Add missing abort.
	(replace_uses_in): Do not do a replacement if it would create
	non GIMPLE trees.

2002-02-14  Jeff Law  <law@redhat.com>

	* tree-ssa-ccp.c (def_to_undefined): Improve sanity checking code
	so that it can detect invalid VARYING->UNDEFINED transitions.
	(set_lattice_value): Improve sanity checking code so that it
	does not trip on valid VARYING->CONSTANT transitions.

	* tree-flow.h (struct stmt_ann_d): Add new field in_ccp_worklist.
	* tree-ssa-ccp.c (simulate_stmt): Renamed from simulate_def_use_edges.
	(add_var_to_ssa_edges_worklist): New function.  Only add statements
	to the ssa_edges worklist if they are not already on the worklist.
	(def_to_undefined, def_to_varying, set_lattice_value)
	(tree_ssa_ccp): Only reevaluate the statement if in_ccp_worklist
	is set for the element popped off the ssa_edges worklist.
	(simulate_statement): Simplify now that ssa_edges is a worklist
	of statements to reevaluate rather than a worklist of defs
	that need their immediate uses reevaluated.
	(visit_stmt): Clear in_ccp_worklist.

	* tree-ssa-ccp.c (def_to_undefined): Directly store the new
	lattice values rather than call set_value.
	(def_to_varying): Likewise.
	(set_lattice_value): Likewise.

	* tree-ssa-ccp.c (def_to_undefined): Add some state transition
	sanity checking.  Avoid calling set_value if nothing changed.
	(def_to_varying): Avoid calling set_value if nothing changed.
	(set_lattice_value): Add some state transition sanity checking
	for transitions into the CONSTANT state.  If the object's
	"constant" value has changed to a new constant value, then the
	object has a VARYING value.

 	* tree-ssa-ccp.c (tree_ssa_ccp): Work through the entire
	ssa_edges worklist each iteration through the main loop.

2002-02-13  Jeff Law  <law@redhat.com>

	* tree-ssa-ccp.c: Fix comment formatting glitches.
	
	* tree-ssa-ccp.c (may_fold_p): New function.  Returns nonzero if
	the given statement may fold after replacement of operands with
	constants.
	(evaluate_stmt): Only create a copy of the statement if there is
	a reasonable chance the statement will fold.

2002-02-13  Diego Novillo  <dnovillo@redhat.com>

	* Makefile.in (OBJS): Add tree-ssa-pre.o.

2003-02-13  Daniel Berlin  <dberlin@dberlin.org>

	* tree-dfa.c (create_stmt_ann): Do stmt part of common annotation.
	* tree-flow-inline.h (tree_stmt): Return statement tree is part of.
	* tree-flow.h (struct bb_ann_d): Add ephi_nodes.
	* tree-optimize.c (optimize_tree): Activate SSAPRE again.
	* tree-pretty-print.c (debug_generic_expr): New function.
	(debug_generic_stmt): Ditto.
	(dump_generic_node): Pretty print EUSE's, EREF's,  and EPHI's.
	
	* tree-ssa-pre.c: Rewrite almost entirely. Now performs more
	strength reduction, EPHI minimization, and keeps SSA up to date.
	* tree.c (tree_size): Handle EUSE, EPHI, EREF nodes.
	(tree_node_structure): Ditto.
	(ephi_node_elt_check_failed): New function.
	* tree.def: Add EUSE_NODE, ELEFT_NODE, EKILL_NODE, EPHI_NODE,
	EEXIT_NODE.
	* tree.h (EREF_NODE_CHECK): New.
	(EPHI_NODE_ELT_CHECK): New.
	(struct tree_eref_common): New.
	(struct tree_euse_node): New.
	(struct tree_ephi_node): New.
	(union tree_node): Add euse, eref, ephi members.
	(enum tree_node_structure): Add TS_EPHI_NODE, TS_EUSE_NODE,
	TS_EREF_NODE.

2003-02-13  Daniel Berlin <dberlin@dberlin.org>
            Andreas Jaeger  <aj@suse.de>

	* tree-flow.h: Add some garbage collector marks.

2003-02-12  Jeff Law  <law@redhat.com>

	* Makefile.in (ssa.o): Depends on $(TREE_H) and tree-flow.h
	* ssa.c: Include tree.h and tree-flow.h.
	(compute_dominance_frontiers_1): Use the sparse bitmap
	of dominator children from the basic block's annotation
	if it's available.  Otherwise build the sparse bitmap
        using the result of get_dominated_by.
	* tree-ssa.c (rewrite_into_ssa): Reorder things slightly so
	that we can use the cached dominator children computed
	by mark_def_sites in compute_dominance_frontiers.

2003-02-12  Andreas Jaeger  <aj@suse.de>

	* tree-dfa.c (dump_alias_info): Cast variable of size_t properly.

2003-02-12  Daniel Berlin  <dberlin@dberlin.org>

	* tree-dfa.c (find_may_aliases_for): Remove
	(compute_may_aliases): Always call compute_alias_sets.

2003-02-10  Jeff Law <law@redhat.com>

	* ssa.c (compute_dominance_frontiers_1): Use a sparse bitmap
	for the frontiers.
	(compute_dominance_frontiers): Corresponding changes.
	(convert_to_ssa): Similarly.  Convert the sparse bitmap to
	a simple bitmap to avoid lots of collateral damage.
	* ssa.h (compute_dominance_frontiers): Update prototype.
	* tree-ssa.c (added, in_work): Kill, no longer needed.
	(struct def_blocks_d): Add new bitmap (livein_blocks).
	(rewrite_into_ssa): Make dominance frontiers be a sparse
	bitmap instead of a simple bitmap.  Rename the "nonlocals"
	simple bitmap to "globals".  Pass it into mark_def_sites.
	(compute_global_livein): New function.
	(mark_def_sites): Also keep track of variables which are
	used before they are set.  Allow caller to allocate and
	pass in a simple bitmap for global variables.  Process
	items defined in the statement last.
	(set_def_block): Also allocate bitmap for globals.
	(set_livein_block): New function.
	(def_blocks_free): Free def_blocks correctly.  Also free
	livein_blocks.
	(debug_def_blocks_r): Also dump the livein_blocks.
	(insert_phi_nodes): Simplify now that we don't need the
	added and in_work varrays.  Accept DFS as a sparse bitmap
	instead of a simple bitmap.
	(insert_phi_nodes_for): Rework significantly.  Pre-compute all
	the insertion points for semi-pruned form.  While computing those
	insertion points keep track of how many phi vector entries
	would be needed at those insertion points.  When the number of
	entries gets large (32), compute global life information and
	use that to further pruned the number of PHI insertion points
	necessary.

2003-02-09  Diego Novillo  <dnovillo@redhat.com>

	* tree-dfa.c (find_vars_r): Assume that the RHS of an INDIRECT_REF,
	that is also an SSA variable, is a VAR_DECL.
	(get_virtual_var): Handle INDIRECT_REF nodes that are not valid SSA
	variables.

	* tree-ssa-dce.c (stmt_useful_p): Revert kludge in previous commit.
	VA_ARG_EXPR nodes are not inherently live.

	* tree-ssa.c (mark_def_sites): Don't process the LHS of assignments
	twice.
	The operand of a virtual definition constitutes a use of the
	variable which should be considered a non-local if it had not been
	killed inside the block.

	* tree.h (SSA_VAR_P): Only return true for INDIRECT_REFs if their
	operand is a _DECL node.

2003-02-09  Diego Novillo  <dnovillo@redhat.com>

	* config/rs6000/t-rs6000 (simplify-rtx.o): Compile with -Wno-error.

2003-02-08  Diego Novillo  <dnovillo@redhat.com>

	* toplev.c (parse_options_and_default_flags): Enable SSA DCE by
	default.

	* tree-dfa.c (get_expr_operands): Recurse into LHS of an ARRAY_REF
	when it's not a regular variable.  Always recurse into the RHS.
	(add_stmt_operand): Set may_point_to_global_mem for pointers that
	are assigned expressions that may reference global memory.  Also
	set its dereference variable to be an alias of global memory.
	(dump_variable): Show may_point_to_global_mem flag.
	(compute_alias_sets): Also dump all referenced variables when
	dumping alias information.
	(add_may_alias): Check for global memory aliasing.
	(may_access_global_mem_p): Rename from may_access_global_mem.
	Return true if the expression is a variable that may point to or
	alias global memory.
	(add_referenced_var): Pointer arguments and global pointers may
	point to global memory.
	(set_may_alias_global_mem): Move ...
	* tree-flow-inline.h (set_may_alias_global_mem): ... here.
	(set_may_point_to_global_mem): New function.
	(may_point_to_global_mem_p): New function.

	* tree-ssa-dce.c (stmt_useful_p): VA_ARG_EXPRs are inherently live.
	* tree-ssa.c (rewrite_into_ssa): Don't call dump_referenced_vars.

2003-02-06  Diego Novillo  <dnovillo@redhat.com>

	* tree-dfa.c (struct alias_tags, alias_tags, num_alias_tags):
	Remove.  Update all users.
	(struct alias_set_d): New.
	(alias_sets): New file local variable.
	(compute_alias_sets): New function.
	(compute_may_aliases): Call it when not doing points-to analysis.
	(register_alias_set): New function.
	(find_alias_for): New function.
	(may_alias_p): Declare static.
	Don't assume that VAR may not be aliased if it's a non-addressable
	_DECL.
	If VAR and PTR are aggregate types, check if they can have a field
	that points to the other one.
	(find_may_aliases_for): Move handling of global memory aliasing ...
	(add_may_alias): ... here.
	Also accept the base symbols for the variable and its alias.
	(register_new_alias): Remove.  Update all users.
	(find_alias_tag): Remove.  Update all users.
	(find_vars_r): Update VAR after re-writing *TP when sharing
	INDIRECT_REF nodes.
	* tree-flow.h (may_alias_p): Remove declaration.

	* tree-ssa.c (rewrite_into_ssa): Include referenced variables in
	default debug dumps.

	Support for VLAs.

	* tree-dfa.c (find_vla_decls): New function.
	(compute_may_aliases): Call it.
	(find_vla_decls_r): New function.
	(dump_variable): Show whether the variable is used in a VLA
	declaration.
	* tree-flow-inline.h (is_vla_decl): New function.
	(set_vla_decl): New function.
	* tree-flow.h (struct var_ann_d): Add bitfield 'is_vla_decl'.
	* tree-ssa-dce.c (need_to_preserve_store): Return true if SYM is
	used inside a VLA declaration.

2003-02-05  Andrew MacLeod  <amacleod@redhat.com>

	* Makefile.in : Include new file tree-iterator.h in tree-simple.h
	* gimplify.c (simplify_cleanup_point_expr): Use tsi_ rather than gsi_.
	* tree-cfg.c (make_blocks, remove_bb): Use tsi_ not gsi_ routines.
	(bsi_remove): Renamed from gsi_remove, use bsi_ routines.
	(successor_block, first_exec_stmt): Use tsi_ not gsi_ routines.
	(first_stmt, last_stmt, last_stmt_ptr): Use bsi_ not gsi_ routines.
	(bsi_init): Split out from bsi_start.
	(bsi_start): Renamed from gsi_start_bb, use bsi_ routines.
	(bsi_next_in_bb): Moved from tree-flow-inline.h and renamed from
	gsi_step_in_bb. Also verify BB of new stmt.
	* tree-dfa.c (compute_immediate_uses, dump_immediate_uses,
	collect_dfa_stats, compute_may_aliases): Use block_stmt_iterator.
	* tree-flow-inline.h (gsi_step_in_bb): Moved to tree-cfg.c
	(bsi_end_p): Renamed from gsi_end_bb_p.
	(bsi_next): renamed from gsi_step_bb
	(bsi_prev): New function.
	(bsi_stmt_ptr): Block version of gsi_stmt_ptr.
	(bsi_stmt): Block version of gsi_stmt.
	(bsi_container): Block version of gsi_container.
	* tree-flow.h (block_stmt_iterator): New iterator type.
	* tree-iterator.h: New include file for tree_iterator.
	* tree-simple.h : Include tree-iterator.h
	(gimple_stmt_iterator, gsi_start, gsi_end_p, gsi_stmt_ptr,
	gsi_stmt, gsi_container): Move to tree-iterator.h and rename to tsi_.
	(gsi_step): Move to tree-iterator.h and renamed to tsi_next.
	* tree-ssa-ccp.c (simulate_block, substitute_and_fold): Use block
	iterators instead of gimple_stmt_iterator.
	* tree-ssa-dce.c (mark_control_parent_necessary, find_useful_stmts,
	remove_dead_stmts, remove_dead_stmt): Use block_stmt_iterator.
	* tree-ssa.c (mark_def_sites, rewrite_out_of_ssa, rewrite_stmts): Use
	block_stmt_iterator.

2003-02-04  Daniel Berlin  <dberlin@dberlin.org>

	* tree-alias-common.c (get_alias_var_decl): If it's a global var,
	make sure it doesn't get added to local_alias_vars.
	(get_name): Return the right name for FUNCTION_DECL's.

2003-02-04  Diego Novillo  <dnovillo@redhat.com>

	* tree-dfa.c (add_stmt_operand): Do not add a VUSE for a pointer
	when clobbering its associated INDIRECT_REF variable.

2003-02-04  Diego Novillo  <dnovillo@redhat.com>

	* config/rs6000/t-rs6000 (jump.o, regmove.o, c-typeck.o, cfgrtl.o,
	combine.o, fold-const.o, ifcvt.o, reload1.o, rtlanal.o,
	cp/decl2.o, cp/pt.o, f/where.o, java/expr.o, objc/objc-act.o,
	rs6000.o, insn-emit.o): Compile with -Wno-error.

2003-02-03  Diego Novillo  <dnovillo@redhat.com>
            Jeff Law  <law@redhat.com>

	* tree-cfg.c (make_blocks): Don't always start a new block with
	COND_EXPR and SWITCH_EXPR statements.
	Call stmt_ends_bb_p to determine if the current statement should be
	the last in the block.
	(make_cond_expr_blocks): Second argument is now the entry block
	to the conditional.
	(make_switch_expr_blocks): Second argument is now the entry block
	to the switch.
	(make_edges, make_ctrl_stmt_edges, make_loop_expr_edges,
	cleanup_control_flow, cleanup_cond_expr_graph,
	cleanup_switch_expr_graph, disconnect_unreachable_case_labels,
	find_taken_edge, successor_block, latch_block, is_latch_block,
	switch_parent): Work with the last statement of the block, not the
	first.
	(is_ctrl_altering_stmt): Pre-compute the code of the statement.
	(stmt_starts_bb_p): Declare file local.
	Don't call is_ctrl_stmt.  Check if T is a LOOP_EXPR instead.
	(stmt_ends_bb_p): New function.

	* tree-flow.h (stmt_starts_bb_p): Remove declaration.

2003-02-03  Diego Novillo  <dnovillo@redhat.com>

	* tree-dfa.c (find_vars_r): Share INDIRECT_REF nodes whose operand
	is a VAR_DECL.
	(add_referenced_var): Add additional argument 'sym'.  Update all users.
	Don't call get_base_symbol.
	(add_indirect_ref_var): Rename argument 'var' to 'ptr'.
	(htab_hash_var): Remove.  Update all users to use htab_hash_pointer.
	(htab_var_eq): Remove.  Update all users to use htab_eq_pointer.

	* tree-flow-inline.h (var_ann): Don't retrieve the annotation of
	the base pointer for INDIRECT_REF variables.
	(is_aliased): Remove.  Update all users.
	(is_dereferenced): Remove.  Update all users.
	(same_var_p): Remove.  Update all users to use pointer equality.

	* tree-simple.c (get_base_symbol): Convert tail recursion into
	iteration.

	* tree-ssa.c (rewrite_out_of_ssa): Add FIXME note about overlapping
	live ranges for different versions of the same variable.

2003-02-03  Jeff Law  <law@redhat.com>

	* tree-dfa.c (add_referenced_var): Annotate each item in the
	REFERENCED_VARS varray with a unique id.
	* tree-flow.h (struct var_ann_d): Add new uid field.
	* tree-ssa.c (mark_def_sites): Compute the set of variables
	live across basic blocks and return them in an sbitmap.
	(insert_phi_nodes): Use the set of nonlocal variables computed
	by mark_def_sites to reduce the number of PHI nodes inserted.
	(rewrite_into_ssa): Updated to deal with changes in
	insert_phi_nodes and mark_def_sites.  Free the sbitmap returned
	by mark_def_sites.

2003-02-03  Diego Novillo  <dnovillo@redhat.com>

	* c-common.h (GOTO_DESTINATION): Remove.  Fix botched
	merge.

2003-02-03  Diego Novillo  <dnovillo@redhat.com>

	Fix warnings to allow bootstrapping with -Werror.

	* Makefile.in (c-semantics.o-warn): Add -Wno-error.
	(emit-rtl.o-warn): Likewise.
	(profile.o-warn): Likewise.
	(tree.o-warn): Likewise.
	(OBJS): Remove simple-break-elim.o and simple-goto-elim.o.
	* c-pretty-print.c (print_function_decl): Remove unused function.
	* bitmap.c (bitmap_last_set_bit): Initialize variable 'word'.
	* c-typeck.c (build_binary_op): Initialize variable 'type'.
	* combine.c (combine_simplify_rtx): Initialize variable 'reversed'.
	(make_compound_operation): Initialize variable 'i'.
	* dwarf2out.c (dwarf2out_finish): Initialize variable 'context'.
	* expr.c (store_constructor): Initialize variables 'lo', 'hi',
	'startb' and 'endb'.
	(expand_expr): Initialize variable 'op0'.
	* fold-const.c (fold): Initialize variable 'tem'.
	* profile.c (branch_prob): Initialize variable 'prev_file_name'.
	* reload.c (find_equiv_reg): Initialize variables 'valtry and
	'valueno'.
	* rtlanal.c (get_jump_table_offset): Initialize variable 'set'.
	* ssa-ccp.c (ssa_const_prop): Fix sign mismatch warning.
	* varasm.c (output_constant_def): Initialize variable 'defstr'.
	* gimplify.c (simplify_expr): Initialize variables
	'saved_input_filename' and 'saved_lineno'.
	(simplify_compound_lval): Initialize variable 'code'.
	* tree-alias-ander.c (pta_bottom): De-ansify.
	(andersen_cleanup): Remove unused variables.
	(andersen_heap_assign): Mark argument lhs ATTRIBUTE_UNUSED.
	(pta_bottom): Remove unused function.
	(pta_get_ptsize): Remove unused function.

2003-02-02  Diego Novillo  <dnovillo@redhat.com>

	* tree-dfa.c (get_expr_operands): Add a VUSE for the dereference of
	every pointer passed in a function call.
	Move code to add an operand for the base pointer of an
	INDIRECT_REF ...
	(add_stmt_operand): ... here.
	Add a VUSE for the base pointer of every INDIRECT_REF variable.
	(find_may_aliases_for): Fix starting index for the loop that scans
	INDIRECT_REFs for aliasing.
	Factor code that marks two variables aliased into
	register_new_alias.
	(register_new_alias): New function.
	(may_alias_p): Handle aliasing of structure fields.
	(add_may_alias): Fix documentation.
	(find_vars_r): Factor code that adds a new referenced variable into
	add_referenced_var.
	(add_referenced_var): New function.
	(add_indirect_ref_var): New function.
	(get_virtual_var): Handle variables wrapped in SSA_NAMEs.
	(set_may_alias_global_mem): Move from ...
	* tree-flow-inline.h: ... here.

	* tree-ssa-dce.c (need_to_preserve_store): CALL_EXPRs are
	implicitly live.  VA_ARG_EXPRs are not.
	(stmt_useful_p):

	* tree.h (SSA_NAME_VAR): Rename from SSA_NAME_DECL.  Update all
	users.
	(struct tree_ssa_name): Rename field 'decl' to 'var'.  Update all
	users.
	(SSA_DECL_P): Accept only VAR_DECLs and PARM_DECLs possibly wrapped
	inside an SSA_NAME node.
	(SSA_VAR_P): Also accept SSA_NAME nodes.

2003-02-01  Daniel Berlin  <dberlin@dberlin.org>

	* Makefile.in (tree-ssa-pre2.o): Remove accidental addition.

2003-01-31  Diego Novillo  <dnovillo@redhat.com>

	* tree-cfg.c (find_taken_edge_cond_expr): New function.
	(find_taken_edge_switch_expr): New function.
	(value_matches_some_label): New function.
	(find_taken_edge): Re-structure to use the three new functions.

2003-01-30  Jason Merrill  <jason@redhat.com>

	* gimplify.c (simplify_function_tree): Set TREE_SIDE_EFFECTS on
	the BIND_EXPR wrapper.

2003-01-30  Diego Novillo  <dnovillo@redhat.com>

	* tree-dfa.c (call_may_clobber): New function.
	(get_expr_operands): Call it.
	(find_vars_r): Call it.

2003-01-30  Jeff Law <law@redhat.com>

	* tree-dfa.c (struct alias_tags): New.  Collector for key information
	regarding alias tags.
	(indirect_refs_base, indirect_refs_alias_set): New varrays.
	(addressable_vars_base, addressable_vars_alias_set): Likewise.
	(compute_may_aliases): Initialize and finalize the new varrays.
	Update allocation of alias tags information.
	(find_may_aliases_for): Extract base symbols and alias set
	information for V1 and V2 from the virtual arrays and store
	them into local variables.  Pass them as necessary to
	may_alias_p, may_access_global_mem, find_alias_tag.  Add base
	symbol and alias set when creating a new alias tag.
	(find_vars_r): Fill in new varrays as needed.
	(may_alias_p): Add new arguments for base and alias set of the
	two origianl incoming arguments.  No longer call get_base_symbol
	or get_alias_set.
	(find_alias_tag,  may_access_global_mem): Similarly.
	(add_stmt_operand): Update to pass additional argument to
	may_access_global_mem.
	(dump_alias_info): Update to deal with new alias tag structure.
	* tree-flow.h (may_alias_p): Update prototype with new arguments.
	* tree-ssa-pre.c (process_left_occs_and_kills): Update to pass
	new arguments to may_alias_p.

2003-01-30  Daniel Berlin  <dberlin@dberlin.org>

	Remove all traces of steensgaard's algorithm.
	* tree-alias-steen.c: Removed.
	* tree-alias-steen.h: Ditto.
	* tree-alias-ecr.c: Ditto.
	* tree-alias-ecr.h: Ditto.
	* disjoint-set.c: Ditto.
	* disjoint-set.h: Ditto.
	* Makefile.in: Remove removed files.
	* c-config-lang.in: Ditto.
	* gengtype.c: Ditto.
	* tree-alias-common.c: Don't use steen_alias_ops anymore.
	* toplev.c: Remove help text and steen option.
	* tree-alias-common.h: Remove PTA_STEEN.
	* tree-alias-type.c: Remove all steensgaard related types and
	functions.
	* tree-alias-type.h: Ditto.

2003-01-30  Diego Novillo  <dnovillo@redhat.com>

	* tree-cfg.c (struct cfg_stats_d): New.
	(cfg_stats): New file local.
	(build_tree_cfg): Start TV_TREE_CFG timer before allocating memory.
	Initialize cfg_stats.
	(make_blocks): Count coalesced label blocks.
	(dump_tree_cfg): Call dump_cfg_stats if TDF_STATS is enabled.
	(dump_cfg_stats): New.
	(debug_cfg_stats): New.

	* tree-dfa.c (SCALE, LABEL, PERCENT): Move ...
	* tree-flow.h: ... here

2003-01-29  Diego Novillo  <dnovillo@redhat.com>

	* tree-cfg.c (make_blocks): Do not start a new block if the
	previous statement and the current statement are labels of the same
	kind.

2003-01-29  Diego Novillo  <dnovillo@redhat.com>

	* tree-cfg.c (parent_array): Make file local.
	(label_to_block_map): New file local variable.
	(build_tree_cfg): Initialize label_to_block_map.
	(make_edges): Don't pre-scan all the blocks looking for blocks with
	labels.
	(make_exit_edges): Remove argument label_to_block_map.  Update all
	callers.
	(make_goto_expr_edges): Likewise.
	(dump_tree_bb): Check that the block has a valid annotation.
	(set_bb_for_stmt): If the statement is a label, add the label to
	the label_to_block_map.

	* tree-pretty-print.c (dump_vops): Check that the block has a valid
	annotation.

2003-01-29  Jeff Law <law@redhat.com>

	* tree-dfa.c (find_may_aliases_for): Just accept the index of
	the current indirect_ref.  Caller updated.
	(num_indirect_refs, num_addressable_vars): New variables.
	(indirect_refs, addressable_vars): New varrays.
	(dump_dfa_status): Dump info on the indirect refs and
	addressable vars.
	(dump_alias_info): Similarly.
	(compute_may_aliases): Initialize and finalize the new virtual
	arrays and hash tables for indirect refs and addressable vars.
	Include setup/teardown in the cost for alias analysis.
	(find_may_aliases_for):  Split main loop into two.  The first
	walks over the indirect refs and takes advantage of the
	symmetric properties of the aliasing relationship to avoid
	useless work.  The second loop iterates over the addressable
	variables.
	(find_vars_r): Rework to build all three arrays we need.

2003-01-29  Andreas Jaeger  <aj@suse.de>

	* tree-alias-common.c (find_func_aliases): Remove unused variable.
	(display_points_to_set_helper): #if 0 function to avoid warning
	about unused function.

	* tree-alias-ecr.c (ECR_new): Remove ISO C style function
	definition.
	* disjoint-set.c (disjoint_set_new): Likewise.

2003-01-29  Frank Ch. Eigler  <fche@redhat.com>

	* tree-mudflap.c (mx_xfn_indirect_ref): Use a stack of flags for
	tracking pointer deference reads vs writes.
	(mf_build_check_statement_for): Pass access-type value to __mf_check.
	* c-mudflap.c (mflang_register_call): Adapt to mf-runtime.h API change.

2003-01-29  Diego Novillo  <dnovillo@redhat.com>

	* Makefile.in (ssa.o): Add dependency on $(TIMEVAR_H).
	* timevar.def (TV_DOM_FRONTIERS): Define.
	* ssa.c (compute_dominance_frontiers): Use.

2003-01-29  Diego Novillo  <dnovillo@redhat.com>

	* tree-ssa-dce.c (remove_dead_stmt): Fix uninitialized use
	warning.

2003-01-28  Diego Novillo  <dnovillo@redhat.com>

	* timevar.def (TV_TREE_SSA_REWRITE_BLOCKS): Adjust legend.
	* tree-ssa.c (rewrite_into_ssa): Use TV_TREE_SSA_REWRITE_BLOCKS.
	(mark_def_sites): Add comment.

2003-01-28  Jeff Law <law@redhat.com>

	* ssa.c (compute_dominance_frontiers_1): Use get_dominated_by
	to avoid useless walks over all the basic blocks.  Use cache
	of immediate dominators to avoid silly calls to get_immediate_dominator.
	Do not clear elements of the frontiers bitmap.
	(compute_dominance_frontiers): Compute cache of immediate
	dominators and pass it to compute_dominance_frontiers_1.  Clear
	the entire vector of frontiers bitmaps.

	* timevar.def (TV_TREE_SSA_REWRITE_BLOCKS): Renamed from
	TV_TREE_BUILD_SSA.
	(TV_TREE_SSA_OTHER): New timevar.
	* tree-ssa.c (rewrite_into_ssa): Updated.  Use new TV_TREE_SSA_OTHER
	timevar.

	* tree.h (LABEL_DECL_INDEX): Define for use by CFG builder.
	* tree-cfg.c (make_exit_edges): Accept and pass though label to
	block mapping array.
	(make_goto_expr_edges): For simple gotos, lookup the destination
	in the label to block mapping array.  Zap old slow code to
	handle simple gotos.
	(make_edges): Build the label to block mapping array.

	* tree.h (PHI_NODE_ELT_CHECK): Provide version when ENABLE_CHECKING
	is not defined.

2003-01-28  Diego Novillo  <dnovillo@redhat.com>

	* tree-flow-inline.h (parent_block, set_parent_block, phi_nodes):
	Assume that blocks always have valid annotations.
	(add_dom_child): New function.
	(dominator_children): New function.

	* tree-flow.h (struct bb_ann_d): Add field 'dom_children'.

	* tree-ssa.c (mark_def_sites): Add parameter 'idom'.
	Add each block BB to the set of dominator children of BB's
	immediate dominator.
	(rewrite_block): Remove 'idom' parameter.
	Recurse into blocks set in the dominator children bitmap.

2003-01-28  Diego Novillo  <dnovillo@redhat.com>

	* flags.h (flag_disable_tree_ssa): New flag.
	* c-decl.c (c_expand_body): Use it.
	* toplev.c: Declare it.
	(f_options): Add help text for -fdisable-tree-ssa.
	* doc/invoke.texi: Add documentation for -fdisable-tree-ssa.

2003-01-28  Diego Novillo  <dnovillo@redhat.com>

	* Makefile.in (TREE_FLOW_H): Add dependency on $(HASHTAB_H)
	(OBJS): Temporarily remove tree-ssa-pre.o.
	(tree-ssa.o, c-decl.o): Add dependency on $(TREE_DUMP_H).

	* c-decl.c: Include tree-dump.h

	* c-pretty-print.c (dump_c_node): Fix rendering of GOTO_STMTs to
	computed locations.
	(op_prio): Don't abort on unknown operators.

	* c-simplify.c (mostly_copy_tree_r): Don't copy statement
	annotations.

	* gimplify.c (simplify_addr_expr): Mark the RHS of the simplified
	ADDR_EXPR addressable.
	(mostly_copy_tree_r): Don't copy statement annotations.

	* old-tree-inline.c (walk_tree): Handle SSA_NAME nodes.

	* timevar.def (TV_TREE_RDEFS): Remove.
	(TV_TREE_BUILD_SSA): Define.
	(TV_TREE_DFA): Define.

	* tree-cfg.c: Update copyright notices.
	Remove doxygen markers everywhere.
	(remove_unreachable_block): New local function
	(remove_unreachable_blocks): Call it.
	(remove_bb): Rename from remove_tree_bb.  Update all callers.
	(validate_loops): Remove unused function.
	(block_invalidates_loop): Remove unused function.
	(remove_stmt): Invalidate the defining statement of all the
	definitions made by the statement.
	Remove the annotation before replacing the statement with
	empty_stmt_node.

	* tree-dfa.c: Update copyright notices.
	Remove doxygen markers everywhere.
	(struct clobber_data_d): Remove existing fields.  Add fields 'stmt'
	and 'prev_vops'.  Update all users.
	(alias_tags): Rename from alias_leaders.
	(num_alias_tags): Rename from num_alias_leaders.
	(struct dfa_stats_d): Declare.
	(struct dfa_counts_d): Remove.  Update all users.
	(TRM_*): Remove.  Update all users.
	(find_tree_refs): Remove.  Update all users.
	(get_stmt_operands): Rename from find_refs_in_stmt.  Update all users.
	(get_expr_operands): Rename from find_refs_in_expr.  Update all users.
	(add_stmt_operand): New function.
	(set_def): New function.
	(add_use): New function.
	(add_vdef): New function.
	(add_vuse): New function.
	(create_phi_node): New function.
	(copy_stmt): New function.
	(compute_immediate_uses): New function.
	(compute_immediate_uses_for): New function.
	(compute_reached_uses): New function.
	(compute_reaching_defs): New function.
	(add_immediate_use): New function.
	(create_var_ann): New function.
	(create_stmt_ann): New function.
	(dump_immediate_uses): New function.
	(debug_immediate_uses): New function.
	(dump_immediate_uses_for): New function.
	(debug_immediate_uses_for): New function.
	(create_ref_list, empty_ref_list, add_ref_to_list_begin,
	add_ref_to_list_end, add_list_to_list_begin, add_list_to_list_end,
	find_list_node, rli_start, rli_start_last, rli_start_at,
	rli_delete, add_ref_to_list_after, tree_ref_size, create_ref,
	add_ephi_arg, add_referenced_var, replace_ref_with,
	try_replace_ref_with, replace_ref_r, replace_ref_stmt_with,
	remove_ref, remove_def, reset_def_def_links, replace_phi_arg_with,
	create_tree_ann, function_may_recurse_p, dump_ref, debug_ref,
	dump_ref_list, dump_ref_array, debug_ref_list, debug_ref_array,
	dump_phi_args, dump_if_different, count_tree_refs, ref_type_name,
	ref_defines, is_killing_def, tree_ref_structure, output_ref):
	Remove.  Update all users.
	(dump_referenced_vars): Remove parameter 'details'.  Update all
	users.
	(dump_variable): Don't abort if the variable is nil.  Display all
	the aliases for the variable.
	(dump_dfa_stats): Handle new counters.
	(collect_dfa_stats): Likewise.
	(collect_dfa_stats_r): Likewise.
	(find_vars_r): New function.
	(compute_may_aliases): Call it via walk_tree before computing aliases.
	Only use alias tags if -ftree-points-to is not given.
	Call add_may_alias.
	(find_may_aliases_for): Only use alias tags if -ftree-points-to is
	not given.
	(add_may_alias): New function.
	(find_alias_tag): Rename from find_alias_leader.
	(dump_alias_info): New function.
	(debug_alias_info): New function.
	(htab_hash_var): New function.
	(htab_var_eq): New function.
	(get_virtual_var): New function.

	* tree-dump.c (struct dump_option_value_info): Rename -block to
	-blocks.  Add new option -vops.
	(dump_function): Don't display which pass enabled the dump.

	* tree-flow-inline.h: Update copyright notices.
	(var_ann): New function.
	(stmt_ann): New function.
	(ann_type): New function.
	(bb_ann): Rename from bb_annotation.
	(may_aliases): New function.
	(set_may_alias_global_mem): New function.
	(may_alias_global_mem_p): New function.
	(set_indirect_ref): New function.
	(indirect_ref): New function.
	(is_dereferenced): New function.
	(modify_stmt): New function.
	(unmodify_stmt): New function.
	(stmt_modified_p): New function.
	(def_op): New function.
	(use_ops): New function.
	(vdef_ops): New function.
	(vuse_ops): New function.
	(immediate_uses): New function.
	(reaching_defs): New function.
	(phi_nodes): New function.
	(same_var_p): New function.
	(gsi_step_in_bb): Re-implement.  Check if the iterator stepped out
	of the block by calling bb_for_stmt.
	(gsi_end_bb_p): Rename from gsi_end_bb.  Update all users.
	Call gsi_stmt to determine if the iterator has reached the end of
	the block.
	(ref_id, ref_type, ref_bb, ref_stmt, ref_var, imm_uses,
	reached_uses, imm_reaching_def, set_imm_reaching_def,
	set_phi_arg_def, phi_arg_def, set_phi_arg_edge, phi_arg_edge,
	reaching_defs, phi_args, num_phi_args, phi_arg, set_phi_arg,
	tree_annotation, tree_refs, add_tree_ref, remove_tree_ref,
	alias_leader, set_alias_leader, set_tree_flag, clear_tree_flag,
	reset_tree_flags, tree_flags, indirect_var, set_indirect_var,
	bb_refs, remove_bb_ref, set_exprref_class, exprref_class,
	set_exprref_inserted, exprref_inserted, set_exprref_save,
	exprref_save, set_exprref_reload, exprref_reload,
	set_exprref_processed, set_exprref_processed2, exprref_processed2i,
	exprref_uses, set_exprref_uses, set_expruse_def, expruse_def,
	set_expruse_phiop, expruse_phiop, set_expruse_phi, expruse_phi,
	set_expruse_has_real_use, expruse_has_real_use,
	set_exprphi_phi_args, exprphi_phi_args, num_ephi_args, ephi_arg,
	set_ephi_arg, set_exprphi_downsafe, exprphi_downsafe,
	set_exprphi_canbeavail, exprphi_canbeavail, set_exprphi_later,
	exprphi_later, set_exprphi_extraneous, exprphi_extraneous,
	exprphi_willbeavail, is_assignment_stmt, is_may_ref, is_may_def,
	is_may_use, is_partial_ref, is_partial_use, is_volatile_ref,
	is_volatile_def, is_volatile_use, is_clobbering_def,
	is_relocating_def, is_addressof_use, is_pure_use, is_pure_def,
	rli_after_end, rli_step, rli_step_rev, rli_ref, get_last_ref,
	get_first_ref, ref_list_is_empty): Remove.  Update all users.

	* tree-flow.h: Update copyright notices.
	Remove doxygen markers.
	Include hashtab.h.
	(enum tree_ann_type): New.
	(struct tree_ann_common_d): New.
	(struct var_ann_d): New.
	(struct operands_d): New.
	(struct voperands_d): New.
	(operands_t): New type.
	(voperands_t): New type.
	(struct dataflow_d): New.
	(dataflow_t): New type.
	(struct stmt_ann_d): New.
	(tree_ann): New type.
	(var_ann_t): New type.
	(stmt_ann_t): New type.
	(bb_ann_t): Rename from bb_ann.
	(enum tree_ref_type, TRM_*, struct ref_list_node, struct
	ref_list_priv, ref_list, struct tree_ref_common, struct var_ref_d,
	struct var_def_d, struct var_phi_d, struct var_use_d, struct
	phi_node_arg_d, phi_node_arg, struct expr_ref_common, struct
	expr_phi_d, struct expr_use_d, enum tree_ref_structure_enum, union
	tree_ref_d, tree_ref, struct tree_ann_d, tree_ann, enum tree_flags,
	struct dfa_counts_d, ref_list_iterator): Remove.  Update all users.
	(TDFA_USE_OPS): Define.
	(TDFA_USE_VOPS): Define.

	* tree-inline.c (walk_tree): Handle SSA_NAME nodes.

	* tree-optimize.c: Update copyright notices.
	Remove doxygen markers.
	(optimize_function_tree): Temporarily disable call to
	tree_perform_ssapre.
	Remove #if0 code.

	* tree-pretty-print.c (MASK_POINTER): Define.
	(dump_vops): New function.
	(dump_generic_node): Shorten made-up names for unnamed objects.
	Hanlde PHI_NODE, VDEF_EXPR and SSA_NAME nodes.
	Keep track of basic block transitions.
	Call dump_vops if -vops dump option is given.
	(op_prio): Don't abort if the operand is nil.
	(dump_block_info): Don't keep track of basic block transitions.

	* tree-simple.c: Update copyright notices.
	(get_base_symbol): Call STRIP_NOPS.
	Handle SSA_NAME nodes.

	* tree-simple.h: Update copyright notices.
	(gsi_end_p): Rename from gsi_end.  Update all callers.

	* tree-ssa-ccp.c: Update copyright notices.
	Update code to use the new SSA infrastructure.
	(const_values): New hash table to keep track of constants.
	(struct value_map_d): New.
	(cfg_edges): Rename from edges.  Update all users.
	(set_value): New function.
	(get_value): New function.
	(get_default_value): New function.
	(value_map_hash): New function.
	(value_map_eq): New function.

	* tree-ssa-dce.c: Update copyright notice.
	Update code to use new SSA infrastructure.  Factor some code into
	new functions.
	(dom_info): Declare with file scope.
	(struct stmt_stats): Add fields 'total_phis' and 'removed_phis'.
	(needed_stmts): New hash table to keep track of needed statements.
	(stmt_useful_p): New function.
	(find_useful_stmts): Call it.
	(remove_dead_stmt, remove_dead_phis): New functions.
	(remove_dead_stmts): Call them.
	(need_to_preserve_store): Preserve stores to volatile variables.
	(tree_ssa_dce): Rename from tree_ssa_eliminate_dead_code.  Update
	all users.

	* tree-ssa.c: Update copyright notice.
	Change basic algorithm to rewrite the function into SSA form
	instead of building factored use-def chains.
	Include hashtab.h and tree-dump.h
	(next_ssa_version): New global variable.
	(def_blocks): New file local variable.
	(struct def_blocks_d): New.
	(currdefs): New file local variable.
	(struct currdef_d): New.
	(rewrite_into_ssa): Rename from build_tree_ssa.  Update all users.
	Call compute_may_aliases, mark_def_sites and rewrite_block.
	(rewrite_block): Rename from search_fud_chains.  Call
	rewrite_stmts.
	(mark_def_sites): New function.
	(set_def_block): New function.
	(rewrite_stmts): New function.
	(rewrite_stmt): New function.
	(rewrite_operand): New function.
	(rewrite_out_of_ssa): New function.
	(remove_phi_node): New function.
	(register_new_def): New function.
	(def_blocks_free): New function.
	(def_blocks_hash): New function.
	(def_blocks_eq): New function.
	(currdef_hash): New function.
	(currdef_eq): New function.
	(debug_def_blocks): New function.
	(debug_def_blocks_r): New function.
	(build_fud_chains, compute_reaching_defs, follow_chain,
	dump_reaching_defs, debug_reaching_defs, set_ssa_links): Remove.
	(remove_phi_arg): Rename from tree_ssa_remove_phi_alternative.
	Update all users.
	(init_tree_ssa): Set next_ssa_version to 1.
	Create hash tables def_blocks and currdefs.
	(delete_tree_ssa): Accept a FUNCTION_DECL tree as argument.  Update
	all users.
	(currdef_for): Add new parameter 'create_default'.  If nonzero,
	create a new SSA name if none is found for the variable.
	(set_currdef_for): Search in the currdefs hash table.

	* tree.c (tree_node_kind): Add new values phi_kind and
	ssa_name_kind.
	(tree_node_kind_names): Likewise.
	(tree_size): Handle PHI_NODE and SSA_NAME nodes.
	(make_node): Likewise.
	(tree_node_structure): Likewise.
	(phi_node_elt_check_failed): New function.
	(make_phi_node): New function.
	(make_ssa_name): New function.
	(build_vdef_expr): New function.

	* tree.def (SSA_NAME): New code.
	(VDEF_EXPR): New code.
	(PHI_NODE): New code.

	* tree.h (union tree_ann_d): Forward declare.
	(struct tree_common): Change type of field 'ann'.
	(PHI_NODE_ELT_CHECK): Define.
	(phi_node_elt_check_failed): Declare.
	(VDEF_RESULT): Define.
	(VDEF_OP): Define.
	(SSA_NAME_DECL): Define.
	(SSA_NAME_DEF_STMT): Define.
	(SSA_NAME_VERSION): Define.
	(struct tree_ssa_name): New.
	(PHI_RESULT): Define.
	(PHI_NUM_ARGS): Define.
	(PHI_ARG_CAPACITY): Define.
	(PHI_ARG_ELT): Define.
	(PHI_ARG_EDGE): Define.
	(PHI_ARG_DEF): Define.
	(struct phi_arg_d): New.
	(struct tree_phi_node): New.
	(SSA_DECL_P): Define.
	(SSA_VAR_P): Define.
	(enum tree_node_structure_enum): Add values TS_SSA_NAME and
	TS_PHI_NODE.
	(union tree_node): Add fields 'ssa_name' and 'phi'.
	(make_phi_node): Declare.
	(make_ssa_name): Declare.
	(build_vdef_expr): Declare.
	(TDF_BLOCKS): Rename from TDF_BLOCK.
	(TDF_VOPS): Define.

	* doc/invoke.texi: Document new tree dump option -vops.  Update
	documentation for switch -blocks.

2003-01-27  Jeff Law <law@redhat.com>

	* gimplify.c (simplify_return_expr): Correctly handle return
	expressions with side effects in functions returning void.

	* tree-ssa-ccp.c (widen_bitfield): Do not try to widen anything
	except constant integers.

2003-01-26  Jeff Law <law@redhat.com>

	* c-simplify.c (simplify_decl_stmt): Fix comment typo.
	Use correct predicate when "simplifying" a static initializer.

2003-01-26  Andreas Jaeger  <aj@suse.de>

	* Makefile.in (gt-dependence.h): New rule.

2003-01-23  Jeff Law <law@redhat.com>

	* c-simplify.c (simplify_decl_stmt): Arrange to examine initializers
	for static variables.
	* gimplify.c (simplify_constructor): Kill initial is_simple_constructor
	check.
	(simplify_modify_expr): Get the type from the destination rather than
	the toplevel expression.  Handle case where type is ARRAY_TYPE.  Ignore
	TREE_STATIC for the RHS.

2003-01-24  Frank Ch. Eigler  <fche@redhat.com>

	* tree-mudflap.c (mf_varname_tree): Check for non-NULL DECL_NAME
	before trying to cplus_demangle it.

2003-01-23  Jeff Law <law@redhat.com>

	* tree-cfg.c (make_exit_edges): Fix thinkos.

2003-01-22  Jeff Law <law@redhat.com>

	* tree-cfg.c (make_goto_expr_edges): Check the underlying
	LABEL_DECL, not the LABEL_EXPR for FORCED_LABEL and NONLOCAL_LABEL.

	* gimplify.c (simplify_expr, case GOTO_EXPR): Identify and mark
	labels which are targets of nonlocal gotos and mark functions which
	have labels which are targets of nonlocal gotos.
	(simplify_expr, case LABEL_DECL): New case.  Mark labels which
	have their address taken.
	* tree-cfg.c (is_nonlocal_label_block): Remove.  All callers
	updated.
	(make_exit_edges, case GOTO_EXPR): Handle computed gotos sanely.
	(make_exit_edges, case CALL_EXPR): Handle abnormal edges from
	nonlocal gotos at call sites.
	(make_exit_edges, case RETURN_EXPR): Likewise.
	(make_exit_edges, case MODIFY_EXPR): New case to handle abnormal
	edges from nonlocal gotos as call sites.
	(make_goto_expr_edges): Handle computed gotos and nonlocal gotos.
	(is_ctrl_altering_stmt): Handle abnormal edges in CALL_EXPRs
	functions which receive nonlocal gotos.  Similarly for CALL_EXPRs
	which occur on the RHS of a MODIFY_EXPR.
	* tree.h (FORCED_LABEL, NONLOCAL_LABEL): New defines.
	(FUNCTION_RECEIVES_NONLOCAL_GOTO): Likewise.

2003-01-22  Frank Ch. Eigler  <fche@redhat.com>

	* doc/invoke.texi: Provide some information about -fmudflap.

	* tree-mudflap.c (mf_varname_tree): Conditionally invoke the C++
	demangler in libiberty.  Reduce function printing verbosity.
	(mf_file_function_line_tree):  Reduce function printing verbosity.
	(mudflap_enqueue_decl): Use COMPLETE_TYPE_P to avoid trying to
	register (get size of) void-typed objects.

2003-01-21  Jose Renau  <renau@uiuc.edu>

        * tree-flow-inline.h (get_lineno): Return -1 for nodes without
        locus information.
        (get_filename): Return "???" for nodes without locus information.

2003-01-21  Jeff Law <law@redhat.com>

	* tree-cfg.c (cleanup_switch_expr_graph): Wrap declaration of
	switch_expr with ENABLE_CHECKING block.

	* c-simplify.c (is_last_stmt_of_scope): Wrap definition and
	declaration inside and ENABLE_CHECKING block.

2003-01-20  Frank Ch. Eigler  <fche@redhat.com>

	* tree-mudflap.c (mx_xfn_indirect_ref): Use new TREE_LOCUS field
	as a predicate for finding TREE_FILENAME etc.

2003-01-16  Daniel Berlin  <dan@dberlin.org>

	* Remove dead PRE code.
	* tree-ssa-pre.c (tree_perform_ssapre): Collect left occurrences and
	kills *after* finishing collecting all expressions.

2003-01-15  Jeff Law <law@redhat.com>

	* Death to WFL nodes.
	* c-aux-info.c: Replace DECL_SOURCE_FILE and DECL_SOURCE_LINE with
	TREE_FILENAME and TREE_LINENO respectively when retrieving file
	and line information.  Use TREE_LOCUS to copy existing information
	from one node to another.  Use annotate_with_file_line to add or
	replace location information on a node.  Remove support for
	EXPR_WITH_FILE_LOCATION nodes.  Remove STRIP_WFL statements.
	* c-common.c, c-parse.in, c-pretty-print.c, dbxout.c: Likewise.
	* diagnostic.c, dwarf2out.c, dwarfout.c: Likewise.
	* except.c, integrate.c, stmt.c, tree-alias-common.c: Likewise.
	* tree-cfg.c, tree-dfa.c, tree-dump.c, tree-flow-inline.h: Likewise.
	* tree-mudflap.c, tree-pretty-print.c, tree-simple.c: Likewise.
	* tree-ssa-ccp.c, tree-ssa-dce.c, tree-ssa-pre.c: Likewise.
	* varasm.c, xcoffout.c: Likewise.
	* config/alpha/alpha.c: Likewise.
	* config/mips/mips.c: Likewise.
	* c-decl.c: Likewise.
	(duplicate_decls): Also copy TREE_LOCUS from olddecl to newdecl.
	(finish_function): Save and restore the current filename and
	linenumber around genericizing of the function tree.
	* c-simplify.c (c_simplify_stmt): Use annotate_all_with_file_line
	instead of wrap_all_with_wfl.  Remove STRIP_WFL statements.
	* expr.c (expand_expr): Emit line number notes for expressions
	with attached file/line information.  Remove EXPR_WITH_FILE_LOCATION
	support.
	* gimplify.c: Kill STRIP_WFL statements.  Remove EXPR_WITH_FILE_LOCATION
	support.
	(simplify_expr_wfl): Kill.
	(annotate_stmt_with_file_line): Renamed from wrap_with_wfl.
	(annotate_all_with_file_line): Renamed from wrap_all_with_wfl.
	(simplify_expr): Save and restore the current file/line around
	simplification of the given expression.  Add annotation to more
	nodes created during simplification.
	(simplify_self_mod_expr): Add file/line location to nodes we create.
	(get_initialized_tmp_var): Similarly.
	* old-tree-inline.c (expand_call_inline): Use annotate_with_file_line
	to add file/line information to nodes instead of wrapping them
	with EXPR_WITH_FILE_LOCATION nodes.
	* print-tree.c: Use TREE_FILENAME and TREE_LINENO instead of
	DECL_SOURCE_FILE and DECL_SOURCE_LINE respectively.  Remove
	support for EXPR_WITH_FILE_LOCATION nodes.
	(print_node): Dump any file/line information that is attached to
	the given node.
	* tree-inline.c (walk_tree): Set lineno appropriately.
	* tree-simple.h (annotate_all_with_file_line): Renamed from
	wrap_all_with_wfl.  Remove STRIP_WFL statements.
	* tree.c (build_expr_wfl): Kill.
	(make_node): Use annotate_with_file_line.
	(annotate_with_file_line): New function.
	* tree.def: Remove EXPR_WITH_FILE_LOCATION.
	* tree.h (tree_common): Add locus field.  Remove references to
	EXPR_WITH_FILE_LOCATION.
	(tree_decl): Remove locus field.
	(STRIP_WFL, EXPR_WFL_*): Kill.
	(DECL_SOURCE_LOCATION, DECL_SOURCE_FILE, DECL_SOURCE_LINE): Kill.
	(TREE_LOCUS, TREE_FILENAME, TREE_LINENO): new.
	(annotate_with_file_line): Renamed from build_expr_wfl.

	* objc/objc-act.c: Use TREE_FILENAME and TREE_LINENO to
	extract file/line information from tree nodes.

2003-01-14  Frank Ch. Eigler  <fche@redhat.com>

	* tree-mudflap.c (mx_xfn_indirect_ref): Handle ARRAY_REF of
	a COMPONENT_REF specially to avoid unnecessary checks.

2003-01-13  Frank Ch. Eigler  <fche@redhat.com>

	Front-end generalization.
	* Makefile.in (C_AND_OBJC_OBJS): Add c-mudflap.o and dependencies.
	* tree-mudflap.c: Don't include "c-tree.h" any more.
	(mf_init_extern_trees): Divert to mflang_lookup_decl().
	(mf_enqueue_register_call, mf_flush_enqueued_calls): Move and rename
	these functions.
	* tree-mudflap.h: Declare new mflang_* routines.
	* c-mudflap.c: New file with C front-end mflang_* routines.
	* tree-nomudflap.c (*): Call internal_error instead of abort.

2003-01-07  Steven Bosscher  <s.bosscher@student.tudelft.nl>

	* Makefile.in (check-g95): New test target.
	(check-f95): Alias for check-g95.

2003-01-07  Diego Novillo  <dnovillo@redhat.com>

	* tree-dump.c (dump_function_to_file): New function.
	(dump_function): Call it.
	Convert argument declaration to K&R format.
	* tree-dump.h: Include splay-tree.h.
	(dump_function_to_file): Declare.

	* tree-optimize.c (optimize_function_tree): Remove unused variables
	dump_file and dump_flags.
	(dump_current_function): Remove.  Update all users by calling
	dump_function instead.
	* tree.h (dump_current_function): Remove declaration.

	* Makefile.in (TREE_DUMP_H): Define.
	Update targets depending on tree-dump.h to depend on $(TREE_DUMP_H).
	(tree-ssa-cp.o): Remove unused target.
	(tree-cfg.o): Add dependency on $(TREE_DUMP_H).
	(tree-optimize.o): Likewise.
	(tree-ssa-dce.o): Likewise.
	(tree-ssa-ccp.o): Likewise.
	(tree-ssa-pre.o): Likewise.

2003-01-02  Daniel Berlin  <dberlin@dberlin.org>

	* tree-ssa-pre.c (rename_2): Fix a false matching condition.
	This is actually fallout from is_default_def change.

2003-01-02  Jason Merrill  <jason@redhat.com>

	* c-simplify.c (c_genericize): Dump more info about the function.
	Use dump_function.
	* tree-dump.c (dump_function): Move from cp/optimize.c.
	* tree-dump.h: Declare it.

	* gimplify.c (mostly_copy_tree_r): Remove unnecessary cases.
	(unshare_expr): New fn.
	* tree-inline.c (mark_local_for_remap_r, unsave_r): New fns, adapted
	from C++ versions.
	(lhd_unsave_expr_now): Likewise.
	* tree.c (unsave_expr_now): Remove.
	(unsafe_for_reeval): Labels and BIND_EXPRs are only somewhat unsafe.

	* gimplify.c (simplify_function_tree): Add an outer BIND_EXPR if
	needed.
	(voidify_wrapper_expr): Not static.  Abort if we try to voidify an
	expression with TREE_ADDRESSABLE type.  Be clever with INDIRECT_REFs.
	(foreach_stmt): Avoid redundant work.
	(create_tmp_var): Abort if we try to create a temp of ADDRESSABLE type.
	(simplify_expr): Simplify VTABLE_REF.
	* c-simplify.c (simplify_decl_stmt): Ignore DECL_EXTERNAL decls.
	(simplify_stmt_expr): Fix thinko.
	(simplify_block): Don't ignore partial scopes.
	(simplify_condition): New fn.
	(simplify_c_loop, simplify_if_stmt, simplify_switch_stmt): Call it.
	* expr.c (expand_expr) [BIND_EXPR]: Handle statics better.
	* tree-inline.c (remap_decl): Remap all decls.
	(declare_return_variable): Be clever with INDIRECT_REFs.
	(expand_call_inline): If we have an explicit return slot, the inlined
	body is void.
	(walk_tree): Fix type handling.
	(copy_tree_r): Don't walk into decls.
	* tree-simple.c (is_simple_unary_expr): Handle VTABLE_REF.
	(is_simple_id): Allow RESULT_DECL.
	* tree-simple.h (gsi_stmt): Strip WFLs and NOPs.

	* gimplify.c (simplify_cond_expr): Handle void arms.  Add target parm.
	(simplify_modify_expr): Pass it.  Add special handling for COND_EXPR
	and CONSTRUCTOR (from Daniel Berlin).  Add want_value parm.
	(simplify_expr): Pass new args. Loop sooner if language-specific
	simplification happened.
	(simplify_return_expr): Pass the whole MODIFY_EXPR to simplify_expr.
	(simplify_target_expr): Simplify.

	* tree.def (CATCH_EXPR, EH_FILTER_EXPR): New tree codes.
	* except.c (expand_eh_handler): New fn.
	(expand_eh_region_end_allowed): If no types are allowed, hand off to
	expand_eh_region_end_must_not_throw.
	* except.h: Declare expand_eh_handler.
	* expr.c (expand_expr) [TRY_CATCH_EXPR]: Use it.
	[CATCH_EXPR, EH_FILTER_EXPR]: New cases.
	* gimplify.c (simplify_expr) [EXC_PTR_EXPR, CATCH_EXPR,
	EH_FILTER_EXPR]: New cases.
	(gimple_build_eh_filter): New fn.
	(maybe_protect_cleanup): New fn.
	(gimple_push_cleanup): Call it.
	(simplify_cleanup_point_expr): Fix thinko.
	* c-simplify.c (simplify_cleanup): Call it.
	* tree-simple.h: Declare it.
	* Makefile.in (gimplify.o): Depend on except.h.
	* tree.h (CATCH_TYPES, CATCH_BODY): New macros.
	(EH_FILTER_TYPES, EH_FILTER_FAILURE): New macros.
	* tree-simple.c (is_simple_id): Allow EXC_PTR_EXPR.
	* c-pretty-print.c (dump_c_node) [CLEANUP_POINT_EXPR]: Support.
	* tree-pretty-print.c (dump_generic_node): Likewise.
	[CATCH_EXPR, EH_FILTER_EXPR, EXC_PTR_EXPR]: Support.

	* c-pretty-print.c (NIY): Print operands.
	(dump_c_tree): Don't look at TREE_CHAIN if it doesn't matter.
	(dump_c_node) [ARRAY_TYPE]: Handle non-constant array bounds.
	[CALL_EXPR]: Pass spc down.
	[VTABLE_REF]: Support.
	(op_prio) [TARGET_EXPR]: Support.
	(print_call_name): Handle function pointers.
	* tree-pretty-print.c: Likewise.

2002-12-31  Steven Bosscher  <s.bosscher@student.tudelft.nl>

        * gimplify.c (create_tmp_var_noc): Remove unused function.
	* tree-simple.h: Kill prototype.

2002-12-30  Diego Novillo  <dnovillo@redhat.com>

	* tree-flow.h (tree_find_loops): Remove unused declaration.

2002-12-29  Daniel Berlin  <dberlin@dberlin.org>

	* toplev.c: Add flag_ip, enable by default at -O4+ (This is not
	set in stone, and thus, not documented).
	(decode_f_option): Add warning if andersen's PTA is selected but
	not compiled in.

	* flags.h: Add flag_ip.

	* tree-alias-ander.c: Fix todo.
	(andersen_function_call): Return 1 if we don't need to process
	the function.
	(ptset_map): New map, cache points-to sets.
	(andersen_op): We can do IP on all statics without help.
	(andersen_init): Only init once if we are doing ip analysis.
	(andersen_cleanup): Don't cleanup if we need the info for ip.
	(andersen_add_var): Clear points-to set if it exists already.
	(andersen_add_var_same): Ditto.
	(andersen_function_call): We can do interprocedural analysis on
	statics.
	(andersen_may_alias): Cache points-to sets.

	* c-decl.c (c_expand_body): Don't throw away tree if flag_ip is
	on, even if they are uninlinable, they may be wanted for ip
	optimizations.

	* tree-alias-common.c (get_values_from_constructor): New
	function to collect alias_typevars from constructors.
	(alias_annot): Fix where the GTY is so gengtype picks it up.
	(intra_function_call): Ignore non-pointers for global var
	assignment. What arguments point to can now point to a global var
	as well.
	(find_func_aliases): We need to handle decl's with initials as
	well.
	Only call intra_function_call if we have to.
	Handle constructors.
	(create_fun_alias_var): Incoming pointer arguments could be
	pointing to a global var, unless this is a static function and we
	are doing interprocedural analysis.
	(create_alias_vars): Take an fndecl argument, and use it.
	(init_alias_vars): Handle ip_partial as well.
	(ptr_may_alias_var): Simplify, fix.

	* tree-alias-common.h (tree_alias_ops): function_call now returns
	an int, and we have an extra member named ip_partial.

	* tree-alias-steen.c (steen_ops): We can't do ip_partial.
	(steen_function_call): Update definition and return 1.

	* tree-dfa.c (compute_may_aliases): Call create_alias_vars with
	current_function_decl.

	* tree-flow.h (create_alias_vars): Remove proto from here, it's
	in tree-alias-common.h.
	(tree_perform_ssapre): Take a tree, like the other optimizers.

	* tree-optimize.c (optimize_function_tree): Call
	tree_perform_ssapre with a tree.

	* tree-ssa-pre.c: Remove dead, #if 0'd code.
	(tree_perform_ssapre): Use passed in tree.

2002-12-23  Frank Ch. Eigler  <fche@redhat.com>

	* tree-mudflap.c (mf_decl_cache_locals, mf_decl_clear_locals): New
	functions.
	(mudflap_c_function): Call them before/after basic transforms.
	(mf_cache_shift_decl_l, ..._mask_l): New variables to track local
	VAR_DECL shadows of cache parameters.
	(mf_build_check_statement_for): Use and update them.

2002-12-23  Frank Ch. Eigler  <fche@redhat.com>

	* tree-mudflap.c (mx_register_decls): Trust incoming TREE_ADDRESSABLE
	instead of own timetaking analysis.
	(mf_find_addrof, mx_xfn_find_addrof): Removed functions.

2002-12-23  Steven Bosscher <s.bosscher@student.tudelft.nl>

	* tree-dfa.c: Add doxygen markers in comments.

2002-12-22  Diego Novillo  <dnovillo@redhat.com>

	* gimplify.c: Undo the following change:
	    2002-12-11  Diego Novillo  <dnovillo@redhat.com>
		* gimplify.c (simplify_return_expr): return statements should
		  only have a GIMPLE value as argument.

	* tree-simple.c: Fix grammar for return statements.

2002-12-20  Frank Ch. Eigler  <fche@redhat.com>

	* tree-mudflap.c (mf_init_extern_trees): Rewrite last change
	without using statement-expressions.

2002-12-19  Diego Novillo  <dnovillo@redhat.com>

	* tree-cfg.c (build_tree_cfg): Make sure that TV_TREE_CFG
	is popped properly.

2002-12-19  Frank Ch. Eigler  <fche@redhat.com>

	* tree-mudflap.c (mf_init_extern_trees): Abort gracefully if
	<mf-runtime.h> was not included.
	(*): Correct some minor compiler warnings elsewhere.

2002-12-18  Diego Novillo  <dnovillo@redhat.com>

	* configure: Regenerate with autoconf 2.13.

2002-12-17  Ben Elliston  <bje@redhat.com>

	* tree-optimize.c (optimize_function_tree): Temporarily
	disable SSA optimizations if -fmudflap is present.

2002-12-16  Ben Elliston  <bje@redhat.com>

	* tree-mudflap.c (mx_flag): Assert that the tree node is valid.

2002-12-14  Jason Merrill  <jason@redhat.com>

	* tree-dump.c (dump_files): Add .generic.  Move .inlined after it.
	* tree.h (tree_dump_index): Likewise.
	* c-simplify.c (c_genericize): Emit original and generic dumps here.
	* c-decl.c (c_expand_body): Not here.

2002-12-13  Ben Elliston  <bje@redhat.com>

	* tree-dfa.c (find_refs_in_expr): Terminate comment.

2002-12-12  Steven Bosscher <s.bosscher@student.tudelft.nl>

	* tree-cfg.c: Update doxygen documentation.
	* tree-dfa.c: Add doxygen documentation.

2002-12-11  Steven Bosscher <s.bosscher@student.tudelft.nl>

	* tree-cfg.c: Add doxygen markers in comments.
	* tree-optimize.c: Likewise.
	* tree-ssa.c: Likewise.

2002-12-11  Diego Novillo  <dnovillo@redhat.com>

	* gimplify.c (simplify_return_expr): return statements should only
	have a GIMPLE value as argument.
	* tree-cfg.c (call_expr_flags): New function.
	(is_ctrl_altering_stmt): Call it.
	* tree-flow.h (extern): Declare it.

2002-12-06  Diego Novillo  <dnovillo@redhat.com>

	* tree-cfg.c (make_goto_expr_edges): Temporary hack to prevent
	removing blocks with nonlocal labels.
	(is_nonlocal_label_block): Return true if DECL_NONLOCAL is set for
	the label.

	* tree-dfa.c (alias_leaders): New local array.
	(num_alias_leaders): New local variable.
	(find_alias_leader): New local function.
	(may_access_global_mem): New local function.
	(find_may_aliases_for): Call them.
	(compute_may_aliases): Allocate and deallocate alias_leaders.
	Show alias information if -fdump-tree-...-alias flag is given.
	(may_alias_p): Return true if both variables are the same.
	(find_refs_in_expr): Strip WFL and NOPs from the parent statement.
	If a pointer relocation is due to a function call, assignment from
	a global or a function argument, mark the pointer as a may-alias
	for global storage.
	(dump_referenced_vars): Reformat output.
	(dump_variable): Likewise.

	* tree-dump.c (dump_option_value_info): Add entry for TDF_ALIAS.
	* tree.h (TDF_ALIAS): Define.
	* doc/invoke.texi: Document new flag.

	* tree-flow-inline.h (may_alias_global_mem_p): New function.
	* tree-flow.h (enum tree_flags): Add value TF_MAY_ALIAS_GLOBAL_MEM.
	(may_alias_global_mem_p): Declare.

	* tree-simple.c (get_base_symbol): Return NULL_TREE, not NULL.
	* tree-ssa-ccp.c (tree_ssa_ccp): Remove unused variable.
	* tree-ssa-dce.c (need_to_preserve_store): Call
	decl_function_context instead of DECL_CONTEXT.
	If the symbol may alias global memory, return nonzero.

	* tree-ssa.c (dump_reaching_defs): Reformat output.
	(set_currdef_for): Walk the alias leader chain, setting CURRDEF for
	all the alias sets that may be affected by the definition.

2002-12-06  Daniel Berlin  <dberlin@dberlin.org>

	* tree-dfa.c (may_alias_p): Fix global variables and points-to.

2002-12-03  Daniel Berlin  <dberlin@dberlin.org>

	* tree-ssa.c (delete_tree_ssa):  Move call to delete_alias_vars
	above resetting num_referenced_vars.

2002-12-03  Diego Novillo  <dnovillo@redhat.com>

	* Makefile.in: Add dependencies on $(TM_H) and coretypes.h for the
	files mentioned below.
	* old-tree-inline.c: Include tm.h and coretypes.h.
	* c-pretty-print.c: Likewise.
	* disjoint-set.c: Likewise.
	* tree-alias-ecr.c: Likewise.
	* tree-alias-type.c: Likewise.
	* tree-alias-ander.c: Likewise.
	* tree-alias-steen.c: Likewise.
	* tree-alias-common.c: Likewise.
	* tree-ssa.c: Likewise.
	* tree-ssa-pre.c: Likewise.
	* tree-cfg.c: Likewise.
	* tree-dfa.c: Likewise.
	* tree-optimize.c: Likewise.
	* c-simplify.c: Likewise.
	* gimplify.c: Likewise.
	* tree-browser.c: Likewise.
	* simple-break-elim.c: Likewise.
	* simple-goto-elim.c: Likewise.
	* tree-dchain.c: Likewise.
	* c-call-graph.c: Likewise.
	* tree-simple.c: Likewise.
	* tree-nomudflap.c: Likewise.
	* tree-pretty-print.c: Likewise.
	* tree-ssa-dce.c: Likewise.
	* tree-ssa-ccp.c: Likewise.
	* dependence.c: Likewise.
	* tree-mudflap.c: Likewise
	(mx_xfn_indirect_ref): Use size_type_node instead of c_size_type_node.

2002-12-03  Diego Novillo  <dnovillo@redhat.com>

	* tree-dfa.c: Undo this change that causes bootstrap
	failures:

	2002-12-02  Diego Novillo  <dnovillo@redhat.com>

		* tree-dfa.c (may_alias_p): Artificial variables
		can also be aliased.

2002-12-03  Andreas Jaeger  <aj@suse.de>

	* tree-simple.c (right_assocify_expr): Remove unused variable.

2002-12-02  Andrew MacLeod  <amacleod@redhat.com>

	* gimplify.c (simplify_cleanup_point_expr): gsi_stmt can return NULL,
	use gsi_end.
	* tree-cfg.c (make_blocks): Use gsi_end, gsi_stmt can return NULL. Set
	basic_block for empty_stmt_node containers.
	(make_edges): Stmt's can be NULL.
	(make_ctrl_stmt_edges, make_exit_edges, make_loop_expr_edges,
	make_cond_expr_edges, make_goto_expr_edges, is_nonlocal_label_block,
	block_invalidates_loop, cleanup_control_flow, cleanup_cond_expr_graph,
	cleanup_switch_expr_graph, disconnect_unreachable_case_labels,
	find_taken_edge, tree_cfg2dot, successor_block, is_latch_block,
	switch_parent, first_stmt, last_stmt): Check for first_stmt() or
	last_stmt() returning NULL.
	(remove_tree_bb, first_exec_stmt): Use gsi_end.
	(last_stmt_ptr): Iterate to find last execuatbel stmt_ptr in a block.
	(gsi_start_bb): Return first non-empty stmt, if there is one.
	(set_bb_for_stmt): Don't decend into an empty_stmt_node.
	* tree-dfa.c (find_tree_refs): Use gsi_end.
	(collect_dfa_stats): Use gsi_end_bb.
	* tree-flow-inline.h (gsi_step_bb): split.
	(gsi_step_in_bb): gsi_step with explicit bb specified. Never return
	empty_stmt_node.
	(gsi_start_bb): Move to tree-cfg.c.
	(gsi_end_bb): New. Have we reached the end of a basic block.
	* tree-flow.h (gsi_start_bb): Make external.
	(gsi_end_bb, gsi_step_in_bb): New prototypes.
	* tree-simple.h (gsi_end): renamed from gsi_after_end.
	(gsi_stmt): Return NULL if stmt is an empty_stmt_node or error mark.
	* tree-ssa-ccp.c (simulate_block, substitute_and_fold): Use gsi_end.
	* tree-ssa-dce.c (mark_control_parent_necessary, find_useful_stmts,
	remove_dead_stmts): Use gsi_end_bb.
	(process_worklist): Check for NULL last_stmt.
	* tree-ssa-pre.c (finalize_1): Use gsi_end_bb, gsi_stmt can be NULL.

2002-12-02  Diego Novillo  <dnovillo@redhat.com>

	* tree-dfa.c (dump_ref): Display '<nil>' for NULL references.
	(dump_phi_args): Handle NULL arguments.
	(may_alias_p): Artificial variables can also be aliased.

2002-12-02  Daniel Berlin <dberlin@dberlin.org>

	* tree-ssa-pre.c (okay_injuring_def): inj could be null.
	(get_operand):  Use instead of special casing INDIRECT_REF and
	COMPONENT_REF everywhere.
	(names_match_p): Fix.
	(defs_match_p): Ignore partial uses.
	(rename_2): Fix non-matching condition.
	(update_old_new): Update the kills and lefts arrays.
	(finalize_1): Set the bb for the new statement.
	(update_ssa_for_new_use): Ditto.
	(code_motion): Ditto.
	(call_modifies_slot): Handle function pointers (where we end up
	with a _DECL as our argument).
	(pre_part_1_trav): Update the kills and lefts arrays.
	Just use TREE_TYPE (ei->expr) for type of expression.
	(add_left_occ): New helper function.
	(process_left_occs_and_kills): Add other cases we need to handle.
	(tree_perform_ssapre): Add new processed array, since for left
	occurrences and kills, we need to process *all* statements, not
	just ones we might consider candiates for PRE.

2002-12-02  Diego Novillo  <dnovillo@redhat.com>

	* tree-dfa.c (find_refs_in_expr): Look for references in
	VA_ARG_EXPR nodes.

2002-12-01  Diego Novillo  <dnovillo@redhat.com>

	* tree-optimize.c (optimize_function_tree): Undo
	inadvertent change in previous commit.

2002-12-01  Diego Novillo  <dnovillo@redhat.com>

	* fold-const.c (operand_equal_p): Check for NULL TREE_TYPEs.

	* tree-cfg.c (remove_stmt): Call remove_ref.
	(disconnect_unreachable_case_labels): Do not disconnect the edge
	going to the block holding the BIND_EXPR node for the switch()
	body.
	(dump_tree_cfg): Call dump_current_function.

	* Makefile.in (tree-dfa.o): Depend on convert.h.
	* tree-dfa.c: Include convert.h.
	(remove_def): New local function.
	(reset_def_def_links): New local function.
	(replace_phi_arg_with): New local function.
	(replace_ref_with): New function.
	(try_replace_ref_with): Rename from replace_ref_in.
	Also look for V_USE references on the LHS of assignments.
	When replacing the callee of a CALL_EXPR, make sure that the type
	of the new callee is compatible with the old one.
	(replace_ref_r): Call operand_equal_p.
	(remove_ref): New function.
	(same_var_p): New function.
	(dump_referenced_vars): Add new flag DETAILS.  Update all users.
	(debug_referenced_vars): Likewise.

	* tree-ssa.c (dump_reaching_defs): Change output format.
	(set_ssa_links): Don't set def-def links for PHI nodes.

	* tree-ssa-ccp.c (replace_uses_in): Add new argument COMMIT.
	Update all users.

	* tree-optimize.c (dump_current_function): New function.
	(optimize_function_tree): Call it.
	* tree.h (dump_current_function): Declare.
	* c-decl.c (c_expand_body): Call dump_current_function.
	* tree-ssa-dce.c (tree_ssa_eliminate_dead_code): Likewise.
	* tree-ssa-pre.c (tree_perform_ssapre): Likewise.
	* tree-ssa.c (build_tree_ssa): Likewise.
	* tree-ssa-ccp.c (tree_ssa_ccp): Likewise.
	Dump variables and reaching definitions if TDF_DETAILS is set.

	* tree-pretty-print.c (print_call_name): Call dump_generic_node for
	NOP_EXPR operands.

	* tree-ssa-pre.c: Don't include c-common.h nor c-tree.h
	Replace calls to build_modify_expr with build everywhere.
	Replace calls to deep_copy_node with copy_node_r everywhere.

2002-11-29  Andreas Jaeger  <aj@suse.de>

	* c-call-graph.c (construct_call_graph): Fix format.

	* tree-alias-ander.c: Declare print_out_result.

	* tree-ssa-pre.c: Declare is_on_lhs and call_modifies_slot.

	* tree.h: Declare expand_asm_expr and add_var_to_bind_expr.

	* tree-inline.c: Declare remap_decls.

2002-11-28  Daniel Berlin  <dberlin@dberlin.org>

	* tree-alias-common.h: Start adding doxygen docs.

	* tree-alias-common.c: Ditto

2002-11-28  Daniel Berlin  <dberlin@dberlin.org>

	* tree-alias-ander.c: Convert debug defines and ifdefs into
	dump_file use.

	* tree.h: Add TDI_pta.

	* tree-dump.c: Add dump-tree-pta and TDI_pta.

2002-11-28  Diego Novillo  <dnovillo@redhat.com>

	* Makefile.in (tree-ssa-pre.o, tree-cfg.o, gimplify.o, tree-ssa-dce.o,
	tree-ssa-ccp.o): Add dependency on $(TIMEVAR_H).
	* timevar.def (TV_TREE_GIMPLIFY, TV_TREE_MAY_ALIAS,
	TV_TREE_INSERT_PHI_NODES, TV_TREE_BUILD_FUD_CHAINS, TV_TREE_RDEFS):
	New timers.
	(TV_TREE_SSA): Remove.
	(TV_INTEGRATION, TV_EXPAND): Switch order.
	* c-decl.c (c_expand_body): Pop TV_EXPAND before running the tree
	optimizers.
	* gimplify.c (simplify_function_tree): Push/pop TV_TREE_GIMPLIFY.
	* tree-cfg.c (build_tree_cfg): Push/pop TV_TREE_CFG.
	* tree-dfa.c (compute_may_aliases): Push/pop TV_TREE_MAY_ALIAS.
	* tree-ssa-ccp.c (tree_ssa_ccp): Push/pop TV_TREE_CCP.
	* tree-ssa-dce.c (tree_ssa_eliminate_dead_code): Push/pop
	TV_TREE_DCE.
	Call compute_reaching_defs.
	Remove debugging dumps before DCE.
	* tree-ssa-pre.c (tree_perform_ssapre): Push/pop TV_TREE_PRE.
	* tree-ssa.c (build_tree_ssa): Don't call compute_reaching_defs.
	Don't call dump_reaching_defs.
	(insert_phi_nodes): Push/pop TV_TREE_INSERT_PHI_NODES.
	(build_fud_chains): Push/pop TV_TREE_BUILD_FUD_CHAINS.
	(compute_reaching_defs): Push/pop TV_TREE_RDEFS.
	Call dump_reaching_defs.
	* tree-optimize.c (optimize_function_tree): Remove calls to
	timevar_push and timevar_pop.

2002-11-28  Diego Novillo  <dnovillo@redhat.com>

	* Makefile.in (tree-ssa.o): Add dependency on $(TIMEVAR_H) and
	tree-alias-common.h.
	(tree-dfa.o): Likewise.
	(tree-optimize.o): Add dependency on $(TIMEVAR_H).
	* tree-dfa.c (compute_may_aliases): Move call to delete_alias_vars
	* tree-ssa.c (delete_tree_ssa): ... here.

2002-11-27  Diego Novillo  <dnovillo@redhat.com>

	* tree-dfa.c (add_may_alias): Remove.  Update all users.
	(get_alias_index): Remove.  Update all users.
	(dfa_stats_d): Remove fields num_may_alias, max_num_may_alias,
	num_alias_imm_rdefs and max_num_alias_imm_rdefs.  Update all users.
	(may_alias_p): Make extern.  Move declaration to tree-flow.h.
	(TRM_DEFAULT): Remove.  Update all users.  Update values of the
	other TRM_* constants.
	(create_ref): Don't initialize the PHI argument array with the
	number of incoming edges.
	(collect_dfa_stats): Do not traverse the function body with
	walk_tree.
	Free temporary hash table before returning.
	(compute_may_aliases): Update comment.
	(may_alias_p): Switch arguments if the first argument is not an
	INDIRECT_PTR or the artificial global_var.
	(find_may_aliases_for): If a pointer aliases a variable, set the
	pointer to be the alias leader for the variable.
	(ref_defines): Call may_alias_p.
	(is_killing_def): Return false if the reaching definition is NULL.
	Don't check for volatile definitions.
	Change second argument to be a tree.  Update all users.

	* tree-flow-inline.h (alias_imm_reaching_def): Remove.  Update all
	users.
	(may_alias): Remove.  Update all users.
	(set_imm_reaching_def): Check for circularity.
	(alias_leader): New function.
	(set_alias_leader): New function.
	(is_aliased): New function.
	(is_default_def): Remove.  Update all users.

	* tree-flow.h (struct var_ref_d): Remove field alias_imm_rdefs.
	Update all users.
	(struct var_def_d): Remove field m_default.  Update all users.
	(struct tree_ann_d): Remove field may_aliases.  Update all users.
	Add field alias_leader.
	(struct dfa_counts_d): Remove fields num_may_alias and
	num_may_alias_imm_rdefs.  Update all users.

	* tree-ssa.c: Update documentation on may-alias processing.
	(set_ssa_links): Remove third argument.  Update all users.
	(set_alias_imm_reaching_def): Remove.  Update all users.
	(create_default_def): Likewise.
	(analyze_rdefs): Likewise.
	(currdef_for): Move from tree-flow-inline.h
	(set_currdef_for): Likewise.
	(compute_reaching_defs): Rename from compute_tree_rdefs.  Update
	all users.
	(follow_chain): Call is_killing_def instead of is_partial_def.
	(tree_ssa_remove_phi_alternative): Remove unused variable ref.
	(set_ssa_links): When processing V_USE references, make sure that
	CURRDEF is a definition for the variable or one of its aliases.

2002-11-26  Sebastian Pop  <s.pop@laposte.net>

	* Makefile.in (OBJS): Add tree-browser.o.
	(tree-browser.o): New dependency.
	* tree-browser.c: New file.
	* tree-browser.def: New file.

2002-11-26  Jason Merrill  <jason@redhat.com>

	Gimplify C++ cleanups.
	* gimplify.c (voidify_wrapper_expr): Split out from...
	(simplify_bind_expr): ...here.
	(simplify_cleanup_point_expr): New fn.
	(simplify_target_expr): New fn.
	(gimple_conditional_context): New fn.
	(gimple_push_condition, gimple_pop_condition): New fns.
	(simplify_expr) [TRY_CATCH_EXPR]: Handle like TRY_FINALLY_EXPR.
	* c-simplify.c (simplify_cleanup): New fn.
	(c_simplify_stmt): Call it and lang_simplify_stmt.
	(simplify_expr_stmt): Wrap the expr in a CLEANUP_POINT_EXPR.
	(simplify_return_stmt, simplify_decl_stmt): Likewise.
	(simplify_stmt_expr): Handle the STMT_EXPR_NO_SCOPE case.
	(is_last_stmt_of_scope): Likewise.
	* c-common.h: Declare c_genericize, c_simplify_stmt and
	lang_simplify_stmt.
	* c-common.c (lang_simplify_stmt): Define.

	Gimplify EXIT_EXPRs.
	* gimplify.c (gimplify_loop_expr, gimplify_exit_expr): New fns.
	(simplify_expr): Call them.
	* expr.c (expand_expr) [LOOP_EXPR]: Pass 1 again for exit_flag.

	* tree-simple.c (right_assocify_expr): Also set TREE_SIDE_EFFECTS.

	* gimplify.c (simplify_expr): Call STRIP_TYPE_NOPS.
	[REALPART_EXPR]: Don't just return.

	* tree-pretty-print.c (dump_c_node): Handle REFERENCE_TYPE.
	* c-pretty-print.c (dump_c_node): Likewise.  Handle null FOR_INIT_STMT.

2002-11-25  Daniel Berlin <dberlin@dberlin.org>

	* config.gcc: Try committing the correct version.
	* tree-alias-ander.c (andersen_may_alias): Add "!= NULL" to make
	return a bool.

2002-11-24  Daniel Berlin  <dberlin@dberlin.org>

	* configure.in: Add --with-libbanshee, passed to us by toplevel if
	libbanshee was configured. Substitute approriate definitions for
	Makefile (IE disabling tree-alias-ander building) if it wasn't.
	* config.in: Regenerated.
	* config.gcc: Rebuild libbanshee with stage1 on darwin to work
	around system compiler problem.
	* configure: Regenerated.
	* Makefile.in: Add banshee stuff.
	* tree-alias-ander.c: New file.
	* tree-alias-ander.h: New file.
	* tree-alias-common.c (get_alias_var): Fix field based stuff.
	(find_func_aliases): Don't walk subtrees if we processed the tree.
	(ptr_may_alias_var): Fix both field-based and non-field-based lookup.

2002-11-22  Andrew MacLeod  <amacleod@redhat.com>

	* tree-ssa-dce.c (mark_necessary): Split out mark_tree_necessary. Don't
	mark if tree is already marked.
	(mark_tree_necessary): New. Mark tree without processing control parent.
	(mark_control_parent_necessary): Remove recursion, mark trees directly.
	(need_to_preserve_store): Can expression/symbol affect external values.
	(tree_ssa_eliminate_dead_code): Split.
	(find_useful_stmts): Find initial set of needed statements.
	(process_worklist): Find statements which calculate needed statements.
	(remove_dead_stmts): Delete statements which are dead.

2002-11-16  Jason Merrill  <jason@redhat.com>

	Improve tree dumps.
	* c-pretty-print.c, tree-pretty-print.c (dump_c_node): Handle
	integers larger than a host word.
	(op_prio): Handle INIT_EXPR.
	* gimplify.c (simplify_bind_expr): Set TREE_SIDE_EFFECTS and type
	of void_type_node on the COMPOUND_EXPRs as we walk.
	* tree-simple.c (right_assocify_expr): Propagate the type from cur
	rather than rhs.

	* c-decl.c (finish_function): Call c_genericize instead of
	simplify_function_tree.
	* c-simplify.c (c_genericize): New function.
	(simplify_stmt_expr): Just genericize.
	(simplify_compound_literal_expr): Likewise.
	(c_build_bind_expr): Don't build a block for an artificial decl.
	(simplify_decl_stmt): Add the variable to the temps list iff it's
	artificial.
	(c_simplify_expr): Don't call push/pop_context.
	* c-decl.c (build_compound_literal): Set DECL_ARTIFICIAL.
	* c-tree.h: Declare c_genericize.

	* c-simplify.c (tree_build_scope): Remove.

	Remove INIT_EXPR from GIMPLE.
	* c-simplify.c (simplify_decl_stmt): Use MODIFY_EXPR.
	* gimplify.c (simplify_bind_expr): Likewise.
	(simplify_modify_expr): Convert INIT_EXPR to MODIFY_EXPR.

	* c-simplify.c (create_tmp_var_1): Drop; change all users to call
	create_tmp_var.
	(gimple_add_tmp_var): Now adds to the external temps list if
	available, or directly to the function otherwise.

	Avoid gratuitous unused warnings.
	* c-simplify.c (simplify_expr_stmt): Check TREE_SIDE_EFFECTS
	directly.  Also check for explicit conversions to void.
	(expr_has_effect): Remove.

	* Makefile.in (OBJS): Remove tree-dchain.o.

	* stor-layout.c (variable_size): We don't care about
	global_bindings_p if the frontend doesn't want a list of the
	expressions.

2002-11-13  Diego Novillo  <dnovillo@redhat.com>

	* toplev.c (parse_options_and_default_flags): Enable SSA-CCP by
	default with optimization >= 1.
	* tree-dfa.c (find_refs_in_expr): Clobber '*.GLOBAL_VAR', not
	'GLOBAL_VAR'.
	(collect_dfa_stats): Collect statistics on '*.GLOBAL_VAR'.
	(compute_may_aliases): Make sure that variable is an INDIRECT_REF.
	(may_alias_p): GLOBAL_VAR should alias INDIRECT_REFs.
	Only check addressability on VAR_DECLs.
	(find_may_aliases_for): Make sure argument is an INDIRECT_REF.
	* tree-flow-inline.h (indirect_var): Call DECL_P.
	(set_indirect_var): Call DECL_P.
	Create annotation if it doesn't exist.
	(create_indirect_ref): Move from tree-dfa.c.
	* tree-flow.h (create_indirect_ref): Declare.
	* tree-ssa-ccp.c (visit_phi_node): Avoid debugging dump from
	accessing uninitialized data.
	* tree-ssa.c (init_tree_ssa): Create an INDIRECT_REF node for
	.GLOBAL_VAR.

2002-11-12  Diego Novillo  <dnovillo@redhat.com>

	* tree-cfg.c (delete_tree_cfg): Call free_aux_for_blocks.
	Call free_basic_block_vars.

	* gimplify.c (simplify_expr): VA_ARG_EXPR nodes are in GIMPLE form
	already.
	Gimplify BIT_FIELD_REF nodes.
	(simplify_call_expr): Update comment.
	* tree-dfa.c (find_refs_in_expr): VA_ARG_EXPR nodes make no
	data references.
	Handle BIT_FIELD_REF nodes.
	* tree-pretty-print.c (op_prio): Don't write an error message if
	the operand is not recognized.
	* tree-simple.c (is_simple_unary_expr): Handle BIT_FIELD_REFs.
	(is_simplifiable_builtin): Only return false for MD builtins.

2002-11-08  Diego Novillo  <dnovillo@redhat.com>

	* tree-cfg.c (cleanup_switch_expr_graph): Handle edges going to
	EXIT_BLOCK_PTR.
	(first_stmt): Return NULL for ENTRY_BLOCK_PTR, EXIT_BLOCK_PTR and
	INVALID_BLOCK.
	* tree-dfa.c (find_refs_in_expr): Call mark_not_simple.

2002-11-07  Diego Novillo  <dnovillo@redhat.com>

	* Makefile.in (tree-ssa.o, tree-cfg.o, tree-dfa.o): Add dependency
	on function.h
	* tree-cfg.c: Include function.h.
	(build_tree_cfg): Set dump_file to NULL after closing the file.
	(remove_tree_bb): Don't dump warnings about statements being
	removed.
	(dump_tree_cfg): Use current_function_name.
	Check that the flowgraph is not empty before dumping the function
	body.
	(tree_cfg2dot): Use current_function_name.
	* tree-dfa.c: Include function.h
	(dump_dfa_stats): Use current_function_name.
	* tree-optimize.c (optimize_function_tree): Set dump_file to NULL
	after closing the file.
	* tree-pretty-print.c (dump_generic_node): Make sure that the
	flowgraph exists before displaying block boundaries.
	* tree-ssa-ccp.c (tree_ssa_ccp): Set dump_file to NULL after
	closing the file.
	* tree-ssa.c: Include function.h.
	(build_tree_ssa): Set tree_ssa_dump_file to NULL after closing the
	file.
	(dump_reaching_defs): Use current_function_name.
	(dump_tree_ssa): Likewise.

2002-11-07  Diego Novillo  <dnovillo@redhat.com>

	* tree-cfg.c (successor_block): Return EXIT_BLOCK_PTR if no
	successor can be found while walking the nesting chain.

2002-11-07  Diego Novillo  <dnovillo@redhat.com>

	* tree-cfg.c: Fix some formatting in code and comments.
	(set_bb_for_stmt): Move from tree-flow-inline.h
	* tree-dfa.c: Fix some formatting in code and comments.
	* tree-flow-inline.h: Likewise.
	* tree-flow.h: Likewise.
	* tree-ssa.c: Likewise.

2002-11-06  Diego Novillo  <dnovillo@redhat.com>

	* Makefile.in (tree-ssa-ccp.o): Add dependency on tree-inline.h
	* tree-cfg.c (find_taken_edge): New function.
	(cleanup_cond_expr_graph): Call it.
	(disconnect_unreachable_case_labels): Call it.

	* tree-dfa.c (struct clobber_data_d): Remove field
	parent_expr_p.  Update all users.
	(find_refs_in_expr): Remove argument parent_expr_p.  Update all users.
	(create_ref): Remove arguments parent_expr_p and operand_p.  Update
	all users.
	(replace_ref_in): Rename from replace_ref_operand_with.  Update all
	users.  Find the operand in the statement and replace it with a new
	operand.
	(replace_ref_r): New local function.
	(is_killing_def): Also handle V_PHI references.
	(output_ref): Move from tree-flow-inline.h

	* tree-flow-inline.h (ref_expr): Remove.  Update all users.
	(restore_ref_operand): Remove.  Update all users.
	(set_output_ref): Remove.  Update all users.
	(is_assignment_stmt): New function.
	(is_may_def, is_may_use, is_partial_def, is_partial_use,
	is_volatile_def, is_volatile_use, is_default_def,
	is_clobbering_def, is_initializing_def, is_relocating_def,
	is_addressof_use, is_pure_use): Check reference type first.
	(is_pure_def): New function.

	* tree-flow.h (struct tree_ref_common): Remove fields expr_p,
	operand_p and orig_operand.  Update all users.
	(struct tree_ann_d): Remove field output_ref.  Update all users.

	* tree-ssa-ccp.c: Include tree-inline.h.
	(simulate_block): Simulate every statement in the block, not its
	references
	(simulate_def_use_chains): Simulate statements containing uses
	reached by the definition.
	(substitute_and_fold): Traverse statements, not references.
	Call fold_stmt.
	(visit_phi_node): If PHI node is marked volatile, assume varying.
	(visit_stmt): Rename from visit_expression_for.  Work on a
	statement, not a reference.
	(visit_assignment): Rename from visit_assignment_for.  Work on a
	statement, not a reference.
	(visit_cond_stmt): Rename from visit_condexpr_for.  Work on a
	statement, not a reference.
	(evaluate_stmt): Rename from evaluate_expr.  Work on a statement,
	not a reference.
	(initialize): Initialize special definitions to varying.
	(replace_uses_in): Work on a statement, not an expression.
	(fold_stmt): Rename from ccp_fold.  Work on a statement, not an
	expression.
	(get_rhs): New local function.
	(set_rhs): New local function.

2002-11-06  Daniel Berlin  <dberlin@dberlin.org>

	* tree-flow.h: Prototype set_bb_for_stmt, last_stmt_ptr,
	add_ephi_arg, num_ephi_args, set_ephi_arg, ephi_arg.
	(enum tree_ref_type): Add E_LEFT, E_KILL, E_EXIT.

	* tree-cfg.c (set_bb_for_stmt): Move to tree-flow-inline.h.
	(last_stmt_ptr): New function, gives pointer to last statement in
	bb.

	* tree-flow-inline.h: Add exprref_processed, exprref_processed2,
	expruse_phi, num_ephi_args, set_ephi_arg, ephi_arg, add_ephi_arg.

	* tree-dfa.c (tree_ref_structure): Handle E_{LEFT,KILL,EXIT}.
	(ref_type_name): Ditto.
	(tree_ref_size): Ditto.
	(dump_ref): E_PHI's phi_args is now a varray of phi_arg structs.
	(add_ephi_arg): New function.
	(remove_ref_from_list): Fix crash when node not found.
	(compute_may_aliases): Add timing for points-to analysis.

	* timevar.def: Add TV_TREE_PTA.

	* tree-ssa-pre.c: Start of massive cleanup and rewriting (in
	preparation for load/store PRE). No more uses of ref_expr, proper
	call handling. Started removing unnecessary structures and lists,
	started removing redundant and inefficient operations (IE O(n^2)
	loops to process all phi operands, etc).  Basic load PRE implemented.
	Code may look ugly due to large pieces commented out waiting for DFA
	updating of refs to redo.

2002-11-05  Diego Novillo  <dnovillo@redhat.com>

	* tree-cfg.c (create_block_annotations): New local function.
	(create_bb_ann): Remove.  Update all users.
	(parent_array): New local variable.
	(build_tree_cfg): Initialize it.
	Call create_block_annotations.
	(create_bb): Call alloc_block instead of ggc_alloc to allocate
	memory for basic blocks.
	Don't call set_parent_block.
	Grow array parent_array.
	(dump_tree_cfg): Change meaning of second argument.  Make it accept
	any of the TDF_* flags defined in tree.h.
	(delete_tree_cfg): Call free_aux_for_blocks.
	Free array parent_array.
	* tree-flow-inline.h (get_filename): New function.
	(is_exec_stmt): return false if T is error_mark_node.
	* tree-flow.h (struct var_ref_d): Mark alias_imm_rdefs field for
	garbage collection.
	(get_filename): Declare.
	(struct bb_ann_d): Rename from bb_ann_def.
	Remove garbage collection markers.
	(referenced_vars): Mark for garbage collection.
	(global_var): Likewise.
	(create_bb_ann): Remove.
	* tree-optimize.c (optimize_function_tree): Remove CFG and SSA
	after debugging dumps.

	* diagnostic.h (print_generic_stmt): Rename from print_generic_tree.
	Update all users.
	(print_generic_expr): Rename from print_generic_node.  Update all
	users.
	(PPF_BRIEF): Remove.  Update all users.
	(PPF_BLOCK): Remove.  Update all users.
	(PPF_LINENO): Remove.  Update all users.
	(PPF_IS_STMT): Remove.  Update all users.
	* flags.h (flag_dump_tree_all_ssa): Remove.  Update all users.
	* toplev.c (f_options): Remove entry for -fdump-tree-all-ssa.
	Update all users.
	* tree-dump.c (dump_enable_all): Rename from dump_enable_all_ssa.
	Update all users.
	(dump_files): Add entry for -fdump-tree-all.
	(dump_option_value_info): Remove entries for TDF_REFS and
	TDF_RDEFS.
	Add entry for TDF_BLOCK.
	(dump_switch_p): If -fdump-tree-all was given, call dump_enable_all.
	* tree-pretty-print.c (PPF_BRIEF): Remove.  Update all users.
	(PPF_BLOCK): Remove.  Update all users.
	(PPF_LINENO): Remove.  Update all users.
	(PPF_IS_STMT): Remove.  Update all users.
	(dumping_stmts): New local variable.
	(print_generic_stmt): Rename from print_generic_tree.  Update all
	users.
	Set dumping_stmts to true.
	(print_generic_expr): Rename from print_generic_node.  Update all
	users.
	Set dumping_stmts to false.
	(maybe_init_pretty_print): Set last_bb to -1.
	(dump_block_info): If available, dump file and line number
	information for the first statement in the basic block.
	* tree-ssa.c (build_tree_ssa): Dump referenced variables and
	reaching definition information if -details is given.
	* tree.h (enum tree_dump_index): Rename TDI_all to TDI_tu.  Update
	all users.
	Add new index TDI_all.
	(TDF_DETAILS): Change value.
	(TDF_REFS): Remove.  Update all users.
	(TDF_RDEFS): Remove.  Update all users.
	(TDF_BLOCK): Define.
	* doc/invoke.texi: Update documentation for -fdump-tree-... flags.

2002-11-05  Frank Ch. Eigler  <fche@redhat.com>

	* tree-mudflap.c (mudflap_enqueue_decl, _constant): Use
	size_in_bytes, not c_size_in_bytes.
	(mf_init_extern_trees): Import uintptr_t typedef node from
	mf-runtime.h.

2002-11-01  Diego Novillo  <dnovillo@redhat.com>

	* tree-cfg.c (remove_tree_bb): Add new argument remove_stmts.
	Update all callers.
	(make_ctrl_stmt_edges): Add an edge to the body of a SWITCH_EXPR.
	(make_cond_expr_edges): Don't try to linearize the if() subgraph.
	(make_case_label_edges): Don't remove the fallthru edge from the
	entry block to the switch() subgraph.
	(cleanup_tree_cfg): Call cleanup_control_flow.
	(remove_unreachable_blocks): Remove blocks of compound structures
	before removing the entry block.
	(remove_blocks): New local function.
	(blocks_unreachable_p): New local function.
	(is_nonlocal_label_block): New local function.
	(find_subblocks): New local function.
	(is_parent): New local function.
	(gsi_remove): New function.
	(remove_stmt): New local function.
	(cleanup_control_flow): New local function.
	(cleanup_cond_expr_graph): New local function.
	(cleanup_switch_expr_graph): New local function.
	(disconnect_unreachable_case_labels): New local function.

	* tree-dfa.c (remove_decl): New function.
	(find_decl_location): New function.

	* tree-flow.h (gsi_remove): Declare.
	(remove_decl): Declare.
	(find_decl_location): Declare.

	* tree-ssa-ccp.c (optimize_unexecutable_edges): Remove.  Update all
	users.
	(ssa_ccp_df_delete_unreachable_insns): Remove.  Update all users.
	(tree_ssa_ccp): Call print_generic_tree with PPF_BLOCK.

2002-10-31  Diego Novillo  <dnovillo@redhat.com>

	* tree-dfa.c (create_indirect_ref): New local function.
	(find_refs_in_expr): Call it.
	(create_ref): Check E_* reference types with == instead of &.
	(dump_ref): Likewise.
	(count_tree_refs): Likewise.
	* tree-ssa.c (set_ssa_links): Update documentation comment for
	save_chain.

2002-10-31  Diego Novillo  <dnovillo@redhat.com>

	* tree-cfg.c (remove_tree_bb): Don't walk beyond the end of the
	basic block.

2002-10-26  Daniel Berlin  <dberlin@dberlin.org>

	* flags.h: Remove flag_tree_points_to from here.
	* toplev.c: Include tree-alias-common.h.
	(flag_tree_points_to): Now of type enum pta_type, rather than
	int.
	(lang_independent_options): Remove flag_tree_points_to.
	(display_help): Display help for tree-points-to here.
	(decode_f_option): Allow selecting of points-to algorithm.
	* tree-alias-common.c (varmap): Removed.
	(alias_annot): Changed to a hash table.  Update all functions
	approriately.
	(FIELD_BASED): New macro, switches between field-based analysis,
	and field-independent analysis (field-based isn't quite done yet).
	(alias_annot_entry): New, used in hash table.
	(annot_eq): New function.
	(annot_hash): New function.
	(find_func_aliases): Handle casts, fix indendation.
	(splaycount): Removed.
	(splay_tree_count): Removed.
	(display_points_to_set): Removed.
	(splay_tree_size): Removed.
	(alias_get_name): New function.
	(ptr_may_alias_var): Globals are a bit funky to handle.
	* tree-alias-steen.c: Use alias_get_name, rather than
	print_generic_node.
	(steen_simple_assign): Handle assignment of PTF's.
	(test_assign): Remove.
	* tree-alias-common.h (enum pta_type): New.
	(alias_get_name): New.
	(flag_tree_points_to): New.

2002-10-26  Diego Novillo  <dnovillo@redhat.com>

	* tree-cfg.c (cleanup_tree_cfg): Uncomment call to
	compact_blocks.

2002-10-26  Diego Novillo  <dnovillo@redhat.com>

	* Makefile.in (tree-pretty-print.o): Depend on $(TREE_FLOW_H)
	* basic-block.h (BB_COMPOUND_ENTRY): Rename from BB_CONTROL_ENTRY.
	* diagnostic.h (dump_generic_tree): Remove extern declaration.
	(print_generic_node_brief): Remove.  Update all users.
	(PPF_BRIEF): Declare.
	(PPF_BLOCK): Declare.
	(PPF_LINENO): Declare.
	(PPF_IS_STMT): Declare.
	* tree-pretty-print.c (PPF_BRIEF): New constant.
	(PPF_BLOCK): New constant.
	(PPF_LINENO): New constant.
	(PPF_IS_STMT): New constant.
	(dump_block_info): New local function.
	(last_bb): New local variable.
	(dump_generic_tree): Remove unused function.
	(print_generic_tree): Add third argument 'flags'.  Update all
	users.
	(print_generic_node_brief): Remove.  Update all users.
	(print_generic_node): Add third argument 'flags'.  Update all
	users.
	(dump_generic_node): Add third argument 'flags'.  Update all users.
	If PPF_BLOCK is set, display basic block information at basic block
	boundaries.
	If PPF_IS_STMT is set, change the way COMPOUND_EXPR nodes are
	rendered.
	If PPF_BRIEF is set, don't show the bodies of control statements.
	(print_declaration):

	* toplev.c (process_options): Update comment for -fdisable-simple.

	* tree-cfg.c (remove_tree_bb): Rename from tree_delete_bb.
	(latch_block): Move declaration to tree-flow.h.  Declare extern.
	(make_blocks): Start a new block after finding a control flow
	altering statement.
	(make_loop_expr_blocks): Set the loop entry block to be the parent
	block for the loop latch block.
	(cleanup_tree_cfg): Rename from tree_cleanup_cfg.
	Call compact_blocks.
	(remove_tree_bb): Rename from tree_delete_bb.  Update all users.
	(dump_tree_bb): Rename from dump_tree_bb.  Update all users.
	Dump information about loop latch blocks.
	(debug_tree_bb): Rename from tree_debug_bb.  Update all users.
	(debug_tree_cfg): Rename from tree_debug_cfg.  Update all users.
	(dump_tree_cfg): Rename from tree_dump_cfg.  Update all users.
	By default, dump the function with markers for basic block
	boundaries.
	(successor_block): If we can't find a successor following the
	parent chain, return the next block in the linked list of blocks.
	Update documentation comments.
	(stmt_starts_bb_p): Don't let RETURN_EXPR start a new block.
	(is_latch_block): New function.
	(first_exec_stmt): Don't treat BIND_EXPR nodes as a special case.
	(first_stmt): Return NULL_TREE if the block does not exist.
	(last_stmt): Likewise.

	* tree-dfa.c (find_tree_refs): Rename from tree_find_refs.  Update
	all users.
	(find_refs_in_stmt): Handle BIND_EXPR nodes.
	(rli_start): Move from tree-flow-inline.h
	(rli_start_last): Likewise.
	(rli_start_at): Likewise.
	(rli_delete): Likewise.

	* tree-flow-inline.h (gsi_start_bb): Handle NULL blocks.
	(ref_list_is_empty): New function.
	* tree-flow.h (rli_start): Change declaration to extern.
	(rli_start_last): Likewise.
	(rli_start_at): Likewise.
	(rli_delete): Declare.
	(latch_block): Declare.
	(is_latch_block): Declare.
	(get_last_ref): Change to inline declaration.
	(get_first_ref): Likewise.
	(ref_list_empty): Declare.

	* tree-optimize.c (delete_tree_ssa): Remove declaration.

	* tree-ssa-dce.c (mark_control_parent_necessary): Call gsi_step_bb
	instead of gsi_step.
	(tree_ssa_eliminate_dead_code): Likewise.

	* tree-ssa.c (compute_tree_rdefs): Rename from compute_tree_rdefs.
	Update all users.

2002-10-22  Diego Novillo  <dnovillo@redhat.com>

	* tree-dfa.c (struct dfa_stats_d): Add field size_tree_refs.
	(tree_ref_size): New function.
	(create_ref): Call it.
	(dump_dfa_stats): Get total size from dfa_stats.size_tree_refs.
	(count_tree_refs): Call tree_ref_size.
	* tree-flow-inline.h (get_last_ref): New function.
	(get_first_ref): New function.
	* tree-flow.h (struct var_ref_d): Rename from var_ref.
	(struct var_def_d): Rename from var_def.
	(struct var_phi_d): Rename from var_phi.
	(struct var_use_d): Rename from var_use.
	(struct expr_phi_d): Rename from expr_phi.
	(struct expr_use_d): Rename from expr_use.
	* tree-ssa-ccp.c (tree_ssa_ccp): Call get_last_ref.

2002-10-21  Daniel Berlin  <dberlin@dberlin.org>

	* timevar.def: Add TV_TREE_{PRE,CCP,DCE,CFG,SSA}} timevars.

	* tree-optimize.c (optimize_function_tree): Push and pop timevars
	for the tree optimizers.

2002-10-21  Diego Novillo  <dnovillo@redhat.com>

	* Makefile.in (OBJS): Move tree-mudflap.o ...
	(C_AND_OBJC_OBJS): ... here.

2002-10-21  Diego Novillo  <dnovillo@redhat.com>

	* tree-flow-inline.h (rli_start): New function.
	(rli_start_rev): New function.
	(rli_start_at): New function.
	(rli_after_end): New function.
	(rli_step): New function.
	(rli_step_rev): New function.
	(rli_ref): New function.
	* tree-flow.h (struct ref_list_iterator): Declare.
	(FOR_REF_BETWEEN, FOR_EACH_REF, FOR_EACH_REF_REV): Replace with new
	rli_* iterator functions.  Update all users.

2002-10-21  Frank Ch. Eigler  <fche@redhat.com>

	* tree-cfg.c (make_blocks): Ignore TRY_FINALLY_EXPR and
	TRY_CATCH_EXPR.
	* tree-mudflap.c (mx_register_decls): Ignore local decls
	of extern variables of unknown size.

2002-10-20  Daniel Berlin  <dberlin@dberlin.org>

	* tree-ssa-pre.c (repair_injury): DTRT, rather than abort.

	* tree-dfa.c (ref_type_name): E_* don't have these modifier
	fields, but may have the same bits set, so don't print the
	modifiers on them.

	* gimplify.c (create_tmp_var): New function, wraps calls to
	create_tmp_var_1 with pushing/popping of right context.
	All internal gimplify.c now use create_tmp_var_1.
	(create_tmp_var_noc): New function, create the var without
	pushing/popping, and without exposing internals of create_tmp_var_1.
	Only one use of this.

	* tree-simple.h (create_tmp_var_noc): New prototype.

	* c-simplify.c (simplify_stmt_expr): create_tmp_var changed to
	create_tmp_var_noc.

	* tree-ssa-pre.c: Add WAITING_FOR_DFA_UPDATE around code waiting for DFA
	functions to keep refs up to date.
	(add_call_to_ei): occurs and occurstmts is now an
	array of tree pointers, not trees. Update approriately.
	(insert_occ_in_preorder_dt_order_1): Ditto.
	(tree_perform_ssapre): Ditto.
	(find_use_for_var): Removed function.
	(orig_expr_map): Removed global, removed uses.
	(struct ei): Added injfixups member.
	(is_strred_cand): STRIP_WFL the expression.
	(calculate_increment): Ditto.
	(is_injuring_def): Ditto.
	(defs_y_dom_x): Ditto. Also account for fact that y is now a full
	expression, not just an RHS.
	(defs_match_p): Ditto (t2 is no longer just an RHS).
	(finalize_1): Do insertion by replacement.
	(repair_injury): Clean up, do insertion by replacement.
	(find_reaching_def_of_var): Do backwards search in a cleaner way.
	(update_ssa_for_new_use): Change how we do replacement.
	(code_motion): Insertion by replacement. Print EXPR_WFL_LINENO, not
	STMT_LINENO.
	(pre_part_1_trav): Just create_tmp_var will now suffice.

2002-10-18  Diego Novillo  <dnovillo@redhat.com>

	* tree-dfa.c (find_refs_in_expr): Change type of second argument to
	enum tree_ref_type.  Add third argument ref_mod.  Update all users.
	(create_ref): Add third argument ref_mod.  Decode bitmask to set
	the individual bitfields in the new reference.
	* tree-flow-inline.h (is_may_ref): New function.
	(is_may_def): New function.
	(is_may_use): New function.
	(is_partial_ref): New function.
	(is_partial_def): New function.
	(is_partial_use): New function.
	(is_volatile_ref): New function.
	(is_volatile_def): New function.
	(is_volatile_use): New function.
	(is_default_def): New function.
	(is_clobbering_def): New function.
	(is_initializing_def): New function.
	(is_relocating_def): New function.
	(is_addressof_use): New function.
	(is_pure_use): New function.
	* tree-flow.h (V_DEF, V_USE, V_PHI, E_PHI, E_USE, E_KILL): Redefine
	inside enum tree_ref_type.  Update all users.
	(enum tree_ref_type): Define.
	(TRM_DEFAULT, TRM_CLOBBER, TRM_MAY, TRM_PARTIAL, TRM_INITIAL,
	TRM_VOLATILE, TRM_RELOCATE): Rename from M_*.  Update all users.
	(struct tree_ref_common): Change type of field 'type' to enum
	tree_ref_type.  Update all users.
	(struct var_ref): Add bitfields 'm_may', 'm_partial' and 'm_volatile'.
	(struct var_def): Add bitfield 'm_default', 'm_clobber', 'm_initial'
	and 'm_relocate'.
	(struct var_use): Add bitfield 'm_addressof'.
	(ref_type): Change return type to enum tree_ref_type.  Update all
	users.
	(create_ref): Add new argument ref_mod.  Update all users.
	(function_may_recurse_p): Change return type to bool.  Update all
	users.
	(ref_type_name): Change argument type to tree_ref.  Update all
	users.
	(validate_ref_type): Remove.

2002-10-18  Diego Novillo  <dnovillo@redhat.com>

	* cp/Make-lang.in (CXX_C_OBJS): Remove tree-cfg.o, tree-dfa.o,
	tree-optimize.o, tree-ssa.o, tree-ssa-pre.o, gimplify.o, tree-simple.o,
	tree-alias-steen.o, tree-alias-ecr.o, tree-alias-type.o,
	disjoint-set.o, tree-ssa-ccp.o, tree-dchain.o, tree-alias-common.o,
	and tree-ssa-dce.o.

2002-10-17  Diego Novillo  <dnovillo@redhat.com>

	* Makefile.in (TREE_FLOW_H): Add bitmap.h, basic-block.h,
	hard-reg-set.h and tree-simple.h.  Update all users.
	(C_AND_OBJC_OBJS): Move tree-cfg.o, tree-dfa.o,
	tree-ssa.o, tree-optimize.o, c-simplify.o, c-call-graph.o,
	tree-simple.o, simple-break-elim.o, simple-goto-elim.o, tree-dchain.o,
	tree-ssa-pre.o, tree-alias-type.o, tree-mudflap.o, gimplify.o,
	tree-alias-ecr.o, tree-alias-common.o, tree-alias-steen.o,
	disjoint-set.o, tree-ssa-ccp.o and tree-ssa-dce.o ...
	(OBJS): ... here.
	(gimplify.o): Add dependency on $(TREE_FLOW_H).
	(tree-pretty-print.o): New rule.
	(GTFILES): Add tree-flow.h
	* c-config-lang.in (gtfiles): Remove tree-flow.h
	* c-simplify.c (copy_if_shared_r, unmark_visited_r,
	unshare_all_trees, mark_not_simple): Move ...
	* gimplify.c: ... here.
	Include tree-flow.h
	* tree-flow.h: Include hard-reg-set.h.

	* c-common.h (print_c_tree, print_c_node, print_c_node_brief,
	debug_c_tree, debug_c_node, debug_c_node_brief): Move declarations
	from diagnostic.h.
	* c-call-graph.c (construct_call_graph): Call get_name.
	(print_callee): Likewise.
	* c-pretty-print.c (print_declaration): Declare static.
	(print_function_decl): Likewise.
	(print_struct_decl): Likewise.
	(dump_c_tree): Likewise.
	(dump_c_node): Likewise.
	* diagnostic.h (dump_generic_tree, dump_generic_node,
	print_generic_tree, print_generic_node, print_generic_node_brief):
	Declare.
	* tree-pretty-print.c: New file.
	* c-decl.c: Replace calls to print_c_node with print_generic_node.
	* tree-alias-common.c: Likewise.
	* tree-alias-steen.c: Likewise.
	* tree-cfg.c: Likewise.
	* tree-dfa.c: Likewise.
	* tree-mudflap.c: Likewise.
	* tree-optimize.c: Likewise.
	* tree-ssa-ccp.c: Likewise.
	* tree-ssa-pre.c: Likewise.
	* tree-ssa-dce.c: Likewise.
	Don't include c-common.h nor c-tree.h
	(tree_ssa_eliminate_dead_code): Don't call COMPOUND_BODY.
	Replace ASM_STMT with ASM_EXPR.  Don't check for EXPR_STMT.

2002-10-17  Daniel Berlin  <dberlin@dberlin.org>
            Diego Novillo  <dnovillo@redhat.com>

	* tree-cfg.c (remove_bb_ann): Remove.  Update all users.
	(delete_tree_cfg): Set bb->aux to NULL in all basic blocks.
	* tree-dfa.c: Remove extern declaration for tree_find_refs.
	(create_ref_list): Allocate new list with ggc_alloc.
	(empty_ref_list): Just set first and last element to NULL.
	(delete_ref_list): Remove.  Update all users.
	(remove_ref_from_list): Don't call free.
	(add_ref_to_list_begin): Allocate new node with ggc_alloc.
	(add_ref_to_list_end): Likewise.
	(add_ref_to_list_after): Likewise.
	(create_ref): Call BITMAP_GGC_ALLOC.
	(remove_tree_ann): Remove.  Update all users.
	(tree_ref_structure): New function.
	* tree-flow.h (edge, basic_block): Forward declare if necessary.
	(struct ref_list_node): Mark for garbage collection.
	(struct ref_list_priv): Likewise.
	(struct tree_ref_common): Likewise.
	(struct var_ref): Likewise.
	(struct var_def): Likewise.
	(struct var_phi): Likewise.
	(struct var_use): Likewise.
	(struct phi_node_arg_d): Likewise.
	(struct expr_ref_common): Likewise.
	(struct expr_phi): Likewise.
	(struct expr_use): Likewise.
	(union tree_ref_d): Likewise.
	(struct tree_ann_d): Likewise.
	(struct bb_ann_def): Likewise.
	(referenced_vars): Likewise.
	(global_var): Likewise.
	(enum tree_ref_structure_enum): New.
	(call_sites): Remove unused function.
	* tree-inline.c (copy_tree_r): Copy the 'ann' field from tree_common.
	* old-tree-inline.c (copy_tree_r): Likewise.
	* tree-ssa.c (added): Mark for garbage collection.
	(in_work): Likewise.
	(work_stack): Likewise.
	(delete_tree_ssa): Set global_var to NULL_TREE.
	* tree.h (struct tree_ann_d): Forward declare.
	(struct tree_common): Rename field 'aux' to 'ann'.  Update all
	users.  Don't mark it 'skip' for garbage collection.

2002-10-16  Daniel Berlin  <dberlin@dberlin.org>

	* tree-dfa.c (compute_may_aliases): Call create/delete_alias_vars
	if flag_tree_points_to is on.
	(may_alias_p): Use points-to info if user asked us to generate it.

	* tree-optimize.c (optimize_function_tree): Don't call
	create_alias_vars here.

2002-10-16  Diego Novillo  <dnovillo@redhat.com>

	* tree-cfg.c (make_cond_expr_edges): If the conditional has known
	value, only make the edge to the corresponding branch.
	(tree_delete_bb): Write a warning to the dump file when removing
	blocks with executable statements.
	(first_exec_stmt): Skip over empty BIND_EXPR blocks.

	* tree-dfa.c (find_refs_in_expr): Don't look for references in non
	GIMPLE statements.
	(remove_tree_ann): Clear the annotation with memset.
	(collect_dfa_stats_r): Don't call tree_annotation.
	(find_may_aliases_for): Avoid adding the same alias more than once.
	(may_alias_p): Fix comment grammar.

	* tree-flow-inline.h (is_exec_stmt): New function.
	* tree-flow.h (FOR_EACH_REF): Guard against NULL lists.
	(FOR_EACH_REF_REV): Likewise.
	(is_exec_stmt): Declare.

	* tree-ssa-ccp.c (visit_phi_node): Reformat debug dumping output.
	(visit_expression_for): Move check for clobbering definitions
	before check for NULL expressions.
	(visit_condexpr_for): Reformat debug dumping output.
	(set_lattice_value): Remove stale comments.
	(replace_uses_in): Don't clear TF_FOLDED flag from expression.

	* tree-ssa.c (add_phi_node): If possible, associate the PHI node to
	a statement.
	(create_default_def): Create initial declarations for static
	variables with DECL_INITIAL set.
	(delete_tree_ssa): Remove annotations from variables.

2002-10-16  Daniel Berlin  <dberlin@dberlin.org>

	* tree-alias-type.c (alias_tvar_new_with_aterm): New function.
	Update all allocations to allocate right type, rather than the union.
	Update to use macros to access members of alias_typevar.

	* tree-alias-type.h: Split alias_typevar into a common, an ECR, and
	an aterm, update all users.
	Add macros to access members of union.

	* tree-alias-common.c (create_alias_var): Handle function_decl's
	properly (needed for proper handling of function pointers).
	Updates for macros to access typevars.
	Fix some indentation.

	* tree-alias-steen.c: Updates for macros to access typevars.

2002-10-16  Frank Ch. Eigler  <fche@redhat.com>

	* c-decl.c (c_expand_body): Enable mudflap, only for gimple.
	* c-pretty-print.c (dump_c_node): Render try/catch/finally exprs.
	(op_prio): Accept BIND_EXPRs.
	* gcc.c (cpp_unique_options): Make -fmudflap -include mf-runtime.h.
	* toplev.c (process_options): Complain on -fmudflap -fdisable-simple.
	* tree-mudflap.c (*): Reorganize for generic/gimple operation.
	(mf_init_extern_trees): Extract decl nodes from -include'd file.
	(mf_external_ref, mf_decl_extern_trees): Removed; updated callers.
	(mf_offset_expr_of_array_ref): Don't bother store index type as
	TREE_PURPOSE.
	(mf_build_check_statement_for): Use GIMPLE tree types and builders.
	(mx_register_decls): New function, replacing mx_register_decl.
	(mx_xfn_xform_decls): Support only GIMPLE input tree types.
	(mf_flush_enqueued_calls): Clean up enqueued call statements.

2002-10-14  Diego Novillo  <dnovillo@redhat.com>

	* toplev.c (parse_options_and_default_flags): Undo local
	hack that slipped in the previous commit.

2002-10-14  Diego Novillo  <dnovillo@redhat.com>

	* Makefile.in (c-decl.o): Add dependency on diagnostic.h.
	* c-decl.c: Include diagnostic.h
	(c_expand_body): Call get_name.

	* basic-block.h (struct basic_block_def): Rename head_tree to
	head_tree_p and end_tree to end_tree_p.  Change type to tree *.
	Update all users.
	(BLOCK_HEAD_TREE): Remove.  Update all users.
	(BLOCK_END_TREE): Remove.  Update all users.
	* tree-cfg.c (build_tree_cfg): Return if function body is empty.
	(make_blocks): Change first argument to tree *.  Update all users.
	(make_bind_expr_blocks): Likewise.
	(make_loop_expr_blocks): Likewise.
	(make_cond_expr_blocks): Likewise.
	(make_switch_expr_blocks): Likewise.
	(create_bb): Likewise.
	(first_exec_block): Likewise.
	(first_exec_stmt): Likewise.
	(tree_delete_bb): Use a gimple statement iterator to unmap
	statements.
	(insert_stmt_before): Remove empty function.
	(replace_expr_in_tree): Remove.  Update all users.
	(find_expr_in_tree_helper): Likewise.
	(find_expr_in_tree): Likewise.
	(first_stmt): Call STRIP_NOPS.
	(last_stmt): Call STRIP_NOPS.

	* tree-dfa.c (struct clobber_data_d): Rename parent_stmt to
	parent_stmt_p and parent_expr to parent_expr_p.  Change types to
	tree *.  Update all users.
	(find_refs_in_stmt): Change first argument type to tree *.  Update
	all users.
	(find_refs_in_expr): Chnage arguments parent_stmt and parent_expr
	to tree *.  Update all users.
	(create_ref): Don't add the same reference twice on the same list
	when parent_stmt and parent_expr are the same node.
	Don't set output_ref when the parent statement is not in GIMPLE
	form.
	(replace_ref_operand_with): Move from tree-flow-inline.h
	(replace_ref_expr_with): New function.
	(replace_ref_stmt_with): New function.
	(create_tree_ann): Abort if trying to annotate certain nodes.
	Don't create an empty ref list.
	In the presence of WFL or NOPS wrappers, add the annotation to the
	inner node.
	(dump_ref): Don't call tree_annotation to access the tree
	annotation.

	* tree-flow.h (struct tree_ref_common): Rename field stmt to stmt_p
	and field expr to expr_p.  Change types to tree *.  Update all
	users.
	(replace_ref_expr_with): Declare.
	(replace_ref_stmt_with): Declare.
	(insert_stmt_before, insert_stmt_after, replace_expr_in_tree,
	find_expr_in_tree): Remove.
	* tree-flow-inline.h (ref_expr): Return NULL_TREE if expr_p is
	NULL.
	(ref_stmt): Return NULL_TREE if stmt_p is NULL.
	(tree_annotation): Call STRIP_WFL and STRIP_NOPS before returning
	the annotation.
	(add_tree_ref): Remove consistency checks.  Create an empty list
	the first time.
	(get_lineno): Return -1 on NULL_TREE.
	(set_output_ref): Remove consistency.
	(set_tree_flag): Likewise.
	(clear_tree_flag): Likewise.
	(reset_tree_flags): Likewise.
	* tree-simple.h (gimple_stmt_iterator): Rename ptr to tp.  Change
	type to tree *.  Update all users.
	(gsi_start): Change argument type to tree *.  Update all users.
	(gsi_stmt_ptr): New function.
	(gsi_container): New function.

	* tree-optimize.c (optimize_function_tree): Don't test fnbody for
	NULL.
	Re-enable optimizers.
	* tree-ssa-ccp.c: Update documentation comments.
	Don't include c-common.h and c-tree.h.
	(tree_ssa_ccp): Don't call COMPOUND_BODY.
	(ccp_fold): New private function.
	(substitute_and_fold): Call it.
	Call replace_ref_expr_with.
	Set TF_FOLDED flag on the statement, not the expression.
	(visit_assignment_for): Call STRIP_NOPS and STRIP_WFL.
	(evaluate_expr): Call ccp_fold.  Only use the RHS of the simplified
	value in the case of MODIFY_EXPR or INIT_EXPR.
	(restore_expr):
	* tree-ssa-dce.c (mark_control_parent_necessary): Use a gimple
	iterator.
	(tree_ssa_eliminate_dead_code): Likewise.
	* tree-ssa-pre.c: Disable and add warning comments for out-of-date
	calls to create_ref, find_refs_in_stmt and replace_expr_in_tree.

2002-10-12  Daniel Berlin  <dberlin@dberlin.org>

	* tree-alias-type.h  (alias_typevar_def): Add struct aterm
	as a temporary hack for andersen's analysis.
	* tree-alias-common.c (current_alias_ops): New, use it
	instead of referring to steen_alias_ops everywhere.
	(get_alias_var): Use STRIP_WFL.
	(find_func_aliases): Ditto.
	(create_alias_vars): Call init function, move deletion to
	delete_alias_vars.
	(delete_alias_vars): New function, move deletion code to here.
	(get_virtual_var): Removed.
	(ptr_may_alias_var): New function.
	* tree-alias-common.h (struct tree_alias_ops): Add may_alias
	function.
	* tree-alias-steen.c (steen_may_alias): New function.

2002-10-10  Falk Hueffner  <falk.hueffner@student.uni-tuebingen.de>

	* diagnostic.h (dump_c_tree, dump_c_node,
	print_declaration, print_function_decl,
	print_struct_decl): Fix argument types.

2002-10-10  Diego Novillo  <dnovillo@redhat.com>

	* tree.h (struct tree_common): Rename field unused_0 to
	not_gimple_flag.
	(TREE_NOT_GIMPLE): Define.
	* c-simplify.c (mark_not_simple_r): Remove.  Update all users.
	(mark_not_simple): Set TREE_NOT_GIMPLE.
	* gimplify.c (simplify_call_expr): Enable call to mark_not_simple.
	* tree-flow.h (TF_NOT_SIMPLE): Remove.  Update all users.

	* tree-cfg.c (build_tree_cfg): Rename from tree_find_basic_blocks.
	Update all users.
	Find the first executable statement before starting basic block 0.
	(make_blocks): Do not accept TRY_FINALLY_EXPR and TRY_CATCH_EXPR
	nodes.
	(make_edges): Always create an edge from entry to basic block 0.
	(delete_tree_cfg): Rename from delete_cfg.  Update all uses.
	(first_exec_stmt): Return the container for the first statement,
	not the statement itself.

	* tree-dfa.c (tree_find_refs): Re-implement using a GIMPLE
	iterator.
	(find_refs_in_stmt): Handle GIMPLE statements.
	(find_refs_in_expr): Call flags_from_decl_or_type when handling
	CALL_EXPR expressions.
	(create_ref): Call DECL_P.
	(remove_tree_ann): Call tree_annotation.

	* tree-flow-inline.h (gsi_step_bb): Stop if statement is not inside
	a basic block.

	* tree-flow.h (build_tree_cfg): Rename from tree_find_basic_blocks.
	Update all users.
	(delete_tree_cfg): Rename from delete_cfg.
	(tree_find_refs): Declare.
	(build_tree_ssa): Rename from tree_build_ssa.
	(is_upward_exposed): Remove unused function.
	* tree-optimize.c (delete_tree_ssa): Remove declaration.
	(optimize_function_tree): Re-enable SSA builder.
	* tree-simple.h (gsi_container): New function.

	* Makefile.in (tree-ssa.o): Remove dependencies on c-common.h and
	c-tree.h.
	* tree-ssa.c: Don't include c-common.h nor c-tree.h.
	(tree_find_refs): Remove declaration.
	(remove_annotations_r): New local function.
	(build_tree_ssa): Rename from tree_build_ssa.  Update all users.
	(analyze_rdefs): Don't call prep_stmt.
	(is_upward_exposed): Remove unused function.
	(add_phi_node): Don't associate the PHI node to a statement.
	(delete_tree_ssa): Receive the function body as argument.
	Walk the function body removing annotations from every tree.

2002-10-10  Steven Bosscher  <s.bosscher@student.tudelft.nl>

	* tree-ssa-dce (tree_ssa_eliminate_dead_code): Initialize prev to
	NULL_TREE.
	Don't close dump_file until end of function.
	Dump the the tree after DCE for -fdump-tree-dce.

2002-10-08  Richard Henderson  <rth@redhat.com>
	    Jason Merrill  <jason@redhat.com>
	    Diego Novillo  <dnovillo@redhat.com>

	* tree-simple.h (gimple_stmt_iterator): New type.
	(gsi_start): New function.
	(gsi_after_end): New function.
	(gsi_step): New function.
	(gsi_stmt): New function.

2002-10-08  Diego Novillo  <dnovillo@redhat.com>

	* calls.c (flags_from_decl_or_type): Make extern.
	(ECF_*): Move ...
	* rtl.h (ECF_*): ... here.
	(flags_from_decl_or_type): Declare.

	* tree.h (COND_EXPR_COND): Define.
	(COND_EXPR_THEN): Define.
	(COND_EXPR_ELSE): Define.
	(LABEL_EXPR_LABEL): Define.
	(optimize_function_tree): Declare.

2002-10-08  Diego Novillo  <dnovillo@redhat.com>

	* Makefile.in (TREE_FLOW_H): Define.
	(c-decl.o): Remove dependency on tree-optimize.h.
	(tree-alias-steen.o, tree-alias-common.o, tree-ssa.o, tree-ssa-pre.o,
	 tree-cfg.o, tree-dfa.o, tree-optimize.o, c-simplify.o, c-call-graph.o,
	 tree-ssa-dce.o, tree-ssa-ccp.o): Depend on $(TREE_FLOW_H).
	(tree-cfg.o): Remove dependencies on c-tree.h and c-common.h.
	* c-call-graph.c (construct_call_graph): Disable calls to removed
	functions.
	* c-decl.c: Don't include tree-optimize.h.
	(c_expand_body): Enable calls to optimize_function_tree.

	* c-pretty-print.c (dump_c_node): Fix printf warnings.
	Only dump the first node of a COMPOUND_EXPR when brief_dump is set.
	Use COND_EXPR_COND, COND_EXPR_THEN and COND_EXPR_ELSE accessors.
	Only dump the opening brace of a BIND_EXPR when brief_dump is set.

	* tree-cfg.c: Don't include tree-optimize.h, c-common.h and c-tree.h.
	(binding_stack, make_for_stmt_blocks, make_if_stmt_blocks,
	 make_while_stmt_blocks, make_switch_stmt_blocks,
	 make_do_stmt_blocks, create_maximal_bb, make_for_stmt_edges,
	 make_while_stmt_edges, make_do_stmt_edges, make_if_stmt_edges,
	 make_break_stmt_edges, make_continue_stmt_edges, create_loop_hdr,
	 insert_before_ctrl_stmt, insert_before_normal_stmt,
	 insert_after_ctrl_stmt, insert_after_normal_stmt,
	 insert_after_loop_body, tree_split_bb, stmt_ends_bb_p): Remove.
	Update all users.
	(STRIP_CONTAINERS): Define.
	(make_bind_expr_blocks): New local function.
	(make_cond_expr_blocks): New local function.
	(make_loop_expr_blocks): New local function.
	(make_switch_expr_blocks): New local function.
	(make_loop_expr_edges): New local function.
	(make_cond_expr_edges): New local function.
	(make_case_label_edges): New local function.
	(first_exec_block): New local function.
	(make_goto_expr_edges): Rename from make_goto_stmt_edges.
	(make_blocks): Remove arguments COMPOUND_STMT and PREV_CHAIN_P.
	Use gimple_stmt_iterator to iterate over the statements in the
	function.  Create maximal basic blocks during traversal.
	(create_bb): Remove arguments end, prev_chain_p and binding_scope.
	Rename control_parent to parent_block.
	(set_bb_for_stmt): Move from tree-flow.h.
	(make_edges): Don't assume that basic block 0 contains executable
	statements.
	Handle BIND_EXPR nodes.
	(make_ctrl_stmt_edges): Handle LOOP_EXPR, COND_EXPR and
	SWITCH_EXPR.
	(make_exit_edges): Handle GOTO_EXPR, CALL_EXPR and RETURN_EXPR.
	(tree_delete_bb): Call first_stmt and last_stmt.
	(block_invalidates_loop): Call last_stmt.
	(replace_expr_in_tree): Don't dump line number information.
	(find_expr_in_tree_helper): Don't call statement_code_p.
	(tree_dump_bb): Call get_lineno.
	(tree_cfg2dot): Ditto.
	(successor_block): Use a gimple_stmt_iterator to find the first
	executable block after the current one.
	(is_ctrl_stmt): Handle COND_EXPR, LOOP_EXPR and SWITCH_EXPR.
	(is_ctrl_altering_stmt): Call flags_from_decl_or_type to discover
	non-return functions.
	(is_loop_stmt): Handle LOOP_EXPR.
	(is_computed_goto): Handle GOTO_EXPR.
	(stmt_starts_bb_p): Handle CASE_LABEL_EXPR, LABEL_EXPR, RETURN_EXPR
	and BIND_EXPR.
	(first_exec_stmt): Use a gimple_stmt_iterator to traverse the
	statements.
	(first_stmt): New function.
	(last_stmt): New function.

	* tree-dfa.c: Don't include c-common.h, c-tree.h and
	tree-optimize.h.  Include diagnostic.h.
	(tree_find_refs): Disable.
	(find_refs_in_stmt): Disable.
	(find_refs_in_expr): Don't call prep_stmt.
	(tree_ann): Don't annotate empty_stmt_node.
	(find_declaration): Remove.  Update all users.
	(dump_ref): Call get_lineno.
	(is_visible_to): Always return true.

	* tree-flow.h: Include tree-flow-inline.h, basic-block.h and
	tree-simple.h.
	(tree_ann_d): Remove compound_parent field.
	(set_bb_for_stmt): Declare extern.
	(compound_parent, set_compound_parent, struct for_header_blocks,
	union header_blocks, prev_chain_p, set_prev_chain_p, binding_scope,
	set_binding_scope, loop_hdr, for_init_bb, set_for_init_bb,
	for_cond_bb, set_for_cond_bb, for_expr_bb, set_for_expr_bb,
	end_while_bb, set_end_while_bb, do_cond_bb, set_cond_bb,
	stmt_ends_bb_p, loop_parent, latch_block, switch_parent,
	first_exec_stmt, last_exec_stmt, is_exec_stmt,
	is_statement_expression, first_non_decl_stmt, first_decl_stmt,
	first_non_label_in_bb, tree_split_bb, find_declaration): Remove.
	Update all users.
	(get_lineno): New function.
	(struct bb_ann_def): Rename field parent to parent_block.  Update
	all users.
	Remove fields prev_chain_p, loop_hdr and binding_scope.  Update all
	users.
	(parent_block): Rename from bb_parent.
	(set_parent_block): Rename from set_bb_parent.
	(prev_chain_p): Remove
	(bb_empty_p): Return true if block only contains empty_stmt_node.
	(gsi_step_bb): New function.
	(gsi_start_bb): New function.
	(gsi_insert_before, gsi_insert_after, gsi_delete, gsi_replace):
	Declare.
	(insert_stmt_before): Rename from insert_stmt_tree_before.
	(insert_stmt_after): Rename from insert_stmt_tree_after.
	(first_stmt): Declare.
	(last_stmt): Declare.
	(tree_perform_ssapre, tree_ssa_ccp,
	tree_ssa_eliminate_dead_code): Move declaration from tree-optimize.h.
	* tree-flow-inline.h: New file for all the inline functions
	declared in tree-flow.h

	* tree-optimize.c: Don't include tree-optimize.h, c-common.h and
	c-tree.h.
	(optimize_function_tree): Disable call to double_chain_stmts.
	Call init_flow.
	Call tree_find_basic_blocks.
	Disable calls to tree_build_ssa and optimizers.
	(build_tree_ssa): Remove.  Update all users.
	* tree-optimize.h: Remove.
	* tree-ssa-ccp.c: Don't include tree-optimize.h
	* tree-ssa-dce.c: Don't include tree-optimize.h.
	Include diagnostic.h
	* tree-ssa-pre.c: Don't include tree-optimize.h.
	(requires_edge_placement): Disable unused function.
	(set_need_repair): Disable unused function.
	(finalize_1): Disable calls to insert_stmt_tree_before and
	insert_stmt_tree_after.
	(repair_injury): Ditto.
	(code_motion): Ditto.
	* tree-ssa.c: Don't include tree-optimize.h.
	(insert_phi_nodes_for): Remove unused variable.
	(add_phi_node): Don't call statement_code_p.
	* cp/optimize.c: Don't include tree-optimize.h
	* tree-alias-common.c: Don't include tree-optimize.h.
	(find_func_decls): Disable.
	(display_points_to_set): Disable.
	* tree-alias-steen.c: Don't include tree-optimize.h.

2002-10-04  Jason Merrill  <jason@redhat.com>

	* gimplify.c (declare_tmp_vars): Don't add temps to block vars.
	* tree-inline.c (remap_decls): Split out from remap_block.
	(copy_bind_expr): Remap BIND_EXPR_VARS separately from block vars.

	* c-simplify.c (simplify_expr_stmt): Call set_file_and_line_for_stmt.

	* gimplify.c: New file.
	(push_gimplify_context, pop_gimplify_context): New fns.
	(gimple_push_bind_expr, gimple_pop_bind_expr): New fns.
	(simplify_bind_expr): Use them.
	(gimple_current_bind_expr, gimple_add_tmp_var): New fn.
	(foreach_stmt): Recurse if necessary.
	(various): Use generic interfaces instead of c-specific ones.
	* c-simplify.c: Move language-independent code to gimplify.c.
	(simplify_c_loop): Use add_tree instead of add_stmt_to_compound.
	(various): Use new *_bind_expr interfaces.
	* Makefile.in (C_AND_OBJC_OBJS): Add gimplify.o.
	(gimplify.o): New rule.

	* c-decl.c (c_expand_body): Dump trees here.
	* c-simplify.c (simplify_function_body): Not here.

2002-10-03  Frank Ch. Eigler  <fche@redhat.com>

	* tree-mudflap.c (mf_offset_expr_of_array_ref): Don't emit
	intermediate variables for constant index values.
	(mx_xfn_indirect_ref): For constant valid index values and
	known valid array sizes, omit bounds checks.

2002-10-03  Jason Merrill  <jason@ariel.home>

	* c-simplify.c (simplify_bind_expr): Don't clear TREE_SIDE_EFFECTS
	if we have a block.

	* c-simplify.c (simplify_expr) [TRY_FINALLY_EXPR]: New case.

	* tree-inline.c (copy_body_r) [RETURN_EXPR]: Don't make an extra
	copy of the MODIFY_EXPR.  Mark the return label used.
	(expand_call_inline): Don't push/pop_srcloc.  Only emit the return
	label if it was used.

	* tree-simple.c (right_assocify_expr): Split out from
	rationalize_compound_expr.  Don't move non-matching op0's.
	* tree-simple.h: Declare it.
	* c-simplify.c (simplify_boolean_expr): Call it.
	(simplify_cond_expr): Reorganize.  Optimize if (a&&b).

	* c-simplify.c (wrap_with_wfl): Drop special loop handling.
	(simplify_c_loop): Wrap loop contents in wfls.

	* c-simplify.c (STRIP_WFL): Move...
	* tree.h: ...here.

	* c-common.c (c_walk_subtrees): Don't walk TREE_CHAIN.
	* tree-inline.c (walk_tree): Call langhook walk_subtrees first.
	For expressions, walk TREE_CHAIN if it matters.

2002-10-01  Frank Ch. Eigler  <fche@redhat.com>

	* builtins.c (expand_builtin_alloca): Disable if -fmudflap.
	* tree-mudflap.c (mudflap_enqueue_decl): Tweak logic to include
	more globals.
	(mx_xfn_indirect_ref): Handle bitfield COMPONENT_REFs; instrument
	BIT_FIELD_REF/INDIRECT_REFs.

2002-10-01  Jason Merrill  <jason@redhat.com>

	* c-decl.c (poplevel): Only add undeclared labels to the toplevel
	block.
	* c-parse.in (label_decl): Push the declared label.

	* c-decl.c (c_expand_body): If we've been simplified, use
	expand_expr_stmt_value instead.

	* c-decl.c (c_expand_decl): Rename from c_expand_decl_stmt.
	Handle all C-specific expansion semantics.
	* c-tree.h: Change prototype.
	* langhooks.h (struct lang_hooks): Add expand_decl hook.
	* langhooks.c (lhd_expand_decl): Default version.
	* langhooks-def.h (LANG_HOOKS_EXPAND_DECL): Provide default.
	* c-lang.c (LANG_HOOKS_EXPAND_DECL): Define.
	* c-semantics.c (lang_expand_decl_stmt): Remove.
	(genrtl_decl_stmt): Use lang_hooks.expand_decl.
	* Makefile.in (c-semantics.o): Depend on langhooks.h.
	* c-objc-common.c (c_objc_common_init): Don't set
	lang_expand_decl_stmt.

	* c-common.def (ASM_STMT): Only 4 operands.
	* c-common.h (ASM_CV_QUAL): Remove.
	(genrtl_asm_stmt): Adjust prototype.
	* c-typeck.c (build_asm_stmt): Adjust.
	* c-semantics.c (genrtl_asm_stmt): Change cv_qualifier parm to
	volatile_p.
	(expand_stmt): Adjust.

	* c-common.h (SWITCH_COND, SWITCH_BODY, CASE_LOW, CASE_HIGH,
	CASE_LABEL_DECL, GOTO_DESTINATION, ASM_STRING, ASM_OUTPUTS,
	ASM_INPUTS, ASM_CLOBBERS, ASM_VOLATILE_P, ASM_INPUT_P): Move to tree.h.

	* c-pretty-print.c (newline_and_indent): New fn.
	(dump_c_tree, dump_c_node): Make spc a plain int.
	(dump_c_node): Use output_add_identifier.
	Reorganize for bnw-simple; indent in the enclosing node rather
	than the subexpression.
	[FUNCTION_DECL]: Just print the name for now.
	[COMPOUND_EXPR, COND_EXPR]: Handle use as statements.
	[BIND_EXPR, GOTO_EXPR, EXIT_EXPR, LOOP_EXPR, LABELED_BLOCK_EXPR,
	EXIT_BLOCK_EXPR, RETURN_EXPR, SWITCH_EXPR, ASM_EXPR,
	CASE_LABEL_EXPR]: Implement.
	(print_declaration): Print 'static'.
	* c-tree.h: Move c-pretty-print decls to diagnostic.h.

	* expr.c (store_field): Don't always pass want_value==0 to store_expr.

	* expr.c (expand_expr) [EXIT_EXPR]: Handle EXIT_EXPR_IS_LOOP_COND.

	* expr.c (expand_expr) [LOOP_EXPR]: Pass exit_flag==0 to
	exand_start_loop.
	[BIND_EXPR]: Adjust for functions-as-trees mode.
	[COMPOUND_EXPR]: Avoid recursion if possible.
	[SWITCH_EXPR, LABEL_EXPR]: Move handling from java/expr.c.
	[CASE_LABEL_EXPR, ASM_EXPR]: New handling.

	* tree.h (struct tree_common): Add visited flag.
	(TREE_VISITED): New macro.
	* tree.c (copy_node): Clear TREE_VISITED.
	* print-tree.c (print_node): Print visted.

	* stmt.c (expand_asm_expr): New fn.

	* tree.c (build1): Always set TREE_SIDE_EFFECTS for 's' codes.

	* tree.h (enum tree_index): Add TI_EMPTY_STMT.
	(empty_stmt_node): New macro.
	* tree.c (build_common_tree_nodes_2): Initialize it.

	* tree.def: Change some codes from 'e' to 's'.
	(CASE_LABEL_EXPR, ASM_EXPR): New codes.

	* tree.def (SWITCH_EXPR): Now has three operands.

	* tree-inline.c: Retarget to generic trees.  FIXME FIXME.
	* old-tree-inline.c: Old C/Java-specific inliner.
	* Makefile.in (old-tree-inline.o): New rule.
	* c-common.c (c_walk_subtrees): New fn.
	(c_tree_chain_matters_p): New fn.
	* c-lang.c: Use them for LANG_HOOKS_TREE_INLINING_WALK_SUBTREES
	and LANG_HOOKS_TREE_INLINING_TREE_CHAIN_MATTERS_P.
	* c-common.h: Declare them.
	(DECL_NUM_STMTS): Move to tree.h.
	* c-decl.c (finish_function): Simplify the function trees.
	* c-objc-common.c (inline_forbidden_p): Look inside BIND_EXPRs
	for nested functions.  Don't inline a function with _STMT trees.

	* basic-block.h: Include hard-reg-set.h.

	* c-decl.c (start_function): Don't call make_decl_rtl.
	(c_expand_body): Call it here instead.

	* Makefile.in (explow.o): Depend on langhooks.h.

	* unroll.c (copy_loop_body): Don't copy NOTE_INSN_DELETED_LABELs
	between copy_notes_from and loop_end, either.

2002-09-30  Daniel Berlin  <dberlin@dberlin.org>

	* tree-ssa-pre.c (repair_injury): Start work on updating SSA
	representation for strength reduction injuries.
	Print a new line after outputting tree node in debug statements.
	Fix strength reduction of a candidate with two variables (IE a *
	c).
	Put the repair after the injuring statement, not at the end of the
	block.
	Break the RHS use lookup if it's defined by a phi.
	(calculate_increment): Ditto on node printing.
	(code_motion): Ditto on updating SSA rep for strength reduction
	injuries.
	(find_rhs_use_for_var): Rewrite to use maybe_find_rhs_use_for_var.
	(maybe_find_rhs_use_for_var): Rename from find_rhs_use_for_var,
	don't abort, return NULL.
	(set_var_phis): Simplify break condition.
	Make sure RHS *has* a use before we go and get it.
	(rename2): Ditto on RHS checking.
	When looking up injuring defs, break on phis.
	(phi_opnd_from_res): Ditto.
	(defs_y_dom_x): Ditto.
	(TODO List): Add new TODO to fix the remapping crud.

2002-09-27  Daniel Berlin  <dberlin@dberlin.org>

	* tree-ssa-pre.c (tree_perform_ssapre): Move insertion into
	splay tree inside the is_simple_modify_expr block, to prevent
	tree check failure.

2002-09-26  Daniel Berlin  <dberlin@dberlin.org>

	* tree-ssa-pre.c (update_phis_in_list): New function.
	(update_ssa_for_new_use): New function.
	(code_motion): Start working on code to update SSA representation.
	(find_reaching_def_of_var): New function.

2002-09-25  Steven Bosscher  <s.bosscher@student.tudelft.nl>

	* Makefile.in (tree): Add dependency on c-tree.h
	* tree-optimize.c: Include c-tree.h
	(optimize_function_tree): React to -fdump-tree-optimized.

2002-09-25  Daniel Berlin  <dberlin@dberlin.org>

	* tree-dfa.c (add_list_to_ref_list_end): New function.
	(add_list_to_ref_list_begin): Ditto.
	(find_list_node): Handle searching in empty lists.
	(find_refs_in_stmt): De-staticify.

	* tree-flow.h (add_list_to_ref_list_end): New declaration.
	(add_list_to_ref_list_begin): Ditto.
	(find_refs_in_stmt): Add prototype.

2002-09-25  Diego Novillo  <dnovillo@redhat.com>

	* Makefile.in (tree-dfa.o): Depend on flags.h
	* tree-cfg.c (tree_dump_cfg): Alter output format slightly.
	(block_invalidates_loop): Look for clobbering definitions of
	GLOBAL_VARIABLE.
	* tree-simple.c (get_base_symbol): Handle EXPR_WITH_FILE_LOCATION
	nodes.
	* tree-optimize.c (init_tree_flow): Remove.  Update all users.
	(build_tree_ssa): Don't call tree_find_refs.
	Don't call tree_compute_rdefs.

	* tree-dfa.c: Include flags.h
	(dump_file): Remove.
	(dump_flags): Remove.
	(pointer_refs): Remove.
	(struct dfa_stats_d): Add fields max_num_phi_args, num_may_alias,
	max_num_may_alias, num_alias_imm_rdefs and max_num_alias_imm_rdefs.
	Remove field num_fcalls.
	(dfa_counts): Declare.
	(tree_find_refs): Declare.
	(tree_ssa_dump_file): Declare.
	(tree_ssa_dump_flags): Declare.
	(dump_if_different): New function.
	(add_default_defs): Remove.  Update all users.
	(add_call_site_clobbers): Remove.  Update all users.
	(add_ptr_may_refs): Remove.  Update all users.
	(compute_may_aliases): New function.
	(find_may_aliases_for): New function.
	(add_may_alias): New function.
	(may_alias_p): New function.
	(is_visible_to): New function.
	(get_alias_index): New function.
	(call_sites): Remove.  Update all users.
	(global_var): Declare.
	(E_FCALL): Remove.  Adjust other constants.
	(M_INDIRECT): Remove.  Update all users.
	(M_RELOCATE): Declare.
	(tree_find_refs): Move debugging dumps to tree_build_ssa.
	Move initialization code to init_tree_ssa.
	Call compute_may_aliases.
	(find_refs_in_expr): For INDIRECT_REF nodes create a reference to
	the canonical INDIRECT_REF node associated with the pointer symbol.
	Given a pointer p, clobber the canonical INDIRECT_REF of p after
	creating a V_DEF for p.
	For CALL_EXPR nodes, if the called function is not pure nor
	const, create a use and a clobbering definition to GLOBAL_VAR.
	(create_ref): Allow INDIRECT_REF variables.
	(add_phi_arg): Keep track of number of PHI arguments created.
	(function_may_recurse_p): Look for clobbering definitions to
	GLOBAL_VAR.
	(get_fcalls): Remove unused function.
	(is_pure_fcall): Remove unused function.
	(fcall_takes_ref_args): Remove unused function.
	(find_declaration): Stop iterating at ENTRY_BLOCK_PTR.
	(debug_variable): New function.
	(dump_variable): New function.
	(dump_referenced_vars): Call it.
	(dump_phi_args): Don't dump NULL arguments.
	(PERCENT): Define.
	(dump_dfa_stats): Re-format output.
	Add new counters.
	Call dump_if_different.
	(collect_dfa_stats): Also recurse into GLOBAL_VAR.
	(collect_dfa_stats_r): Collect may-alias information.
	(count_tree_refs): Collect information about def-def links for
	aliases.
	Keep track of maximum values for number of PHI arguments, aliases
	and def-def links.
	(ref_type_name): Handle M_RELOCATE.
	(validate_ref_type): Ditto.

	* tree-ssa.c: Add more documentation.
	(tree_ssa_dump_file): Rename from dump_file.  Declare extern.
	(tree_ssa_dump_flags): Rename from dump_flags.  Declare extern.
	(added): New local varray.
	(in_work): New local varray.
	(work_stack): New local varray.
	(dfa_counts): Declare.
	(insert_phi_nodes_for): New local function.
	(add_phi_node): New local function.
	(set_ssa_links): New local function.
	(set_alias_imm_reaching_def): New local function.
	(create_default_def): New local function.
	(init_tree_ssa): New local function.
	(tree_find_refs): Relocate declaration from tree-flow.h
	(tree_build_ssa): Call init_tree_ssa.
	Call tree_find_refs.
	Process all SSA-related dump options.
	(insert_phi_nodes): Rename from insert_phi_terms.  Update all
	users.
	Call insert_phi_nodes_for.
	(build_fud_chains): Add more documentation.
	Initialize save_chain to 0.
	(search_fud_chains): Add more documentation.
	Call set_ssa_links.
	Call create_default_def.
	(tree_compute_rdefs): Initialize array marked to 0.
	(follow_chain): Follow def-def chains for non-killing definitions
	for aliases.
	(dump_reaching_defs): Call dump_variable.

	* tree-flow.h (E_FCALL): Remove.  Update all users.
	(M_INDIRECT): Remove.  Update all users.
	(M_RELOCATE): Declare.
	(struct var_ref): Add field alias_imm_rdefs.
	(alias_imm_reaching_def): New inline function.
	(struct tree_ann_d): Add field indirect_var.
	Add field may_aliases.
	(enum tree_flags): Relocate.
	(indirect_var): New inline function.
	(set_indirect_var): New inline function.
	(may_alias): New inline function.
	(num_may_alias): New inline function.
	(struct dfa_counts_d): Declare.
	(global_var): Declare.
	(FCALL_NON_PURE, FCALL_PURE, FCALL_BUILT_IN): Remove.
	(tree_find_refs): Move to tree-ssa.c.
	(dump_variable): Declare.
	(debug_variable): Declare.
	(get_fcalls): Remove.
	(is_pure_fcall): Remove.
	(fcall_takes_ref_args): Remove.
	(ref_defines): Declare.
	(is_killing_def): Declare.
	(get_alias_index): Declare.
	(delete_tree_ssa): Rename from delete_ssa.  Update all users.
	(set_currdef_for): Allow INDIRECT_REF nodes.
	(bb_annotation): Don't create a new one if the block didn't have an
	annotation already.

	* tree-ssa-ccp.c (substitute_and_fold): Rename from
	ssa_ccp_substitute_constants.  Update all users.
	Call replace_uses_in.
	(replace_uses_in): New local function.
	(evaluate_expr): Call it.
	(initialize): Call get_base_symbol.

	* tree-ssa-dce.c (tree_ssa_eliminate_dead_code): Don't handle
	E_FCALL.

2002-09-22  Diego Novillo  <dnovillo@redhat.com>

	* Makefile.in (tree-dfa.o): Depend on hashtab.h.
	* c-simplify.c (get_name): Declare extern.
	* tree-cfg.c (tree_dump_cfg): Call it.
	(tree_cfg2dot): Call it.
	* tree-ssa-ccp.c (tree_ssa_ccp): Call get_name.
	* tree-ssa-dce.c (tree_ssa_eliminate_dead_code): Call get_name.
	* tree-ssa-pre.c (tree_perform_ssapre): Call get_name.
	* tree-ssa.c (analyze_rdefs): Call get_name.
	(dump_reaching_defs): Call get_name.
	(dump_tree_ssa): Call get_name.
	* tree.h (get_name): Declare.

	* tree-dfa.c: Include "hashtab.h"
	(struct dfa_stats_d): New.
	(collect_dfa_stats): New local function.
	(collect_dfa_stats_r): New local function.
	(count_tree_refs): New local function.
	(count_ref_list_nodes): New local function.
	(tree_find_refs): Call dump_begin on entry to the function.
	(dump_referenced_vars): Call get_name.
	(SCALE): Declare.
	(LABEL): Declare.
	(dump_dfa_stats): New function.
	(debug_dfa_stats): New function.
	* tree-dump.c (struct dump_option_value_info): Add entry for TDF_STATS.
	* tree-flow.h (has_annotation): Remove.  Update all users.
	(dump_dfa_stats): Declare.
	(debug_dfa_stats): Declare.
	(tree_annotation): Don't create one if the tree doesn't have one
	already.  Update all users to new semantics.
	* tree-ssa-dce.c (print_stats): Dump if dump_flags has TDF_STATS bit
	set.
	* tree-ssa.c (tree_build_ssa): Open dump file on entry.
	Call dump_dfa_stats if dump_flags has TDF_STATS bit set.
	Call dump_tree_ssa if dump_flags has TDF_DETAILS bit set.
	* tree.h (TDF_STATS): Define.
	* doc/invoke.texi: Document 'stats' flag for -fdump-tree.

	* tree-dfa.c (next_tree_ref_id): Change type to unsigned long.
	Update all users.
	tree-flow.h (tree_ref_common): Change type of field 'id' to
	unsigned long.  Update all users.
	(ref_id): Change return type to unsigned long.  Update all users.

2002-09-21  Daniel Berlin  <dberlin@dberlin.org>

	* tree-ssa-pre.c (struct expr_info): Add repaired member.
	(repair_injury): Track which injuries we repaired, so we don't
	repair them > 1 time.

2002-09-20  Diego Novillo  <dnovillo@redhat.com>

	* c-pretty-print.c (dump_c_node): Fix call to REAL_VALUE_TO_DECIMAL.

2002-09-20  Diego Novillo  <dnovillo@redhat.com>

	* tree-dfa.c (find_refs_in_stmt): Fix botched call to
	clobber_vars_r with CLEANUP_STMT nodes.

2002-09-20  Diego Novillo  <dnovillo@redhat.com>

	* toplev.c (flag_tree_ssa): Remove.  Update all users.

2002-09-20  Frank Ch. Eigler  <fche@redhat.com>

	* gcc.c (cc1_options): Make -fmudflap imply -fno-merge-constants.
	* varasm.c (categorize_decl_for_section): Likewise, for strings.
	* tree-mudflap.c (mudflap_enqueue_decl): Don't be interested
	in !TREE_USED decls.  Fix minor type warning.
	(mf_offset_expr_of_array_ref): Create explicit temporary variables
	for array index expressions instead of SAVE_EXPRs.  Update callers.
	(mf_build_check_statement_for): Insert temp variables.
	(mx_xfn_indirect_ref): Correct recursion-protection checking
	sequence.  Tweak array check-base calculation back to "&array[0]".
	(*): Use build_function_type_list instead of build_function_type.
	(mx_external_ref): Remove unused parameter.  Update callers.

2002-09-19  Diego Novillo  <dnovillo@redhat.com>

	* c-decl.c (c_expand_body): Invoke tree optimizers with -O1 and
	above.
	* flags.h (flag_tree_ssa): Remove.
	* tree-cfg.c (find_expr_in_tree_helper): Change last argument type
	to int.
	* tree-dfa.c (create_ref): Ditto.
	* tree-flow.h (num_referenced_vars): Change type to unsigned long.
	* doc/invoke.texi (-ftree-ssa): Remove.
	(-fdump-tree-{pre,ccp,dce}): Add to the summary section.
	(-fdump-tree-xxx-details): Update documentation.
	(-fdump-tree-ccp): Document.
	(-fdump-tree-simple): Move elsewhere.

2002-09-19  Richard Henderson  <rth@redhat.com>

	* function.c (insns_for_mem_hash): Cast to size_t first.
	* tree-dfa.c (num_referenced_vars): Unsigned long, not size_t.
	(dump_referenced_vars): Use %lu for it.
	(dump_ref): Use HOST_WIDE_INT_PRINT_DEC.
	* tree-nomudflap.c (mudflap_c_function): Use ATTRIBUTE_UNUSED.
	(mudflap_enqueue_decl, mudflap_enqueue_constant): Likewise.
	* tree-ssa-pre.c (compute_idfs): Cast to size_t first.

	* tree-optimize.c (optimize_function_tree): Fix missed renamings.
	* tree-ssa-pre.c (tree_perform_ssapre): Likewise.

2002-09-19  Jeff Law <law@redhat.com>

	* tree-dfa.c (find_refs_in_stmt): Search for references in the call
	address of a CALL_EXPR.

2002-09-19  Daniel Berlin <dberlin@dberlin.org>

        * toplev.c: tree-ssa-* -> tree-*.

	* doc/invoke.texi: Ditto.

2002-09-19  Daniel Berlin <dberlin@dberlin.org>

	* flags.h: flag_tree_ssa_* -> flag_tree_*.

	* toplev.c: Ditto.

	* tree-optimize.c: Ditto.

	* tree-dump.c: dump-tree-ssa-* -> dump-tree-*.
	TDI_ssa_* -> TDI_*.

	* tree.h: Ditto

	* tree-ssa-dce.c (tree_ssa_eliminate_dead_code): Fix dump handling.

2002-09-18  Daniel Berlin <dberlin@dberlin.org>

	* tree-dump.c (dump_files): Use dump-tree-ssa-??? for the option names
	and "ssa-???" for the dump files.

	* tree.h: TDI_ccp and TDI_dce -> TDI_ssa_ccp and TDI_ssa_dce.

	* tree-ssa-ccp.c: TDI_ccp->TDI_ssa_ccp.

2002-09-18  Daniel Berlin <dberlin@dberlin.org>

	* tree-dump.c: Fix order of dump files

2002-09-17  Daniel Berlin <dberlin@dberlin.org>

	* tree-ssa-pre.c: Remove a lot of finding refs in statements junk.
	Start on strength reduction.
	Only generate simple statements.
	Remove EXPR* macros in favor of inline functions.
	Update comparisons and sets to 1 and 0 to true and false where
	approriate.
	(toplevel): Add DEBUGGING_STRRED define (temporary, for
	implementation debugging, *not* useful as a dump option).
	Add TODO notes.
	Add global avdefs, orig_expr_map, need_repair_map,
	strred_candidate.
	(set_var_phis): Add struct expr_info * argument.
	Update to handle injuring definitions.
	(defs_y_dom_x): Ditto.
	(phi_opnd_from_res): Ditto.
	(phi_for_operand): Remove extra \.
	(find_tree_ref_for_var): Renamed to find_use_for_var. Update all
	callers.
	Use orig_expr_map to lookup original expression, remove statement
	searching gunk.
	(find_rhs_use_for_var): New function.
	(is_strred_cand): New function.
	(is_injuring_def): New function.
	(calculate_increment): New function.
	(repair_injury): New function.
	(set_need_repair): New function.
	(struct expr_info): Add strred_cand member.
	(rename_2): Update to handle injuring definitions.
	(expr_phi_insertion): Ditto.
	(code_motion): Update to repair injuries.
	Only insert SIMPLE statements.
	Free avdefs here now.
	(finalize_1): Don't free avdefs anymore here.
	(tree_perform_ssapre): Record original expresion for
	find_use_for_var's benefit.
	Determine strength reduction candidates.

	* tree-flow.h: Remove EXPR* macros in favor of inline functions.
	Remove E_INJ.

	* tree-dfa.c: Change EXPR* macros to the new functions.
	Remove E_INJ.

2002-09-18  Diego Novillo  <dnovillo@redhat.com>

	* tree-dfa.c (M_ADDRESSOF): Define.
	(find_refs_in_expr): Create addressof-use references for ADDR_EXPR
	nodes.
	Don't create references for FUNCTION_DECL nodes.
	(ref_type_name): Handle M_ADDRESSOF.
	(validate_ref_type): Ditto.
	(clobber_vars_r): Don't clobber FUNCTION_DECL nodes.
	* tree-flow.h (M_ADDRESSOF): Declare.

2002-09-17  Diego Novillo  <dnovillo@redhat.com>

	* doc/invoke.texi: Document -ftree-ssa-dce and -fdump-tree-dce.
	* cp/Make-lang.in (CXX_C_OBJS): Add tree-ssa-dce.o.

2002-09-17  Ben Elliston  <bje@redhat.com>

	* Makefile.in (C_AND_OBJC_OBJS): Add tree-ssa-dce.o.
	tree-ssa-dce.o): New target.
	* tree-ssa-dce.c: New file.
	* flags.h (flag_tree_ssa_dce): Declare flag.
	* tree.h (tree_dump_index): Add TDI_dce.
	* toplev.c (flag_tree_ssa_dce): New flag.
	(f_options): Add "dump-tree-all-ssa" option.
	* tree-flow.h (enum tree_flags): Add TF_NECESSARY.
	* tree-dump.c (dump_files): Add dump-tree-dce option.
	(dump_enable_all_ssa): Enable it when dumping all.
	* tree-optimize.h (tree_ssa_eliminate_dead_code): Declare.
	* tree-optimize.c (optimize_function_tree): Invoke the
	optimisation pass if flag_tree_ssa_dce is set.

2002-09-17  Diego Novillo  <dnovillo@redhat.com>

	* Makefile.in (tree-ssa.o): Add dependency on c-tree.h
	* c-simplify.c (mark_not_simple_r): Don't mark IDENTIFIER_NODEs.
	* tree-dfa.c (function_may_recurse_p): Fix comment.
	(dump_ref): Don't dump immediate uses for PHI nodes more than once.
	(dump_referenced_vars): Unparse the name of the variable.
	* tree-flow.h (dump_tree_ssa): Declare.
	(debug_tree_ssa): Declare.
	(replace_ref_operand_with): Check if OPERAND_P is NULL.
	(restore_ref_operand): Ditto.
	(tree_annotation): Check that constants, types and IDENTIFIER_NODEs
	are not being annotated.
	* tree-ssa.c: Include c-tree.h.
	(dump_reaching_defs): Unparse the variable name.
	(dump_tree_ssa): New function.
	(tree_build_ssa): Call it.
	(debug_tree_ssa): New function.

2002-09-14  Steven Bosscher <s.bosscher@student.tudelft.nl>

	* dwarf2out.c (is_fortran): Return true for
	DW_LANG_Fortran95.
	(gen_compile_unit_die): Return DW_LANG_Fortran95 if
	language is "GNU F95".

2002-09-13  Daniel Berlin  <dberlin@dberlin.org>

	* tree-dump.c (dump_switch_p): Get longest match, not first one.

	* tree.h: Put TDI_* back in order, now that we do longest match
	matching.

2002-09-13  Diego Novillo  <dnovillo@redhat.com>

	* tree-dfa.c (add_call_site_clobbers): Call decl_function_context
	instead of DECL_CONTEXT.
	* tree-ssa-ccp.c (initialize): Ditto.
	* tree-ssa.c (analyze_rdefs): Ditto.

2002-09-11  Diego Novillo  <dnovillo@redhat.com>

	* tree-dfa.c (find_refs_in_stmt): Call clobber_vars_r to clobber
	CLEANUP_STMT nodes.
	(create_ref): Only add _DECL nodes to the list of referenced
	variables.
	(clobber_vars_r): Create a may-use reference prior to clobbering
	the variable.
	(add_call_site_clobbers): Ditto.
	(add_ptr_may_refs): Move call to find_list_node where it's actually
	needed.
	* tree-flow.h: Update documentation on M_CLOBBER.

2002-09-10  Daniel Berlin  <dberlin@dberlin.org>

	* tree-ssa-pre.c (defs_match_p): Fix typo ( | -> || ).

2002-09-10  Diego Novillo  <dnovillo@redhat.com>

	* tree-dfa.c (V_PHI_ARG): Remove.  Adjust related constants.
	Update all users.
	(add_ref_to_list_after): Don't allocate memory for the
	node when adding to the beginning or the end of the list.
	(add_phi_arg): Don't call create_ref to add a new argument.
	(debug_phi_args): New function.
	(dump_phi_args): New function.
	(dump_ref): Call it.
	(dump_referenced_vars): Use 'file' instead of 'dump_file'.

	* tree-flow.h (V_PHI_ARG): Remove.  Update all users.
	(struct var_ref): Move fields used in distinct
	reference types to other structures.  Update all users.
	(struct var_def): New.
	(struct var_phi): New.
	(struct var_use): New.
	(union tree_ref_d): Add members vdef, vphi, vuse and vphi_arg.
	Update all users.
	(save_chain): Remove.  Update all users.
	(set_save_chain): Remove.  Update all users.
	(marked_with): Remove.  Update all users.
	(mark_def_with): Remove.  Update all users.
	(dump_reaching_defs): Declare.
	(debug_reaching_defs): Declare.

	(struct phi_node_arg_d): New structure.
	(phi_node_arg): New type.
	(phi_arg): Change return type to phi_node_arg.
	(imm_reaching_def_edge): Rename to phi_arg_edge.
	(set_imm_reaching_def_edge): Rename to set_phi_arg_edge.
	(phi_arg_def): New inline function.
	(set_phi_arg_def): New inline function.
	(debug_phi_args): Declare.
	(dump_phi_args): Declare.

	* tree-ssa-ccp.c: Use new phi_node_arg type when examining PHI node
	arguments.

	* tree-ssa-pre.c: Ditto.

	* tree-ssa.c (save_chain): New local variable.
	(build_fud_chains, search_fud_chains): Use it.
	(marked): New local variable.
	(tree_compute_rdefs, follow_chain): Use it.
	(dump_reaching_defs): New function.
	(debug_reaching_defs): New function.

2002-09-09  Daniel Berlin <dberlin@dberlin.org>

	* Makefile.in (tree-alias-steen.o): Remove gt-tree-alias-steen.h
	(tree-alias-common.o): Add dependency on c-common.h

	* tree-ssa-pre.c: Fix PRE now that V_USE's expr's are the entire
	assignment, rather than just the right hand side.
	Stop generating our own call clobbers

	* tree-dfa.c (create_ref): Make sure var is not null before checking
	TREE_THIS_VOLATILE.

	* tree.h: Reorder TDI_* so ssapre comes before ssa.

	* tree-dump.c: dump-tree-ssapre has to come before dump-tree-ssa
	in the table, or else it'll never match.

2002-09-09  Frank Ch. Eigler  <fche@redhat.com>

	* tree-mudflap.c (mf_offset_expr_of_array_ref): Fold constants along
	the way.
	(mf_build_check_statement_for): Ditto.  Flag new COMPONENT_REFs.
	(mx_xfn_indirect_ref): Instrument COMPONENT_REFs specially.  Tweak
	ARRAY_REF instrumentation to reduce need of copying and recursion.

2002-09-09  Diego Novillo  <dnovillo@redhat.com>

	* tree-ssa.c (analyze_rdefs): Disable uninitialized variable warnings.

2002-09-09  Diego Novillo  <dnovillo@redhat.com>

	* Makefile.in (tree-ssa.o): Add dependency on tree-simple.h.
	(tree-dfa.o): Add dependency on tree-simple.h and tree-inline.h.
	(tree-alias-steen.o): Add dependency on c-common.h.
	(tree-optimize.o): Add dependency on c-common.h.

	* c-simplify.c (deep_copy_node): Call walk_tree with mostly_copy_tree_r.
	(mostly_copy_tree_r): Also copy flags from original tree.
	(mark_not_simple_r): Call set_tree_flag.

	* tree-alias-steen.c: Include c-common.h.

	* tree-cfg.c (map_stmt_to_bb): Remove.
	(block_invalidates_loop): Change return type to bool.
	(create_loop_hdr): New function.
	(create_bb): Call it.
	(create_bb_ann): Return newly created annotation object.
	(remove_bb_ann): Nullify loop_hdr annotation, if there is one.
	(tree_delete_bb): Only remove basic block annotation from
	executables statements.
	(is_computed_goto): New function.

	* tree-dfa.c (pointer_refs): New file local variable.
	(call_sites): New global variable.
	(V_DEF, V_USE, V_PHI, V_PHI_ARG, E_FCALL, E_PHI, E_USE, E_KILL,
	E_INJ): New global constants.
	(M_DEFAULT, M_CLOBBER, M_MAY, M_PARTIAL, M_INITIAL, M_INDIRECT,
	M_VOLATILE): New global constants.
	(num_referenced_vars): New global variable.
	(referenced_vars): Rename from referenced_symbols.  Update all
	users.
	(clobber_vars_r): New function.
	(add_default_defs): New function.
	(add_call_site_clobbers): New function.
	(add_ptr_may_refs): New function.
	(add_phi_arg): New function.
	(find_list_node): New function.
	(remove_ref_from_list): Call it.
	(add_ref_to_list_after): New function.
	(is_pure_fcall): New function.
	(fcall_takes_ref_args): New function.
	(dump_referenced_vars): New function.
	(debug_referenced_vars): New function.
	(ref_type_name): New function.
	(validate_ref_type): New function.
	(debug_phi_args): Remove.
	(dump_phi_args): Remove.
	(add_referenced_var): Rename from add_ref_symbol.  Update all
	users.
	(dump_ref): Rename from dump_varref.  Update all users.
	(debug_ref): Rename from debug_varref.  Update all users.
	(dump_ref_list): Rename from dump_varref_list.  Update all users.
	(dump_ref_array): Rename from dump_varref_array.  Update all users.
	(next_tree_ref_id): Rename from next_varref_id.  Update all users.

	(tree_find_refs): Rename from tree_find_varrefs.  Update all users.
	Call add_default_defs.
	Call add_call_site_clobbers.
	Call add_ptr_may_refs.
	Call dump_referenced_vars.
	Create and destroy pointer_refs list.

	(find_refs_in_stmt): Set reference type to clobbering definition
	for the ASM_OUTPUTS and ASM_CLOBBERS expressions of an ASM_STMT.
	Set reference type to initial definition for the DECL_INITIAL node
	of a DECL_STMT.
	Clobber everything in CLEANUP_STMT nodes.

	(find_refs_in_expr): Re-write.
	Recursively clobber every VAR_DECL contained in non SIMPLE nodes.
	Mark indirect pointer references with M_INDIRECT flag.
	Add pointer references to pointer_refs list.
	Glob references to arrays and structures.
	Add function call expressions to call_sites list.

	(empty_ref_list): Do nothing if the list is empty already.
	(delete_ref_list): Ditto.
	(create_ref): Add new argument ADD_TO_BB.
	Set M_VOLATILE modifier if this is a reference to a volatile
	variable.
	Count number of incoming edges for V_PHI references before
	initializing the V_PHI_ARG array.
	Only add reference to basic block if ADD_TO_BB is true.
	Set output reference for the parent expression for V_DEF
	references.
	(remove_tree_ann): Do nothing if the tree didn't have an
	annotation.

	* tree-flow.h (enum treeref_type): Remove.  Update all users.
	(union varref_def): Ditto.
	(tree_ref): Rename from varref.  Update all users.
	(V_DEF): Declare.
	(V_USE): Declare.
	(V_PHI): Declare.
	(V_PHI_ARG): Declare.
	(E_FCALL): Declare.
	(E_PHI): Declare.
	(E_USE): Declare.
	(E_KILL): Declare.
	(E_INJ): Declare.
	(M_DEFAULT): Declare.
	(M_CLOBBER): Declare.
	(M_MAY): Declare.
	(M_PARTIAL): Declare.
	(M_INITIAL): Declare.
	(M_INDIRECT): Declare.
	(M_VOLATILE): Declare.
	(struct tree_ref_common): Rename from treeref_common.  Update all
	users.
	Change type of field 'type' to HOST_WIDE_INT.
	Rename field 'sym' to 'var'.
	(struct var_ref): Rename from varref.  Update all users.
	Join the structures varuse
	and vardef into a single structure.
	(struct expr_ref_common): Rename from exprref_common.  Update all
	users.
	(struct expr_use): Rename from expruse.  Update all users.
	(struct expr_phi): Rename from exprphi.  Update all users.
	(union tree_ref_d): Rename from varref_def.  Update all users.
	(EXPRPHI_PHI_ARGS): Rename from EXPRPHI_PHI_CHAIN.  Update all
	users.
	(struct tree_ann_d): Rename field 'compound_stmt' to
	'compound_parent'.
	Add field 'output_ref'.
	(enum tree_flags): New enum.
	(TF_REFERENCED): New flag.
	(phi_arg): Remove.
	(get_num_phi_args): Remove.
	(get_phi_arg): Remove.

	(struct vardef): Remove.  Update all users.
	(VARDEF_IMM_USES): Ditto.
	(VARDEF_SAVE_CHAIN): Ditto.
	(VARDEF_RUSES): Ditto.
	(VARDEF_MARKED): Ditto.
	(VARDEF_PHI_ARGS): Ditto.
	(struct varuse): Ditto.
	(VARUSE_IMM_RDEF): Ditto.
	(VARUSE_RDEFS): Ditto.
	(VARREF_ID): Ditto.
	(VARREF_TYPE): Ditto.
	(VARREF_BB): Ditto.
	(VARREF_EXPR): Ditto.
	(VARREF_OPERAND_P): Ditto.
	(VARREF_STMT): Ditto.
	(VARREF_SYM): Ditto.
	(IS_DEFAULT_DEF): Ditto.
	(IS_ARTIFICIAL_REF): Ditto.
	(TREE_ANN): Ditto.
	(BB_FOR_STMT): Ditto.
	(TREE_CURRDEF): Ditto.
	(TREE_REFS): Ditto.
	(TREE_COMPOUND_STMT): Ditto.
	(TREE_FLAGS): Ditto.
	(BB_ANN): Ditto.
	(BB_PARENT): Ditto.
	(BB_REFS): Ditto.
	(BB_PREV_CHAIN_P): Ditto.
	(BB_BINDING_SCOPE): Ditto.
	(BB_LOOP_HDR): Ditto.
	(FOR_INIT_STMT_BB): Ditto.
	(FOR_COND_BB): Ditto.
	(FOR_EXPR_BB): Ditto.
	(END_WHILE_BB): Ditto.
	(DO_COND_BB): Ditto.
	(BB_EMPTY_P): Ditto.

	(ref_type): New inline function.
	(ref_var): New inline function.
	(ref_stmt): New inline function.
	(ref_expr): New inline function.
	(ref_bb): New inline function.
	(ref_id): New inline function.
	(replace_ref_operand_with): New inline function.
	(restore_ref_operand): New inline function.
	(imm_uses): New inline function.
	(save_chain): New inline function.
	(set_save_chain): New inline function.
	(reached_uses): New inline function.
	(marked_with): New inline function.
	(mark_def_with): New inline function.
	(phi_args): New inline function.
	(num_phi_args): New inline function.
	(phi_arg): New inline function.
	(imm_reaching_def): New inline function.
	(set_imm_reaching_def): New inline function.
	(imm_reaching_def_edge): New inline function.
	(set_imm_reaching_def_edge): New inline function.
	(reaching_defs): New inline function.
	(tree_annotation): New inline function.
	(has_annotation): New inline function.
	(bb_for_stmt): New inline function.
	(set_bb_for_stmt): New inline function.
	(currdef_for): New inline function.
	(set_currdef_for): New inline function.
	(tree_refs): New inline function.
	(add_tree_ref): New inline function.
	(remove_tree_ref): New inline function.
	(compound_parent): New inline function.
	(set_compound_parent): New inline function.
	(set_tree_flag): New inline function.
	(clear_tree_flag): New inline function.
	(tree_flags): New inline function.
	(reset_tree_flags): New inline function.
	(output_ref): New inline function.
	(set_output_ref): New inline function.
	(bb_annotation): New inline function.
	(bb_parent): New inline function.
	(set_bb_parent): New inline function.
	(bb_refs): New inline function.
	(remove_bb_ref): New inline function.
	(prev_chain_p): New inline function.
	(set_prev_chain_p): New inline function.
	(binding_scope): New inline function.
	(set_binding_scope): New inline function.
	(header_blocks): New inline function.
	(for_init_bb): New inline function.
	(set_for_init_bb): New inline function.
	(for_cond_bb): New inline function.
	(set_for_cond_bb): New inline function.
	(for_expr_bb): New inline function.
	(set_for_expr_bb): New inline function.
	(end_while_bb): New inline function.
	(set_end_while_bb): New inline function.
	(do_cond_bb): New inline function.
	(set_do_cond_bb): New inline function.
	(bb_empty_p): New inline function.

	(referenced_vars): Rename from referenced_symbols.  Update all
	users.
	(num_referenced_vars): Declare.
	(NREF_SYMBOLS): Remove.  Update all users.
	(REF_SYMBOL): Ditto.
	(ADD_REF_SYMBOL): Ditto.
	(referenced_var): New inline function.
	(call_sites): Declare.
	(next_tree_ref_id): Rename from next_varref_id.  Update all users.
	(is_computed_goto): Declare.
	(is_pure_fcall): Declare.
	(fcall_takes_ref_args): Declare.
	(add_ref_to_list_after): Declare.
	(find_list_node): Declare.
	(ref_type_name): Declare.
	(validate_ref_type): Declare.

	* tree-optimize.c: Include c-common.h.
	(optimize_function_tree): Store DECL_SAVED_TREE in a local
	variable.

	* tree-ssa-ccp.c (cp_lattice_meet): New function.
	(visit_phi_node): Call it.
	(add_outgoing_control_edges): New function.
	(visit_expression_for): Call it.
	Don't handle static initializers.
	Handle computed gotos.
	(add_control_edge): New function.
	(visit_condexpr_for, simulate_block, add_outgoing_control_edges): Call
	it.
	(simulate_def_use_chains): Only look at unmodified V_USE references.
	(ssa_ccp_substitute_constants): Ditto.
	(evaluate_expr): Ditto.
	(initialize): Set initial value for incoming parameters and globals
	to VARYING.
	Set initial value for initialized static variables to VARYING,
	unless the variable is read-only.
	(set_lattice_value): Don't special case globals, volatiles and
	variables with their address taken.

	* tree-ssa.c: Include tree-simple.h.
	(tree_build_ssa): Don't add default definitions.
	(insert_phi_terms): Add new PHI nodes at the beginning of the list
	of references for the basic block.
	(search_fud_chains): Add def-def chains for non-killing
	definitions.
	(delete_ssa): Remove list call_sites.
	Set num_referenced_vars to 0.
	Set referenced_vars to NULL.
	(follow_chain): Follow def-def chains for non-killing definitions.
	(is_upward_exposed): Change return type to bool.
	(add_phi_arg): Remove.

2002-09-06  Frank Ch. Eigler  <fche@redhat.com>

	* tree-mudflap.c (deferred_static_decl*): Correct GTY markup.
	(mudflap_enqueue_decl): Correct iteration bounds.
	(mf_init_extern_trees): Add more constness to mf_cache_structptr_type.
	(mf_offset_expr_of_array_ref): Remove excess mx_flagging.  save_expr
	array subscripts.
	(mf_build_check_statement_for): Reorganize to take explicit
	check-base/size arguments, in addition to value argument.  save_expr
	array subscripts.  Copy value/base/size subtrees.
	(mx_xfn_indirect_ref): Support marking of subtrees for nontraversal.
	Track source line numbers more aggressively.  For arrays, check bounds
	from base through indexed element, not just the indexed element.
	Use nontraversal flagging to eliminate some excess instrumentation.
	(mf_xform_derefs): Support nontraversal by a hash table.
	(*): Remove "{{{"/"}}}" folding marks.

2002-09-02  Daniel Berlin  <dberlin@dberlin.org>

	* tree-alias-common.[ch]: New files.
	* tree-alias-steen.[ch]: Split out common stuff into
	tree-alias-common.[ch].
	* c-config-lang.in: Modify to use tree-alias-common.[ch] instead of
	tree-alias-steen, since this is where the GTY'd stuff is now.
	* Makefile.in: Add dependencies for tree-alias-common.[ch].

2002-09-03  Diego Novillo  <dnovillo@redhat.com>

	* c-simplify.c (simplify_goto_stmt): New function.
	(simplify_stmt): Call it.
	* tree-simple.c: Document grammar for GOTO_STMT nodes.
	(rationalize_compound_expr): Wrap it with #if 0/#endif.
	(get_base_symbol): Minor comment fixup.

2002-09-03  Frank Ch. Eigler  <fche@redhat.com>

	* gcc.c (MFWRAP_SPEC): Add --wrap=alloca.

2002-09-01  Diego Novillo  <dnovillo@redhat.com>

	* c-simplify.c (simplify_stmt): Mark CLEANUP_STMTs and ASM_STMTs
	not SIMPLE.
	(simplify_for_stmt): Do not allow expression sequences in
	FOR_INIT_STMT and FOR_EXPR nodes.
	* tree-simple.c: Document difference with original SIMPLE grammar.

2002-08-31  Frank Ch. Eigler  <fche@redhat.com>

	* tree-mudflap.c (mf_build_check_statement_for): Tolerate dereference
	of void pointers.
	(mx_register_decl): Correct typo in below patch.

2002-08-30  Graydon Hoare  <graydon@redhat.com>

	* tree-mudflap.c (mx_register_decl): Mark declarations as
	TREE_ADDRESSABLE when mudflap decides to register them.

2002-08-29  Graydon Hoare  <graydon@redhat.com>

	* tree-mudflap.c (mx_xfn_indirect_ref): Rewrite array references as
	pointer dereferences.
	(struct mf_xform_decls_data): New member: param_decls.
	(mx_register_decl): New function.
	(mx_xfn_xform_decls): Factor code out into mx_register_decl.
	Register live parameters with mudflap.
	(mx_xfn_find_addrof): Notice references to fields of structures
	and function parameters.

2002-08-29  Frank Ch. Eigler  <fche@redhat.com>

	* c-pretty-print.c (dump_c_tree): Detect loops in statement chains
	using a hash table to track visited status.
	* Makefile.in: Add hashtab.h dependency.

2002-08-28  Frank Ch. Eigler  <fche@redhat.com>

	* tree-mudflap.c (mudflap_enqueue_constant): Register non-string
	constants also.
	(mf_build_check_statement_for): Include pushlevel/pushdecl/poplevel
	for local variables.

2002-08-27  Frank Ch. Eigler  <fche@redhat.com>

	Better static registration:
	* varasm.c (make_decl_rtl): Handle DECL_RTL_SET_P case for
	mudflap static registration.
	* tree-mudflap.c (mudflap_enqueue_decl): Rewrite to handle
	deferred statics.
	(mudflap_finish_file): Call above fn back for deferred statics.

	Cleanup:
	* tree-mudflap.c (mf_varname_tree, mf_file_function_line_tree):
	Reorganize output_buffer reuse mechanism.
	(mf_build_check_statement_for): Set TREE_SIDE_EFFECTS.
	(mx_xfn_indirect_ref): Correct file/line collection tests.

	Dynamic linking support:
	* gcc.c (MFWRAP_SPEC): Make conditional on -static.  Add the
	newer wrapped functions dlopen/mmap/munmap.
	(MFLIB_SPEC): Be sensitive to -static.  Partial support for
	dynamic linking.

2002-08-26  Diego Novillo  <dnovillo@redhat.com>

	* Makefile.in (tree-ssa.o): Add dependency on ggc.h
	(c-simplify.o): Add dependency on langhooks-def.h
	* c-simplify.c: Include langhooks-def.h
	(simplify_function_tree): Do nothing if the front end does not
	support simplification.

	* tree-flow.h (struct vardef): Remove fields 'phi_chain' and
	'phi_chain_bb'.
	Add field 'phi_args'.
	(VARDEF_PHI_CHAIN): Remove.  Update all users.
	(VARDEF_PHI_CHAIN_BB): Remove.  Update all users.
	(VARDEF_PHI_ARGS): Define.
	(struct varuse): Rename field 'chain' to 'imm_rdef'.  Update all
	users.
	(VARUSE_IMM_RDEF):  Rename from VARUSE_CHAIN.  Update all users.
	(phi_arg): New structure.
	(get_num_phi_args): New function.
	(get_phi_arg): New function.
	(set_phi_arg): New function.
	(add_phi_arg): New function.
	(debug_phi_args): Declare.
	(dump_phi_args): Declare.
	* tree-dfa.c (create_ref): Remove initialization of
	VARDEF_PHI_CHAIN and VARDEF_PHI_CHAIN_BB.
	Initialize array VARDEF_PHI_ARGS.
	(dump_varref): Call dump_phi_args.
	(dump_phi_args): New function.
	(debug_phi_args): New function.
	* tree-ssa-ccp.c (PHI_PARMS): Remove.
	(EIE): Remove.
	(visit_phi_node): Get the argument's edge directly from the
	argument instead of calling find_edge.
	(initialize): Cast call to NUM_EDGES to unsigned.
	* tree-ssa-pre.c: Update uses of VARDEF_PHI_CHAIN,
	VARDEF_PHI_CHAIN_BB and VARUSE_CHAIN everywhere.
	* tree-ssa.c: Ditto.
	Include ggc.h.
	(search_fud_chains): Call add_phi_arg to add arguments to each PHI
	node.
	(tree_ssa_remove_phi_alternative): Call set_phi_arg to switch the
	last element with the element being removed.

2002-08-26  Diego Novillo  <dnovillo@redhat.com>

	* c-simplify.c (mostly_copy_tree_r): Unshare STMT_EXPR
	nodes.

2002-08-25  Diego Novillo  <dnovillo@redhat.com>

	* tree-dfa.c (find_refs_in_stmt): Replace calls to
	RETURN_EXPR with RETURN_STMT_EXPR.
	* c-simplify.c (simplify_return_stmt): Ditto.
	(deep_copy_node): Ditto.
	* c-pretty-print.c (dump_c_node): Ditto.

2002-08-24  Diego Novillo  <dnovillo@redhat.com>

	* c-pretty-print.c: Add `break' after calls to NIY in
	switch statements.

2002-08-23  Jeffrey A Law  (law@redhat.com)

	* tree-ssa-ccp.c (tree_ssa_ccp): Remove #if 0 that accidentally
	got checked in.  Cleanup the cfg to remove unreachable blocks
	discovered by CCP.

	* basic-block.h (EDGE_EXECUTABLE): New edge flag.

	* cfganal.c (find_edge): New function.

	* ssa-ccp.c: Convert to use EDGE_EXECUTABLE bit in the
	edge flags rather than a bitmap.  Convert edge worklist
	into a varray.  Avoids expensive find_index_edge calls.
	* tree-ssa-ccp.c: Likewise.

	* tree-flow.h (tree_ssa_remove_phi_alternative): Declare.
	* tree-ssa.c (tree_ssa_remove_phi_alternative): New function.
	* tree-ssa-ccp.c (optimize_unexecutable_edges): Remove
	PHI alternatives for unexecutable edges.  Also remove
	unexecutable edges from the CFG.

2002-08-22  Jeffrey A Law  (law@redhat.com)

        * Makefile.in (tree-optimize.o): Depend on tree-dchain.o
        * tree-optimize.c: Include tree-dchain.h.
        (optimize_function_tree): Unconditionally build and tear down
        the backpointers for the statement chain.

2002-08-22  Diego Novillo  <dnovillo@redhat.com>

	* tree-dfa.c (find_refs_in_stmt): Look for VARUSE references in
	initialization expressions.
	(find_refs_in_expr): Reformat.
	(remove_ref_from_list): Optimize for the common case of removing
	the head or the tail of the list.
	(add_ref_to_list_end): Reformat comment.
	(create_ref): Store the reference to LHS of assignment expressions.
	(dump_varref): Also dump immediate uses of PHI nodes.
	* tree-flow.h (IS_GHOST_DEF): Rename to IS_DEFAULT_DEF.  Update all
	callers everywhere.
	(struct tree_ann_def): Update comments for field 'currdef'.
	* tree-ssa-ccp.c (ssa_edges): Change type to ref_list.
	(SSA_NAME): Remove.
	(initialize): New function
	(finalize): New function.
	(visit_expression): Rename to visit_expression_for.  Update all
	callers.
	(visit_condexpr_for): New function.
	(visit_assignment): Rename to visit_assignment_for.  Update all
	callers.
	(examine_flow_edges): Rename to simulate_block.  Update all
	callers.
	(follow_def_use_chains): Rename to simulate_def_use_chains.  Update
	all callers.
	(evaluate_expr_for): Rename to evaluate_expr.  Change argument to
	'tree'.
	(set_lattice_value): New function.
	(tree_ssa_ccp): Change main loop to visit flow_edges and ssa_edges
	alternately.
	(visit_phi_node): Do not set the lattice value to UNDEFINED when we
	find a non-executable edge.
	(visit_expression_for): Default definitions for PARM_DECLs are
	assigned a VARYING value.
	Default definitions for any other local variables are assigned an
	UNDEFINED value.
	Clobber VARDEFs that are not the LHS of an assignment.
	Clobber VARDEFs that initialize non-const static variables.
	* tree-ssa.c (search_fud_chains): Set up def-use edges for PHI
	nodes and regular definitions.

	* tree.c (simple_cst_equal): Call simple_cst_list_equal to compare
	CONSTRUCTOR_ELTS pointers.

2002-08-22  Diego Novillo  <dnovillo@redhat.com>

	* c-pretty-print.c (buffer): New file local variable.
	(initialized): New file local variable.
	(print_c_tree): Don't call init_output_buffer.  Call
	maybe_init_pretty_print.
	(print_c_node): Ditto.
	(print_c_node_brief): Ditto.
	(maybe_init_pretty_print): New function.
	* tree-mudflap.c (mf_varname_tree): Only call init_output_buffer
	once.  Call output_clear_message_text before returning.

2002-08-21  Frank Ch. Eigler  <fche@redhat.com>

	Support source-file/line coordinates in check/violation messages.
	* tree-mudflap.c (mf_init_extern_trees): Add new "location" formal
	arg to __mf_check.
	(mf_file_function_line_tree): New function to build an actual location
	string.
	(build_check_statement_for): Call it / pass it.
	(mx_xfn_indirect_ref): Track source file/line location via
	STMT_LINENO, FILE_STMT, EXPR_WITH_FILE_LOCATION traversal memos.

2002-08-21  Daniel Berlin  <dberlin@dberlin.org>

	* dominance.c: Cache immediate dominators.

2002-08-20  Daniel Berlin  <dberlin@dberlin.org>

	* tree-alias-steen.h (struct tree_alias_ops): Add flag for
	interprocedural.

	* tree-alias-steen.c (steen_alias_ops): Set interprocedural to 0
	for now.
	(intra_function_call): New function to handle intraprocedural calling.
	(finc_func_aliases): Use it.
	Handle *x = *y, *x = &y, and *x = (cast) y.
	(display_points_to_set_helper): New function, split from ...
	(display_points_to_set): Here.
	(create_alias_vars): Try to print all alias vars we find in the
	alias_vars array, rather than just those that are linked directly to
	trees.
	Clear arrays when we finish if we aren't interprocedural.

2002-08-20  Frank Ch. Eigler  <fche@redhat.com>

	static object registration support:
	* tree-mudflap.c (mudflap_enqueue_decl, mudflap_enqueue_constant):
	Replace stubs with real code.
	(mf_enqueue_register_call): New function to generate asm-object
	call to __mf_register.
	(mf_flush_enqueued_calls): New function to emit global ctor function
	with enqueued __mf_register calls.
	(mf_varname_tree): Tolerate being called from non-function context.
	* c-objc-common.c: #include <tree-mudflap.h>.

	gengtypes support for mudflap:
	* Makefile.in (GTFILES): Include tree-mudflap.c.
	(gt-tree-mudflap.h): New target.
	* tree-mudflap.c: Annotate global tree nodes with GTY(()).
	* tree-nomudflap.c: Add dummy ggc root table.

2002-08-19  Diego Novillo  <dnovillo@redhat.com>

	* tree-dfa.c (find_refs_in_expr): If the current sub-expression is
	not SIMPLE, mark its parent.
	(create_ref): If the parent expression is not SIMPLE, create
	VARDEFs regardless of the original reference type.

	* tree-ssa-ccp.c (widen_bitfield): New function.
	(evaluate_expr_for): Call it.

2002-08-18  Diego Novillo  <dnovillo@redhat.com>

	* tree-ssa-ccp.c (evaluate_expr_for): Fix thinko in
	2002-08-17 patch.

2002-08-17  Diego Novillo  <dnovillo@redhat.com>

	* tree-ssa-ccp.c (evaluate_expr_for): keep VARREF_SYM in a local
	variable.

2002-08-16  Diego Novillo  <dnovillo@redhat.com>

	* basic-block.h (BB_CONTROL_EXPR): Update value.
	(BB_LOOP_CONTROL_EXPR): Define.
	(BB_CONTROL_ENTRY): Update value.
	* tree-cfg.c (make_for_stmt_blocks): Flag header blocks withh
	BB_LOOP_CONTROL_EXPR.
	(make_while_stmt_blocks): Ditto.
	(make_do_stmt_blocks): Ditto.
	(tree_delete_bb): Update annotations in the loop entry block when
	removing one of the loop expression blocks.

	* tree-dfa.c (tree_find_varrefs): Disregard empty blocks.
	(find_refs_in_stmt): Handle all the loop expression blocks in
	FOR_STMT and DO_STMT nodes.
	(find_refs_in_expr): Change first argument to tree *.  Update all
	callers.
	Force all references to be definitions when the expression is not
	in SIMPLE form.
	Also create references for compound variables and array references.
	Not just their individual components.
	Always use the original parent expression when making recursive
	calls.
	(create_ref): Add new argument operand_p.  Update all callers.
	(remove_tree_ann): New function.
	(dump_varref): Don't assume that the referenced symbol is a _DECL
	node.
	* tree-flow.h (treeref_common): Add field operand_p.
	(VARREF_OPERAND_P): Define.
	(BB_EMPTY_P): Define.
	(remove_tree_ann): Declare.
	(create_ref): Add new argument operand_p.
	* tree-simple.c (get_base_symbol): New function.
	* tree-simple.h (get_base_symbol): Declare.
	* tree-ssa-ccp.c (visit_assignment): Call it.
	(ssa_ccp_substitute_constants): Use VARREF_OPERAND_P to replace
	values into the expression.
	(evaluate_expr_for): Ditto.
	Do not try to evaluate the expression if the reference is not of
	the same type as the expression.
	After evaluation, restore the expression to its original form.
	* tree-ssa-pre.c (insert_occ_in_preorder_dt_order_): Update calls
	to create_ref.
	(finalize_): Ditto.
	(expr_phi_insertion): Ditto.
	* tree-ssa.c (tree_build_ssa): Ditto.
	(insert_phi_terms): Ditto.
	(delete_ssa): Call remove_tree_ann.

2002-08-15  Diego Novillo  <dnovillo@redhat.com>

	* c-pretty-print.c: Move extern definitions to diagnostic.h.
	(print_c_node_brief): New function.
	(debug_c_node_brief): New function.
	(debug_c_node): Add option for showing brief versions of statement
	nodes.  Update all callers.
	(print_declaration): Ditto.
	* c-simplify.c (simplify_function_tree): Add newline to debug
	output.
	* c-tree.h (print_c_node_brief): Declare.
	(debug_c_node_brief): Declare.
	* tree-cfg.c: Call print_c_node_brief in debugging otuput.
	* tree-mudflap.c (dump_c_node): Remove extern declaration.
	(mf_varname_tree): Update call to dump_c_node.

2002-08-15  Daniel Berlin  <dberlin@dberlin.org>

	* tree-cfg.c (find_expr_in_tree_helper): Renamed from find_expr_in_tree.
	(find_expr_in_tree): Redone.

2002-08-15  Daniel Berlin  <dberlin@dberlin.org>

	* tree-cfg.c (insert_before_ctrl_stmt): Fix insertion for various
	parts of for loop.

	* tree-ssa-pre.c (finalize_1): Set EXPR_STMT type to type of
	expression in it.

2002-08-14  Frank Ch. Eigler  <fche@redhat.com>

	* gcc.c (LINK_COMMAND_SPEC): Tweak placement of %(mflib).

2002-08-14  Diego Novillo  <dnovillo@redhat.com>

	* tree-simple.h (is_simple_decl_stmt): Declare.

2002-08-13  Frank Ch. Eigler  <fche@redhat.com>

	* gcc.c (MFWRAP_SPEC, MFLIB_SPEC): New macros, splitting MFLIB_SPEC.
	(mfwrap_spec, mflib_spec): Define corresponding vars.
	(static_specs): Define correponding spec aliases.
	(LINK_COMMAND_SPEC): Include -fmudflap refs to new spec aliases.
	(cpp_unique_options): Move -fmudflap MFCPP_SPEC clause here.
	(cc1_options): Move -fmudflap MFCC1_SPEC clause here.
	(MFCC1_SPEC, MFCPP_SPEC, MFLIB_SPEC): Remove macros and uses.

2002-08-13  Graydon Hoare  <graydon@redhat.com>

	* tree-mudflap.c (mf_build_check_statement_for): Factor code out of
	mx_xfn_indirect_ref for use in ARRAY_REF case.
	(mf_build_check_statement_for): Check size of underlying object
	rather than size of pointer.
	(mx_xfn_indirect_ref): Check ARRAY_REF expressions.
	(mf_offset_expr_of_array_ref): New function to calculate array ref
	offsets.

2002-08-13  Diego Novillo  <dnovillo@redhat.com>

	* tree-simple.c (is_simple_condexpr): Update comment.
	* tree-ssa-ccp.c (ssa_ccp_substitute_constants): Add debugging code.

2002-08-12  Jason Merrill  <jason@redhat.com>

	* c-typeck.c (build_component_ref): Don't add a NON_LVALUE_EXPR
	in C99 mode.

	* c-simplify.c (simplify_expr): Always simplify.  Loop if *expr_p
	changed.
	(simplify_addr_expr): Just replace *expr_p if we have a '&*'.
	* tree-simple.c (is_simplifiable_builtin): Add more tree codes.

2002-08-11  Diego Novillo  <dnovillo@redhat.com>

	* c-simplify.c: Fix typo.  Substitute CHECKING with ENABLE_CHECKING.
	* tree-cfg.c: Ditto.
	* tree-dfa.c: Ditto.
	* tree-ssa-ccp.c: Ditto.
	* tree-ssa.c: Ditto.

2002-08-11  Diego Novillo  <dnovillo@redhat.com>

	* tree-dfa.c (find_refs_in_expr): Use the given ref_type for some unary
	expressions.
	(create_ref): Insert ghost definitions at the beginning of the
	basic block.
	(find_expr_in_tree): Ignore IDENTIFIER_NODE.
	* tree-flow.h (treeref_common): Move the id field to the end of the
	structure.
	(IS_GHOST_DEF): Redefine to return non zero for definitions
	without an associated expression in basic block 0.
	* tree-ssa-ccp.c (tree_ssa_ccp): Use last_basic_block to allocate
	executable_blocks.
	(visit_expression): Set the lattice value for ghost definitions to
	VARYING.
	(examine_flow_edges): Update comments.
	* tree-ssa.c (tree_build_ssa): Create ghost definitions in basic
	block 0.
	(insert_phi_terms): Don't ignore ghost definitions.

	* c-simplify.c (simplify_function_tree): Return 0 if the function's
	body is not a COMPOUND_STMT.
	Return 0 if simplification failed.
	(simplify_expr): Change to return int.  Return non zero if
	simplification was successful.
	(c_simplify_expr): Add default case to avoid compile time warnings.
	(create_tmp_alias_var): Reformat comment.
	* tree-simple.h (simplify_expr): Change return type to int.

	* c-simplify.c: Guard consistency checks with #if defined CHECKING
	everywhere.
	* tree-cfg.c: Ditto.
	* tree-dfa.c: Ditto.
	* tree-ssa-ccp.c: Ditto.
	* tree-ssa.c: Ditto.

	* c-simplify.c: Include hard-reg-set.h, basic-block.h and
	tree-flow.h.
	(mark_not_simple_r): New function.
	(simplify_expr): Temporarily mark VA_ARG_EXPR and BIT_FIELD_REF
	trees as not simplifiable.
	(simplify_call_expr): If the builtin cannot be simplified, flag it.
	* Makefile.in (c-simplify.o): Update dependencies.
	* tree-dfa.c (create_ref): Variable references inside
	non-simplifiable expressions are always considered definitions.
	* tree-flow.h (TF_NOT_SIMPLE): New flag.
	* tree-simple.c (is_simplifiable_builtin): Update comments.

	* c-pretty-print.c (dump_c_node): Unparse anonymous structures and
	unions.
	Change rendering for SAVE_EXPR and BIT_FIELD_REF.

	* Makefile.in (tree-mudflap.o, tree-nomudflap.o): Add.

2002-08-11  Frank Ch. Eigler  <fche@redhat.com>

	Prototype -fmudflap support.
	* Makefile.in (C_AND_OBJC_OBJS): Add tree-mudflap.o.
	(OBJS): Add tree-nomudflap.o.
	* flags.h (flag_mudflap): New flag.
	* toplev.c: Map "-fmudflap" to that flag.
	* c-decl.c (c_expand_body): Call mudflap_c_function if flag_mudflap.
	* c-objc-common.c (c_objc_common_finish_file): Add mudflap hook.
	* varasm.c (make_decl_rtl): Add mudflap hook.
	(output_constant_def_contents): Ditto.
	* tree-mudflap.c: New file: implement mudflap instrumentation.
	* tree-nomudflap.c: New file: stub functions for non-C frontends.
	* tree-mudflap.h: New file: define exported functions.
	* gcc.c (MFLIB_SPEC, MFCC1_SPEC, MFCPP_SPEC): Add general
	-fmudflap spec mappings.
	* c-simplify.c (simplify_stmt): Stub: handle CLEANUP_STMT nodes.
	* tree-dfa.c (find_refs_in_stmt): Ditto.
	* c-pretty-print.c (dump_c_node): Ditto.
	(print_declaration): Handle "extern" decls.  Handle arrays with
	indefinite sizes.
	* tree-simple.h (is_simple_stmt, is_simple_compstmt): Remove decls.

2002-08-11  Jason Merrill  <jason@redhat.com>

	* c-simplify.c (simplify_self_mod_expr): Unshare the lhs before
	using it again.
	(simplify_compound_lval): Don't unshare.

	* c-simplify.c (c_simplify_expr): Check statement_code_p.

	* c-simplify.c (maybe_fixup_loop_cond): Move to cp/cp-simplify.c.
	(simplify_for_stmt): Don't call it.
	(simplify_while_stmt): Don't call it.

2002-08-11  Diego Novillo  <dnovillo@redhat.com>

	* c-simplify.c (simplify_compound_lval): Use mostly_copy_tree_r.

2002-08-09  Jason Merrill  <jason@redhat.com>

	* langhooks-def.h: Replace the simplify_function_tree hook
	with a simplify_expr hook.
	* langhooks.h: Likewise.
	* langhooks.c: Replace lhd_simplify_function_tree with
	lhd_simplify_expr.
	* c-lang.c (LANG_HOOKS_SIMPLIFY_FUNCTION_TREE): Don't define.
	(LANG_HOOKS_SIMPLIFY_EXPR): Define.
	* c-decl.c (c_expand_body): De-hook simplify_function_tree.
	* c-common.h: Declare c_simplify_expr.
	* c-simplify.c (simplify_function_tree): Rename from
	c_simplify_function_tree.  Call simplify_expr instead of
	simplify_stmt.
	(c_simplify_expr): Split out from...
	(simplify_expr): ...here.  No longer static.  Call langhook.
	(is_simple_decl_stmt): Move here from tree-simple.c.
	* tree-simple.c: Don't include c-tree.h.
	(is_simple_stmt, is_simple_compstmt): Remove.
	(is_simple_decl_stmt): Move to c-simplify.c.
	* tree.h: Declare simplify_function_tree.
	* tree-simple.h: Declare simplify_expr, add_tree.

	* tree-simple.c (rationalize_compound_expr): New fn.

2002-08-07  Diego Novillo  <dnovillo@redhat.com>

	* basic-block.h (EDGE_TRUE_VALUE): Define.
	(EDGE_FALSE_VALUE): Define.
	* tree-cfg.c: Include c-tree.h.
	(make_for_stmt_edges): Call simple_cst_equal to determine infinite
	and zero iteration loops.
	Set EDGE_TRUE_VALUE and EDGE_FALSE_VALUE to edges coming out of
	predicate block.
	(make_while_stmt_edges): Ditto.
	(make_do_stmt_edges): Ditto.
	(make_if_stmt_edges): Set EDGE_TRUE_VALUE and EDGE_FALSE_VALUE to
	edges coming out of predicate block.

	* c-simplify.c (simplify_compound_lval): Unshare the compound
	reference before simplification.

	* tree-cfg.c (insert_before_ctrl_stmt): Call print_c_node instead of
	print_node_brief.
	(insert_before_normal_stmt): Ditto.
	(insert_after_ctrl_stmt): Ditto.
	(insert_after_normal_stmt): Ditto.
	(insert_after_loop_body): Ditto.
	(replace_expr_in_tree): Ditto.
	(tree_dump_bb): Ditto.

	* tree-dfa.c: Include c-tree.h
	(next_varref_id): New global variable.
	(tree_find_varrefs): Initialize it to 0.
	(create_ref): Increment it after creating a new reference.  Store
	it in ref.common.id.
	Add the new reference to the list of references for the containing
	expression.
	(dump_varref): Show the reference ID.
	* tree-flow.h (treeref_common): Add field 'id'.
	(VARREF_ID): Define.

	* tree-dump.c (dump_files): Re-order dump files.
	* tree.h (tree_dump_index): Ditto.

	* tree-optimize.c (optimize_function_tree): Remove blank lines.

	* tree-simple.c: Remove unary operator '!' from grammar.

	* tree-flow.h (tree_ann_def): Add field 'flags'.
	(TF_FOLD): Define.
	(TREE_ANN): Re-define into an lvalue.
	(BB_FOR_STMT): Ditto.
	(TREE_CURRDEF): Ditto.
	(next_varref_id): Declare.
	* tree-ssa-ccp.c: Include tree-simple.h
	(ssa_edges): Convert sbitmap into varray_type.  Update all uses.
	(decl_map): Remove.
	(SSA_NAME): Use VARREF_ID instead of DECL_UID.
	(visit_assignment): New function.
	(evaluate_expr_for): New function.
	(dump_lattice_value): New function.
	(tree_ssa_ccp): Add debugging dumps.
	Remove #if 0 code everywhere.
	(visit_phi_node): Add debugging dumps.
	Also visit PHI arguments.
	Remove basic block argument
	(visit_expression): Re-implement.
	(examine_flow_edges): Add debugging dumps.
	(ssa_ccp_substitute_constants): Add debugging dumps.
	Update comments.
	Mark and fold expressions with substituted constants.
	* tree-ssa.c (search_fud_chains): Don't check if BB_REFS(bb) is
	empty before iterating.
	Add comment explaining how we chain PHI node arguments to their
	originating basic block.

	* Makefile.in (tree-cfg.o, tree-dfa.o, tree-ssa-ccp.o): Update
	dependencies.

2002-07-29  Daniel Berlin  <dberlin@dberlin.org>

	* tree-ssa-pre.c (tree_perform_ssapre): Ben forgot to add a
	dump_begin call when he removed the before dump.

2002-07-24  Daniel Berlin  <dberlin@dberlin.org>

	* tree-alias-ecr.c (ECR_new_with_type): Use correct number in mapping.

2002-07-23  Daniel Berlin  <dberlin@dberlin.org>

	* c-simplify.c (simplify_for_stmt): Deep copy the result of the
	tail_expression, so it's unshared.

2002-07-23  Daniel Berlin  <dberlin@dberlin.org>

	* tree-flow.h: Add prototype for create_alias_vars.

	* tree-alias-steen.c (display_points_to_set): New function.
	(init_alias_vars): Display points to sets when we are done.

	* disjoint-set.h (disjoint_set_def): ptr_alias to ECR_def so that
	we mark parent properly.

2002-07-24  Diego Novillo  <dnovillo@redhat.com>

	* Makefile.in (GTFILES): Move tree-alias-type.[ch],
	tree-alias-ecr.[ch], tree-alias-steen.[ch] from ...
	* c-config-lang.in (gtfiles): ... here.

	* tree-simple.c (is_simplifiable_builtin): Replace
	BUILT_IN_VARARGS_START with BUILT_IN_VA_START.

2002-07-23  Andreas Jaeger  <aj@suse.de>

	* tree-ssa-pre.c (hash_expr_tree): Remove.

	* c-call-graph.c (write_dtd): Remove.

	* tree-ssa.c (delete_refs): Remove.

2002-07-23  Andreas Jaeger  <aj@suse.de>

	* gengtype.c (open_base_files): Add tree.h.

	* tree-alias-type.h: Remove inclusion of tree.h.

	* tree-alias-steen.c: Include tree.h.
	Add prototype for create_fun_alias_var_ptf.

	* tree-alias-ecr.c: Add prototype for ECR_add_pending.

	* tree-ssa-pre.c (calculate_preorder): Remove unused variables.

	* tree-simple.c: Include expr.h and rtl.h for prototypes.

	* tree-optimize.c: Include tree-alias-steen.h for prototypes.

	* Makefile.in (tree-optimize.o): Add tree-alias-steen.h.
	(tree-simple.o): Add expr.h and rtl.h.
	(tree-alias-steen.o): Add tree.h.

	* diagnostic.h: Add declaration of debug_output_buffer.

	* c-call-graph.c (construct_call_graph): Make static to follow
	declaration.
	(construct_call_graph): Use #if 0 instead of C++ comments to
	disable code.

2002-07-20  Andreas Jaeger  <aj@suse.de>

	* doc/invoke.texi (Option Summary): Fix syntax.

2002-07-19  Jason Merrill  <jason@redhat.com>

	* c-simplify.c (simplify_return_stmt): Do simplify a returned
	expression in a void function.

	* c-simplify.c (simplify_stmt_expr): Handle C++ return semantics.

2002-07-19  Jason Merrill  <jason@redhat.com>

	* c-pretty-print.c (dump_c_node) [TARGET_EXPR]: Handle.
	[COND_EXPR]: Print a returned expression in a void function.

2002-07-19  Ben Elliston  <bje@redhat.com>

	* tree-ssa-pre.c (tree_perform_ssapre): Don't dump the original
	tree before applying this optimisation.

	* flags.h (flag_dump_tree_all_ssa): New flag.
	* toplev.c (flag_dump_tree_all_ssa): New flag.
	(f_options): Add "dump-tree-all-ssa" option.
	(process_options): Process flag_dump_tree_all_ssa.
	* tree.h (dump_enable_all_ssa): Declare.
	* tree-dump.c (dump_enable_all_ssa): New function.
	* doc/invoke.texi (Option Summary): Add -fdump-tree-all-ssa and
	-fdump-tree-ssapre options.
	(Debugging Options): Describe in more detail.
	* c-simplify.c (c_simplify_function_tree): Dump the original tree
	only if a TDI_original dump is requested, rather than TDI_simple.

	* tree-dump.c (dump_begin): Include phase number in dump filename.

2002-07-18  Ben Elliston  <bje@redhat.com>

	* tree-dump.c (dump_files): Rename "unparse" to "raw".
	* tree.h (TDF_UNPARSE): Rename from this ..
	(TDF_RAW): .. to this.
	* tree-ssa-pre.c (tree_perform_ssapre): Use TDF_RAW and invert the
	logical sense of this flag.
	* tree-ssa-ccp.c (tree_ssa_ccp): Likewise.
	* c-simplify.c (c_simplify_function_tree): Likewise.

2002-07-18  Daniel Berlin  <dberlin@dberlin.org>

	* tree-ssa-pre.c (calculate_preorder): New function.
	(tree_perform_ssapre): Use it, rather than
	flow_compute_preorder_tranversal, which seems to not do
	what we want.

2002-07-18  Daniel Berlin <dberlin@dberlin.org>

	* tree-alias-type.c: Move gt-tree-alias-type include to end of file.

	* tree-alias-steen.c: Move gt-tree-alias-steen include to end of file.

2002-07-18  Daniel Berlin  <dberlin@dberlin.org>

	* gengtype.c (get_base_file_bitmap): Mark tree-alias-* and
	disjoint-set* as c/c++/objc files only.

	* Makefile.in (gt-tree-alias-type.h): Add.
	(tree-alias-type.o): Add dependency on gt-tree-alias-type.h.

	* tree-alias-type.c: Include gt-tree-alias-type.h.
	(alias_bottom): Add a GTY marked version of alias_bottom here.

	* tree-alias-type.h: Remove the GTY marker from alias_bottom.

2002-07-17  Daniel Berlin  <dberlin@dberlin.org>

	* tree-alias-ecr.c (ECR_union_pending_sets): Only clear bitmap if
	it's not NULL.

2002-07-16  Jason Merrill  <jason@redhat.com>

	* c-simplify.c (add_tree): Build an EXPR_STMT immediately.
	(convert_to_stmt_chain): Remove.
	(simplify_stmt, simplify_for_stmt, simplify_while_stmt,
	simplify_do_stmt, simplify_expr_wfl, tail_expression): Adjust.

2002-07-17  Daniel Berlin  <dberlin@dberlin.org>

	* tree-alias-ecr.c: New file. Equivalence Class Representation.

	* tree-alias-steen.c: New file. Steengaard Alias Analysis.

	* disjoint-set.c: New file. Disjoint set data structure.

	* tree-alias-type.c: New file. Alias types.

	* c-simplify.c (create_tmp_alias_var): New function, like
	create_tmp_var, but doesn't add it to the current binding.

	* tree-simple.h: Prototype for create_tmp_alias_var.

	* tree-optimize.c (build_tree_ssa): Create alias variables, if
	requested.

	* flags.h: Add flag_tree_points_to.

	* toplev.c: Ditto.

	* gengtype.c (open_base_files): Add disjoint-set.h,
	tree-alias-ecr.h, tree-alias-type.h, tree-flow.h.

	* Makefile.in (C_AND_OBJC_OBJS): Add disjoint-set.o,
	tree-alias-ecr.o, tree-alias-type.o, tree-alias-steen.o.
	(tree-alias-steen.o): Add dependencies.
	(tree-alias-ecr.o): Ditto.
	(tree-alias-type.o): Ditto.
	(disjoint-set.o): Ditto.

2002-07-10  Daniel Berlin  <dberlin@dberlin.org>
	    Diego Novillo  <dnovillo@redhat.com>

	* Makefile.in (C_AND_OBJC_OBJS): Add tree-ssa-ccp.o
	* flags.h (flag_tree_ssa_ccp): Declare.
	* fold-const.c (eval_subst): Make extern.
	* toplev.c (flag_tree_ssa_ccp): Define.
	(f_options): Document -ftree-ssa-ccp.
	* tree-dump.c (dump_files): Add -fdump-tree-ccp.
	* tree-flow.h (tree_perform_ssapre): Move declaration ...
	* tree-optimize.h: ... here.
	(tree_ssa_ccp): Declare.
	* tree-optimize.c (optimize_function_tree): Call tree_ssa_ccp.
	* tree-ssa-ccp.c: New file.
	* tree.c (next_decl_uid): Remove static declaration.
	* tree.h (next_decl_uid): Declare.
	(tree_dump_index): Add TDI_ccp.
	* cp/Make-lang.in (CXX_C_OBJS): Add tree-ssa-ccp.o.
	* doc/invoke.texi: Document -ftree-ssa-pre and -ftree-ssa-ccp.

2002-07-09  Daniel Berlin  <dberlin@dberlin.org>

	s/varrays of refs/ref_list of refs/g

	* tree-flow.h: Add ref_list structure.
	Add prototypes for ref_list functions.
	(FOR_EACH_REF, FOR_EACH_REF_REV): New macros to iterate through
	ref lists.
	* tree-cfg.c, tree-ssa.c, tree-ssa-pre.c: Update all uses.

	* tree-dfa.c (create_ref_list): New function.
	(delete_ref_list): Ditto.
	(empty_ref_list): Ditto.
	(add_ref_to_list_end): Ditto.
	(add_ref_to_list_begin): Ditto.
	(remove_ref_from_list): Ditto.

2002-07-04  Diego Novillo  <dnovillo@redhat.com>

	* tree-simple.c (is_simplifiable_builtin): Don't simplify target
	builtins.

2002-07-03  Diego Novillo  <dnovillo@redhat.com>

	* c-simplify.c (simplify_decl_stmt): Unshare the
	initializer nodes before simplification.

2002-06-29  Aldy Hernandez  <aldyh@quesejoda.com>
            Diego Novillo  <dnovillo@redhat.com>

        * c-simplify.c (simplify_call_expr): Do not bail on all builtins.
        (is_simple_call_expr): Same.
	(simplify_addr_expr): New function.
	(simplify_expr): Call it.

        * tree-simple.c (is_simplifiable_builtin): New.
        (is_simple_compound_lval): Do not bail on INDIRECT_REF.

        * tree-simple.h: New prototype for is_simplifiable_builtin.

2002-06-26  Daniel Berlin  <dberlin@dberlin.org>

	* tree-ssa.c (tree_build_ssa): Call free_dominance_info, not
	free, on idom.

	* tree-ssa-pre.c (compute_domchildren): Update to use new
	dominance_info structure, rather than idom array.
	(tree_perform_ssapre): Don't forget to free the dominance info.

	s/VARRAY_FREE/VARRAY_CLEAR/g now that VARRAY's are ggc allocated.

2002-06-24  Diego Novillo  <dnovillo@redhat.com>

	* tree-ssa.c (build_fud_chains): Use dominance_info instead of int *.
	(search_fud_chains): Ditto.
	Call get_immediate_dominator.
	* tree-ssa-pre.c (a_dom_b): Call dominated_by_p.
	(pre_idom): Change type to dominance_info.  Update all uses.
	(pre_doms): Remove.  Update all uses.

2002-06-20  Jason Merrill  <jason@redhat.com>

	Simplify DECL_STMT, CONSTRUCTOR and COMPOUND_LITERAL_EXPR.
	* tree-simple.c (is_simple_decl_stmt): New fn.
	(is_simple_constructor, is_simple_constructor_elt): New fns.
	(is_simple_stmt, is_simple_unary_expr): Use them.
	(is_simple_modify_expr): Accept an INIT_EXPR.
	(is_simple_id): Don't allow a COMPOUND_LITERAL_EXPR.
	(is_simple_unary_expr): Here either.
	* c-simplify.c (simplify_decl_stmt, simplify_constructor): New fns.
	(simplify_compound_literal_expr): New fn.
	(simplify_stmt, simplify_expr): Use them.
	(get_initialized_tmp_var): Use an INIT_EXPR.
	(simplify_modify_expr): Accept an INIT_EXPR.
	(simplify_for_stmt): Call simplify_decl_stmt.
	(get_name): Don't crash if the decl is anonymous.
	(tail_expression): New fn.
	* tree-simple.h: Declare new fns.
	* c-pretty-print.c (dump_c_node) [INIT_EXPR]: Print like MODIFY_EXPR.
	(dump_c_node, op_prio): Handle COMPOUND_LITERAL_EXPR.
	* c-simplify.c (simplify_expr_wfl): Only wrap pre and post stuff
	that came from our subexpression.
	(simplify_stmt): Restore stmts_are_full_exprs_p.

	* c-simplify.c (simplify_expr_wfl): Bracket substatements with
	FILE_STMTs rather than wrapping them in EXPR_WITH_FILE_LOCATION.
	(simplify_stmt): Update lineno and input_filename from stmts.
	(simplify_expr et al): Don't copy lineno between stmts.  Don't pass
	enclosing stmt down.
	(update_line_number): Remove.

	* c-simplify.c (simplify_expr_stmt): Don't check
	is_last_stmt_of_scope.
	(simplify_stmt_expr): Check it here.  Set *expr_p to void_zero_node
	instead of NULL_TREE.
	(expr_has_effect): No need to deal with NULL exprs now.
	(simplify_expr_wfl): Likewise.

2002-06-18  Diego Novillo  <dnovillo@redhat.com>

	* c-simplify.c (strip_off_ending): Rename to remove_suffix.
	Update callers.
	(is_last_stmt_of_scope): New function.
	(simplify_expr_stmt): Call it.
	(stmt_has_effect): Ditto.
	(c_simplify_function_tree): Update comment.

2002-06-18  Jason Merrill  <jason@redhat.com>

	* c-simplify.c (maybe_fixup_loop_cond): New fn for C++ conditions.
	(simplify_for_stmt, simplify_while_stmt): Use it.

	* c-pretty-print.c (dump_c_node) [COMPONENT_REF]: Print "->" if
	appropriate.

2002-06-19  Jason Merrill  <jason@redhat.com>

	* c-simplify.c (simplify_stmt_expr): New fn.
	(simplify_expr): Call it.
	(stmt_expr_level): Remove.
	(stmt_has_effect, c_simplify_function_tree): Remove refs.
	(expr_has_effect): Deal with null expression.
	(simplify_expr_wfl): If the subexpression is simplified away, drop
	this one, too.  Don't wrap statements.
	* tree-simple.c (is_simple_unary_expr): Don't allow a STMT_EXPR.
	* tree-inline.c (copy_tree_r): Clear the aux field in the copies.

2002-06-17  Frank Ch. Eigler  <fche@redhat.com>

	* c-pretty-print.c (dump_c_node): Print pointer-type
	integer constants as raw numbers with a "B" (bytes) suffix.

2002-06-17  Jason Merrill  <jason@redhat.com>

	* c-simplify.c (simplify_stmt): Take a tree *.
	(various): Adjust.

2002-06-16  Daniel Berlin  <dberlin@dberlin.org>

	* c-simplify.c (get_name): New function.
	(get_initialized_tmp_var): Use it to try to get a prefix for
	create_tmp_var from the value we are initializing to.
	(simplify_cond_expr): Add prefix for create_tmp_var.
	(create_tmp_var): Add prefix argument.

	* tree-simple.h: Change create_tmp_var prototype to match.

	* tree-ssa-pre.c: Change create_tmp_var call.

2002-06-15  Diego Novillo  <dnovillo@redhat.com>

	* Makefile.in (c-decl.o): Add dependency on langhooks.h
	(c-simplify.o): Add dependency on flags.h, langhooks.h, toplev.h
	and rtl.h.
	* c-decl.c: Include langhooks.h.
	(c_expand_body): Simplify the function.  If it succeeds and
	-ftree-ssa is enabled, call optimize_function_tree.
	* c-simplify.c: Include flags.h, rtl.h and toplev.h.
	(simplify_expr_stmt): New function.
	(simplify_stmt): Call it.
	* tree-optimize.c: Don't include langhooks.h.
	(optimize_function_tree): Don't call lang_hooks.simplify_function_tree.

	* c-decl.c (c_expand_body): Do not simplify nor optimize the
	function if -fdisable-simple is given.
	* c-simplify.c (simplify_expr): Use is_simple_addr_expr_arg when
	simplifying ADDR_EXPR nodes.
	* flags.h (flag_disable_simple): Declare.
	* toplev.c (flag_disable_simple): Define.
	(f_options): Document -fdisable-simple.
	(process_options): Warn if -fdisable-simple is used with
	optimization enabled.
	* tree-simple.c (is_simple_addr_expr_arg): New function.
        (is_simple_unary_expr): Call it.
	* tree-simple.h (is_simple_addr_expr_arg): Declare.
	* doc/invoke.texi: Document -fdisable-simple.

	* c-pretty-print.c (dump_c_node): Handle DECL_STMT nodes inside
	FOR_INIT_STMT.
	* c-simplify.c (c_simplify_function_tree): Don't do anything if the
	program had errors.
	(simplify_stmt): Skip DECL_STMTs.
	(simplify_for_stmt): Handle DECL_STMT nodes inside FOR_INIT_STMT.
	(simplify_save_expr): New function.
	(simplify_expr): Call it.
	(tree_last_decl): Handle cases where DECL_STMTs are found before
	the body of the function.
	* tree-simple.c (is_simple_stmt): Handle DECL_STMT nodes inside
	FOR_INIT_STMT.
	(is_simple_compound_lval): Handle nodes wrapped in NON_LVALUE_EXPR.

2002-06-14  Frank Ch. Eigler  <fche@redhat.com>

	* c-pretty-print.c (dump_c_node): Print more type qualifiers,
	especially for pointers.

2002-06-11  Diego Novillo  <dnovillo@redhat.com>

	* c-simplify.c: Remove folding markers.
	(insert_before_first): Remove unused function.
	* tree-cfg.c: Remove folding markers.
	* tree-dfa.c: Ditto.
	* tree-flow.h: Ditto.
	* tree-optimize.c: Ditto.
	* tree-optimize.h: Ditto.
	* tree-simple.c: Ditto.
	* tree-ssa.c: Ditto.

2002-06-11  Jason Merrill  <jason@redhat.com>

	* c-simplify.c (add_tree): Don't deep-copy expressions.
	(simplify_for_stmt): Only deep-copy pre_cond_s the first time.
	Don't deep copy expr_chain.

2002-06-10  Diego Novillo  <dnovillo@redhat.com>

	* tree-cfg.c (remove_bb_ann): Don't call VARRAY_FREE.
	* tree-dfa.c (create_ref): Use sizeof (ref) instead of
	refs->element_size.
	* tree.h (struct tree_common): Skip field 'aux' from GC type
	information.
	* tree-optimize.c (optimize_function_tree): Don't call
	VARRAY_REF.
	* tree-ssa.c (insert_phi_terms): Ditto.
	(delete_refs): Ditto.
	* c-simplify.c (simplify_array_ref): Ditto.
	* simple-break-elim.c: Disable whole file.
	* simple-goto-elim.c: Disable whole file.

2002-06-10  Jason Merrill  <jason@redhat.com>

	* c-simplify.c (simplify_switch_stmt): Let simplify_expr handle
	post-effects.  Reorder.
	(simplify_if_stmt): Likewise.  Don't build redundant comparison.
	(simplify_do_stmt, simplify_while_stmt): Likewise.
	(simplify_for_stmt): Likewise.  Remove POST_P parm.
	(simplify_stmt): Adjust.
	(insert_before_first): #if 0, no longer used.

	* c-pretty-print.c (dump_c_node): Print FIX_TRUNC_EXPR, FLOAT_EXPR
	et al as casts.  Add parens as needed.

	* tree-simple.c (is_union_based_ref): New fn.
	(is_simple_min_lval): Use it.  Rename from is_simple_arraybase.
	(is_simple_arrayref): Adjust.  Use loop instead of recursion.
	(is_simple_compref): Likewise.
	(is_simple_compref_lhs): Remove.
	* tree-simple.h: Adjust.
	* c-simplify.c (simplify_array_ref): Adjust.
	(simplify_component_ref): Adjust.

	* c-simplify.c (simplify_expr_common): Tweak ordering.
	(get_initialized_tmp_var): Let simplify_expr handle post-effects.
	* tree-simple.c (is_simple_stmt): Accept an rhs for a return expr.

	* c-simplify.c (simplify_boolean_expr): Avoid redundant tests.
	Give the temp the appropriate type for a boolean value, and
	reconvert at the end.

	* c-simplify.c (simplify_self_mod_expr): Don't duplicate side-effects.

	* c-simplify.c (simplify_return_stmt): Accept a SIMPLE rhs.
	Just hand off to simplify_expr.

	* c-simplify.c (get_initialized_tmp_var): New fn.
	(simplify_expr_common): Use it.  Handle post-effects internally if
	POST_P is NULL.
	(is_simple_tmp_var): Rename from simple_tmp_var_p.
	* tree-simple.h: Adjust.

2002-06-09  Diego Novillo  <dnovillo@redhat.com>

	* c-simplify.c (simplify_return_stmt): Update folding markers.
	(build_addr_expr): Ditto.
	* langhooks.h (struct langhooks): Document simplify_function_tree
	hook.

2002-06-09  Jason Merrill  <jason@redhat.com>

	* c-simplify.c (simplify_expr_common): Handle creating both lvalue
	and rvalue temps.  Add new parameter to specify which.
	(simplify_expr): Now just a wrapper.
	(simplify_lvalue_expr): Likewise.
	(simplify_expr_either): New wrapper.
	(simplify_component_ref): Use it instead of simplify_lvalue_expr.

	* c-pretty-print.c (debug_c_tree): Add a trailing newline.
	(debug_c_node): Likewise.
	* gdbinit.in (pct): New macro, calls debug_c_tree.

2002-06-08  Jason Merrill  <jason@redhat.com>

	* tree-simple.c (is_simple_unary_expr): Only allow the address of
	a varname.
	(is_simple_id): Allow STRING_CST.
	* c-simplify.c (simplify_expr_common): Split out from simplify_expr.
	Do simplify ADDR_EXPR.
	(simplify_lvalue_expr): Use it and build_addr_expr.  Take
	simple_test_f.
	(simplify_modify_expr): Adjust.
	(build_addr_expr): New fn.
	(simplify_array_ref): Use simplify_lvalue_expr.
	(simplify_component_ref): Likewise.

	* tree-simple.c (is_simple_rhs): Remove condexpr rule.
	(is_simple_compref_lhs): Remove &ID.idlist rule.
	(is_simple_relop): New fn.
	(is_simple_binary_expr, is_simple_condexpr): Use it.
	* tree-simple.h: Declare it.

	* c-simplify.c (create_tmp_var): Refuse to create an array temp.
	(simple_tmp_var_p): New fn.
	(simplify_lvalue_expr): Use it; make sure we don't return a temp.
	* tree-simple.h: Declare it.

	* c-pretty-print.c (dump_c_node) [ARRAY_REF]: Wrap array in parens
	as needed.
	[COMPONENT_REF]: Likewise.
	[POINTER_TYPE]: Fix pointer-to-function handling.
	[ARRAY_TYPE]: Don't try to print an unknown dimension.

	* tree-simple.c (is_simple_arraybase): New function.
	(is_simple_arrayref): Use it to check the array base again.
	* tree-simple.h: Add declaration.
	* c-simplify.c (simplify_array_ref): Do simplify the base.
	* expr.c (expand_expr): First make sure the type has a size.

2002-06-07  Jason Merrill  <jason@redhat.com>

	* cppexp.c (num_equality_op): Use a temporary variable to work
	around gcc 3.0.4 bug.

2002-06-05  Diego Novillo  <dnovillo@redhat.com>

	* Makefile.in (BOOT_CFLAGS): Remove -ftree-ssa.
	* c-decl.c (c_expand_body): Call optimize_function_tree if tree SSA
	is enabled.
	* c-lang.c (LANG_HOOKS_SIMPLIFY_FUNCTION_TREE): Define.
	* c-simplify.c (simplify_tree): Rename to c_simplify_function_tree.
	Update all callers.
	Dump function body before and after simplification if
	-fdump-tree-simple is used.
	(simplify_expr): Document FIXME for simplification of BIT_FIELD_REF
	nodes.
	* c-tree.h (simplify_tree): Rename to c_simplify_function_tree.
	* langhooks-def.h (LANG_HOOKS_SIMPLIFY_FUNCTION_TREE): Define
	(LANGHOOKS_INITIALIZER): Add LANG_HOOKS_SIMPLIFY_FUNCTION_TREE.
	(lhd_simplify_function_tree): Declare.
	* langhooks.c (lhd_simplify_function_tree): New function.
	* langhooks.h (lang_hooks): Add simplify_function_tree function
	pointer.
	* toplev.c (parse_options_and_default_flags): Set flag_tree_ssa to
	1 at optimization levels >= 1.
	Revert to default warning when -Wuninitialized is used without -O.
	* tree-cfg.c (tree_find_basic_blocks): Rename argument 't' to
	'fnbody'.
	* tree-optimize.c: Include langhooks.h.
	(optimize_tree): Rename to optimize_function_tree.  Update all
	users.
	Rename argument 't' to 'fndecl'.
	Call simplify langhook before building SSA.
	(build_tree_ssa): Rename argument 't' to 'fndecl'.
	Adjust call to tree_find_basic_blocks to pass body of the function.
	* tree-optimize.h (optimize_tree): Rename to
	optimize_function_tree.
	* tree-simple.c (is_simple_unary_expr): Document FIXME on
	BIT_FIELD_REF nodes.
	* tree-ssa.c: Add whitespace.
	* testsuite/lib/c-torture.exp: Remove -ftree-ssa flag.

2002-06-03  Daniel Berlin  <dberlin@dberlin.org>

	* tree-cfg.c (insert_before_*):  For insertion into FOR_INIT's, if
	we have an expression statement, transform into a compound
	expression.
	Pick the right place to insert a statement by iterating until we
	have a first_exec_stmt (first_non_decl_stmt) that is really the
	first executable non decl statement.
	(insert_after_*): Ditto.

2002-06-03  Daniel Berlin  <dberlin@dberlin.org>

	* tree-ssa-pre.c: Update BB stuff to new basic block structure.
	Add some comments throughout (more coming, particularly describing
	the algorithm, rather than the implementation).
	(free_expr_info): Free refs as well.
	(defs_y_dom_x): Handle unary expressions as well.
	(insert_euse_in_preorder_dt_order_1): Use block of ref, not block
	of statement.
	Don't insert exit blocks if we hit them before hitting an
	occurrence (it's pointless).
	(rename_2): Return set of phi operands we touched, don't forget to
	free VARRAY's we allocated.
	(rename_1): Correct downsafety computation. Now get exact same
	results as Open64.
	Correct setting of has_real_use.
	(finalize_1): Fix up insertion.
	(code_motion): Fix up insertion.

	* tree-dfa.c (dump_varref):  Improve dumping of expression
	references.

2002-06-03  Diego Novillo  <dnovillo@redhat.com>

	* tree-cfg.c (delete_bb): Rename to tree_delete_bb.  Update callers.
	(tree_find_basic_blocks): Initializer last_basic_block.
	(create_bb): Update last_basic_block after creating a new block.
	(tree_cleanup_cfg): Delete unreachable blocks by traversing the
	linked list, not the array.  Update comments.
	(delete_bb): Update comments.
	(tree_dump_cfg): Also show last_basic_block.
	* tree-ssa.c (tree_build_ssa): Use last_basic_block instead of
	n_basic_blocks to allocate dominator arrays.
	(insert_phi_terms): Ditto.
	(search_fud_chains): User FOR_EACH_BB to look for dominator
	children.

2002-05-29  Diego Novillo  <dnovillo@redhat.com>

	* tree-cfg.c (tree_find_basic_blocks): Set next_bb and prev_bb for
	ENTRY_BLOCK_PTR and EXIT_BLOCK_PTR.
	(create_bb): Set flag BB_NEW for every newly created block.
	Call link_block to add the new block to the linked list.
	(tree_split_bb): Traverse basic blocks using FOR_EACH_BB.
	(make_goto_stmt_edges): Ditto.
	(remove_unreachable_blocks): Add reminder comment to stop
	compacting the basic block array every time a block is deleted.
	(delete_cfg): Traverse basic blocks using FOR_EACH_BB.
	(tree_dump_bb): Ditto.
	(tree_dump_cfg): Ditto.
	(tree_cfg2dot): Ditto.
	* tree-dfa.c (tree_find_varrefs): Ditto.
	(create_tree_ann): Ditto.
	(get_fcalls): Ditto.
	(find_declaration): Ditto.
	* tree-ssa.c (tree_build_ssa): Ditto.

2002-05-28  Diego Novillo  <dnovillo@redhat.com>

	* Makefile.in: Add -ftree-ssa to BOOT_CFLAGS.

2002-05-27  Diego Novillo  <dnovillo@redhat.com>

	* c-decl.c (c_expand_body): Close dump file before simplifying the
	function.
	* c-pretty-print.c (dump_c_node): Handle COMPLEX_CST,
	BIT_FIELD_REF, COMPLEX_EXPR, CONJ_EXPR, REALPART_EXPR,
	IMAGPART_EXPR and VA_ARG_EXPR nodes.
	Display all type casts, not just pointer casts.
	(op_prio): Handle LROTATE_EXPR, RROTATE_EXPR, REALPART_EXPR and
	IMAGPART_EXPR.
	* c-simplify.c: Include "tree-inline.h"
	(dump_file): New local variable.
	(dump_flags): New local variable.
	(stmt_expr_level): New local variable.
	(simplify_tree): Open and close dump file if
	-fdump-tree-simple-details is given.
	Initialize stmt_expr_level.
	(simplify_stmt): Dump statement before and after simplification if
	-fdump-tree-simple-detail is given.
	Unshare the expression of an EXPR_STMT before simplifying it.
	Call simplify_return_stmt to handle RETURN_STMT nodes.
	Do not simplify DECL_STMT nodes.
	Call stmt_has_effect before re-chaining side effects.
	(simplify_for_stmt): Do not return the simplified statement.
	Update all callers.
	Simplify FOR_BODY after the headers.
	Unshare loop header expressions before simplification.
	(simplify_while_stmt): Do not return the simplified statement.
	Update all callers.
	Simplify WHILE_BODY after the headers.
	Unshare the loop header expression before simplification.
	(simplify_do_stmt): Do not return the simplified statement.  Update
	all callers.
	Unshare the loop header expression before simplification.
	(simplify_if_stmt): Do not return the simplified statement.  Update
	all callers.
	Simplify the condition expression before the clauses.
	Unshare the condition expression before simplification.
	(simplify_switch_stmt): Do not return the simplified statement.
	Update all callers.
	Simplify the switch expression before the body.
	Unshare the switch expression before simplification.
	(simplify_decl_stmt): Remove.
	(simplify_expr): Remove argument 'needs_lvalue'.
	Add argument 'stmt'.
	Replace first argument 'expr' with a pointer to the
	expression 'expr_p'.
	Do not return the simplified expression.
	Update all callers and uses.
	Handle TRUTH_NOT_EXPR nodes.  Simplify SAVE_EXPR nodes into a
	SIMPLE id and remove the SAVE_EXPR node.
	Do not simplify BIT_FIELD_REF nodes.
	Remove code that tried to create new lvalues.
	(simplify_array_ref): Replace first argument 'expr' with a pointer
	to the expression 'expr_p'.
	Do not return the simplified expression.
	Add argument 'stmt'.
	Update all callers and uses.
	(simplify_self_mod_expr): Replace first argument 'expr' with a
	pointer to the expression 'expr_p'.
	Do not return the simplified expression.
	Add argument 'stmt'.
	Update all callers and uses.
	Call simplify_lvalue_expr to simplify a copy of the LHS into an
	lvalue for the new assignment.
	Simplify the new binary expression.
	(simplify_component_ref): Replace first argument 'expr' with a
	pointer to the expression 'expr_p'.
	Do not return the simplified expression.
	Add argument 'stmt'.
	Update all callers and uses.
	(simplify_call_expr): Ditto.
	(simplify_tree_list): Ditto.
	(simplify_cond_expr): Ditto.
	Build a replacement IF_STMT and call simplify_if_stmt() to process
	it.  Set the line number of the new statement from the statement
	containing the original expression.
	(simplify_modify_expr): Replace first argument 'expr' with a
	pointer to the expression 'expr_p'.
	Do not return the simplified expression.
	Add argument 'stmt'.
	Update all callers.
	Call simplify_lvalue_expr to simplify the LHS of the assignment.
	(simplify_boolean_expr): Replace first argument 'expr' with a
	pointer to the expression 'expr_p'.
	Do not return the simplified expression.
	Add argument 'stmt'.
	Update all callers.
	Build a new IF_STMT and simplify it all at once by calling
	simplify_if_stmt.
	(simplify_compound_expr): Replace first argument 'expr' with a
	pointer to the expression 'expr_p'.
	Do not return the simplified expression.
	Add argument 'stmt'.
	Update all callers.
	(simplify_expr_wfl): Ditto.
	(simplify_lvalue_expr): New function.
	(add_tree): Create a copy of each expression before adding it to
	the list.
	(deep_copy_node): Call copy_tree_r to copy expression nodes.
	(stmt_has_effect): Return nonzero if the statement may be the last
	statement of a statement expression body.
	(mostly_copy_tree_r): New function.
	* tree-dump.c (dump_options): Add 'details'.
	* tree-simple.c: Update documentation about ADDRESSOF expressions.
	(is_simple_stmt): Test for SIMPLE values when checking return
	statements.
	Accept all DECL_STMT nodes.
	(is_simple_compstmt): Return nonzero if T is NULL.  Do not test
	DECL_STMT nodes
	(is_simple_expr): Return nonzero if T is NULL.
	(is_simple_rhs): Ditto.
	(is_simple_modify_expr): Ditto.
	(is_simple_modify_expr_lhs): Ditto.
	(is_simple_binary_expr): Ditto.
	(is_simple_cond_expr): Ditto.
	(is_simple_unary_expr): Call STRIP_NOPS before testing T.
	Always accept ADDR_EXPR nodes.
	Always accept BIT_FIELD_REF nodes.
	(is_simple_call_expr): Return nonzero if T is NULL.
	(is_simple_const): Ditto.
	(is_simple_val): Ditto.
	(is_simple_compref): Ditto.
	(is_simple_compref_lhs): Ditto.
	(is_simple_cast): Ditto.
	(is_simple_cast_op): Ditto.
	(is_simple_id): Return nonzero if T is NULL.  Allow identifiers
	wrapped inside NON_LVALUE_EXPR and EXPR_WITH_FILE_LOCATION nodes.
	Allow real and imaginary parts of a complex variable.
	Allow compound literals.
	(is_simple_arrayref): Allow arrays of complex types.
	* tree.h (TDF_DETAILS): Define.
	* cp/pt.c (tsubst_template_parms): Check that 'parms' is non-NULL
	before calling TMPL_PARMS_DEPTH.
	* doc/invoke.texi: Document -fdump-tree-simple-details.

2002-05-10  Daniel Berlin  <dberlin@dberlin.org>

	* c-pretty-print.c (dump_c_node): Print "<unnamed whatever>" for
	types, variables, etc that have no name, rather than printing
	nothing.
	Handle PMF's properly.
	Print out structure initializers in a somewhat sensible way.
	Print SAVE_EXPR () around SAVE_EXPRs.
	(print_call_name): Handle EXPR_WITH_FILE_LOCATION.

2002-05-09  Daniel Berlin  <dberlin@dberlin.org>

	* tree-dfa.c (dump_varref): Tree inlining generates variables with
	no name. Don't crash on dumping varref's of them.

	* tree-inline.c (expand_call_inline): Generate a proper STMT_EXPR
	(it was missing COMPOUND_STMT).

2002-05-08  Daniel Berlin  <dberlin@dberlin.org>

	s/varref_type/treeref_type/g
	s/create_varref/create_ref/g

	* tree-flow.h: Add EXPRPHI, EXPRUSE, EXPRKILL, EXPRINJ.
	Add structures and macros for each.
	Add tree_perform_ssapre prototype.

	* Makefile.in (C_AND_OBJC_OBJS): Add tree-ssa-pre.o
	(tree-ssa-pre.o): Add dependencies for tree-ssa-pre.o

	* cp/Make-lang.in: Add tree-ssa-pre.o

	* flags.h: Add flag_tree_ssa_pre.

	* tree-ssa-pre.c: New file, SSA-PRE.

	* toplev.c: Add flag_tree_ssa_pre.
	(lang_independent_options): Add tree-ssa-pre.

	* tree-dump.c (dump_files): Add ssapre dump.

	* tree-optimize.c (optimize_tree): Do SSAPRE if requested.

	* tree.h (dump_index): Add TDI_ssa_pre.

	* tree-dfa.c (create_ref): Add support for creating the EXPR*'s refs.
	(dump_varref): Add support for dumping EXPR* refs.

	* tree-ssa.c (search_fud_chains): Add BB to VARDEF_PHI_CHAIN_BB.

2002-05-07  Diego Novillo  <dnovillo@redhat.com>

	* c-pretty-print.c (op_prio): Handle ABS_EXPR.
	Don't abort when the operand is not recognized.
	(op_symbol): Don't abort when the operand is not recognized.
	* c-simplify.c (simplify_expr): Remove 'const' qualifier from first
	argument.
	Do not copy incoming expression.
	Exclude handling of MODIFY_EXPR, INIT_EXPR, SAVE_EXPR and binary
	expression nodes.
	(simplify_array_ref): Remove 'const' qualifier from first argument.
	Do not copy the incoming expression.
	(simplify_self_mod_expr): Ditto.
	Do not simplify the first operand twice.
	(simplify_component_ref): Remove 'const' qualifier from first
	argument.  Do not copy the incoming expression.
	(simplify_call_expr): Ditto.
	(simplify_tree_list): Ditto.
	(simplify_cond_expr): Ditto.
	(simplify_modify_expr): Ditto.
	(simplify_boolean_expr): Ditto.
	(simplify_compound_expr): Ditto.
	(simplify_save_expr): Ditto.
	(simplify_expr_wfl): Ditto.
	(tree_build_scope): Re-write.  Do nothing if block already contains
	a scope.  Use chainon to chain the body with the scope closing
	node.
	(deep_copy_node): Do not check for NULL nodes.  Do not deep copy
	declarations, types and constants.

2002-05-06  Daniel Berlin  <dberlin@dberlin.org>

	* c-simplify.c (deep_copy_node): Don't copy DECL_STMT_DECL's.

2002-05-06  Daniel Berlin  <dberlin@dberlin.org>

	* tree-simple.c (is_simple_compstmt): Don't post-initialize
	statics or aggregate initializers.

	* c-simplify.c (simplify_decl_stmt): Ditto.

2002-05-06  Sebastian Pop  <s.pop@laposte.net>

	* Makefile.in (simple-break-elim.o, simple-goto-elim.o, tree-dchain.o):
	Added.
	* c-decl.c: Include tree-dchain.h
	(c_expand_body): Add entry point to the goto, break elimination
	after the simplification pass.
	* simple-break-elim.c: New file.
	* simple-goto-elim.c: New file.
	* tree-dchain.h: New file.
	* tree-dchain.c: New file.

2002-05-02  Diego Novillo  <dnovillo@redhat.com>

	* c-simplify.c (simplify_expr): Constify first argument.
	Always work on a copy of the input expression.
	Do not simplify COMPOUND_LITERAL_EXPR nor CONSTRUCTOR nodes.
	(simplify_array_ref): Constify first argument.  Always work on a
	copy of the input expression.
	(simplify_self_mod_expr): Ditto.
	(simplify_component_ref): Ditto.
	(simplify_call_expr): Ditto.
	(simplify_tree_list): Ditto.
	(simplify_cond_expr): Ditto.
	When building the THEN_CLAUSE and ELSE_CLAUSE for the new IF_STMT,
	create a scope for them and simplify the scope, not the expression.
	(simplify_modify_expr): Constify first argument.  Always work on a
	copy of the input expression.
	(simplify_boolean_expr): Ditto.
	(simplify_compound_expr): Ditto.
	(simplify_save_expr): Ditto.
	(simplify_expr_wfl): Ditto.
	* tree-cfg.c (tree_find_basic_blocks): Update comments for
	-fdump-tree-dot.
	(tree_dump_cfg): Ditto.
	* tree-dump.c (dump_files): Rename -fdump-tree-graphviz to
	-fdump-tree-dot.
	* tree-simple.c (is_simple_unary_expr): Do not handle &CONST
	expressions.
	Handle COMPOUND_LITERAL_EXPR and CONSTRUCTOR nodes.
	(is_simple_const): Strip NOPS and handle &CONST expressions.
	* tree.h (enum tree_dump_index): Remove references to GraphViz.
	* doc/invoke.texi: Update documentation for -fdump-tree-dot.

2002-05-02  Sebastian Pop  <s.pop@laposte.net>

	* c-pretty-print.c (dump_c_node): Don't print declarations
	from the SCOPE_STMT_BLOCK, use the DECL_STMT instead.

2002-04-30  Diego Novillo  <dnovillo@redhat.com>

	* c-pretty-print.c (NIY): Display an error string instead of aborting.
	(op_prio): Add support for COMPOUND_EXPR, TRUTH_XOR_EXPR, MIN_EXPR,
	MAX_EXPR and NON_LVALUE_EXPR.
	For EXPR_WITH_FILE_LOCATION nodes, return the priority of
	the internal node.
	(op_symbol): Add support for TRUTH_XOR_EXPR.
	* c-simplify.c (simplify_stmt): Only remove null statements that
	have been nullified by simplification.
	Call debug_tree() dump unhandled tree nodes.
	(simplify_for_stmt): Always deep-copy PRE_COND_S before adding it
	to PRE_P.
	(simplify_expr): When simplifying a MODIFY_EXPR node into an
	rvalue, return operand 0.
	Handle VA_ARG_EXPR, BIT_FIELD_REF and NON_LVALUE_EXPR nodes.
	Treat TRUTH_AND_EXPR, TRUTH_OR_EXPR and TRUTH_XOR_EXPR nodes as
	regular binary expressions.
	Call debug_tree() to dump an unhandled expression.
	(simplify_array_ref): Do not simplify the base of an array.
	(simplify_call_expr): Do not simplify calls to builtins.
	(simplify_cond_expr): Handle conditional expressions of type void.
	(simplify_boolean_expr): Return 'T != 0' instead of 'T'.
	(simplify_save_expr): Do not wrap statement trees inside SAVE_EXPR
	nodes.
	(tree_last_decl): Ignore FILE_STMT nodes preceding a SCOPE_STMT.
	* tree-simple.c: Update grammar to accept any valid C array as the
	array base.
	(is_simple_compstmt): Accept DECL_INITIAL expressions for read-only
	variables.
	(is_simple_expr): Do not abort if the incoming tree is NULL.
	(is_simple_modify_expr): Allow SAVE_EXPR, EXPR_WITH_FILE_LOCATION
	and NON_LVALUE_EXPR wrappers.
	(is_simple_binary_expr): Ditto.
	(is_simple_condexpr): Ditto.
	Accept TRUTH_AND_EXPR, TRUTH_OR_EXPR and TRUTH_XOR_EXPR.
	(is_simple_unary_expr): Do not abort it the incoming tree is NULL.
	Allow SAVE_EXPR, EXPR_WITH_FILE_LOCATION and NON_LVALUE_EXPR
	wrappers.
	Handle BIT_FIELD_REF and VA_ARG_EXPR nodes.
	(is_simple_call_expr): Always return 1 for builtin calls.
	(is_simple_arrayref): Do not check the array base.

2002-04-30  Daniel Berlin  <dberlin@dberlin.org>

	* c-simplify.c (simplify_call_expr): Don't try to simplify
	call_expr arglist if it's not there.

2002-04-27  Diego Novillo  <dnovillo@redhat.com>

	* c-decl.c (c_expand_body): Call simplify_tree to simplify a
	FUNCTION_DECL node.
	* c-simplify.c (simplify_tree): New function.
	(simplify_stmt): Remove variable 'new_vars'.  Update all called
	functions.
	Remove argument 'scope'.  Update all callers.
	Do not keep track of new scope statements as they are entered.
	Do not call declare_tmp_vars().
	(simplify_for_stmt): Remove argument new_vars_p.  Update all callers.
	(simplify_while_stmt): Ditto.
	(simplify_do_stmt): Ditto.
	(simplify_if_stmt): Ditto.
	(simplify_switch_stmt): Ditto.
	(simplify_decl_stmt): Reformat comments.
	(simplify_expr): Remove argument new_vars_p.  Update all callers.
	Call simplify_save_expr() to simplify SAVE_EXPR nodes.
	Call simplify_expr_wfl() to simplify EXPR_WITH_FILE_LOCATION nodes.
	Do not call is_unop() and is_binop() when checking for unary and
	binary operators.
	Do not return early after simplify statement-expressions.
	Do not call add_modify_stmt() to create assignment expressions.
	(simplify_array_ref): Remove argument new_vars_p.  Update all callers.
	(simplify_self_mod_expr): Ditto.
	(simplify_component_ref): Ditto.
	(simplify_call_expr): Ditto.
	(simplify_tree_list): Ditto.
	(simplify_cond_expr): Ditto.
	(simplify_modify_expr): Ditto.
	(simplify_boolean_expr): Ditto.
	(simplify_compound_expr): Ditto.
	(simplify_save_expr): New function.
	(simplify_expr_wfl): New function.
	(tree_build_scope): Reformat.
	(add_tree): Call stmt_has_effect() and expr_has_effect() to decide
	whether or not to add a new tree to the list.
	(add_modify_stmt): Remove.
	(create_tmp_var): Remove 'new_vars_p' argument.
	Call pushdecl() to insert the newly created variable in the current
	binding scope.
	(declare_tmp_vars): Do not create a BLOCK_VARS for the scope.
	(is_binop): Remove.
	(is_unop): Remove.
	(expr_has_effect): New function.
	* c-tree.h (simplify_tree): Remove second argument.
	* stmt.c (warn_if_unused_value): Check operand 0 of SAVE_EXPR
	nodes.
	* tree-dfa.c (find_refs_in_expr): Call find_refs_in_expr() to look
	inside an EXPR_WITH_FILE_LOCATION node.
	* tree-simple.c (is_simple_stmt): Add a case for SCOPE_STMT nodes.
	(is_simple_compstmt): Assume that T is the first tree in the
	compound statement's body.
	Stop when a scope ending SCOPE_STMT node is found.
	(is_simple_binary_expr): Don't call is_simple_binop().
	(is_simple_condexpr): Don't call is_simple_relop().
	(is_simple_binop): Remove.
	(is_simple_relop): Remove.
	(is_simple_unary_expr): Accept any operator with tree code class
	'1' followed by a simple value.
	Accept simple unary expressions wrapped inside SAVE_EXPR,
	EXPR_WITH_FILE_LOCATION and NON_LVALUE_EXPR nodes.
	(is_simple_id): Accept simple identifiers wrapped inside SAVE_EXPR,
	EXPR_WITH_FILE_LOCATION and NON_LVALUE_EXPR nodes.
	* tree-simple.h (create_tmp_var): Remove second argument.
	(is_simple_binop): Remove.
	(is_simple_relop): Remove.

2002-04-22  Diego Novillo  <dnovillo@redhat.com>

	* c-simplify.c (stmt_has_effect): New function.
	(simplify_stmt): Fix example code in comment.
	Use EXPR_STMT_EXPR to access the expression in an expression
	statement.
	Call debug_c_node to display unhandled statements.
	Call stmt_has_effect to determine whether the statement has been
	nullified by the simplification process.
	(simplify_for_stmt): Do not simplify the initialization expression
	if it's NULL.
	Do not convert post_cond_s into a statement chain.
	Do not simplify the expression if it's NULL.
	(simplify_switch_stmt): initialize post_cond_s to NULL before
	simplifying the expression.
	(simplify_expr): Rename argument IS_LHS to NEEDS_LVALUE.  Update
	all uses.
	When simplifying assignments, return the LHS of the assignment if
	the caller wants to use the assignment as an rvalue.
	Do not simplify ADDR_EXPR nodes.
	Handle NOP_EXPR, CONVERT_EXPR, FIX_TRUNC_EXPR, FIX_CEIL_EXPR,
	FIX_ROUND_EXPR, INDIRECT_REF, NEGATE_EXPR, INTEGER_CST, STRING_CST,
	COMPLEX_CST.
	Abort if the expression has not been simplified and cannot be used
	as an rvalue to assign it to a temporary.
	When creating a new temporary to hold an lvalue, if the expression
	is an indirect reference, use the address of the referenced object.
	When creating an indirect reference, use the pointed-to type as the
	type of the reference.
	(simplify_self_mod_expr): If the LHS operand needs to be
	simplified, simplify twice.  Once to produce an lvalue and another
	to produce a simple value.
	(simplify_modify_expr): Break assignment chains (a = b = c = ...)
	into individual assignments.
	(simplify_compound_expr):
	(create_tmp_var): If the type is an array, use TYPE_POINTER_TO as
	the pointer type.
	(update_line_number): Fix typo in comment.
	(is_unop): Ditto.
	(convert_to_stmt_chain): Only add statements that comply with
	stmt_has_effect().
	* tree-dfa.c (find_declaration): Fix typo in comment.
	(debug_varref): Ditto.
	* tree-flow.h: Ditto.
	* tree-simple.c (is_simple_stmt): New function.
	(is_simple_compstmt): New function.
	(is_simple_expr): Fix typo in comment.
	(is_simple_rhs): Allow conditional expressions.
	(is_simple_modify_expr): Fix typo in comment.
	(is_simple_modify_expr_lhs): Ditto.
	(is_simple_binary_expr): Ditto.
	(is_simple_condexpr): Ditto.
	(is_simple_relop): Ditto.
	(is_simple_unary_expr): Ditto.
	Allow taking the address of a constant (for strings).
	(is_simple_call_expr): Fix typo in comment.
	Call is_simple_id to determine if the first operand is a SIMPLE
	function identifier.
	(is_simple_arglist): Fix typo in comment.
	(is_simple_varname): Ditto.
	(is_simple_const): Don't accept casts of SIMPLE constants.
	(is_simple_id): Don't accept casts of SIMPLE identifiers.
	(is_simple_val): Fix typo in comment.
	(is_simple_arrayref): Ditto.
	(is_simple_compref): Ditto.
	(is_simple_compref_lhs): Ditto.
	(is_simple_cast_op): Ditto.
	(is_simple_exprseq): Allow NULL expression sequences.
	* tree-simple.h (is_simple_stmt): Declare
	(is_simple_compstmt): Declare.
	* tree-ssa.c (follow_chain): Fix typo in comment.

2002-04-22  Diego Novillo  <dnovillo@redhat.com>

	* c-pretty-print.c (dump_c_node): Don't print function
	bodies of FUNCTION_DECL nodes.

2002-04-19  Andreas Jaeger  <aj@suse.de>

	* Makefile.in (c-call-graph.o): New.

2002-04-18  Sebastian Pop  <s.pop@laposte.net>

	* c-pretty-print.c (PRINT_FUNCTION_NAME): Define.
	(dump_c_node): Call pretty_print_string to print string.
	Call print_call_name to print function names.
	(pretty_print_string): New function.
	(print_call_name): New function.

2002-04-17  Diego Novillo  <dnovillo@redhat.com>

	* c-simplify.c (simplify_do_stmt): Call is_simple_condexpr to test
	if the conditional is in SIMPLE form.
	(simplify_if_stmt): Ditto.

2002-04-17  Diego Novillo  <dnovillo@redhat.com>

	* c-pretty-print.c (dump_c_node): Handle escape sequences in strings.
	(op_symbol): Handle TRUTH_NOT_EXPR.
	* c-simplify.c: Rename 'after' with 'post' and 'before' with 'pre'
	everywhere.
	Re-group some functions and add comments.
	(simplify_stmt): Update calls to simplify_for_stmt,
	simplify_while_stmt, simplify_do_stmt and simplify_switch_stmt.
	Call simplify_if_stmt.
	Do not test if expression is in SIMPLE form before calling
	simplify_expr.
	Call convert_to_stmt_chain to emit statement trees for side effects
	found while simplifying.
	(simplify_for_stmt): Re-implement.  Do not change structure of the
	statement.  Simplify each header expression and emit side effects
	at sequence points.
	(simplify_while_stmt): Ditto.
	(simplify_do_stmt): Ditto.
	(simplify_switch_stmt): Ditto.
	(new_simplified_if): Rename to simplify_if_stmt.
	Call simplify_expr to simplify the conditional.
	(simplify_if_stmt): New name for new_simplified_if.
	(simplify_expr): Do not default simple_test_f to is_simple_expr.
	If simple_test_f is not set, abort.
	Handle COMPOUND_EXPR, MODIFY_EXPR, TRUTH_ANDIF_EXPR,
	TRUTH_ORIF_EXPR, SAVE_EXPR and EXPR_WITH_FILE_LOCATION.
	(simplify_arglist): Rename to simplify_tree_list.
	(simplify_tree_list): New name for simplify_arglist.
	(simplify_boolean_expr): New function.
	(simplify_compound_expr): New function.
	(tree_build_scope): Use SCOPE_BEGIN_P instead of TREE_LANG_FLAG_0
	to access scope operands.  Use COMPOUND_BODY instead of
	TREE_OPERAND to access the body of the compound statement.
	(add_tree): Use a TREE_LIST container instead of directly chaining the
	trees.
	(add_assignment_tree): Rename to add_modify_stmt.  Update all
	callers.
	(add_modify_stmt): New name for add_assignment_tree.
	(insert_before_continue_end): Do nothing it the tree to insert is
	NULL.
	(copy_stmt_chain): Rename to deep_copy_list.  Update all callers.
	(deep_copy_list): New name for copy_stmt_chain.
	(copy_stmt): Rename to deep_copy_node.  Update all callers.
	(deep_copy_node): New name for copy_stmt.  Handle TREE_LIST
	trees.
	(insert_before_first): New function.
	(is_binop): Add COMPOUND_EXPR.
	(convert_to_stmt_chain): New function.
	* tree-cfg.c (make_for_stmt_blocks): Fix comment.
	* tree-simple.c (is_simple_condexpr): New function.
	(is_simple_const): Allow casts of SIMPLE constants.
	(is_simple_id): Allow casts of SIMPLE identifiers.
	(is_simple_cast): Call is_simple_cast_op.
	(is_simple_cast_op): New function.
	(is_simple_exprseq): New function.
	* tree-simple.h (deep_copy_list): Declare.
	(deep_copy_node): Declare.
	(is_simple_cast_op): Declare.
	(is_simple_exprseq): Declare.

2002-04-03  Diego Novillo  <dnovillo@redhat.com>

	* c-simplify.c (simplify_expr): Add arguments simple_tree_f and
	is_lhs.  Update all callers.
	Call simplify_call_expr, simplify_cond_expr, simplify_arglist and
	simplify_modify_expr.
	Call is_unop and is_binop to check for unary and binary operators.
	(simplify_binary_expr): Remove.
	(simplify_call_expr): New function.
	(simplify_arglist): New function.
	(simplify_cond_expr): New function.
	(simplify_modify_expr): New function.
	(keep_stmt_p): Remove.
	(is_binop): New function.
	(is_unop): New function.
	(simplify_stmt): Don't call keep_stmt_p.
	(simplify_decl_stmt): Call add_assignment_tree.
	* tree-simple.c: Include c-tree.h
	Add expression-statements to the SIMPLE grammar.
	(is_simple_modify_expr_lhs): New function.
	(is_simple_modify_expr): Call it.
	(is_simple_relop): Update comment.
	(is_simple_unary_expr): Allow expression-statements.
	(is_simple_arglist): New function.
	(is_simple_call_expr): Call it.
	(is_simple_id): Accept expressions taking the address of a
	function.
	* tree-simple.h (is_simple_modify_expr_lhs): Declare.
	(is_simple_arglist): Declare.

2002-03-21  Diego Novillo  <dnovillo@redhat.com>

	* Makefile.in (c-simplify.o): Add dependency on varray.h.
	* c-simplify.c: Include varray.h.
	Remove comments with SIMPLE grammar.
	(simplify_array_ref): New.
	(simplify_self_mod_expr): New.
	(simplify_component_ref): New.
	(add_assignment_tree): New.
	(simplify_expr): Call simplify_array_ref to simplify array
	references.
	Call simplify_self_mod_expr to simplify ++, --, += and -=
	expressions.
	Call simplify_component_ref to simplify references to structures.
	(simplify_binary_expr): Do not check whether the expression is
	already in SIMPLE form.
	* tree-simple.c: Document changes from original SIMPLE grammar.
	(is_simple_unary_expr): Add check for *ID.
	(is_simple_call_expr): Update comments.
	(is_simple_const): Ditto.
	(is_simple_id): Do not accept *ID expressions.
	(is_simple_val): Update comments.
	(is_simple_arrayref): Accept any variable name as the base address.
	(is_simple_compref_lhs): New.
	(is_simple_compref): Call it.
	* tree-simple.h (is_simple_compref_lhs): Declare.

2002-03-18  Diego Novillo  <dnovillo@redhat.com>

	* Makefile.in (C_AND_OBJC_OBJS): Add tree-simple.o
	(tree-simple.o): New rule.
	* c-simplify.c (simplified_p): Remove.
	(simplified_rec_p): Remove.
	(simplified_condition_p): Remove.
	(simplify_for_stmt): Call is_simple_expr instead of
	simplified_condition_p.
	(simplify_while_stmt): Ditto.
	(simplify_do_stmt): Call is_simple_expr instead of simplified_p.
	(new_simplified_if): Call is_simple_expr instead of
	simplified_rec_p.
	(simplify_decl_stmt): Update comment.
	(simplify_expr): Return the original expression if it's already
	in SIMPLE form.
	Do not special case most binary and unary expressions.
	When simplifying array references, create temporary variables to
	hold the base address for the array.
	Simplify COMPONENT_REF expressions separately.
	Call simplify_binary_expr to handle most binary expressions.
	(simplify_binary_expr): New function.
	(keep_stmt_p): Call is_simple_unary_expr to determine whether the
	statement should be kept or not.
	* tree-simple.c: New file.
	* tree-simple.h (is_simple_expr): Declare.
	(is_simple_rhs): Declare.
	(is_simple_modify_expr): Declare.
	(is_simple_binary_expr): Declare.
	(is_simple_binop): Declare.
	(is_simple_relop): Declare.
	(is_simple_unary_expr): Declare.
	(is_simple_call_expr): Declare.
	(is_simple_const): Declare.
	(is_simple_id): Declare.
	(is_simple_varname): Declare.
	(is_simple_val): Declare.
	(is_simple_arrayref): Declare.
	(is_simple_compref): Declare.
	(is_simple_cast): Declare.
	* cp/Make-lang.in (CXX_C_OBJS): Add tree-simple.o

2002-03-18  Diego Novillo  <dnovillo@redhat.com>

	* tree-simple.h: New file.
	* Makefile.in (c-simplify.o): Add dependency on tree-simple.h
	* c-simplify.c: Reformat some comments.
	(tree_last_decl): Declare.

2002-03-18  Sebastian Pop  <s.pop@laposte.net>

        * c-simplify.c (insert_stmt_chain): Delete.
        (simplified_condition_p, insert_after_case_labels): New.
	(simplify_stmt, simplify_for_stmt, simplify_while_stmt,
	simplify_do_stmt, new_simplified_if, simplify_switch_stmt):
	Returns a single node, generate a chain of statements to be executed
	before the if, and a list of new variables.
        (new_simplified_if): Simplify clauses.
        (simplify_expr): Remove unused parameter scope.

2002-03-14  Sebastian Pop  <s.pop@laposte.net>

	* c-simplify.c (simplify_switch_stmt, simplify_expr): Add scope
	parameter.
	(simplify_while_stmt, simplify_do_stmt, simplify_for_stmt): Avoid
	negating loop condition during simplification.
	(new_simplified_if): Don't simplify the IF_BODY.
	(copy_stmt_chain): Use copy_stmt.
	(copy_stmt): New function.

2002-02-28  Sebastian Pop  <s.pop@laposte.net>

	* tree-dfa.c (find_refs_in_stmt): Changed if/else statements in
	a switch.

2002-02-28  Sebastian Pop  <s.pop@laposte.net>

	* c-simplify.c (simplify_if_stmt): Deleted.
	(new_simplified_if): New function.
	(make_type_writable): New function.
	(insert_before_continue_end): New function.
	(insert_before_continue): New function.
	(copy_stmt_chain): New function.
	(insert_stmt_chain): New function.
	(update_line_number): New function.
	(simplified_p): New function.
	(simplified_rec_p) New function.
	(simplify_stmt): Modify the way to call simplification
	of COMPOUND_STMT, FOR_STMT, WHILE_STMT, DO_STMT, IF_STMT,
	and SCOPE_STMT in order to avoid to execute the code after
	the switch.  Add FILE_STMT, LABEL_STMT, GOTO_STMT, ASM_STMT cases.
	Simplified a little the code after the switch.
	(simplify_for_stmt): Change functions parameters.
	Add code to simplify the FOR_INIT_STMT, FOR_COND, FOR_EXPR.
	(simplify_while_stmt): Change functions parameters.
	Add code to simplify the WHILE_COND.
	(simplify_do_stmt): Change functions parameters.
	Add code to simplify the DO_COND.
	(simplify_switch_stmt): Change functions parameters.
	(simplify_expr): Remove scope parameter.
	Avoid to introduce a new temporary variable for an expression
	that is already simplified.
	([ARRAY|COMPONENT]_REF, COND_EXPR): Handle them apart.
	(TRUTH_ANDIF_EXPR, TRUTH_ORIF_EXPR): Avoid to evaluate the second
	operand if the value can be deduced from the first one.
	(keep_stmt_p): Add some other cases in which we don't need to keep
	a statement after its simplification.

2002-02-28  Sebastian Pop  <s.pop@laposte.net>

	* Makefile.in: Add c-call-graph.o dependence.
	* c-call-graph.c: New file.
	* c-decl.c (c_expand_body): Add an entry point for call-graph.
	* tree-dump.c (dump_files): Add the flag dump-call-graph.
	* tree.h (tree_dump_index): Add TDI_xml.

2002-02-28  Sebastian Pop  <s.pop@laposte.net>

	* c-pretty-print.c (dump_c_tree): Declare it extern.
	(dump_c_node): Declare it extern.
	(dump_c_scope_vars): Deleted, some code moved in print_declaration ().
	(print_declaration): New function.
	(print_function_decl): New function.
	(print_struct_decl): New function.
	(INDENT_PRINT_C_NODE): Deleted.
	(INDENT): New macro.
	(NIY): Define the macro body in a block.
	(dump_c_node): Add dumping for TREE_PURPOSE operand in TREE_LIST.
	[VOID|INTEGER|REAL|COMPLEX|VECTOR|ENUMERAL|BOOLEAN|CHAR]_TYPE nodes:
	insert some code from print-tree.c:print_node_brief () in order to
	stabilise the type printing.
	[RECORD|UNION]_TYPE nodes: Don't print their contents by default,
	move the existing code in print_struct_decl ().
	[POSTDECREMENT|POSTINCREMENT]_EXPR: Print the operand in post postion.
	[MIN|MAX|ABS]_EXPR: New code for printing these nodes.
	FOR_STMT: Don't print the FOR_BODY if it is not present.
	RETURN_STMT: Don't print the return expression for a void function.
	ASM_STMT: New code for printing this node.
	SCOPE_STMT: Use print_declaration instead of dump_c_scope_vars.
	COMPOUND_LITERAL_EXPR: Add the node as not implemented yet.
	(op_prio): Fix switch indent.
	Add node EXPR_WITH_FILE_LOCATION with priority 16.
	(op_symbol): Fix switch indent.

2002-01-25  Diego Novillo  <dnovillo@redhat.com>

	* Makefile.in (c-pretty-print.o): Add dependency on errors.h.
	* c-decl.c (c_expand_body): React to -ftree-dump-simple.
	* c-pretty-print.c: Fix typo in header comment.
	(NYI): Flush output buffer, dump the tree and abort.
	(dump_c_node): Add unparsing code for ERROR_MARK, IDENTIFIER_NODE,
	ARRAY_TYPE, UNION_TYPE, STRING_CST, CEIL_DIV_EXPR, FLOOR_DIV_EXPR,
	ROUND_DIV_EXPR, TRUNC_MOD_EXPR, FLOOR_MOD_EXPR, ROUND_MOD_EXPR,
	RDIV_EXPR, EXACT_DIV_EXPR, LROTATE_EXPR, RROTATE_EXPR,
	BIT_ANDTC_EXPR, BIT_NOT_EXPR, UNORDERED_EXPR, SAVE_EXPR and
	EXPR_WITH_FILE_LOCATION.
	Unify unparsing code for common binary and unary expressions.
	Handle indirect references like any other unary expression.
	(dump_c_scope_vars): Remove unused variable 'context'.
	Call dump_c_node to print the type.
	(dump_c_indirect_ref): Remove.
	(op_prio): New function.
	(op_symbol): New function.
	* c-simplify.c (simplify_stmt): Do not simplify a return
	expression, only its second operand.
	Fix capitalization in error message.
	(simplify_expr): Add documentation.
	Fix capitalization in error message.
	* tree-dump.c (dump_files): Add entry for -fdump-tree-simple.
	(dump_options): Add entry for -unparse.
	* tree.h (TDI_simple): Define.
	(TDF_UNPARSE): Define.
	* doc/invoke.texi: Document -fdump-tree-simple.

2002-01-23  Sebastian Pop  <s.pop@laposte.net>

        * c-pretty-print.c: Clean C++ comments.
	(debug_output_buffer): Remove declaration and definition.
        * diagnostic.h (debug_output_buffer): Add declaration.
	* diagnostic.c (debug_output_buffer): Add definition.

2002-01-21  Diego Novillo  <dnovillo@redhat.com>

	* tree-dfa.c (find_refs_in_stmt): Fix capitalization in error
	message.
	(find_refs_in_expr): Ditto.

2002-01-20  Diego Novillo  <dnovillo@redhat.com>
            Sebastian Pop  <s.pop@laposte.net>

	* Makefile.in: Add c-simplify.o.
	* cp/Make-lang.in: Ditto.
	* c-decl.c (c_expand_body): Call simplify_stmt() before
	calling optimize_tree().
	* c-simplify.c: New file.
	* c-tree.h (simplify_stmt): Declare.
	(print_c_tree)
	* tree-dfa.c (find_refs_in_stmt): Fix error message for unhandled
	statement codes.

2002-01-20  Sebastian Pop  <s.pop@laposte.net>

	* Makefile.in: Add c-pretty-print.o.
	* cp/Make-lang.in: Ditto.
	* c-pretty-print.c: New file.
	* c-tree.h (print_c_tree): Declare.
	(print_c_node): Declare.
	(debug_c_tree): Declare.
	(debug_c_node): Declare.

2001-12-29  Diego Novillo  <dnovillo@redhat.com>

	* c-lang.c (c_post_options): Move code to enable tree-ssa
	if -Wuninitialized is used ...
	* c-common.c (c_common_post_options): ... here.

2001-12-29  Diego Novillo  <dnovillo@redhat.com>

	* Makefile.in (tree-optimize.o): Don't depend on c-common.h
	* tree-cfg.c: Don't include c-tree.h.  Explain why we need to
	include c-common.h.
	* tree-dfa.c: Explain why we need to include c-common.h.
	* tree-ssa.c: Ditto.
	* tree-optimize.c: Don't include c-common.h

2001-12-21  Nathan Sidwell  <nathan@codesourcery.com>

	Revert my patch of 2001-07-23 for the moment.

2001-10-15  Diego Novillo  <dnovillo@redhat.com>

	* tree-dfa.c (create_varref): If the new reference is inside a
	statement, add it to the list of references for that statement.

2001-10-14  Diego Novillo  <dnovillo@redhat.com>

	* Merge from mainline:

	Tue Sep 11 11:37:52 CEST 2001  Jan Hubicka  <jh@suse.cz>

		* basic-block.h (cached_make_edge): New.
		(make_edge): Remove first parameter.
		* flow.c (cached_make_edge): Rename from make_edge; return
		newly created edge; use obstack allocation.
		(make_edge): New.
		(flow_call_edges_add): Updaet make_edge call.
		(add_noreturn_fake_exit_edges): Likewise.
		(connect_infinite_loops_to_exit): Liekwise.
		(make_label_edge, make_edges, find_sub_basic_blocks): Use
		cached_make_edge.
		* profile.c (branch_prob): Update make_edge call.
		* ssa-dce.c (ssa_eliminate_dead_code): Likewise.

2001-10-14  Diego Novillo  <dnovillo@redhat.com>

	* Makefile.in (tree-ssa.o): Remove dependency on flags.h.
	(tree-optimize.o): Add dependency on flags.h.
	* bb-reorder.c (fixup_reorder_chain): Update call to make_edge.
	* c-lang.c (c_post_options): Set flag_tree_ssa if -Wuninitialized
	is given.
	* ifcvt.c (find_if_case_1): Update call to make_edge.
	* toplev.c (toplev_main): Do not warn about -Wuninitialized without
	-O if -ftree-ssa is used.
	* tree-cfg.c (dot_dump_file): Remove.
	(dot_dump_flags): Remove.
	(cfg_dump_file): Rename to dump_file.
	(cfg_dump_flags): Rename to dump_flags.
	(remove_bb_ann): New function.
	(tree_find_basic_blocks): Do not open dump files at the beginning
	of the function.
	Do not call delete_cfg.
	Create annotations for ENTRY_BLOCK_PTR and EXIT_BLOCK_PTR.
	(make_for_stmt_blocks): Update FOR_INIT_STMT_BB and FOR_COND_BB
	when creating the header blocks.
	Create the blocks for the loop body before the expression block.
	(make_while_stmt_blocks): Update END_WHILE_BB when creating the
	header blocks.
	Create the blocks for the loop body before the end-while block.
	(make_do_stmt_blocks): Update DO_COND_BB when creating header
	blocks.
	Create the blocks for the loop body before the block for DO_COND.
	(create_bb): When creating loop header blocks, allocate space for
	the header_blocks union.
	Call create_bb_ann to create a new annotation.
	(remove_bb_ann): New function.
	(tree_split_bb): New function.
	(make_edges): Remove first argument from call to make_edge,
	make_ctrl_stmt_edges, make_exit_edges, make_for_stmt_edges,
	make_while_stmt_edges, make_do_stmt_edges, make_if_stmt_edges,
	make_goto_stmt_edges, make_break_stmt_edges and
	make_continue_stmt_edges.
	When creating edges for the default label, remove the fallthru edge
	that was created for the associated SWITCH_STMT entry block.
	Do not call delete_unreachable_blocks.
	Call tree_cleanup_cfg.
	(make_ctrl_stmt_edges): Remove first argument.
	(make_exit_edges): Remove first argument.
	If the last element of the block is an EXPR_STMT, assume that it is
	the call to a non-returning function and make an edge to the exit
	block.
	Do not call make_return_stmt_edges.  Call make_edge directly.
	(make_for_stmt_edges): Remove first argument.
	Simplify the graph for infinite and zero-iteration loops.
	(make_while_stmt_edges): Remove first argument.
	Simplify the graph for infinite and zero-iteration loops.
	(make_do_stmt_edges): Remove first argument.
	Simplify the graph for infinite and one-iteration loops.
	(make_if_stmt_edges): Remove first argument.
	Simplify the graph for always-true and always-false conditionals.
	(make_goto_stmt_edges): Remove first argument.
	(make_break_stmt_edges): Remove first argument.
	(make_continue_stmt_edges): Remove first argument.
	(make_return_stmt_edges): Remove.
	(tree_cleanup_cfg): New function.
	(delete_unreachable_blocks): Do not react to -Wunreachable-code.
	Write to dump file blocks that have been removed.
	Call remove_edge.
	(is_ctrl_altering_stmt): If the statement contains a call to a
	non-returning function, return 1.
	(delete_cfg): Call remove_bb_ann.  Also remove annotations for
	ENTRY_BLOCK_PTR and EXIT_BLOCK_PTR.
	(latch_block): Use WHILE_COND_BB instead of END_WHILE_BB.
	(insert_stmt_tree_before): Use cfg_dump_file instead of dump_file.
	(insert_before_ctrl_stmt): Ditto.
	(insert_before_normal_stmt): Ditto.
	(insert_stmt_tree_after): Ditto.
	(insert_after_ctrl_stmt): Ditto.
	(insert_after_normal_stmt): Ditto.
	(replace_expr_in_tree): Ditto.
	(insert_bb_before): Ditto.
	* tree-dfa.c (tree_find_varrefs): Call find_refs_in_expr when the
	tree is not a statement.
	(find_refs_in_stmt): Update comments.
	Do not deal with FOR_STMT and DO_STMT trees separately.
	When processing VAR_DECLs, call find_refs_in_expr with the
	declaration, not its initial value.
	(find_refs_in_expr): When processing COMPONENT_REFs and ARRAY_REFs,
	recurse using the same reference type that was given by the
	original caller.
	(create_varref): Insert new PHI terms at the beginning of the
	BB_REFS array, not the end.
	* tree-flow.h (struct for_header_blocks): Declare.
	(union header_blocks): Declare.
	(struct bb_ann_def): Add new field 'loop_hdr'.
	(BB_ANN): Re-define so that it can be used as an lvalue.
	(BB_PARENT): Ditto.
	(BB_REFS): Ditto.
	(BB_PREV_CHAIN): Ditto.
	(BB_BINDING_SCOPE): Ditto.
	(BB_LOOP_HDR): Define.
	(FOR_INIT_STMT_BB): Redefine using BB_LOOP_HDR.
	(FOR_COND_BB): Ditto.
	(FOR_EXPR_BB): Ditto.
	(DO_COND_BB): Ditto.
	(END_WHILE_BB): New name for WHILE_COND_BB.
	(tree_warn_uninitialized): Declare.
	(tree_cleanup_cfg): Declare.
	(tree_split_bb): Declare.
	* tree-optimize.c: Include flags.h.
	(init_tree_flow): New function.
	(optimize_tree): Call build_tree_ssa instead of building SSA
	in-place.
	(build_tree_ssa): New function.
	* tree-optimize.h (build_tree_ssa): Declare.
	* tree-ssa.c: Don't include toplev.h
	(tree_warn_uninitialized): Define.
	(tree_compute_rdefs): Do not call is_upward_exposed.  Instead
	traverse all the uses of each variable and warn if the use is
	reached by the ghost definition.

2001-10-10  Graham Stott  <grahams@redhat.com>

	* tree-cfg.c (create_bb): Add new binding_scope parameter which allows
	the binding scope either to be explicitly specified if non-zero.
	(make_blocks): Update call to create_bb.
	(make_for_stmt_blocks): Ditto.
	(make_while_stmt_blocks): Ditto.
	(make_do_stmt_blocks): Ditto.
	(make_if_stmt_blocks): Ditto.
	(make_switch_stmt_blocks): Ditto.
	(create_maximal_bb): Ditto.
	(make_edges): If a statement expression is in the last basic
        block create an edge to EXIT_BLOCK_PTR and not the next block.
	(insert_before_normal_stmt): Pass the appropriate binding scope to
	create_bb.

2001-10-01  Graham Stott  <grahams@redhat.com>
            Diego Novillo  <dnovillo@redhat.com>

	* tree-optimize.c (optimize_tree): Early return if the program has
	errors.

2001-09-30  Diego Novillo  <dnovillo@redhat.com>

	* tree-optimize.c (optimize_tree): Compute reaching definitions
	after building SSA.

2001-09-30  Diego Novillo  <dnovillo@redhat.com>

	* tree-cfg.c (insert_after_ctrl_stmt): Remove unused argument.
	(make_blocks): Pop top element from scope binding stack when an end
	of scope statement is found.
	(create_bb): Remove code for popping top element from scope binding
	stack.
	Do not push basic block 0 to initialize scope binding stack.
	(insert_stmt_tree_after): Remove unused argument from call to
	insert_after_ctrl_stmt.
	(tree_dump_bb): Dump BB_BINDING_SCOPE if defined.
	* doc/invoke.texi: Document debugging option -ftree-dump-ssa-rdefs.

2001-09-29  Diego Novillo  <dnovillo@redhat.com>

	* Makefile.in (tree-ssa.o): Update dependencies.
	(tree-cfg.o): Ditto.
	(tree-optimize.o): Ditto.
	* basic-block.h (BB_CONTROL_EXPR): Define.
	(BB_CONTROL_ENTRY): Define.
	* c-common.h (TDF_RDEFS): Define.
	* c-dump.c (dump_option_value_in): Add entry for TDF_RDEFS.
	* tree-cfg.c: Include flags.h and c-tree.h
	(binding_stack): New local variable.
	(delete_block): Rename to delete_bb.
	(tree_find_basic_blocks): Initialize varray 'binding_stack'.
	Call make_blocks with an additional argument.
	Adjust size of varray 'basic_block_info' after building CFG.
	(make_blocks): Add new argument prev_chain_p.
	Update all callers and callees.
	Create sub-graphs for statement-expressions.
	Update prev_chain_p when accessing the next tree in the chain.
	(make_for_stmt_blocks): Add new argument prev_chain_p.
	Update all callers and callees.
	Update flags for control header blocks with BB_CONTROL_ENTRY and/or
	BB_CONTROL_EXPR.
	(make_while_stmt_blocks): Ditto.
	(make_do_stmt_blocks): Ditto.
	(make_if_stmt_blocks): Ditto.
	(make_switch_stmt_blocks): Ditto.
	(create_maximal_bb): Add new argument prev_chain_p.
	Update all callers and callees.
	(create_bb): Add new argument prev_chain_p.
	Push basic block 0 the first time into the binding scope stack.
	Associate the new basic block to the binding scope at the top of
	the binding stack.
	Push new binding scopes when a SCOPE_BEGIN statement is found.
	Pop the top binding scope when a SCOPE_END statement is found.
	(make_edges): Handle statement expressions.
	Handle case labels preceded by scope statements in switch
	statements.
	(make_for_stmt_edges): Use FOR_INIT_STMT_BB, FOR_COND_BB and
	FOR_EXPR_BB to access the header basic blocks.
	(delete_unreachable_blocks): Call delete_bb instead of
	delete_block.
	(delete_block): Rename to delete_bb.
	(block_invalidates_loop): Use data references to find calls to
	non-pure functions.
	(is_ctrl_stmt): Reformat.
	(loop_body): New function.
	(set_loop_body): New function.
	(stmt_starts_bb_p): Statement expression trees also start a new
	basic block.
	(delete_cfg): Call VARRAY_FREE to delete all the references in each
	basic block.
	(latch_block): Use FOR_EXPR_BB, WHILE_COND_BB and DO_COND_BB to
	find out the latch block for the loop.
	(last_exec_stmt): New function.
	(is_exec_stmt): Scope statements that begin a scope are also
	considered executables.
	(is_statement_expression): New function.
	(first_non_decl_stmt): New function.
	(first_decl_stmt): New function.
	(first_non_label_in_bb): New function.
	(insert_stmt_tree_before): New function.
	(insert_before_ctrl_stmt): New function.
	(insert_before_normal_stmt): New function.
	(insert_stmt_tree_after): New function.
	(insert_after_ctrl_stmt): New function.
	(insert_after_normal_stmt): New function.
	(insert_after_loop_body): New function.
	(replace_expr_in_tree): New function.
	(find_expr_in_tree): New function.
	(insert_bb_before): New function.
	(tree_dump_bb): Display the contents of BB_PREV_CHAIN_P.
	* tree-dfa.c (tree_find_varrefs): Use accessor macros for array
	'referenced_symbols'.
	(find_refs_in_stmt): Do not process error_mark_node trees.
	Handle statement-expression nodes as any other statement tree.
	Do not call find_refs_in_stmt_expr.
	(find_refs_in_stmt_expr): Remove.
	(add_ref_to_sym): Remove.
	(add_ref_to_bb): Remove.
	(find_refs_in_expr): Do not process error_mark_node trees.
	ADDR_EXPR trees are not variable references except if used in a
	CALL_EXPR node.
	Handle EXPR_WITH_FILE_LOCATION nodes.
	(create_varref): Remove variable 'is_new'.
	Initialize data-flow arrays VARDEF_IMM_USES, VARDEF_RUSES,
	VARDEF_PHI_CHAIN and VARUSE_RDEFS.
	Do not call add_ref_to_sym and add_ref_to_bb.
	(add_ref_symbol): Use accessor macros for varray
	'referenced_symbols'.
	(function_may_recurse_p): New function.
	(get_fcalls): New function.
	(find_declaration): New function.
	(dump_varref): Handle NULL values of VARREF_EXPR.
	Use VARDEF_PHI_CHAIN instead of VARPHI_CHAIN.
	(dump_varref_list): Check if the list is NULL before traversing it.
	* tree-flow.h (struct vardef): Add fields 'ruses', 'marked' and
	'phi_chain'.
	(VARDEF_RUSES): Define.
	(VARDEF_MARKED): Define.
	(VARDEF_PHI_CHAIN): Define.
	(VARPHI_CHAIN): Remove.
	(struct varphi): Remove.
	(struct varuse): Add field 'rdefs'.
	(VARUSE_RDEFS): Define.
	(union varref_def): Remove field 'phi'.
	(IS_GHOST_DEF): Define.
	(IS_ARTIFICIAL_REF): Define.
	(struct bb_ann_def): Add fields 'prev_chain_p' and 'binding_scope'.
	(BB_PREV_CHAIN_P): Define.
	(BB_BINDING_SCOPE): Define.
	(FOR_INIT_STMT_BB): Define.
	(FOR_COND_BB): Define.
	(FOR_EXPR_BB): Define.
	(WHILE_COND_BB): Define.
	(DO_COND_BB): Define.
	(IF_COND_BB): Define.
	(CASE_COND_BB): Define.
	(NREF_SYMBOLS): Define.
	(REF_SYMBOL): Define.
	(ADD_REF_SYMBOL): Define.
	(FCALL_NON_PURE): Define.
	(FCALL_PURE): Define.
	(FCALL_BUILT_IN): Define.
	(loop_body): Declare.
	(set_loop_body): Declare.
	(last_exec_stmt): Declare.
	(is_statement_expression): Declare.
	(first_non_decl_stmt): Declare.
	(first_decl_stmt): Declare.
	(first_non_label_in_bb): Declare.
	(insert_stmt_tree_before): Declare.
	(insert_stmt_tree_after): Declare.
	(replace_expr_in_tree): Declare.
	(find_expr_in_tree): Declare.
	(insert_bb_before): Declare.
	(function_may_recurse_p): Declare.
	(get_fcalls): Declare.
	(find_declaration): Declare.
	(tree_compute_rdefs): Declare.
	(analyze_rdefs): Declare.
	(is_upward_exposed): Declare.
	* tree-optimize.c (optimize_tree): Update name for varray
	referenced_symbols.
	Free varray referenced_symbols and call delete_ssa on exit.
	* tree-ssa.c: Include flags.h, diagnostic.h and toplev.h.
	(tree_build_ssa): Create ghost definitions before building FUD
	chains.
	(insert_phi_terms): Use accessor macros for 'referenced_symbols'.
	Ignore ghost definitions when placing PHI terms.
	(build_fud_chains): Call get_tree_ann to create an annotation for
	the symbol if it doesn't already have one.
	(search_fud_chains): Reformat comments.
	Do not initialize varray VARDEF_IMM_USES.
	If a successor basic block does not have references, continue on to
	the next one, do not stop.
	Do not initialize varray VARDEF_PHI_CHAIN.
	(delete_ssa): New function.
	(delete_refs): New function.
	(tree_compute_rdefs): New function.
	(analyze_rdefs): New function.
	(follow_chain): New function.
	(is_upward_exposed): New function.

2001-09-14  Diego Novillo  <dnovillo@redhat.com>

	* tree-cfg.c (tree_find_basic_blocks): Remove call to
	mark_critical_edges.
	(create_maximal_bb): Do not create annotations for non-executable
	statements.
	(map_stmt_to_bb): Rename basic_block_ann with bb_ann.
	(delete_cfg): Ditto.
	(is_exec_stmt): Reformat.
	(create_bb_ann): New function.
	* tree-dfa.c (create_node): Remove.
	(ref_symbols_list): Remove.
	(create_tree_ann): Declare.
	(referenced_symbols): Declare.
	(tree_find_varrefs): Replace usage of linked lists with variable
	arrays.
	(create_varref): Remove second argument from call to
	add_ref_symbol.
	Update comments.
	(add_ref_to_sym): Replace usage of linked lists with variable
	arrays.
	Declare static.
	(add_ref_to_bb): Ditto.
	(add_ref_symbol): Ditto.
	(dump_varref_list): Ditto.
	(debug_varref_list): Ditto.
	(create_varref_list): Remove.
	(push_ref): Remove.
	(create_node): Remove.
	(delete_varref_list): Remove.
	(get_tree_ann): Call create_tree_ann if the tree doesn't have an
	annotation already.
	(create_tree_ann): New function.
	* tree-flow.h (varref_list_def): Remove.
	(vardef): Change type of field 'imm_uses' to 'varray_type'.
	(varphi): Change type of field 'phi_chain' to 'varray_type'.
	(varref_node_def): Remove.
	(varref_node): Remove.
	(VARREF_NODE_ELEM): Remove.
	(VARREF_NODE_NEXT): Remove.
	(VARREF_NODE_PREV): Remove.
	(varref_list_def): Remove.
	(varref_list): Remove.
	(VARREF_LIST_FIRST): Remove.
	(VARREF_LIST_LAST): Remove.
	(tree_ann_def): Change type of field 'refs' to 'varray_type'.
	(basic_block_ann_def): Rename to 'bb_ann_def'.
	Change type of field 'refs' to 'varray_type'.
	(basic_block_ann): Rename to 'bb_ann'.
	(ref_symbols_list): Remove.
	(referenced_symbols): Declare.
	(add_ref_to_sym): Remove.
	(add_ref_to_bb): Remove.
	(add_ref_symbol): Remove.
	(remove_ann_from_sym): Remove.
	(create_varref_list): Remove.
	(push_ref): Remove.
	(delete_varref_list): Remove.
	(debug_varref_list): Update argument type to be 'varray_type'.
	(dump_varref_list): Ditto.
	* tree-optimize.c: Include 'basic-block.h'.
	(optimize_tree): Replace references to 'ref_symbols_list' with
	'referenced_symbols'.
	Remove call to delete_varref_list.
	* tree-ssa.c (insert_phi_terms): Rename 'work_list' to
	'work_stack'.
	Use VARRAY_PUSH and VARRAY_TOP to access 'work_stack' instead of
	maintaining the stack pointer in 'work_list_top'.
	Remove code to grow 'work_stack'.
	Remove references to 'work_list_top'.
	Replace references to 'ref_symbols_list' with 'referenced_symbols'.
	(build_fud_chains): Replace references to 'ref_symbols_list' with
	'referenced_symbols'.
	(search_fud_chains): If there are no variable references in the
	basic block, return early.
	Change usage of linked lists with variable arrays.

2001-09-07  Diego Novillo  <dnovillo@redhat.com>

	* tree-cfg.c (tree_find_basic_blocks): Document how to traverse
	trees inside a basic block.
	(make_for_stmt_blocks): Make sure that there is always a block for
	FOR_EXPR, even if the loop does not have an expression.
	Create a separate block for FOR_INIT_STMT.
	(make_while_stmt_blocks): Always create an "end_while" block.
	(make_if_stmt_blocks): Do not store IF_COND in the header block of
	an IF statement.
	(make_for_stmt_edges): Create an edge from the block header to the
	block for FOR_INIT_STMT.
	Determine the first block of the loop body calling BB_FOR_STMT on
	the first executable statement in the body.
	Remove the special case for missing FOR_EXPR trees.
	(make_while_stmt_edges): Create a back edge from the end_while
	block to the header block.
	Determine the first block of the loop body calling BB_FOR_STMT on
	the first executable statement in the body.
	(make_do_stmt_edges): Determine the first block of the loop body
	calling BB_FOR_STMT on the first executable statement in the body.
	(condition_block): Rename to latch_block.  Return the latch
	block for the given loop header.
	(make_continue_stmt_edges): Rename condition_block to
	latch_block.
	(successor_block): Ditto.
	* tree-flow.h (condition_block): Rename to latch_block.

2001-09-06  Diego Novillo  <dnovillo@redhat.com>

	* tree-dfa.c (tree_find_varrefs): Use TDF_REFS instead of TDF_VARREF.
	* tree-flow.h (TDF_VARREF): Remove.

2001-09-04  Nathan Sidwell  <nathan@codesourcery.com>

	* c-common.h (tree_dump_index): Add more comments.
	(TDF_REFS): New dump flag.
	* c-dump.c (dump_files): Name flags `tree' rather than `ast'.
	(dump_option_value_info): New struct.
	(dump_options): New array.
	(dump_switch_p): Parse switch options symbolically.
	* doc/invoke.texi (-fdump-ast): Rename to ...
	(-fdump-tree): ... here. Document options are symbolic, and
	not all are applicable. Combine ssa related flags into the other
	tree dump flags.

2001-08-27  Diego Novillo  <dnovillo@redhat.com>

	* Makefile.in (tree-ssa.o): Update dependencies.
	(tree-cfg.o): Ditto.
	(tree-dfa.o): Ditto.
	(tree-optimize.o): Ditto.

2001-08-26  Diego Novillo  <dnovillo@redhat.com>

	* Makefile.in (C_AND_OBJC_OBJS): Replace tree-opt.o with
	tree-optimize.o.
	(c-decl.o): Ditto.
	(tree-ssa.o): Ditto.
	(tree-cfg.o): Ditto.
	(tree-dfa.o): Ditto.
	(tree-opt.o): Ditto.
	* c-decl.c: Replace tree-opt.h with tree-optimize.h.
	(c_expand_body): Remove call to init_tree_opt.
	* flow.c (flow_loop_dump): Do not display insn UIDs if this is not
	an RTL basic block.
	* tree-cfg.c: Replace tree-opt.h with tree-optimize.h.
	(block_invalidates_loop): New local function.
	(validate_loops): New function.
	(tree_dump_bb): Display the loop depth of the block.
	* tree-dfa.c: Replace tree-opt.h with tree-optimize.h.
	* tree-flow.h (validate_loops): Declare.
	* tree-opt.c: Rename to tree-optimize.c.
	* tree-opt.h: Rename to tree-optimize.h.
	* tree-optimize.c: Rename from tree-opt.c.
	* tree-optimize.h: Rename from tree-opt.h.
	* tree-ssa.c: Replace tree-opt.h with tree-optimize.h.
	(tree_build_ssa): Call tree_dump_bb instead of tree_debug_bb.
	* cp/Make-lang.in: Replace tree-opt.h with tree-optimize.h.

2001-08-20  Diego Novillo  <dnovillo@redhat.com>

	* basic-block.h (basic_block): Remove field 'reachable'.
	Add new field 'flags'.
	(BB_REACHABLE): Define.
	* c-common.h (tree_dump_index): Add TDI_cfg, TDI_dot, TDI_ssa.
	* c-decl.c (c_decode_option): Skip '-f' prefix before calling
	dump_switch_p.
	* c-dump.c (dump_file_info): Add entries for -fdump-tree-cfg,
	-fdump-tree-graphviz and -fdump-tree-ssa.
	* flow.c (find_unreachable_blocks): Use BB_REACHABLE bit in bb->flags
	instead of bb->reachable.
	(delete_unreachable_blocks): Ditto.
	* tree-cfg.c: Minor formatting changes throughout the file.
	(DEBUG_TREE_FLOW): Remove.
	(debug_tree_flow): Remove.
	(cfg_dump_file): New local variable.
	(dot_dump_file): New local variable.
	(cfg_dump_flags): New local variable.
	(dot_dump_flags): New local variable.
	(tree_find_basic_blocks): Remove unused arguments.
	Add code to react to -fdump-tree-cfg and -fdump-tree-graphviz.
	Remove uses of DEBUG_TREE_FLOW.
	(delete_unreachable_blocks): Use BB_REACHABLE bit in bb->flags
	instead of bb->reachable.
	(tree_dump_cfg): New.
	(tree_debug_cfg): Call tree_dump_cfg().
	(tree_cfg2dot): Accept a FILE pointer instead of a file name as
	argument.
	Name the graph with the current function name.
	* tree-dfa.c: Minor formatting changes throughout the file.
	(DEBUG_TREE_DFA): Remove.
	(debug_tree_dfa): Remove.
	(dump_file): New local variable.
	(dump_flags): New local variable.
	(tree_find_varrefs): Add code to react to -fdump-tree-ssa.
	Remove uses of DEBUG_TREE_DFA.
	(find_refs_in_expr): Remove uses of DEBUG_TREE_DFA.
	(create_varref): Replace VARREF_BLOCK with VARREF_BB.
	* tree-flow.h: Minor formatting changes throughout the file.
	(VARREF_BLOCK): Rename to VARREF_BB.
	(VARREF_NEXT): Remove.
	(VARREF_PREV): Remove.
	(TDF_VARREF): Define.
	(tree_find_basic_blocks): Remove unused arguments.
	(tree_dump_cfg): Declare.
	(tree_cfg2dot): Change argument to FILE *.
	* tree-opt.c: Minor formatting changes throughout the file.
	(optimize_tree): Remove unused arguments in call to
	tree_find_basic_blocks().
	* tree-opt.h: Ditto.
	* tree-ssa.c: Minor formatting changes throughout the file.
	(DEBUG_TREE_SSA): Remove.
	(debug_tree_ssa): Remove.
	(dump_file): New local variable.
	(dump_flags): New local variable.
	(tree_build_ssa): Add code to react to -fdump-tree-ssa.
	Remove uses of DEBUG_TREE_SSA.
	(insert_phi_terms): Remove uses of DEBUG_TREE_SSA.
	* doc/invoke.texi: Add documentation for -fdump-tree-cfg,
	-fdump-tree-graphviz and -fdump-tree-ssa.
	Replace existing references to -fdump-tree with -fdump-ast.

2001-08-10  Diego Novillo  <dnovillo@redhat.com>

	* basic-block.h (basic_block): Add new field 'reachable'.
	(expunge_block): Declare.
	* flow.c (ENTRY_BLOCK_PTR): Initialize field 'reachable'.
	(EXIT_BLOCK_PTR): Ditto.
	(expunge_block): Remove static declaration.
	(cleanup_cfg): Clear bb->aux on every basic block.
	(find_unreachable_blocks): Use field 'reachable' when computing
	reachability.
	(delete_unreachable_blocks): Use field 'reachable'.

	* tree-cfg.c: Rename all instance of 'node' with 'block.
	(get_successor_block): Rename to successor_block.
	(make_compound_stmt_edges): Remove.
	(make_switch_stmt_edges): Remove.
	(delete_unreachable_blocks): New.
	(delete_block): New.
	(make_blocks): Add new argument 'compound_stmt'.  Do not include
	COMPOUND_STMT trees in the flowgraph.
	(make_for_stmt_blocks): Include FOR_INIT_STMT in the entry block of
	the loop.
	If FOR_COND does not exist, create a tree holding the constant 1.
	Add new argument 'compound_stmt'.
	(make_while_stmt_blocks): Include WHILE_COND in the entry block of
	the loop.
	Add new argument 'compound_stmt'.
	(make_do_stmt_blocks): Add new argument 'compound_stmt'.
	(make_if_stmt_blocks): Add new argument 'compound_stmt'.
	Include IF_COND in the IF header block.
	(make_switch_stmt_blocks): Add new argument 'compound_stmt'.
	Include SWITCH_COND in the SWITCH header block.
	(create_maximal_bb): Remove argument 'is_loop_header'.
	Add new argument 'compound_stmt'.
	Update all callers.
	Return the newly created basic block instead of its last statement.
	Update comments.
	Do not store control flow altering statements in bb->exit_stmt.
	Only add executable statements to the block.
	Annotate with 'compound_stmt' each tree added to the block.
	(create_bb): Do not update annotation 'is_loop_header'.
	(make_edges): Remove naive reachability analysis.
	When a label node is found, add an edge from the immediately
	enclosing switch statement.
	Call delete_unreachable_blocks() after adding all the edges.
	(make_ctrl_stmt_edges): Do not consider COMPOUND_STMT trees.
	Do nothing for SWITCH_STMT trees.
	(make_exit_edges): Use bb->end_tree instead of BB_EXIT_STMT.
	(make_for_stmt_edges): Remove code that added edges for the block
	holding FOR_INIT_STMT.
	Update comments.
	Do not consider the case where FOR_COND is NULL.
	Call first_exec_stmt() to determine if FOR_BODY is empty.
	Only create an edge from expr_bb to cond_bb if FOR_EXPR is
	non-null.
	(make_while_stmt_edges): Remove code that added edges for the block
	holding WHILE_COND.
	Update comments.
	Call first_exec_stmt() to determine if WHILE_BODY is empty.
	(make_do_stmt_edges): Call first_exec_stmt() to determine if
	DO_BODY is empty.
	(make_if_stmt_edges): Remove code that added edges for the block
	holding IF_COND.
	Call first_exec_stmt() to determine if THEN_CLAUSE or ELSE_CLAUSE
	are empty.
	(make_switch_stmt_edges): Remove.
	(make_goto_stmt_edges): Use bb->end_tree instead of BB_EXIT_STMT.
	(make_break_stmt_edges): Use bb->end_tree instead of BB_EXIT_STMT.
	Call switch_parent() and loop_parent() to determine if the
	statement is inside an appropriate control structure.
	(make_continue_stmt_edges): Use bb->end_tree instead of
	BB_EXIT_STMT.
	(make_return_stmt_edges): Ditto.
	(get_successor_block): Rename to successor_block.
	Call first_exec_stmt() to find the first executable statement in
	TREE_CHAIN.
	(is_ctrl_stmt): Do not consider COMPOUND_STMT trees.
	(stmt_starts_bb_p): Ditto.
	(stmt_ends_bb_p): Reformat comments.
	(delete_cfg): Reformat comments.
	(find_loop_parent): Rename to loop_parent.
	(get_condition_block): Rename to condition_block.
	Update to use new index numbers for control structure header
	blocks.
	(switch_parent): New.
	(first_exec_stmt): New.
	(is_exec_stmt): New.
	(tree_cfg2dot): Reformat comments.
	* tree-dfa.c (find_refs): Remove.
	(find_refs_in_stmt): New
	(find_refs_in_stmt_expr): New.
	(tree_find_varrefs): Look for variables doing a CFG traversal
	instead of the trees.  Remove both arguments.
	(find_refs_in_expr): Add new argument 'bb'.
	Update all recursive calls.
	(create_varref): Abort if the basic block 'bb' is NULL.
	(add_ref_to_sym): Reformat comments.
	(add_ref_symbol): Ditto.
	(delete_varref_list): Ditto.
	* tree-flow.h (struct tree_ann_def): Add 'compound_stmt'.
	(TREE_COMPOUND_STMT): New macro.
	(struct basic_block_ann_def): Remove 'exit_stmt' and
	'is_loop_header'.
	(BB_EXIT_STMT): Remove.
	(BB_IS_LOOP_HEADER): Remove.
	* tree-opt.c (optimize_tree): Call tree_find_varrefs() with no
	arguments.
	Only build DFA and SSA information if n_basic_blocks is greater
	than zero.
	* tree-ssa.c: Rename all instances of 'node' with 'block'.
	(tree_build_ssa): Reformat comments.
	(insert_phi_terms): Ditto.

2001-08-01  Diego Novillo  <dnovillo@redhat.com>

	* tree-cfg.c (USE_TREE_IL): Remove.
	(make_back_edges): Remove.
	(make_fallthru_edge): Remove.
	(get_outermost_scope_block): Remove.
	(is_last_block_of_loop): Remove.
	(tree_find_basic_blocks): Do not return early if 'errorcount' is set.
	(make_edges): Do not treat back edges as a separate case.
	Do not call make_fallthru_edge to create fall-through edges.
	Do not emit a warning for unreachable blocks containing a single
	closing brace.
	(make_do_stmt_edges): Update comment.
	(make_goto_stmt_edges): Do not call get_outermost_scope_block().
	(make_break_stmt_edges): Do not call get_outermost_scope_block().
	Do not call make_back_edges().
	(make_continue_stmt_edges): Call find_loop_parent().  Emit an error
	if the 'continue' statement is not inside a loop.  Call
	get_condition_block() to find the target node.
	(make_return_stmt_edges): Do not call get_outermost_scope_block().
	(get_successor_block): Return EXIT_BLOCK_PTR if 'bb' is the last
	block in the graph.
	Return the condition node of the loop if 'bb' doesn't have a
	natural successor and its parent is a loop header.
	(tree_cfg2dot): Output fake edges with dotted lines.
	* tree-dfa.c (USE_TREE_IL): Remove.
	* tree-opt.c (USE_TREE_IL): Remove.
	* tree-ssa.c (USE_TREE_IL): Remove.
	* tree-flow.h (is_last_block_of_loop): Remove.

2001-07-23  Diego Novillo  <dnovillo@redhat.com>

	* Makefile.in (C_AND_OBJC_OBJS): Add tree-cfg.o, tree-dfa.o,
	tree-ssa.o and tree-opt.o.
	(c-decl.o): Add dependency on tree-opt.h
	(tree-ssa.o): New rule.
	(tree-cfg.o): New rule.
	(tree-dfa.o): New rule.
	(tree-opt.o): New rule.
	* c-decl.c: Include tree-opt.h.
	(c_expand_body): Call optimize_tree() when the -ftree-ssa flag is
	given.
	* flags.h (flag_tree_ssa): Declare.
	* toplev.c (flag_tree_ssa): Define.
	(lang_independent_options): Add -ftree-ssa.
	* tree-cfg.c: New file.
	* tree-dfa.c: New file.
	* tree-flow.h: New file.
	* tree-opt.c: New file.
	* tree-opt.h: New file.
	* tree-ssa.c: New file.
	* cp/Make-lang.in (CXX_C_OBJS): Add tree-cfg.o, tree-dfa.o,
	tree-opt.o and tree-ssa.o.
	* doc/invoke.texi: Add documentation for -ftree-ssa.

2001-07-23  Nathan Sidwell  <nathan@codesourcery.com>

	* Makefile.in (calls.o): Depend on intl.h.
	* calls.c: Include intl.h.
	(ECF_NEED_STACK_FRAME, ECF_NEED_ARG_FRAME): New flags.
	(special_function_p): Detect when we need a stack or arg
	frame. Don't optimize on length.
	(setjmp_call_p): Remove.
	(uninlinable_call_p): New function.
	* tree.h (setjmp_call_p): Remove.
	(uninlinable_call_p): Declare.

2001-07-22  Nathan Sidwell  <nathan@codesourcery.com>

	* params.def (PARAM_MAX_INLINE_AST): New parameter.
	(PARAM_ARG_INLINE_AST): New parameter.
	* doc/invoke.texi (max-inline-ast, arg-inline-ast): Document
	parameters.

Local Variables:
mode: change-log
change-log-default-name: "ChangeLog.tree-ssa"
End:
